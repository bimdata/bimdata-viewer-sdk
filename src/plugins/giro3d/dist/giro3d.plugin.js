!function(){try{if("undefined"!=typeof document){var t=document.createElement("style");t.appendChild(document.createTextNode(".bimdata-giro3d[data-v-fd5ecc76]{width:100%;height:100%;position:relative;overflow:hidden}.bimdata-giro3d__viewer[data-v-fd5ecc76]{width:100%;height:100%;display:block;touch-action:none}")),document.head.appendChild(t)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}}();
/**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
const t="135",e={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},r={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},n=0,i=1,a=2,o=1,s=2,l=3,u=0,c=1,h=2,d=0,f=1,p=2,m=3,g=4,v=5,y=100,x=101,_=102,w=103,b=104,M=200,S=201,T=202,E=203,A=204,R=205,P=206,C=207,I=208,L=209,O=210,D=0,k=1,F=2,N=3,U=4,B=5,z=6,G=7,j=0,V=1,H=2,W=0,q=1,X=2,Y=3,Z=4,K=5,J=300,Q=301,$=302,tt=303,et=304,rt=306,nt=307,it=1e3,at=1001,ot=1002,st=1003,lt=1004,ut=1005,ct=1006,ht=1007,dt=1008,ft=1009,pt=1010,mt=1011,gt=1012,vt=1013,yt=1014,xt=1015,_t=1016,wt=1017,bt=1018,Mt=1019,St=1020,Tt=1021,Et=1022,At=1023,Rt=1024,Pt=1025,Ct=At,It=1026,Lt=1027,Ot=1028,Dt=1029,kt=1030,Ft=1031,Nt=1032,Ut=1033,Bt=33776,zt=33777,Gt=33778,jt=33779,Vt=35840,Ht=35841,Wt=35842,qt=35843,Xt=36196,Yt=37492,Zt=37496,Kt=37808,Jt=37809,Qt=37810,$t=37811,te=37812,ee=37813,re=37814,ne=37815,ie=37816,ae=37817,oe=37818,se=37819,le=37820,ue=37821,ce=36492,he=37840,de=37841,fe=37842,pe=37843,me=37844,ge=37845,ve=37846,ye=37847,xe=37848,_e=37849,we=37850,be=37851,Me=37852,Se=37853,Te=2300,Ee=2301,Ae=2302,Re=2400,Pe=2401,Ce=2402,Ie=2500,Le=2501,Oe=2,De=3e3,ke=3001,Fe=3007,Ne=3002,Ue=3004,Be=3005,ze=3006,Ge=3201,je=0,Ve=1,He=7680,We=35044,qe=35048,Xe="300 es";class Ye{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const r=this._listeners;void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const r=this._listeners[t];if(void 0!==r){const t=r.indexOf(e);-1!==t&&r.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const r=e.slice(0);for(let e=0,n=r.length;e<n;e++)r[e].call(this,t);t.target=null}}}const Ze=[];for(let t=0;t<256;t++)Ze[t]=(t<16?"0":"")+t.toString(16);let Ke=1234567;const Je=Math.PI/180,Qe=180/Math.PI;function $e(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(Ze[255&t]+Ze[t>>8&255]+Ze[t>>16&255]+Ze[t>>24&255]+"-"+Ze[255&e]+Ze[e>>8&255]+"-"+Ze[e>>16&15|64]+Ze[e>>24&255]+"-"+Ze[63&r|128]+Ze[r>>8&255]+"-"+Ze[r>>16&255]+Ze[r>>24&255]+Ze[255&n]+Ze[n>>8&255]+Ze[n>>16&255]+Ze[n>>24&255]).toUpperCase()}function tr(t,e,r){return Math.max(e,Math.min(r,t))}function er(t,e){return(t%e+e)%e}function rr(t,e,r){return(1-r)*t+r*e}function nr(t){return 0==(t&t-1)&&0!==t}function ir(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function ar(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var or=Object.freeze({__proto__:null,DEG2RAD:Je,RAD2DEG:Qe,generateUUID:$e,clamp:tr,euclideanModulo:er,mapLinear:function(t,e,r,n,i){return n+(t-e)*(i-n)/(r-e)},inverseLerp:function(t,e,r){return t!==e?(r-t)/(e-t):0},lerp:rr,damp:function(t,e,r,n){return rr(t,e,1-Math.exp(-r*n))},pingpong:function(t,e=1){return e-Math.abs(er(t,2*e)-e)},smoothstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*(3-2*t)},smootherstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(Ke=t%2147483647),Ke=16807*Ke%2147483647,(Ke-1)/2147483646},degToRad:function(t){return t*Je},radToDeg:function(t){return t*Qe},isPowerOfTwo:nr,ceilPowerOfTwo:ir,floorPowerOfTwo:ar,setQuaternionFromProperEuler:function(t,e,r,n,i){const a=Math.cos,o=Math.sin,s=a(r/2),l=o(r/2),u=a((e+n)/2),c=o((e+n)/2),h=a((e-n)/2),d=o((e-n)/2),f=a((n-e)/2),p=o((n-e)/2);switch(i){case"XYX":t.set(s*c,l*h,l*d,s*u);break;case"YZY":t.set(l*d,s*c,l*h,s*u);break;case"ZXZ":t.set(l*h,l*d,s*c,s*u);break;case"XZX":t.set(s*c,l*p,l*f,s*u);break;case"YXY":t.set(l*f,s*c,l*p,s*u);break;case"ZYZ":t.set(l*p,l*f,s*c,s*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}});class sr{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,r=this.y,n=t.elements;return this.x=n[0]*e+n[3]*r+n[6],this.y=n[1]*e+n[4]*r+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,r=this.y-t.y;return e*e+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const r=Math.cos(e),n=Math.sin(e),i=this.x-t.x,a=this.y-t.y;return this.x=i*r-a*n+t.x,this.y=i*n+a*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}sr.prototype.isVector2=!0;class lr{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,r,n,i,a,o,s,l){const u=this.elements;return u[0]=t,u[1]=n,u[2]=o,u[3]=e,u[4]=i,u[5]=s,u[6]=r,u[7]=a,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this}extractBasis(t,e,r){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const r=t.elements,n=e.elements,i=this.elements,a=r[0],o=r[3],s=r[6],l=r[1],u=r[4],c=r[7],h=r[2],d=r[5],f=r[8],p=n[0],m=n[3],g=n[6],v=n[1],y=n[4],x=n[7],_=n[2],w=n[5],b=n[8];return i[0]=a*p+o*v+s*_,i[3]=a*m+o*y+s*w,i[6]=a*g+o*x+s*b,i[1]=l*p+u*v+c*_,i[4]=l*m+u*y+c*w,i[7]=l*g+u*x+c*b,i[2]=h*p+d*v+f*_,i[5]=h*m+d*y+f*w,i[8]=h*g+d*x+f*b,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],l=t[7],u=t[8];return e*a*u-e*o*l-r*i*u+r*o*s+n*i*l-n*a*s}invert(){const t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],l=t[7],u=t[8],c=u*a-o*l,h=o*s-u*i,d=l*i-a*s,f=e*c+r*h+n*d;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);const p=1/f;return t[0]=c*p,t[1]=(n*l-u*r)*p,t[2]=(o*r-n*a)*p,t[3]=h*p,t[4]=(u*e-n*s)*p,t[5]=(n*i-o*e)*p,t[6]=d*p,t[7]=(r*s-l*e)*p,t[8]=(a*e-r*i)*p,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,r,n,i,a,o){const s=Math.cos(i),l=Math.sin(i);return this.set(r*s,r*l,-r*(s*a+l*o)+a+t,-n*l,n*s,-n*(-l*a+s*o)+o+e,0,0,1),this}scale(t,e){const r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=e,r[4]*=e,r[7]*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),n=this.elements,i=n[0],a=n[3],o=n[6],s=n[1],l=n[4],u=n[7];return n[0]=e*i+r*s,n[3]=e*a+r*l,n[6]=e*o+r*u,n[1]=-r*i+e*s,n[4]=-r*a+e*l,n[7]=-r*o+e*u,this}translate(t,e){const r=this.elements;return r[0]+=t*r[2],r[3]+=t*r[5],r[6]+=t*r[8],r[1]+=e*r[2],r[4]+=e*r[5],r[7]+=e*r[8],this}equals(t){const e=this.elements,r=t.elements;for(let t=0;t<9;t++)if(e[t]!==r[t])return!1;return!0}fromArray(t,e=0){for(let r=0;r<9;r++)this.elements[r]=t[r+e];return this}toArray(t=[],e=0){const r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}function ur(t){if(0===t.length)return-1/0;let e=t[0];for(let r=1,n=t.length;r<n;++r)t[r]>e&&(e=t[r]);return e}lr.prototype.isMatrix3=!0;const cr={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function hr(t,e){return new cr[t](e)}function dr(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function fr(t,e=0){let r=3735928559^e,n=1103547991^e;for(let e,i=0;i<t.length;i++)e=t.charCodeAt(i),r=Math.imul(r^e,2654435761),n=Math.imul(n^e,1597334677);return r=Math.imul(r^r>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507)^Math.imul(r^r>>>13,3266489909),4294967296*(2097151&n)+(r>>>0)}let pr;class mr{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===pr&&(pr=dr("canvas")),pr.width=t.width,pr.height=t.height;const r=pr.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height),e=pr}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}}let gr=0;class vr extends Ye{constructor(t=vr.DEFAULT_IMAGE,e=vr.DEFAULT_MAPPING,r=at,n=at,i=ct,a=dt,o=At,s=ft,l=1,u=De){super(),Object.defineProperty(this,"id",{value:gr++}),this.uuid=$e(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=r,this.wrapT=n,this.magFilter=i,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=s,this.offset=new sr(0,0),this.repeat=new sr(1,1),this.center=new sr(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new lr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const n=this.image;if(void 0===n.uuid&&(n.uuid=$e()),!e&&void 0===t.images[n.uuid]){let e;if(Array.isArray(n)){e=[];for(let t=0,r=n.length;t<r;t++)n[t].isDataTexture?e.push(yr(n[t].image)):e.push(yr(n[t]))}else e=yr(n);t.images[n.uuid]={uuid:n.uuid,url:e}}r.image=n.uuid}return"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),e||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==J)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case it:t.x=t.x-Math.floor(t.x);break;case at:t.x=t.x<0?0:1;break;case ot:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case it:t.y=t.y-Math.floor(t.y);break;case at:t.y=t.y<0?0:1;break;case ot:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&this.version++}}function yr(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?mr.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}vr.DEFAULT_IMAGE=void 0,vr.DEFAULT_MAPPING=J,vr.prototype.isTexture=!0;class xr{constructor(t=0,e=0,r=0,n=1){this.x=t,this.y=e,this.z=r,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,r,n){return this.x=t,this.y=e,this.z=r,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,r=this.y,n=this.z,i=this.w,a=t.elements;return this.x=a[0]*e+a[4]*r+a[8]*n+a[12]*i,this.y=a[1]*e+a[5]*r+a[9]*n+a[13]*i,this.z=a[2]*e+a[6]*r+a[10]*n+a[14]*i,this.w=a[3]*e+a[7]*r+a[11]*n+a[15]*i,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,r,n,i;const a=.01,o=.1,s=t.elements,l=s[0],u=s[4],c=s[8],h=s[1],d=s[5],f=s[9],p=s[2],m=s[6],g=s[10];if(Math.abs(u-h)<a&&Math.abs(c-p)<a&&Math.abs(f-m)<a){if(Math.abs(u+h)<o&&Math.abs(c+p)<o&&Math.abs(f+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,s=(d+1)/2,v=(g+1)/2,y=(u+h)/4,x=(c+p)/4,_=(f+m)/4;return t>s&&t>v?t<a?(r=0,n=.707106781,i=.707106781):(r=Math.sqrt(t),n=y/r,i=x/r):s>v?s<a?(r=.707106781,n=0,i=.707106781):(n=Math.sqrt(s),r=y/n,i=_/n):v<a?(r=.707106781,n=.707106781,i=0):(i=Math.sqrt(v),r=x/i,n=_/i),this.set(r,n,i,e),this}let v=Math.sqrt((m-f)*(m-f)+(c-p)*(c-p)+(h-u)*(h-u));return Math.abs(v)<.001&&(v=1),this.x=(m-f)/v,this.y=(c-p)/v,this.z=(h-u)/v,this.w=Math.acos((l+d+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this.w=t.w+(e.w-t.w)*r,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}xr.prototype.isVector4=!0;class _r extends Ye{constructor(t,e,r={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new xr(0,0,t,e),this.scissorTest=!1,this.viewport=new xr(0,0,t,e),this.texture=new vr(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:t,height:e,depth:1},this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.internalFormat=void 0!==r.internalFormat?r.internalFormat:null,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:ct,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0!==r.stencilBuffer&&r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}setTexture(t){t.image={width:this.width,height:this.height,depth:this.depth},this.texture=t}setSize(t,e,r=1){this.width===t&&this.height===e&&this.depth===r||(this.width=t,this.height=e,this.depth=r,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}_r.prototype.isWebGLRenderTarget=!0;class wr extends _r{constructor(t,e,r){super(t,e);const n=this.texture;this.texture=[];for(let t=0;t<r;t++)this.texture[t]=n.clone()}setSize(t,e,r=1){if(this.width!==t||this.height!==e||this.depth!==r){this.width=t,this.height=e,this.depth=r;for(let n=0,i=this.texture.length;n<i;n++)this.texture[n].image.width=t,this.texture[n].image.height=e,this.texture[n].image.depth=r;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this.texture.length=0;for(let e=0,r=t.texture.length;e<r;e++)this.texture[e]=t.texture[e].clone();return this}}wr.prototype.isWebGLMultipleRenderTargets=!0;class br extends _r{constructor(t,e,r={}){super(t,e,r),this.samples=4,this.ignoreDepthForMultisampleCopy=void 0===r.ignoreDepth||r.ignoreDepth,this.useRenderToTexture=void 0!==r.useRenderToTexture&&r.useRenderToTexture,this.useRenderbuffer=!1===this.useRenderToTexture}copy(t){return super.copy.call(this,t),this.samples=t.samples,this.useRenderToTexture=t.useRenderToTexture,this.useRenderbuffer=t.useRenderbuffer,this}}br.prototype.isWebGLMultisampleRenderTarget=!0;class Mr{constructor(t=0,e=0,r=0,n=1){this._x=t,this._y=e,this._z=r,this._w=n}static slerp(t,e,r,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),r.slerpQuaternions(t,e,n)}static slerpFlat(t,e,r,n,i,a,o){let s=r[n+0],l=r[n+1],u=r[n+2],c=r[n+3];const h=i[a+0],d=i[a+1],f=i[a+2],p=i[a+3];if(0===o)return t[e+0]=s,t[e+1]=l,t[e+2]=u,void(t[e+3]=c);if(1===o)return t[e+0]=h,t[e+1]=d,t[e+2]=f,void(t[e+3]=p);if(c!==p||s!==h||l!==d||u!==f){let t=1-o;const e=s*h+l*d+u*f+c*p,r=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const i=Math.sqrt(n),a=Math.atan2(i,e*r);t=Math.sin(t*a)/i,o=Math.sin(o*a)/i}const i=o*r;if(s=s*t+h*i,l=l*t+d*i,u=u*t+f*i,c=c*t+p*i,t===1-o){const t=1/Math.sqrt(s*s+l*l+u*u+c*c);s*=t,l*=t,u*=t,c*=t}}t[e]=s,t[e+1]=l,t[e+2]=u,t[e+3]=c}static multiplyQuaternionsFlat(t,e,r,n,i,a){const o=r[n],s=r[n+1],l=r[n+2],u=r[n+3],c=i[a],h=i[a+1],d=i[a+2],f=i[a+3];return t[e]=o*f+u*c+s*d-l*h,t[e+1]=s*f+u*h+l*c-o*d,t[e+2]=l*f+u*d+o*h-s*c,t[e+3]=u*f-o*c-s*h-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const r=t._x,n=t._y,i=t._z,a=t._order,o=Math.cos,s=Math.sin,l=o(r/2),u=o(n/2),c=o(i/2),h=s(r/2),d=s(n/2),f=s(i/2);switch(a){case"XYZ":this._x=h*u*c+l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c-h*d*f;break;case"YXZ":this._x=h*u*c+l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c+h*d*f;break;case"ZXY":this._x=h*u*c-l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c-h*d*f;break;case"ZYX":this._x=h*u*c-l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c+h*d*f;break;case"YZX":this._x=h*u*c+l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c-h*d*f;break;case"XZY":this._x=h*u*c-l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c+h*d*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const r=e/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,r=e[0],n=e[4],i=e[8],a=e[1],o=e[5],s=e[9],l=e[2],u=e[6],c=e[10],h=r+o+c;if(h>0){const t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(u-s)*t,this._y=(i-l)*t,this._z=(a-n)*t}else if(r>o&&r>c){const t=2*Math.sqrt(1+r-o-c);this._w=(u-s)/t,this._x=.25*t,this._y=(n+a)/t,this._z=(i+l)/t}else if(o>c){const t=2*Math.sqrt(1+o-r-c);this._w=(i-l)/t,this._x=(n+a)/t,this._y=.25*t,this._z=(s+u)/t}else{const t=2*Math.sqrt(1+c-r-o);this._w=(a-n)/t,this._x=(i+l)/t,this._y=(s+u)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let r=t.dot(e)+1;return r<Number.EPSILON?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=r),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(tr(this.dot(t),-1,1)))}rotateTowards(t,e){const r=this.angleTo(t);if(0===r)return this;const n=Math.min(1,e/r);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const r=t._x,n=t._y,i=t._z,a=t._w,o=e._x,s=e._y,l=e._z,u=e._w;return this._x=r*u+a*o+n*l-i*s,this._y=n*u+a*s+i*o-r*l,this._z=i*u+a*l+r*s-n*o,this._w=a*u-r*o-n*s-i*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const r=this._x,n=this._y,i=this._z,a=this._w;let o=a*t._w+r*t._x+n*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=r,this._y=n,this._z=i,this;const s=1-o*o;if(s<=Number.EPSILON){const t=1-e;return this._w=t*a+e*this._w,this._x=t*r+e*this._x,this._y=t*n+e*this._y,this._z=t*i+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(s),u=Math.atan2(l,o),c=Math.sin((1-e)*u)/l,h=Math.sin(e*u)/l;return this._w=a*c+this._w*h,this._x=r*c+this._x*h,this._y=n*c+this._y*h,this._z=i*c+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,r){this.copy(t).slerp(e,r)}random(){const t=Math.random(),e=Math.sqrt(1-t),r=Math.sqrt(t),n=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(e*Math.cos(n),r*Math.sin(i),r*Math.cos(i),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Mr.prototype.isQuaternion=!0;class Sr{constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.z=r}set(t,e,r){return void 0===r&&(r=this.z),this.x=t,this.y=e,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Er.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Er.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6]*n,this.y=i[1]*e+i[4]*r+i[7]*n,this.z=i[2]*e+i[5]*r+i[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,r=this.y,n=this.z,i=t.elements,a=1/(i[3]*e+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*e+i[4]*r+i[8]*n+i[12])*a,this.y=(i[1]*e+i[5]*r+i[9]*n+i[13])*a,this.z=(i[2]*e+i[6]*r+i[10]*n+i[14])*a,this}applyQuaternion(t){const e=this.x,r=this.y,n=this.z,i=t.x,a=t.y,o=t.z,s=t.w,l=s*e+a*n-o*r,u=s*r+o*e-i*n,c=s*n+i*r-a*e,h=-i*e-a*r-o*n;return this.x=l*s+h*-i+u*-o-c*-a,this.y=u*s+h*-a+c*-i-l*-o,this.z=c*s+h*-o+l*-a-u*-i,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[4]*r+i[8]*n,this.y=i[1]*e+i[5]*r+i[9]*n,this.z=i[2]*e+i[6]*r+i[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const r=t.x,n=t.y,i=t.z,a=e.x,o=e.y,s=e.z;return this.x=n*s-i*o,this.y=i*a-r*s,this.z=r*o-n*a,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const r=t.dot(this)/e;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return Tr.copy(this).projectOnVector(t),this.sub(Tr)}reflect(t){return this.sub(Tr.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const r=this.dot(t)/e;return Math.acos(tr(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return e*e+r*r+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,r){const n=Math.sin(e)*t;return this.x=n*Math.sin(r),this.y=Math.cos(e)*t,this.z=n*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,r){return this.x=t*Math.sin(e),this.y=r,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=r,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,r=Math.sqrt(1-t**2);return this.x=r*Math.cos(e),this.y=r*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}Sr.prototype.isVector3=!0;const Tr=new Sr,Er=new Mr;class Ar{constructor(t=new Sr(1/0,1/0,1/0),e=new Sr(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0;for(let s=0,l=t.length;s<l;s+=3){const l=t[s],u=t[s+1],c=t[s+2];l<e&&(e=l),u<r&&(r=u),c<n&&(n=c),l>i&&(i=l),u>a&&(a=u),c>o&&(o=c)}return this.min.set(e,r,n),this.max.set(i,a,o),this}setFromBufferAttribute(t){let e=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0;for(let s=0,l=t.count;s<l;s++){const l=t.getX(s),u=t.getY(s),c=t.getZ(s);l<e&&(e=l),u<r&&(r=u),c<n&&(n=c),l>i&&(i=l),u>a&&(a=u),c>o&&(o=c)}return this.min.set(e,r,n),this.max.set(i,a,o),this}setFromPoints(t){this.makeEmpty();for(let e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const r=Pr.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),Cr.copy(e.boundingBox),Cr.applyMatrix4(t.matrixWorld),this.union(Cr));const r=t.children;for(let t=0,e=r.length;t<e;t++)this.expandByObject(r[t]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Pr),Pr.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,r;return t.normal.x>0?(e=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),e<=-t.constant&&r>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Nr),Ur.subVectors(this.max,Nr),Ir.subVectors(t.a,Nr),Lr.subVectors(t.b,Nr),Or.subVectors(t.c,Nr),Dr.subVectors(Lr,Ir),kr.subVectors(Or,Lr),Fr.subVectors(Ir,Or);let e=[0,-Dr.z,Dr.y,0,-kr.z,kr.y,0,-Fr.z,Fr.y,Dr.z,0,-Dr.x,kr.z,0,-kr.x,Fr.z,0,-Fr.x,-Dr.y,Dr.x,0,-kr.y,kr.x,0,-Fr.y,Fr.x,0];return!!Gr(e,Ir,Lr,Or,Ur)&&(e=[1,0,0,0,1,0,0,0,1],!!Gr(e,Ir,Lr,Or,Ur)&&(Br.crossVectors(Dr,kr),e=[Br.x,Br.y,Br.z],Gr(e,Ir,Lr,Or,Ur)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Pr.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(Pr).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Rr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Rr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Rr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Rr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Rr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Rr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Rr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Rr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Rr)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Ar.prototype.isBox3=!0;const Rr=[new Sr,new Sr,new Sr,new Sr,new Sr,new Sr,new Sr,new Sr],Pr=new Sr,Cr=new Ar,Ir=new Sr,Lr=new Sr,Or=new Sr,Dr=new Sr,kr=new Sr,Fr=new Sr,Nr=new Sr,Ur=new Sr,Br=new Sr,zr=new Sr;function Gr(t,e,r,n,i){for(let a=0,o=t.length-3;a<=o;a+=3){zr.fromArray(t,a);const o=i.x*Math.abs(zr.x)+i.y*Math.abs(zr.y)+i.z*Math.abs(zr.z),s=e.dot(zr),l=r.dot(zr),u=n.dot(zr);if(Math.max(-Math.max(s,l,u),Math.min(s,l,u))>o)return!1}return!0}const jr=new Ar,Vr=new Sr,Hr=new Sr,Wr=new Sr;class qr{constructor(t=new Sr,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const r=this.center;void 0!==e?r.copy(e):jr.setFromPoints(t).getCenter(r);let n=0;for(let e=0,i=t.length;e<i;e++)n=Math.max(n,r.distanceToSquared(t[e]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const r=this.center.distanceToSquared(t);return e.copy(t),r>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){Wr.subVectors(t,this.center);const e=Wr.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),r=.5*(t-this.radius);this.center.add(Wr.multiplyScalar(r/t)),this.radius+=r}return this}union(t){return Hr.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(Vr.copy(t.center).add(Hr)),this.expandByPoint(Vr.copy(t.center).sub(Hr)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Xr=new Sr,Yr=new Sr,Zr=new Sr,Kr=new Sr,Jr=new Sr,Qr=new Sr,$r=new Sr;class tn{constructor(t=new Sr,e=new Sr(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Xr)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const r=e.dot(this.direction);return r<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(r).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Xr.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Xr.copy(this.direction).multiplyScalar(e).add(this.origin),Xr.distanceToSquared(t))}distanceSqToSegment(t,e,r,n){Yr.copy(t).add(e).multiplyScalar(.5),Zr.copy(e).sub(t).normalize(),Kr.copy(this.origin).sub(Yr);const i=.5*t.distanceTo(e),a=-this.direction.dot(Zr),o=Kr.dot(this.direction),s=-Kr.dot(Zr),l=Kr.lengthSq(),u=Math.abs(1-a*a);let c,h,d,f;if(u>0)if(c=a*s-o,h=a*o-s,f=i*u,c>=0)if(h>=-f)if(h<=f){const t=1/u;c*=t,h*=t,d=c*(c+a*h+2*o)+h*(a*c+h+2*s)+l}else h=i,c=Math.max(0,-(a*h+o)),d=-c*c+h*(h+2*s)+l;else h=-i,c=Math.max(0,-(a*h+o)),d=-c*c+h*(h+2*s)+l;else h<=-f?(c=Math.max(0,-(-a*i+o)),h=c>0?-i:Math.min(Math.max(-i,-s),i),d=-c*c+h*(h+2*s)+l):h<=f?(c=0,h=Math.min(Math.max(-i,-s),i),d=h*(h+2*s)+l):(c=Math.max(0,-(a*i+o)),h=c>0?i:Math.min(Math.max(-i,-s),i),d=-c*c+h*(h+2*s)+l);else h=a>0?-i:i,c=Math.max(0,-(a*h+o)),d=-c*c+h*(h+2*s)+l;return r&&r.copy(this.direction).multiplyScalar(c).add(this.origin),n&&n.copy(Zr).multiplyScalar(h).add(Yr),d}intersectSphere(t,e){Xr.subVectors(t.center,this.origin);const r=Xr.dot(this.direction),n=Xr.dot(Xr)-r*r,i=t.radius*t.radius;if(n>i)return null;const a=Math.sqrt(i-n),o=r-a,s=r+a;return o<0&&s<0?null:o<0?this.at(s,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const r=-(this.origin.dot(t.normal)+t.constant)/e;return r>=0?r:null}intersectPlane(t,e){const r=this.distanceToPlane(t);return null===r?null:this.at(r,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let r,n,i,a,o,s;const l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(r=(t.min.x-h.x)*l,n=(t.max.x-h.x)*l):(r=(t.max.x-h.x)*l,n=(t.min.x-h.x)*l),u>=0?(i=(t.min.y-h.y)*u,a=(t.max.y-h.y)*u):(i=(t.max.y-h.y)*u,a=(t.min.y-h.y)*u),r>a||i>n?null:((i>r||r!=r)&&(r=i),(a<n||n!=n)&&(n=a),c>=0?(o=(t.min.z-h.z)*c,s=(t.max.z-h.z)*c):(o=(t.max.z-h.z)*c,s=(t.min.z-h.z)*c),r>s||o>n?null:((o>r||r!=r)&&(r=o),(s<n||n!=n)&&(n=s),n<0?null:this.at(r>=0?r:n,e)))}intersectsBox(t){return null!==this.intersectBox(t,Xr)}intersectTriangle(t,e,r,n,i){Jr.subVectors(e,t),Qr.subVectors(r,t),$r.crossVectors(Jr,Qr);let a,o=this.direction.dot($r);if(o>0){if(n)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}Kr.subVectors(this.origin,t);const s=a*this.direction.dot(Qr.crossVectors(Kr,Qr));if(s<0)return null;const l=a*this.direction.dot(Jr.cross(Kr));if(l<0)return null;if(s+l>o)return null;const u=-a*Kr.dot($r);return u<0?null:this.at(u/o,i)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class en{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,r,n,i,a,o,s,l,u,c,h,d,f,p,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=r,g[12]=n,g[1]=i,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new en).fromArray(this.elements)}copy(t){const e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this}copyPosition(t){const e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,r=t.elements,n=1/rn.setFromMatrixColumn(t,0).length(),i=1/rn.setFromMatrixColumn(t,1).length(),a=1/rn.setFromMatrixColumn(t,2).length();return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=0,e[4]=r[4]*i,e[5]=r[5]*i,e[6]=r[6]*i,e[7]=0,e[8]=r[8]*a,e[9]=r[9]*a,e[10]=r[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,r=t.x,n=t.y,i=t.z,a=Math.cos(r),o=Math.sin(r),s=Math.cos(n),l=Math.sin(n),u=Math.cos(i),c=Math.sin(i);if("XYZ"===t.order){const t=a*u,r=a*c,n=o*u,i=o*c;e[0]=s*u,e[4]=-s*c,e[8]=l,e[1]=r+n*l,e[5]=t-i*l,e[9]=-o*s,e[2]=i-t*l,e[6]=n+r*l,e[10]=a*s}else if("YXZ"===t.order){const t=s*u,r=s*c,n=l*u,i=l*c;e[0]=t+i*o,e[4]=n*o-r,e[8]=a*l,e[1]=a*c,e[5]=a*u,e[9]=-o,e[2]=r*o-n,e[6]=i+t*o,e[10]=a*s}else if("ZXY"===t.order){const t=s*u,r=s*c,n=l*u,i=l*c;e[0]=t-i*o,e[4]=-a*c,e[8]=n+r*o,e[1]=r+n*o,e[5]=a*u,e[9]=i-t*o,e[2]=-a*l,e[6]=o,e[10]=a*s}else if("ZYX"===t.order){const t=a*u,r=a*c,n=o*u,i=o*c;e[0]=s*u,e[4]=n*l-r,e[8]=t*l+i,e[1]=s*c,e[5]=i*l+t,e[9]=r*l-n,e[2]=-l,e[6]=o*s,e[10]=a*s}else if("YZX"===t.order){const t=a*s,r=a*l,n=o*s,i=o*l;e[0]=s*u,e[4]=i-t*c,e[8]=n*c+r,e[1]=c,e[5]=a*u,e[9]=-o*u,e[2]=-l*u,e[6]=r*c+n,e[10]=t-i*c}else if("XZY"===t.order){const t=a*s,r=a*l,n=o*s,i=o*l;e[0]=s*u,e[4]=-c,e[8]=l*u,e[1]=t*c+i,e[5]=a*u,e[9]=r*c-n,e[2]=n*c-r,e[6]=o*u,e[10]=i*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(an,t,on)}lookAt(t,e,r){const n=this.elements;return un.subVectors(t,e),0===un.lengthSq()&&(un.z=1),un.normalize(),sn.crossVectors(r,un),0===sn.lengthSq()&&(1===Math.abs(r.z)?un.x+=1e-4:un.z+=1e-4,un.normalize(),sn.crossVectors(r,un)),sn.normalize(),ln.crossVectors(un,sn),n[0]=sn.x,n[4]=ln.x,n[8]=un.x,n[1]=sn.y,n[5]=ln.y,n[9]=un.y,n[2]=sn.z,n[6]=ln.z,n[10]=un.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const r=t.elements,n=e.elements,i=this.elements,a=r[0],o=r[4],s=r[8],l=r[12],u=r[1],c=r[5],h=r[9],d=r[13],f=r[2],p=r[6],m=r[10],g=r[14],v=r[3],y=r[7],x=r[11],_=r[15],w=n[0],b=n[4],M=n[8],S=n[12],T=n[1],E=n[5],A=n[9],R=n[13],P=n[2],C=n[6],I=n[10],L=n[14],O=n[3],D=n[7],k=n[11],F=n[15];return i[0]=a*w+o*T+s*P+l*O,i[4]=a*b+o*E+s*C+l*D,i[8]=a*M+o*A+s*I+l*k,i[12]=a*S+o*R+s*L+l*F,i[1]=u*w+c*T+h*P+d*O,i[5]=u*b+c*E+h*C+d*D,i[9]=u*M+c*A+h*I+d*k,i[13]=u*S+c*R+h*L+d*F,i[2]=f*w+p*T+m*P+g*O,i[6]=f*b+p*E+m*C+g*D,i[10]=f*M+p*A+m*I+g*k,i[14]=f*S+p*R+m*L+g*F,i[3]=v*w+y*T+x*P+_*O,i[7]=v*b+y*E+x*C+_*D,i[11]=v*M+y*A+x*I+_*k,i[15]=v*S+y*R+x*L+_*F,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],r=t[4],n=t[8],i=t[12],a=t[1],o=t[5],s=t[9],l=t[13],u=t[2],c=t[6],h=t[10],d=t[14];return t[3]*(+i*s*c-n*l*c-i*o*h+r*l*h+n*o*d-r*s*d)+t[7]*(+e*s*d-e*l*h+i*a*h-n*a*d+n*l*u-i*s*u)+t[11]*(+e*l*c-e*o*d-i*a*c+r*a*d+i*o*u-r*l*u)+t[15]*(-n*o*u-e*s*c+e*o*h+n*a*c-r*a*h+r*s*u)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,r){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=r),this}invert(){const t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],l=t[7],u=t[8],c=t[9],h=t[10],d=t[11],f=t[12],p=t[13],m=t[14],g=t[15],v=c*m*l-p*h*l+p*s*d-o*m*d-c*s*g+o*h*g,y=f*h*l-u*m*l-f*s*d+a*m*d+u*s*g-a*h*g,x=u*p*l-f*c*l+f*o*d-a*p*d-u*o*g+a*c*g,_=f*c*s-u*p*s-f*o*h+a*p*h+u*o*m-a*c*m,w=e*v+r*y+n*x+i*_;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/w;return t[0]=v*b,t[1]=(p*h*i-c*m*i-p*n*d+r*m*d+c*n*g-r*h*g)*b,t[2]=(o*m*i-p*s*i+p*n*l-r*m*l-o*n*g+r*s*g)*b,t[3]=(c*s*i-o*h*i-c*n*l+r*h*l+o*n*d-r*s*d)*b,t[4]=y*b,t[5]=(u*m*i-f*h*i+f*n*d-e*m*d-u*n*g+e*h*g)*b,t[6]=(f*s*i-a*m*i-f*n*l+e*m*l+a*n*g-e*s*g)*b,t[7]=(a*h*i-u*s*i+u*n*l-e*h*l-a*n*d+e*s*d)*b,t[8]=x*b,t[9]=(f*c*i-u*p*i-f*r*d+e*p*d+u*r*g-e*c*g)*b,t[10]=(a*p*i-f*o*i+f*r*l-e*p*l-a*r*g+e*o*g)*b,t[11]=(u*o*i-a*c*i-u*r*l+e*c*l+a*r*d-e*o*d)*b,t[12]=_*b,t[13]=(u*p*n-f*c*n+f*r*h-e*p*h-u*r*m+e*c*m)*b,t[14]=(f*o*n-a*p*n-f*r*s+e*p*s+a*r*m-e*o*m)*b,t[15]=(a*c*n-u*o*n+u*r*s-e*c*s-a*r*h+e*o*h)*b,this}scale(t){const e=this.elements,r=t.x,n=t.y,i=t.z;return e[0]*=r,e[4]*=n,e[8]*=i,e[1]*=r,e[5]*=n,e[9]*=i,e[2]*=r,e[6]*=n,e[10]*=i,e[3]*=r,e[7]*=n,e[11]*=i,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,r,n))}makeTranslation(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const r=Math.cos(e),n=Math.sin(e),i=1-r,a=t.x,o=t.y,s=t.z,l=i*a,u=i*o;return this.set(l*a+r,l*o-n*s,l*s+n*o,0,l*o+n*s,u*o+r,u*s-n*a,0,l*s-n*o,u*s+n*a,i*s*s+r,0,0,0,0,1),this}makeScale(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,e,r,n,i,a){return this.set(1,r,i,0,t,1,a,0,e,n,1,0,0,0,0,1),this}compose(t,e,r){const n=this.elements,i=e._x,a=e._y,o=e._z,s=e._w,l=i+i,u=a+a,c=o+o,h=i*l,d=i*u,f=i*c,p=a*u,m=a*c,g=o*c,v=s*l,y=s*u,x=s*c,_=r.x,w=r.y,b=r.z;return n[0]=(1-(p+g))*_,n[1]=(d+x)*_,n[2]=(f-y)*_,n[3]=0,n[4]=(d-x)*w,n[5]=(1-(h+g))*w,n[6]=(m+v)*w,n[7]=0,n[8]=(f+y)*b,n[9]=(m-v)*b,n[10]=(1-(h+p))*b,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,r){const n=this.elements;let i=rn.set(n[0],n[1],n[2]).length();const a=rn.set(n[4],n[5],n[6]).length(),o=rn.set(n[8],n[9],n[10]).length();this.determinant()<0&&(i=-i),t.x=n[12],t.y=n[13],t.z=n[14],nn.copy(this);const s=1/i,l=1/a,u=1/o;return nn.elements[0]*=s,nn.elements[1]*=s,nn.elements[2]*=s,nn.elements[4]*=l,nn.elements[5]*=l,nn.elements[6]*=l,nn.elements[8]*=u,nn.elements[9]*=u,nn.elements[10]*=u,e.setFromRotationMatrix(nn),r.x=i,r.y=a,r.z=o,this}makePerspective(t,e,r,n,i,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,s=2*i/(e-t),l=2*i/(r-n),u=(e+t)/(e-t),c=(r+n)/(r-n),h=-(a+i)/(a-i),d=-2*a*i/(a-i);return o[0]=s,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=l,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,r,n,i,a){const o=this.elements,s=1/(e-t),l=1/(r-n),u=1/(a-i),c=(e+t)*s,h=(r+n)*l,d=(a+i)*u;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,r=t.elements;for(let t=0;t<16;t++)if(e[t]!==r[t])return!1;return!0}fromArray(t,e=0){for(let r=0;r<16;r++)this.elements[r]=t[r+e];return this}toArray(t=[],e=0){const r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}}en.prototype.isMatrix4=!0;const rn=new Sr,nn=new en,an=new Sr(0,0,0),on=new Sr(1,1,1),sn=new Sr,ln=new Sr,un=new Sr,cn=new en,hn=new Mr;class dn{constructor(t=0,e=0,r=0,n=dn.DefaultOrder){this._x=t,this._y=e,this._z=r,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,r,n=this._order){return this._x=t,this._y=e,this._z=r,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,r=!0){const n=t.elements,i=n[0],a=n[4],o=n[8],s=n[1],l=n[5],u=n[9],c=n[2],h=n[6],d=n[10];switch(e){case"XYZ":this._y=Math.asin(tr(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-tr(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-c,i),this._z=0);break;case"ZXY":this._x=Math.asin(tr(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-tr(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(tr(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-c,i)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-tr(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===r&&this._onChangeCallback(),this}setFromQuaternion(t,e,r){return cn.makeRotationFromQuaternion(t),this.setFromRotationMatrix(cn,e,r)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return hn.setFromEuler(this),this.setFromQuaternion(hn,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new Sr(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}dn.prototype.isEuler=!0,dn.DefaultOrder="XYZ",dn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class fn{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let pn=0;const mn=new Sr,gn=new Mr,vn=new en,yn=new Sr,xn=new Sr,_n=new Sr,wn=new Mr,bn=new Sr(1,0,0),Mn=new Sr(0,1,0),Sn=new Sr(0,0,1),Tn={type:"added"},En={type:"removed"};class An extends Ye{constructor(){super(),Object.defineProperty(this,"id",{value:pn++}),this.uuid=$e(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=An.DefaultUp.clone();const t=new Sr,e=new dn,r=new Mr,n=new Sr(1,1,1);e._onChange((function(){r.setFromEuler(e,!1)})),r._onChange((function(){e.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new en},normalMatrix:{value:new lr}}),this.matrix=new en,this.matrixWorld=new en,this.matrixAutoUpdate=An.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new fn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return gn.setFromAxisAngle(t,e),this.quaternion.multiply(gn),this}rotateOnWorldAxis(t,e){return gn.setFromAxisAngle(t,e),this.quaternion.premultiply(gn),this}rotateX(t){return this.rotateOnAxis(bn,t)}rotateY(t){return this.rotateOnAxis(Mn,t)}rotateZ(t){return this.rotateOnAxis(Sn,t)}translateOnAxis(t,e){return mn.copy(t).applyQuaternion(this.quaternion),this.position.add(mn.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(bn,t)}translateY(t){return this.translateOnAxis(Mn,t)}translateZ(t){return this.translateOnAxis(Sn,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(vn.copy(this.matrixWorld).invert())}lookAt(t,e,r){t.isVector3?yn.copy(t):yn.set(t,e,r);const n=this.parent;this.updateWorldMatrix(!0,!1),xn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?vn.lookAt(xn,yn,this.up):vn.lookAt(yn,xn,this.up),this.quaternion.setFromRotationMatrix(vn),n&&(vn.extractRotation(n.matrixWorld),gn.setFromRotationMatrix(vn),this.quaternion.premultiply(gn.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Tn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(En)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(En)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),vn.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),vn.multiply(t.parent.matrixWorld)),t.applyMatrix4(vn),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let r=0,n=this.children.length;r<n;r++){const n=this.children[r].getObjectByProperty(t,e);if(void 0!==n)return n}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xn,t,_n),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xn,wn,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let r=0,n=e.length;r<n;r++)e[r].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let r=0,n=e.length;r<n;r++)e[r].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let r=0,n=e.length;r<n;r++)e[r].updateMatrixWorld(t)}updateWorldMatrix(t,e){const r=this.parent;if(!0===t&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,r=t.length;e<r;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,r={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function i(e,r){return void 0===e[r.uuid]&&(e[r.uuid]=r.toJSON(t)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=i(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const r=e.shapes;if(Array.isArray(r))for(let e=0,n=r.length;e<n;e++){const n=r[e];i(t.shapes,n)}else i(t.shapes,r)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let r=0,n=this.material.length;r<n;r++)e.push(i(t.materials,this.material[r]));n.material=e}else n.material=i(t.materials,this.material);if(this.children.length>0){n.children=[];for(let e=0;e<this.children.length;e++)n.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let e=0;e<this.animations.length;e++){const r=this.animations[e];n.animations.push(i(t.animations,r))}}if(e){const e=a(t.geometries),n=a(t.materials),i=a(t.textures),o=a(t.images),s=a(t.shapes),l=a(t.skeletons),u=a(t.animations);e.length>0&&(r.geometries=e),n.length>0&&(r.materials=n),i.length>0&&(r.textures=i),o.length>0&&(r.images=o),s.length>0&&(r.shapes=s),l.length>0&&(r.skeletons=l),u.length>0&&(r.animations=u)}return r.object=n,r;function a(t){const e=[];for(const r in t){const n=t[r];delete n.metadata,e.push(n)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const r=t.children[e];this.add(r.clone())}return this}}An.DefaultUp=new Sr(0,1,0),An.DefaultMatrixAutoUpdate=!0,An.prototype.isObject3D=!0;const Rn=new Sr,Pn=new Sr,Cn=new Sr,In=new Sr,Ln=new Sr,On=new Sr,Dn=new Sr,kn=new Sr,Fn=new Sr,Nn=new Sr;class Un{constructor(t=new Sr,e=new Sr,r=new Sr){this.a=t,this.b=e,this.c=r}static getNormal(t,e,r,n){n.subVectors(r,e),Rn.subVectors(t,e),n.cross(Rn);const i=n.lengthSq();return i>0?n.multiplyScalar(1/Math.sqrt(i)):n.set(0,0,0)}static getBarycoord(t,e,r,n,i){Rn.subVectors(n,e),Pn.subVectors(r,e),Cn.subVectors(t,e);const a=Rn.dot(Rn),o=Rn.dot(Pn),s=Rn.dot(Cn),l=Pn.dot(Pn),u=Pn.dot(Cn),c=a*l-o*o;if(0===c)return i.set(-2,-1,-1);const h=1/c,d=(l*s-o*u)*h,f=(a*u-o*s)*h;return i.set(1-d-f,f,d)}static containsPoint(t,e,r,n){return this.getBarycoord(t,e,r,n,In),In.x>=0&&In.y>=0&&In.x+In.y<=1}static getUV(t,e,r,n,i,a,o,s){return this.getBarycoord(t,e,r,n,In),s.set(0,0),s.addScaledVector(i,In.x),s.addScaledVector(a,In.y),s.addScaledVector(o,In.z),s}static isFrontFacing(t,e,r,n){return Rn.subVectors(r,e),Pn.subVectors(t,e),Rn.cross(Pn).dot(n)<0}set(t,e,r){return this.a.copy(t),this.b.copy(e),this.c.copy(r),this}setFromPointsAndIndices(t,e,r,n){return this.a.copy(t[e]),this.b.copy(t[r]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,r,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,r),this.c.fromBufferAttribute(t,n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Rn.subVectors(this.c,this.b),Pn.subVectors(this.a,this.b),.5*Rn.cross(Pn).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Un.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Un.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,r,n,i){return Un.getUV(t,this.a,this.b,this.c,e,r,n,i)}containsPoint(t){return Un.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Un.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const r=this.a,n=this.b,i=this.c;let a,o;Ln.subVectors(n,r),On.subVectors(i,r),kn.subVectors(t,r);const s=Ln.dot(kn),l=On.dot(kn);if(s<=0&&l<=0)return e.copy(r);Fn.subVectors(t,n);const u=Ln.dot(Fn),c=On.dot(Fn);if(u>=0&&c<=u)return e.copy(n);const h=s*c-u*l;if(h<=0&&s>=0&&u<=0)return a=s/(s-u),e.copy(r).addScaledVector(Ln,a);Nn.subVectors(t,i);const d=Ln.dot(Nn),f=On.dot(Nn);if(f>=0&&d<=f)return e.copy(i);const p=d*l-s*f;if(p<=0&&l>=0&&f<=0)return o=l/(l-f),e.copy(r).addScaledVector(On,o);const m=u*f-d*c;if(m<=0&&c-u>=0&&d-f>=0)return Dn.subVectors(i,n),o=(c-u)/(c-u+(d-f)),e.copy(n).addScaledVector(Dn,o);const g=1/(m+p+h);return a=p*g,o=h*g,e.copy(r).addScaledVector(Ln,a).addScaledVector(On,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let Bn=0;class zn extends Ye{constructor(){super(),Object.defineProperty(this,"id",{value:Bn++}),this.uuid=$e(),this.name="",this.type="Material",this.fog=!0,this.blending=f,this.side=u,this.vertexColors=!1,this.opacity=1,this.format=At,this.transparent=!1,this.blendSrc=A,this.blendDst=R,this.blendEquation=y,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=N,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=He,this.stencilZFail=He,this.stencilZPass=He,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const r=t[e];if(void 0===r){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r;continue}const n=this[e];void 0!==n?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[e]=r:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){const e=[];for(const r in t){const n=t[r];delete n.metadata,e.push(n)}return e}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),void 0!==this.sheen&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(t).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(r.combine=this.combine)),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(r.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(r.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(r.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(r.size=this.size),null!==this.shadowSide&&(r.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==f&&(r.blending=this.blending),this.side!==u&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.format!==At&&(r.format=this.format),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.colorWrite=this.colorWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(r.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(r.flatShading=this.flatShading),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),e){const e=n(t.textures),i=n(t.images);e.length>0&&(r.textures=e),i.length>0&&(r.images=i)}return r}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.format=t.format,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let r=null;if(null!==e){const t=e.length;r=new Array(t);for(let n=0;n!==t;++n)r[n]=e[n].clone()}return this.clippingPlanes=r,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}zn.prototype.isMaterial=!0;const Gn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},jn={h:0,s:0,l:0},Vn={h:0,s:0,l:0};function Hn(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+6*(e-t)*(2/3-r):t}function Wn(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function qn(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class Xn{constructor(t,e,r){return void 0===e&&void 0===r?this.set(t):this.setRGB(t,e,r)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,r){return this.r=t,this.g=e,this.b=r,this}setHSL(t,e,r){if(t=er(t,1),e=tr(e,0,1),r=tr(r,0,1),0===e)this.r=this.g=this.b=r;else{const n=r<=.5?r*(1+e):r+e-r*e,i=2*r-n;this.r=Hn(i,n,t+1/3),this.g=Hn(i,n,t),this.b=Hn(i,n,t-1/3)}return this}setStyle(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const n=r[1],i=r[2];switch(n){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i)){const r=parseFloat(t[1])/360,n=parseInt(t[2],10)/100,i=parseInt(t[3],10)/100;return e(t[4]),this.setHSL(r,n,i)}}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=r[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=Gn[t.toLowerCase()];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,e=2){return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}copyLinearToGamma(t,e=2){const r=e>0?1/e:1;return this.r=Math.pow(t.r,r),this.g=Math.pow(t.g,r),this.b=Math.pow(t.b,r),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=Wn(t.r),this.g=Wn(t.g),this.b=Wn(t.b),this}copyLinearToSRGB(t){return this.r=qn(t.r),this.g=qn(t.g),this.b=qn(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){const e=this.r,r=this.g,n=this.b,i=Math.max(e,r,n),a=Math.min(e,r,n);let o,s;const l=(a+i)/2;if(a===i)o=0,s=0;else{const t=i-a;switch(s=l<=.5?t/(i+a):t/(2-i-a),i){case e:o=(r-n)/t+(r<n?6:0);break;case r:o=(n-e)/t+2;break;case n:o=(e-r)/t+4}o/=6}return t.h=o,t.s=s,t.l=l,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,r){return this.getHSL(jn),jn.h+=t,jn.s+=e,jn.l+=r,this.setHSL(jn.h,jn.s,jn.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,r){return this.r=t.r+(e.r-t.r)*r,this.g=t.g+(e.g-t.g)*r,this.b=t.b+(e.b-t.b)*r,this}lerpHSL(t,e){this.getHSL(jn),t.getHSL(Vn);const r=rr(jn.h,Vn.h,e),n=rr(jn.s,Vn.s,e),i=rr(jn.l,Vn.l,e);return this.setHSL(r,n,i),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Xn.NAMES=Gn,Xn.prototype.isColor=!0,Xn.prototype.r=1,Xn.prototype.g=1,Xn.prototype.b=1;class Yn extends zn{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new Xn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=j,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}Yn.prototype.isMeshBasicMaterial=!0;const Zn=new Sr,Kn=new sr;class Jn{constructor(t,e,r){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===r,this.usage=We,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,r){t*=this.itemSize,r*=e.itemSize;for(let n=0,i=this.itemSize;n<i;n++)this.array[t+n]=e.array[r+n];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let r=0;for(let n=0,i=t.length;n<i;n++){let i=t[n];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),i=new Xn),e[r++]=i.r,e[r++]=i.g,e[r++]=i.b}return this}copyVector2sArray(t){const e=this.array;let r=0;for(let n=0,i=t.length;n<i;n++){let i=t[n];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),i=new sr),e[r++]=i.x,e[r++]=i.y}return this}copyVector3sArray(t){const e=this.array;let r=0;for(let n=0,i=t.length;n<i;n++){let i=t[n];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),i=new Sr),e[r++]=i.x,e[r++]=i.y,e[r++]=i.z}return this}copyVector4sArray(t){const e=this.array;let r=0;for(let n=0,i=t.length;n<i;n++){let i=t[n];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),i=new xr),e[r++]=i.x,e[r++]=i.y,e[r++]=i.z,e[r++]=i.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,r=this.count;e<r;e++)Kn.fromBufferAttribute(this,e),Kn.applyMatrix3(t),this.setXY(e,Kn.x,Kn.y);else if(3===this.itemSize)for(let e=0,r=this.count;e<r;e++)Zn.fromBufferAttribute(this,e),Zn.applyMatrix3(t),this.setXYZ(e,Zn.x,Zn.y,Zn.z);return this}applyMatrix4(t){for(let e=0,r=this.count;e<r;e++)Zn.x=this.getX(e),Zn.y=this.getY(e),Zn.z=this.getZ(e),Zn.applyMatrix4(t),this.setXYZ(e,Zn.x,Zn.y,Zn.z);return this}applyNormalMatrix(t){for(let e=0,r=this.count;e<r;e++)Zn.x=this.getX(e),Zn.y=this.getY(e),Zn.z=this.getZ(e),Zn.applyNormalMatrix(t),this.setXYZ(e,Zn.x,Zn.y,Zn.z);return this}transformDirection(t){for(let e=0,r=this.count;e<r;e++)Zn.x=this.getX(e),Zn.y=this.getY(e),Zn.z=this.getZ(e),Zn.transformDirection(t),this.setXYZ(e,Zn.x,Zn.y,Zn.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this}setXYZ(t,e,r,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=n,this}setXYZW(t,e,r,n,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=n,this.array[t+3]=i,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==We&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}Jn.prototype.isBufferAttribute=!0;class Qn extends Jn{constructor(t,e,r){super(new Int8Array(t),e,r)}}class $n extends Jn{constructor(t,e,r){super(new Uint8Array(t),e,r)}}class ti extends Jn{constructor(t,e,r){super(new Uint8ClampedArray(t),e,r)}}class ei extends Jn{constructor(t,e,r){super(new Int16Array(t),e,r)}}class ri extends Jn{constructor(t,e,r){super(new Uint16Array(t),e,r)}}class ni extends Jn{constructor(t,e,r){super(new Int32Array(t),e,r)}}class ii extends Jn{constructor(t,e,r){super(new Uint32Array(t),e,r)}}class ai extends Jn{constructor(t,e,r){super(new Uint16Array(t),e,r)}}ai.prototype.isFloat16BufferAttribute=!0;class oi extends Jn{constructor(t,e,r){super(new Float32Array(t),e,r)}}class si extends Jn{constructor(t,e,r){super(new Float64Array(t),e,r)}}let li=0;const ui=new en,ci=new An,hi=new Sr,di=new Ar,fi=new Ar,pi=new Sr;class mi extends Ye{constructor(){super(),Object.defineProperty(this,"id",{value:li++}),this.uuid=$e(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(ur(t)>65535?ii:ri)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,r=0){this.groups.push({start:t,count:e,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const r=this.attributes.normal;if(void 0!==r){const e=(new lr).getNormalMatrix(t);r.applyNormalMatrix(e),r.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return ui.makeRotationFromQuaternion(t),this.applyMatrix4(ui),this}rotateX(t){return ui.makeRotationX(t),this.applyMatrix4(ui),this}rotateY(t){return ui.makeRotationY(t),this.applyMatrix4(ui),this}rotateZ(t){return ui.makeRotationZ(t),this.applyMatrix4(ui),this}translate(t,e,r){return ui.makeTranslation(t,e,r),this.applyMatrix4(ui),this}scale(t,e,r){return ui.makeScale(t,e,r),this.applyMatrix4(ui),this}lookAt(t){return ci.lookAt(t),ci.updateMatrix(),this.applyMatrix4(ci.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(hi).negate(),this.translate(hi.x,hi.y,hi.z),this}setFromPoints(t){const e=[];for(let r=0,n=t.length;r<n;r++){const n=t[r];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new oi(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ar);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Sr(-1/0,-1/0,-1/0),new Sr(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,r=e.length;t<r;t++){const r=e[t];di.setFromBufferAttribute(r),this.morphTargetsRelative?(pi.addVectors(this.boundingBox.min,di.min),this.boundingBox.expandByPoint(pi),pi.addVectors(this.boundingBox.max,di.max),this.boundingBox.expandByPoint(pi)):(this.boundingBox.expandByPoint(di.min),this.boundingBox.expandByPoint(di.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new qr);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Sr,1/0);if(t){const r=this.boundingSphere.center;if(di.setFromBufferAttribute(t),e)for(let t=0,r=e.length;t<r;t++){const r=e[t];fi.setFromBufferAttribute(r),this.morphTargetsRelative?(pi.addVectors(di.min,fi.min),di.expandByPoint(pi),pi.addVectors(di.max,fi.max),di.expandByPoint(pi)):(di.expandByPoint(fi.min),di.expandByPoint(fi.max))}di.getCenter(r);let n=0;for(let e=0,i=t.count;e<i;e++)pi.fromBufferAttribute(t,e),n=Math.max(n,r.distanceToSquared(pi));if(e)for(let i=0,a=e.length;i<a;i++){const a=e[i],o=this.morphTargetsRelative;for(let e=0,i=a.count;e<i;e++)pi.fromBufferAttribute(a,e),o&&(hi.fromBufferAttribute(t,e),pi.add(hi)),n=Math.max(n,r.distanceToSquared(pi))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const r=t.array,n=e.position.array,i=e.normal.array,a=e.uv.array,o=n.length/3;void 0===e.tangent&&this.setAttribute("tangent",new Jn(new Float32Array(4*o),4));const s=e.tangent.array,l=[],u=[];for(let t=0;t<o;t++)l[t]=new Sr,u[t]=new Sr;const c=new Sr,h=new Sr,d=new Sr,f=new sr,p=new sr,m=new sr,g=new Sr,v=new Sr;function y(t,e,r){c.fromArray(n,3*t),h.fromArray(n,3*e),d.fromArray(n,3*r),f.fromArray(a,2*t),p.fromArray(a,2*e),m.fromArray(a,2*r),h.sub(c),d.sub(c),p.sub(f),m.sub(f);const i=1/(p.x*m.y-m.x*p.y);isFinite(i)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-p.y).multiplyScalar(i),v.copy(d).multiplyScalar(p.x).addScaledVector(h,-m.x).multiplyScalar(i),l[t].add(g),l[e].add(g),l[r].add(g),u[t].add(v),u[e].add(v),u[r].add(v))}let x=this.groups;0===x.length&&(x=[{start:0,count:r.length}]);for(let t=0,e=x.length;t<e;++t){const e=x[t],n=e.start;for(let t=n,i=n+e.count;t<i;t+=3)y(r[t+0],r[t+1],r[t+2])}const _=new Sr,w=new Sr,b=new Sr,M=new Sr;function S(t){b.fromArray(i,3*t),M.copy(b);const e=l[t];_.copy(e),_.sub(b.multiplyScalar(b.dot(e))).normalize(),w.crossVectors(M,e);const r=w.dot(u[t])<0?-1:1;s[4*t]=_.x,s[4*t+1]=_.y,s[4*t+2]=_.z,s[4*t+3]=r}for(let t=0,e=x.length;t<e;++t){const e=x[t],n=e.start;for(let t=n,i=n+e.count;t<i;t+=3)S(r[t+0]),S(r[t+1]),S(r[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let r=this.getAttribute("normal");if(void 0===r)r=new Jn(new Float32Array(3*e.count),3),this.setAttribute("normal",r);else for(let t=0,e=r.count;t<e;t++)r.setXYZ(t,0,0,0);const n=new Sr,i=new Sr,a=new Sr,o=new Sr,s=new Sr,l=new Sr,u=new Sr,c=new Sr;if(t)for(let h=0,d=t.count;h<d;h+=3){const d=t.getX(h+0),f=t.getX(h+1),p=t.getX(h+2);n.fromBufferAttribute(e,d),i.fromBufferAttribute(e,f),a.fromBufferAttribute(e,p),u.subVectors(a,i),c.subVectors(n,i),u.cross(c),o.fromBufferAttribute(r,d),s.fromBufferAttribute(r,f),l.fromBufferAttribute(r,p),o.add(u),s.add(u),l.add(u),r.setXYZ(d,o.x,o.y,o.z),r.setXYZ(f,s.x,s.y,s.z),r.setXYZ(p,l.x,l.y,l.z)}else for(let t=0,o=e.count;t<o;t+=3)n.fromBufferAttribute(e,t+0),i.fromBufferAttribute(e,t+1),a.fromBufferAttribute(e,t+2),u.subVectors(a,i),c.subVectors(n,i),u.cross(c),r.setXYZ(t+0,u.x,u.y,u.z),r.setXYZ(t+1,u.x,u.y,u.z),r.setXYZ(t+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const r=this.attributes;for(const n in r){if(void 0===t.attributes[n])continue;const i=r[n].array,a=t.attributes[n],o=a.array,s=a.itemSize*e,l=Math.min(o.length,i.length-s);for(let t=0,e=s;t<l;t++,e++)i[e]=o[t]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,r=t.count;e<r;e++)pi.fromBufferAttribute(t,e),pi.normalize(),t.setXYZ(e,pi.x,pi.y,pi.z)}toNonIndexed(){function t(t,e){const r=t.array,n=t.itemSize,i=t.normalized,a=new r.constructor(e.length*n);let o=0,s=0;for(let i=0,l=e.length;i<l;i++){o=t.isInterleavedBufferAttribute?e[i]*t.data.stride+t.offset:e[i]*n;for(let t=0;t<n;t++)a[s++]=r[o++]}return new Jn(a,n,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new mi,r=this.index.array,n=this.attributes;for(const i in n){const a=t(n[i],r);e.setAttribute(i,a)}const i=this.morphAttributes;for(const n in i){const a=[],o=i[n];for(let e=0,n=o.length;e<n;e++){const n=t(o[e],r);a.push(n)}e.morphAttributes[n]=a}e.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let t=0,r=a.length;t<r;t++){const r=a[t];e.addGroup(r.start,r.count,r.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const r in e)void 0!==e[r]&&(t[r]=e[r]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const r=this.attributes;for(const e in r){const n=r[e];t.data.attributes[e]=n.toJSON(t.data)}const n={};let i=!1;for(const e in this.morphAttributes){const r=this.morphAttributes[e],a=[];for(let e=0,n=r.length;e<n;e++){const n=r[e];a.push(n.toJSON(t.data))}a.length>0&&(n[e]=a,i=!0)}i&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const r=t.index;null!==r&&this.setIndex(r.clone(e));const n=t.attributes;for(const t in n){const r=n[t];this.setAttribute(t,r.clone(e))}const i=t.morphAttributes;for(const t in i){const r=[],n=i[t];for(let t=0,i=n.length;t<i;t++)r.push(n[t].clone(e));this.morphAttributes[t]=r}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let t=0,e=a.length;t<e;t++){const e=a[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const s=t.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}mi.prototype.isBufferGeometry=!0;const gi=new en,vi=new tn,yi=new qr,xi=new Sr,_i=new Sr,wi=new Sr,bi=new Sr,Mi=new Sr,Si=new Sr,Ti=new Sr,Ei=new Sr,Ai=new Sr,Ri=new sr,Pi=new sr,Ci=new sr,Ii=new Sr,Li=new Sr;class Oi extends An{constructor(t=new mi,e=new Yn){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,r=Object.keys(e);if(r.length>0){const t=e[r[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,r=t.length;e<r;e++){const r=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const r=this.geometry,n=this.material,i=this.matrixWorld;if(void 0===n)return;if(null===r.boundingSphere&&r.computeBoundingSphere(),yi.copy(r.boundingSphere),yi.applyMatrix4(i),!1===t.ray.intersectsSphere(yi))return;if(gi.copy(i).invert(),vi.copy(t.ray).applyMatrix4(gi),null!==r.boundingBox&&!1===vi.intersectsBox(r.boundingBox))return;let a;if(r.isBufferGeometry){const i=r.index,o=r.attributes.position,s=r.morphAttributes.position,l=r.morphTargetsRelative,u=r.attributes.uv,c=r.attributes.uv2,h=r.groups,d=r.drawRange;if(null!==i)if(Array.isArray(n))for(let r=0,f=h.length;r<f;r++){const f=h[r],p=n[f.materialIndex];for(let r=Math.max(f.start,d.start),n=Math.min(i.count,Math.min(f.start+f.count,d.start+d.count));r<n;r+=3){const n=i.getX(r),h=i.getX(r+1),d=i.getX(r+2);a=Di(this,p,t,vi,o,s,l,u,c,n,h,d),a&&(a.faceIndex=Math.floor(r/3),a.face.materialIndex=f.materialIndex,e.push(a))}}else{for(let r=Math.max(0,d.start),h=Math.min(i.count,d.start+d.count);r<h;r+=3){const h=i.getX(r),d=i.getX(r+1),f=i.getX(r+2);a=Di(this,n,t,vi,o,s,l,u,c,h,d,f),a&&(a.faceIndex=Math.floor(r/3),e.push(a))}}else if(void 0!==o)if(Array.isArray(n))for(let r=0,i=h.length;r<i;r++){const i=h[r],f=n[i.materialIndex];for(let r=Math.max(i.start,d.start),n=Math.min(o.count,Math.min(i.start+i.count,d.start+d.count));r<n;r+=3){a=Di(this,f,t,vi,o,s,l,u,c,r,r+1,r+2),a&&(a.faceIndex=Math.floor(r/3),a.face.materialIndex=i.materialIndex,e.push(a))}}else{for(let r=Math.max(0,d.start),i=Math.min(o.count,d.start+d.count);r<i;r+=3){a=Di(this,n,t,vi,o,s,l,u,c,r,r+1,r+2),a&&(a.faceIndex=Math.floor(r/3),e.push(a))}}}else r.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Di(t,e,r,n,i,a,o,s,l,u,d,f){xi.fromBufferAttribute(i,u),_i.fromBufferAttribute(i,d),wi.fromBufferAttribute(i,f);const p=t.morphTargetInfluences;if(a&&p){Ti.set(0,0,0),Ei.set(0,0,0),Ai.set(0,0,0);for(let t=0,e=a.length;t<e;t++){const e=p[t],r=a[t];0!==e&&(bi.fromBufferAttribute(r,u),Mi.fromBufferAttribute(r,d),Si.fromBufferAttribute(r,f),o?(Ti.addScaledVector(bi,e),Ei.addScaledVector(Mi,e),Ai.addScaledVector(Si,e)):(Ti.addScaledVector(bi.sub(xi),e),Ei.addScaledVector(Mi.sub(_i),e),Ai.addScaledVector(Si.sub(wi),e)))}xi.add(Ti),_i.add(Ei),wi.add(Ai)}t.isSkinnedMesh&&(t.boneTransform(u,xi),t.boneTransform(d,_i),t.boneTransform(f,wi));const m=function(t,e,r,n,i,a,o,s){let l;if(l=e.side===c?n.intersectTriangle(o,a,i,!0,s):n.intersectTriangle(i,a,o,e.side!==h,s),null===l)return null;Li.copy(s),Li.applyMatrix4(t.matrixWorld);const u=r.ray.origin.distanceTo(Li);return u<r.near||u>r.far?null:{distance:u,point:Li.clone(),object:t}}(t,e,r,n,xi,_i,wi,Ii);if(m){s&&(Ri.fromBufferAttribute(s,u),Pi.fromBufferAttribute(s,d),Ci.fromBufferAttribute(s,f),m.uv=Un.getUV(Ii,xi,_i,wi,Ri,Pi,Ci,new sr)),l&&(Ri.fromBufferAttribute(l,u),Pi.fromBufferAttribute(l,d),Ci.fromBufferAttribute(l,f),m.uv2=Un.getUV(Ii,xi,_i,wi,Ri,Pi,Ci,new sr));const t={a:u,b:d,c:f,normal:new Sr,materialIndex:0};Un.getNormal(xi,_i,wi,t.normal),m.face=t}return m}Oi.prototype.isMesh=!0;class ki extends mi{constructor(t=1,e=1,r=1,n=1,i=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:n,heightSegments:i,depthSegments:a};const o=this;n=Math.floor(n),i=Math.floor(i),a=Math.floor(a);const s=[],l=[],u=[],c=[];let h=0,d=0;function f(t,e,r,n,i,a,f,p,m,g,v){const y=a/m,x=f/g,_=a/2,w=f/2,b=p/2,M=m+1,S=g+1;let T=0,E=0;const A=new Sr;for(let a=0;a<S;a++){const o=a*x-w;for(let s=0;s<M;s++){const h=s*y-_;A[t]=h*n,A[e]=o*i,A[r]=b,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[r]=p>0?1:-1,u.push(A.x,A.y,A.z),c.push(s/m),c.push(1-a/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const r=h+e+M*t,n=h+e+M*(t+1),i=h+(e+1)+M*(t+1),a=h+(e+1)+M*t;s.push(r,n,a),s.push(n,i,a),E+=6}o.addGroup(d,E,v),d+=E,h+=T}f("z","y","x",-1,-1,r,e,t,a,i,0),f("z","y","x",1,-1,r,e,-t,a,i,1),f("x","z","y",1,1,t,r,e,n,a,2),f("x","z","y",1,-1,t,r,-e,n,a,3),f("x","y","z",1,-1,t,e,r,n,i,4),f("x","y","z",-1,-1,t,e,-r,n,i,5),this.setIndex(s),this.setAttribute("position",new oi(l,3)),this.setAttribute("normal",new oi(u,3)),this.setAttribute("uv",new oi(c,2))}static fromJSON(t){return new ki(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Fi(t){const e={};for(const r in t){e[r]={};for(const n in t[r]){const i=t[r][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?e[r][n]=i.clone():Array.isArray(i)?e[r][n]=i.slice():e[r][n]=i}}return e}function Ni(t){const e={};for(let r=0;r<t.length;r++){const n=Fi(t[r]);for(const t in n)e[t]=n[t]}return e}const Ui={clone:Fi,merge:Ni};class Bi extends zn{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Fi(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const r in this.uniforms){const n=this.uniforms[r].value;n&&n.isTexture?e.uniforms[r]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[r]={type:"m4",value:n.toArray()}:e.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const r={};for(const t in this.extensions)!0===this.extensions[t]&&(r[t]=!0);return Object.keys(r).length>0&&(e.extensions=r),e}}Bi.prototype.isShaderMaterial=!0;let zi=class extends An{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new en,this.projectionMatrix=new en,this.projectionMatrixInverse=new en}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}};zi.prototype.isCamera=!0;class Gi extends zi{constructor(t=50,e=1,r=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=r,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Qe*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Je*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Qe*Math.atan(Math.tan(.5*Je*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,r,n,i,a){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Je*this.fov)/this.zoom,r=2*e,n=this.aspect*r,i=-.5*n;const a=this.view;if(null!==this.view&&this.view.enabled){const t=a.fullWidth,o=a.fullHeight;i+=a.offsetX*n/t,e-=a.offsetY*r/o,n*=a.width/t,r*=a.height/o}const o=this.filmOffset;0!==o&&(i+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,e,e-r,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}Gi.prototype.isPerspectiveCamera=!0;const ji=90;class Vi extends An{constructor(t,e,r){if(super(),this.type="CubeCamera",!0!==r.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=r;const n=new Gi(ji,1,t,e);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new Sr(1,0,0)),this.add(n);const i=new Gi(ji,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Sr(-1,0,0)),this.add(i);const a=new Gi(ji,1,t,e);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new Sr(0,1,0)),this.add(a);const o=new Gi(ji,1,t,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new Sr(0,-1,0)),this.add(o);const s=new Gi(ji,1,t,e);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new Sr(0,0,1)),this.add(s);const l=new Gi(ji,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Sr(0,0,-1)),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();const r=this.renderTarget,[n,i,a,o,s,l]=this.children,u=t.xr.enabled,c=t.getRenderTarget();t.xr.enabled=!1;const h=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,t.setRenderTarget(r,0),t.render(e,n),t.setRenderTarget(r,1),t.render(e,i),t.setRenderTarget(r,2),t.render(e,a),t.setRenderTarget(r,3),t.render(e,o),t.setRenderTarget(r,4),t.render(e,s),r.texture.generateMipmaps=h,t.setRenderTarget(r,5),t.render(e,l),t.setRenderTarget(c),t.xr.enabled=u}}class Hi extends vr{constructor(t,e,r,n,i,a,o,s,l,u){super(t=void 0!==t?t:[],e=void 0!==e?e:Q,r,n,i,a,o,s,l,u),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}Hi.prototype.isCubeTexture=!0;class Wi extends _r{constructor(t,e,r){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=r),super(t,t,e),e=e||{},this.texture=new Hi(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:ct,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.format=At,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new ki(5,5,5),i=new Bi({name:"CubemapFromEquirect",uniforms:Fi(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:c,blending:d});i.uniforms.tEquirect.value=e;const a=new Oi(n,i),o=e.minFilter;e.minFilter===dt&&(e.minFilter=ct);return new Vi(1,10,this).update(t,a),e.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(t,e,r,n){const i=t.getRenderTarget();for(let i=0;i<6;i++)t.setRenderTarget(this,i),t.clear(e,r,n);t.setRenderTarget(i)}}Wi.prototype.isWebGLCubeRenderTarget=!0;const qi=new Sr,Xi=new Sr,Yi=new lr;class Zi{constructor(t=new Sr(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,r,n){return this.normal.set(t,e,r),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,r){const n=qi.subVectors(r,e).cross(Xi.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const r=t.delta(qi),n=this.normal.dot(r);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const i=-(t.start.dot(this.normal)+this.constant)/n;return i<0||i>1?null:e.copy(r).multiplyScalar(i).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return e<0&&r>0||r<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const r=e||Yi.getNormalMatrix(t),n=this.coplanarPoint(qi).applyMatrix4(t),i=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(i),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Zi.prototype.isPlane=!0;const Ki=new qr,Ji=new Sr;class Qi{constructor(t=new Zi,e=new Zi,r=new Zi,n=new Zi,i=new Zi,a=new Zi){this.planes=[t,e,r,n,i,a]}set(t,e,r,n,i,a){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(r),o[3].copy(n),o[4].copy(i),o[5].copy(a),this}copy(t){const e=this.planes;for(let r=0;r<6;r++)e[r].copy(t.planes[r]);return this}setFromProjectionMatrix(t){const e=this.planes,r=t.elements,n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],l=r[5],u=r[6],c=r[7],h=r[8],d=r[9],f=r[10],p=r[11],m=r[12],g=r[13],v=r[14],y=r[15];return e[0].setComponents(o-n,c-s,p-h,y-m).normalize(),e[1].setComponents(o+n,c+s,p+h,y+m).normalize(),e[2].setComponents(o+i,c+l,p+d,y+g).normalize(),e[3].setComponents(o-i,c-l,p-d,y-g).normalize(),e[4].setComponents(o-a,c-u,p-f,y-v).normalize(),e[5].setComponents(o+a,c+u,p+f,y+v).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Ki.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Ki)}intersectsSprite(t){return Ki.center.set(0,0,0),Ki.radius=.7071067811865476,Ki.applyMatrix4(t.matrixWorld),this.intersectsSphere(Ki)}intersectsSphere(t){const e=this.planes,r=t.center,n=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(r)<n)return!1}return!0}intersectsBox(t){const e=this.planes;for(let r=0;r<6;r++){const n=e[r];if(Ji.x=n.normal.x>0?t.max.x:t.min.x,Ji.y=n.normal.y>0?t.max.y:t.min.y,Ji.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(Ji)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let r=0;r<6;r++)if(e[r].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function $i(){let t=null,e=!1,r=null,n=null;function i(e,a){r(e,a),n=t.requestAnimationFrame(i)}return{start:function(){!0!==e&&null!==r&&(n=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(t){r=t},setContext:function(e){t=e}}}function ta(t,e){const r=e.isWebGL2,n=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),n.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const r=n.get(e);r&&(t.deleteBuffer(r.buffer),n.delete(e))},update:function(e,i){if(e.isGLBufferAttribute){const t=n.get(e);return void((!t||t.version<e.version)&&n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const a=n.get(e);void 0===a?n.set(e,function(e,n){const i=e.array,a=e.usage,o=t.createBuffer();t.bindBuffer(n,o),t.bufferData(n,i,a),e.onUploadCallback();let s=5126;return i instanceof Float32Array?s=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?e.isFloat16BufferAttribute?r?s=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):s=5123:i instanceof Int16Array?s=5122:i instanceof Uint32Array?s=5125:i instanceof Int32Array?s=5124:i instanceof Int8Array?s=5120:(i instanceof Uint8Array||i instanceof Uint8ClampedArray)&&(s=5121),{buffer:o,type:s,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version}}(e,i)):a.version<e.version&&(!function(e,n,i){const a=n.array,o=n.updateRange;t.bindBuffer(i,e),-1===o.count?t.bufferSubData(i,0,a):(r?t.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):t.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1)}(a.buffer,e,i),a.version=e.version)}}}class ea extends mi{constructor(t=1,e=1,r=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:n};const i=t/2,a=e/2,o=Math.floor(r),s=Math.floor(n),l=o+1,u=s+1,c=t/o,h=e/s,d=[],f=[],p=[],m=[];for(let t=0;t<u;t++){const e=t*h-a;for(let r=0;r<l;r++){const n=r*c-i;f.push(n,-e,0),p.push(0,0,1),m.push(r/o),m.push(1-t/s)}}for(let t=0;t<s;t++)for(let e=0;e<o;e++){const r=e+l*t,n=e+l*(t+1),i=e+1+l*(t+1),a=e+1+l*t;d.push(r,n,a),d.push(n,i,a)}this.setIndex(d),this.setAttribute("position",new oi(f,3)),this.setAttribute("normal",new oi(p,3)),this.setAttribute("uv",new oi(m,2))}static fromJSON(t){return new ea(t.width,t.height,t.widthSegments,t.heightSegments)}}const ra={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= specularColorMapTexelToLinear( texture2D( specularColorMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= sheenColorMapTexelToLinear( texture2D( sheenColorMap, vUv ) ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},na={common:{diffuse:{value:new Xn(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new lr},uv2Transform:{value:new lr},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new sr(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Xn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Xn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new lr}},sprite:{diffuse:{value:new Xn(16777215)},opacity:{value:1},center:{value:new sr(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new lr}}},ia={basic:{uniforms:Ni([na.common,na.specularmap,na.envmap,na.aomap,na.lightmap,na.fog]),vertexShader:ra.meshbasic_vert,fragmentShader:ra.meshbasic_frag},lambert:{uniforms:Ni([na.common,na.specularmap,na.envmap,na.aomap,na.lightmap,na.emissivemap,na.fog,na.lights,{emissive:{value:new Xn(0)}}]),vertexShader:ra.meshlambert_vert,fragmentShader:ra.meshlambert_frag},phong:{uniforms:Ni([na.common,na.specularmap,na.envmap,na.aomap,na.lightmap,na.emissivemap,na.bumpmap,na.normalmap,na.displacementmap,na.fog,na.lights,{emissive:{value:new Xn(0)},specular:{value:new Xn(1118481)},shininess:{value:30}}]),vertexShader:ra.meshphong_vert,fragmentShader:ra.meshphong_frag},standard:{uniforms:Ni([na.common,na.envmap,na.aomap,na.lightmap,na.emissivemap,na.bumpmap,na.normalmap,na.displacementmap,na.roughnessmap,na.metalnessmap,na.fog,na.lights,{emissive:{value:new Xn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ra.meshphysical_vert,fragmentShader:ra.meshphysical_frag},toon:{uniforms:Ni([na.common,na.aomap,na.lightmap,na.emissivemap,na.bumpmap,na.normalmap,na.displacementmap,na.gradientmap,na.fog,na.lights,{emissive:{value:new Xn(0)}}]),vertexShader:ra.meshtoon_vert,fragmentShader:ra.meshtoon_frag},matcap:{uniforms:Ni([na.common,na.bumpmap,na.normalmap,na.displacementmap,na.fog,{matcap:{value:null}}]),vertexShader:ra.meshmatcap_vert,fragmentShader:ra.meshmatcap_frag},points:{uniforms:Ni([na.points,na.fog]),vertexShader:ra.points_vert,fragmentShader:ra.points_frag},dashed:{uniforms:Ni([na.common,na.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ra.linedashed_vert,fragmentShader:ra.linedashed_frag},depth:{uniforms:Ni([na.common,na.displacementmap]),vertexShader:ra.depth_vert,fragmentShader:ra.depth_frag},normal:{uniforms:Ni([na.common,na.bumpmap,na.normalmap,na.displacementmap,{opacity:{value:1}}]),vertexShader:ra.meshnormal_vert,fragmentShader:ra.meshnormal_frag},sprite:{uniforms:Ni([na.sprite,na.fog]),vertexShader:ra.sprite_vert,fragmentShader:ra.sprite_frag},background:{uniforms:{uvTransform:{value:new lr},t2D:{value:null}},vertexShader:ra.background_vert,fragmentShader:ra.background_frag},cube:{uniforms:Ni([na.envmap,{opacity:{value:1}}]),vertexShader:ra.cube_vert,fragmentShader:ra.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ra.equirect_vert,fragmentShader:ra.equirect_frag},distanceRGBA:{uniforms:Ni([na.common,na.displacementmap,{referencePosition:{value:new Sr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ra.distanceRGBA_vert,fragmentShader:ra.distanceRGBA_frag},shadow:{uniforms:Ni([na.lights,na.fog,{color:{value:new Xn(0)},opacity:{value:1}}]),vertexShader:ra.shadow_vert,fragmentShader:ra.shadow_frag}};function aa(t,e,r,n,i){const a=new Xn(0);let o,s,l=0,h=null,d=0,f=null;function p(t,e){r.buffers.color.setClear(t.r,t.g,t.b,e,i)}return{getClearColor:function(){return a},setClearColor:function(t,e=1){a.set(t),l=e,p(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(t){l=t,p(a,l)},render:function(r,i){let m=!1,g=!0===i.isScene?i.background:null;g&&g.isTexture&&(g=e.get(g));const v=t.xr,y=v.getSession&&v.getSession();y&&"additive"===y.environmentBlendMode&&(g=null),null===g?p(a,l):g&&g.isColor&&(p(g,1),m=!0),(t.autoClear||m)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),g&&(g.isCubeTexture||g.mapping===rt)?(void 0===s&&(s=new Oi(new ki(1,1,1),new Bi({name:"BackgroundCubeMaterial",uniforms:Fi(ia.cube.uniforms),vertexShader:ia.cube.vertexShader,fragmentShader:ia.cube.fragmentShader,side:c,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),s.geometry.deleteAttribute("uv"),s.onBeforeRender=function(t,e,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(s)),s.material.uniforms.envMap.value=g,s.material.uniforms.flipEnvMap.value=g.isCubeTexture&&!1===g.isRenderTargetTexture?-1:1,h===g&&d===g.version&&f===t.toneMapping||(s.material.needsUpdate=!0,h=g,d=g.version,f=t.toneMapping),r.unshift(s,s.geometry,s.material,0,0,null)):g&&g.isTexture&&(void 0===o&&(o=new Oi(new ea(2,2),new Bi({name:"BackgroundMaterial",uniforms:Fi(ia.background.uniforms),vertexShader:ia.background.vertexShader,fragmentShader:ia.background.fragmentShader,side:u,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=g,!0===g.matrixAutoUpdate&&g.updateMatrix(),o.material.uniforms.uvTransform.value.copy(g.matrix),h===g&&d===g.version&&f===t.toneMapping||(o.material.needsUpdate=!0,h=g,d=g.version,f=t.toneMapping),r.unshift(o,o.geometry,o.material,0,0,null))}}}function oa(t,e,r,n){const i=t.getParameter(34921),a=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||null!==a,s={},l=d(null);let u=l;function c(e){return n.isWebGL2?t.bindVertexArray(e):a.bindVertexArrayOES(e)}function h(e){return n.isWebGL2?t.deleteVertexArray(e):a.deleteVertexArrayOES(e)}function d(t){const e=[],r=[],n=[];for(let t=0;t<i;t++)e[t]=0,r[t]=0,n[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:r,attributeDivisors:n,object:t,attributes:{},index:null}}function f(){const t=u.newAttributes;for(let e=0,r=t.length;e<r;e++)t[e]=0}function p(t){m(t,0)}function m(r,i){const a=u.newAttributes,o=u.enabledAttributes,s=u.attributeDivisors;if(a[r]=1,0===o[r]&&(t.enableVertexAttribArray(r),o[r]=1),s[r]!==i){(n.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](r,i),s[r]=i}}function g(){const e=u.newAttributes,r=u.enabledAttributes;for(let n=0,i=r.length;n<i;n++)r[n]!==e[n]&&(t.disableVertexAttribArray(n),r[n]=0)}function v(e,r,i,a,o,s){!0!==n.isWebGL2||5124!==i&&5125!==i?t.vertexAttribPointer(e,r,i,a,o,s):t.vertexAttribIPointer(e,r,i,o,s)}function y(){x(),u!==l&&(u=l,c(u.object))}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,h,y,x){let _=!1;if(o){const e=function(e,r,i){const o=!0===i.wireframe;let l=s[e.id];void 0===l&&(l={},s[e.id]=l);let u=l[r.id];void 0===u&&(u={},l[r.id]=u);let c=u[o];void 0===c&&(c=d(n.isWebGL2?t.createVertexArray():a.createVertexArrayOES()),u[o]=c);return c}(y,h,l);u!==e&&(u=e,c(u.object)),_=function(t,e){const r=u.attributes,n=t.attributes;let i=0;for(const t in n){const e=r[t],a=n[t];if(void 0===e)return!0;if(e.attribute!==a)return!0;if(e.data!==a.data)return!0;i++}return u.attributesNum!==i||u.index!==e}(y,x),_&&function(t,e){const r={},n=t.attributes;let i=0;for(const t in n){const e=n[t],a={};a.attribute=e,e.data&&(a.data=e.data),r[t]=a,i++}u.attributes=r,u.attributesNum=i,u.index=e}(y,x)}else{const t=!0===l.wireframe;u.geometry===y.id&&u.program===h.id&&u.wireframe===t||(u.geometry=y.id,u.program=h.id,u.wireframe=t,_=!0)}!0===i.isInstancedMesh&&(_=!0),null!==x&&r.update(x,34963),_&&(!function(i,a,o,s){if(!1===n.isWebGL2&&(i.isInstancedMesh||s.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;f();const l=s.attributes,u=o.getAttributes(),c=a.defaultAttributeValues;for(const e in u){const n=u[e];if(n.location>=0){let a=l[e];if(void 0===a&&("instanceMatrix"===e&&i.instanceMatrix&&(a=i.instanceMatrix),"instanceColor"===e&&i.instanceColor&&(a=i.instanceColor)),void 0!==a){const e=a.normalized,o=a.itemSize,l=r.get(a);if(void 0===l)continue;const u=l.buffer,c=l.type,h=l.bytesPerElement;if(a.isInterleavedBufferAttribute){const r=a.data,l=r.stride,d=a.offset;if(r&&r.isInstancedInterleavedBuffer){for(let t=0;t<n.locationSize;t++)m(n.location+t,r.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=r.meshPerAttribute*r.count)}else for(let t=0;t<n.locationSize;t++)p(n.location+t);t.bindBuffer(34962,u);for(let t=0;t<n.locationSize;t++)v(n.location+t,o/n.locationSize,c,e,l*h,(d+o/n.locationSize*t)*h)}else{if(a.isInstancedBufferAttribute){for(let t=0;t<n.locationSize;t++)m(n.location+t,a.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=a.meshPerAttribute*a.count)}else for(let t=0;t<n.locationSize;t++)p(n.location+t);t.bindBuffer(34962,u);for(let t=0;t<n.locationSize;t++)v(n.location+t,o/n.locationSize,c,e,o*h,o/n.locationSize*t*h)}}else if(void 0!==c){const r=c[e];if(void 0!==r)switch(r.length){case 2:t.vertexAttrib2fv(n.location,r);break;case 3:t.vertexAttrib3fv(n.location,r);break;case 4:t.vertexAttrib4fv(n.location,r);break;default:t.vertexAttrib1fv(n.location,r)}}}}g()}(i,l,h,y),null!==x&&t.bindBuffer(34963,r.get(x).buffer))},reset:y,resetDefaultState:x,dispose:function(){y();for(const t in s){const e=s[t];for(const t in e){const r=e[t];for(const t in r)h(r[t].object),delete r[t];delete e[t]}delete s[t]}},releaseStatesOfGeometry:function(t){if(void 0===s[t.id])return;const e=s[t.id];for(const t in e){const r=e[t];for(const t in r)h(r[t].object),delete r[t];delete e[t]}delete s[t.id]},releaseStatesOfProgram:function(t){for(const e in s){const r=s[e];if(void 0===r[t.id])continue;const n=r[t.id];for(const t in n)h(n[t].object),delete n[t];delete r[t.id]}},initAttributes:f,enableAttribute:p,disableUnusedAttributes:g}}function sa(t,e,r,n){const i=n.isWebGL2;let a;this.setMode=function(t){a=t},this.render=function(e,n){t.drawArrays(a,e,n),r.update(n,a,1)},this.renderInstances=function(n,o,s){if(0===s)return;let l,u;if(i)l=t,u="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),u="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[u](a,n,o,s),r.update(o,a,s)}}function la(t,e,r){let n;function i(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const a="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let o=void 0!==r.precision?r.precision:"highp";const s=i(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);const l=a||e.has("WEBGL_draw_buffers"),u=!0===r.logarithmicDepthBuffer,c=t.getParameter(34930),h=t.getParameter(35660),d=t.getParameter(3379),f=t.getParameter(34076),p=t.getParameter(34921),m=t.getParameter(36347),g=t.getParameter(36348),v=t.getParameter(36349),y=h>0,x=a||e.has("OES_texture_float");return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===e.has("EXT_texture_filter_anisotropic")){const r=e.get("EXT_texture_filter_anisotropic");n=t.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:u,maxTextures:c,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:f,maxAttributes:p,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:x,floatVertexTextures:y&&x,maxSamples:a?t.getParameter(36183):0}}function ua(t){const e=this;let r=null,n=0,i=!1,a=!1;const o=new Zi,s=new lr,l={value:null,needsUpdate:!1};function u(){l.value!==r&&(l.value=r,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function c(t,r,n,i){const a=null!==t?t.length:0;let u=null;if(0!==a){if(u=l.value,!0!==i||null===u){const e=n+4*a,i=r.matrixWorldInverse;s.getNormalMatrix(i),(null===u||u.length<e)&&(u=new Float32Array(e));for(let e=0,r=n;e!==a;++e,r+=4)o.copy(t[e]).applyMatrix4(i,s),o.normal.toArray(u,r),u[r+3]=o.constant}l.value=u,l.needsUpdate=!0}return e.numPlanes=a,e.numIntersection=0,u}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,a){const o=0!==t.length||e||0!==n||i;return i=e,r=c(t,a,0),n=t.length,o},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1,u()},this.setState=function(e,o,s){const h=e.clippingPlanes,d=e.clipIntersection,f=e.clipShadows,p=t.get(e);if(!i||null===h||0===h.length||a&&!f)a?c(null):u();else{const t=a?0:n,e=4*t;let i=p.clippingState||null;l.value=i,i=c(h,o,e,s);for(let t=0;t!==e;++t)i[t]=r[t];p.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function ca(t){let e=new WeakMap;function r(t,e){return e===tt?t.mapping=Q:e===et&&(t.mapping=$),t}function n(t){const r=t.target;r.removeEventListener("dispose",n);const i=e.get(r);void 0!==i&&(e.delete(r),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){const a=i.mapping;if(a===tt||a===et){if(e.has(i)){return r(e.get(i).texture,i.mapping)}{const a=i.image;if(a&&a.height>0){const o=t.getRenderTarget(),s=new Wi(a.height/2);return s.fromEquirectangularTexture(t,i),e.set(i,s),t.setRenderTarget(o),i.addEventListener("dispose",n),r(s.texture,i.mapping)}return null}}}return i},dispose:function(){e=new WeakMap}}}ia.physical={uniforms:Ni([ia.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new sr(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Xn(0)},sheenColorMap:{value:null},sheenRoughness:{value:0},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new sr},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Xn(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularColor:{value:new Xn(1,1,1)},specularColorMap:{value:null}}]),vertexShader:ra.meshphysical_vert,fragmentShader:ra.meshphysical_frag};class ha extends zi{constructor(t=-1,e=1,r=1,n=-1,i=.1,a=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=r,this.bottom=n,this.near=i,this.far=a,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,r,n,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let i=r-t,a=r+t,o=n+e,s=n-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=t*this.view.offsetX,a=i+t*this.view.width,o-=e*this.view.offsetY,s=o-e*this.view.height}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}ha.prototype.isOrthographicCamera=!0;class da extends Bi{constructor(t){super(t),this.type="RawShaderMaterial"}}da.prototype.isRawShaderMaterial=!0;const fa=4,pa=8,ma=Math.pow(2,pa),ga=[.125,.215,.35,.446,.526,.582],va=pa-fa+1+ga.length,ya=20,xa={[De]:0,[ke]:1,[Ne]:2,[Ue]:3,[Be]:4,[ze]:5,[Fe]:6},_a=new ha,{_lodPlanes:wa,_sizeLods:ba,_sigmas:Ma}=Ia(),Sa=new Xn;let Ta=null;const Ea=(1+Math.sqrt(5))/2,Aa=1/Ea,Ra=[new Sr(1,1,1),new Sr(-1,1,1),new Sr(1,1,-1),new Sr(-1,1,-1),new Sr(0,Ea,Aa),new Sr(0,Ea,-Aa),new Sr(Aa,0,Ea),new Sr(-Aa,0,Ea),new Sr(Ea,Aa,0),new Sr(-Ea,Aa,0)];class Pa{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function(t){const e=new Float32Array(t),r=new Sr(0,1,0);return new da({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r},inputEncoding:{value:xa[De]},outputEncoding:{value:xa[De]}},vertexShader:Fa(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${Na()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:d,depthTest:!1,depthWrite:!1})}(ya),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,r=.1,n=100){Ta=this._renderer.getRenderTarget();const i=this._allocateTargets();return this._sceneToCubeUV(t,r,n,i),e>0&&this._blur(i,0,0,e),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(t){return this._fromTexture(t)}fromCubemap(t){return this._fromTexture(t)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=ka(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=Da(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<wa.length;t++)wa[t].dispose()}_cleanup(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Ta),t.scissorTest=!1,Oa(t,0,0,t.width,t.height)}_fromTexture(t){Ta=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e}_allocateTargets(t){const e={magFilter:st,minFilter:st,generateMipmaps:!1,type:ft,format:Ct,encoding:Ca(t)?t.encoding:Ne,depthBuffer:!1},r=La(e);return r.depthBuffer=!t,this._pingPongRenderTarget=La(e),r}_compileMaterial(t){const e=new Oi(wa[0],t);this._renderer.compile(e,_a)}_sceneToCubeUV(t,e,r,n){const i=new Gi(90,1,e,r),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,l=s.autoClear,u=s.outputEncoding,h=s.toneMapping;s.getClearColor(Sa),s.toneMapping=W,s.outputEncoding=De,s.autoClear=!1;const d=new Yn({name:"PMREM.Background",side:c,depthWrite:!1,depthTest:!1}),f=new Oi(new ki,d);let p=!1;const m=t.background;m?m.isColor&&(d.color.copy(m),t.background=null,p=!0):(d.color.copy(Sa),p=!0);for(let e=0;e<6;e++){const r=e%3;0==r?(i.up.set(0,a[e],0),i.lookAt(o[e],0,0)):1==r?(i.up.set(0,0,a[e]),i.lookAt(0,o[e],0)):(i.up.set(0,a[e],0),i.lookAt(0,0,o[e])),Oa(n,r*ma,e>2?ma:0,ma,ma),s.setRenderTarget(n),p&&s.render(f,i),s.render(t,i)}f.geometry.dispose(),f.material.dispose(),s.toneMapping=h,s.outputEncoding=u,s.autoClear=l,t.background=m}_setEncoding(t,e){t.value=xa[e.encoding]}_textureToCubeUV(t,e){const r=this._renderer,n=t.mapping===Q||t.mapping===$;n?null==this._cubemapShader&&(this._cubemapShader=ka()):null==this._equirectShader&&(this._equirectShader=Da());const i=n?this._cubemapShader:this._equirectShader,a=new Oi(wa[0],i),o=i.uniforms;o.envMap.value=t,n||o.texelSize.value.set(1/t.image.width,1/t.image.height),this._setEncoding(o.inputEncoding,t),this._setEncoding(o.outputEncoding,e.texture),Oa(e,0,0,3*ma,2*ma),r.setRenderTarget(e),r.render(a,_a)}_applyPMREM(t){const e=this._renderer,r=e.autoClear;e.autoClear=!1;for(let e=1;e<va;e++){const r=Math.sqrt(Ma[e]*Ma[e]-Ma[e-1]*Ma[e-1]),n=Ra[(e-1)%Ra.length];this._blur(t,e-1,e,r,n)}e.autoClear=r}_blur(t,e,r,n,i){const a=this._pingPongRenderTarget;this._halfBlur(t,a,e,r,n,"latitudinal",i),this._halfBlur(a,t,r,r,n,"longitudinal",i)}_halfBlur(t,e,r,n,i,a,o){const s=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const u=new Oi(wa[n],l),c=l.uniforms,h=ba[r]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,f=i/d,p=isFinite(i)?1+Math.floor(3*f):ya;p>ya&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${p} samples when the maximum is set to 20`);const m=[];let g=0;for(let t=0;t<ya;++t){const e=t/f,r=Math.exp(-e*e/2);m.push(r),0==t?g+=r:t<p&&(g+=2*r)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;c.envMap.value=t.texture,c.samples.value=p,c.weights.value=m,c.latitudinal.value="latitudinal"===a,o&&(c.poleAxis.value=o),c.dTheta.value=d,c.mipInt.value=pa-r,this._setEncoding(c.inputEncoding,t.texture),this._setEncoding(c.outputEncoding,t.texture);const v=ba[n];Oa(e,3*Math.max(0,ma-2*v),(0===n?0:2*ma)+2*v*(n>pa-fa?n-pa+fa:0),3*v,2*v),s.setRenderTarget(e),s.render(u,_a)}}function Ca(t){return void 0!==t&&t.type===ft&&(t.encoding===De||t.encoding===ke||t.encoding===Fe)}function Ia(){const t=[],e=[],r=[];let n=pa;for(let i=0;i<va;i++){const a=Math.pow(2,n);e.push(a);let o=1/a;i>pa-fa?o=ga[i-pa+fa-1]:0==i&&(o=0),r.push(o);const s=1/(a-1),l=-s/2,u=1+s/2,c=[l,l,u,l,u,u,l,l,u,u,l,u],h=6,d=6,f=3,p=2,m=1,g=new Float32Array(f*d*h),v=new Float32Array(p*d*h),y=new Float32Array(m*d*h);for(let t=0;t<h;t++){const e=t%3*2/3-1,r=t>2?0:-1,n=[e,r,0,e+2/3,r,0,e+2/3,r+1,0,e,r,0,e+2/3,r+1,0,e,r+1,0];g.set(n,f*d*t),v.set(c,p*d*t);const i=[t,t,t,t,t,t];y.set(i,m*d*t)}const x=new mi;x.setAttribute("position",new Jn(g,f)),x.setAttribute("uv",new Jn(v,p)),x.setAttribute("faceIndex",new Jn(y,m)),t.push(x),n>fa&&n--}return{_lodPlanes:t,_sizeLods:e,_sigmas:r}}function La(t){const e=new _r(3*ma,3*ma,t);return e.texture.mapping=rt,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Oa(t,e,r,n,i){t.viewport.set(e,r,n,i),t.scissor.set(e,r,n,i)}function Da(){const t=new sr(1,1);return new da({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:t},inputEncoding:{value:xa[De]},outputEncoding:{value:xa[De]}},vertexShader:Fa(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${Na()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:d,depthTest:!1,depthWrite:!1})}function ka(){return new da({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:xa[De]},outputEncoding:{value:xa[De]}},vertexShader:Fa(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${Na()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:d,depthTest:!1,depthWrite:!1})}function Fa(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Na(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}function Ua(t){let e=new WeakMap,r=null;function n(t){const r=t.target;r.removeEventListener("dispose",n);const i=e.get(r);void 0!==i&&(e.delete(r),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){const a=i.mapping,o=a===tt||a===et,s=a===Q||a===$;if(o||s){if(e.has(i))return e.get(i).texture;{const a=i.image;if(o&&a&&a.height>0||s&&a&&function(t){let e=0;const r=6;for(let n=0;n<r;n++)void 0!==t[n]&&e++;return e===r}(a)){const a=t.getRenderTarget();null===r&&(r=new Pa(t));const s=o?r.fromEquirectangular(i):r.fromCubemap(i);return e.set(i,s),t.setRenderTarget(a),i.addEventListener("dispose",n),s.texture}return null}}}return i},dispose:function(){e=new WeakMap,null!==r&&(r.dispose(),r=null)}}}function Ba(t){const e={};function r(r){if(void 0!==e[r])return e[r];let n;switch(r){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(r)}return e[r]=n,n}return{has:function(t){return null!==r(t)},init:function(t){t.isWebGL2?r("EXT_color_buffer_float"):(r("WEBGL_depth_texture"),r("OES_texture_float"),r("OES_texture_half_float"),r("OES_texture_half_float_linear"),r("OES_standard_derivatives"),r("OES_element_index_uint"),r("OES_vertex_array_object"),r("ANGLE_instanced_arrays")),r("OES_texture_float_linear"),r("EXT_color_buffer_half_float"),r("WEBGL_multisampled_render_to_texture")},get:function(t){const e=r(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function za(t,e,r,n){const i={},a=new WeakMap;function o(t){const s=t.target;null!==s.index&&e.remove(s.index);for(const t in s.attributes)e.remove(s.attributes[t]);s.removeEventListener("dispose",o),delete i[s.id];const l=a.get(s);l&&(e.remove(l),a.delete(s)),n.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,r.memory.geometries--}function s(t){const r=[],n=t.index,i=t.attributes.position;let o=0;if(null!==n){const t=n.array;o=n.version;for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],i=t[e+1],a=t[e+2];r.push(n,i,i,a,a,n)}}else{const t=i.array;o=i.version;for(let e=0,n=t.length/3-1;e<n;e+=3){const t=e+0,n=e+1,i=e+2;r.push(t,n,n,i,i,t)}}const s=new(ur(r)>65535?ii:ri)(r,1);s.version=o;const l=a.get(t);l&&e.remove(l),a.set(t,s)}return{get:function(t,e){return!0===i[e.id]||(e.addEventListener("dispose",o),i[e.id]=!0,r.memory.geometries++),e},update:function(t){const r=t.attributes;for(const t in r)e.update(r[t],34962);const n=t.morphAttributes;for(const t in n){const r=n[t];for(let t=0,n=r.length;t<n;t++)e.update(r[t],34962)}},getWireframeAttribute:function(t){const e=a.get(t);if(e){const r=t.index;null!==r&&e.version<r.version&&s(t)}else s(t);return a.get(t)}}}function Ga(t,e,r,n){const i=n.isWebGL2;let a,o,s;this.setMode=function(t){a=t},this.setIndex=function(t){o=t.type,s=t.bytesPerElement},this.render=function(e,n){t.drawElements(a,n,o,e*s),r.update(n,a,1)},this.renderInstances=function(n,l,u){if(0===u)return;let c,h;if(i)c=t,h="drawElementsInstanced";else if(c=e.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===c)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[h](a,l,o,n*s,u),r.update(l,a,u)}}function ja(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,r,n){switch(e.calls++,r){case 4:e.triangles+=n*(t/3);break;case 1:e.lines+=n*(t/2);break;case 3:e.lines+=n*(t-1);break;case 2:e.lines+=n*t;break;case 0:e.points+=n*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}class Va extends vr{constructor(t=null,e=1,r=1,n=1){super(null),this.image={data:t,width:e,height:r,depth:n},this.magFilter=st,this.minFilter=st,this.wrapR=at,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}function Ha(t,e){return t[0]-e[0]}function Wa(t,e){return Math.abs(e[1])-Math.abs(t[1])}function qa(t,e){let r=1;const n=e.isInterleavedBufferAttribute?e.data.array:e.array;n instanceof Int8Array?r=127:n instanceof Int16Array?r=32767:n instanceof Int32Array?r=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),t.divideScalar(r)}function Xa(t,e,r){const n={},i=new Float32Array(8),a=new WeakMap,o=new Sr,s=[];for(let t=0;t<8;t++)s[t]=[t,0];return{update:function(l,u,c,h){const d=l.morphTargetInfluences;if(!0===e.isWebGL2){const n=u.morphAttributes.position.length;let i=a.get(u);if(void 0===i||i.count!==n){void 0!==i&&i.texture.dispose();const t=void 0!==u.morphAttributes.normal,r=u.morphAttributes.position,s=u.morphAttributes.normal||[],l=!0===t?2:1;let c=u.attributes.position.count*l,h=1;c>e.maxTextureSize&&(h=Math.ceil(c/e.maxTextureSize),c=e.maxTextureSize);const d=new Float32Array(c*h*4*n),f=new Va(d,c,h,n);f.format=At,f.type=xt;const p=4*l;for(let e=0;e<n;e++){const n=r[e],i=s[e],a=c*h*4*e;for(let e=0;e<n.count;e++){o.fromBufferAttribute(n,e),!0===n.normalized&&qa(o,n);const r=e*p;d[a+r+0]=o.x,d[a+r+1]=o.y,d[a+r+2]=o.z,d[a+r+3]=0,!0===t&&(o.fromBufferAttribute(i,e),!0===i.normalized&&qa(o,i),d[a+r+4]=o.x,d[a+r+5]=o.y,d[a+r+6]=o.z,d[a+r+7]=0)}}i={count:n,texture:f,size:new sr(c,h)},a.set(u,i)}let s=0;for(let t=0;t<d.length;t++)s+=d[t];const l=u.morphTargetsRelative?1:1-s;h.getUniforms().setValue(t,"morphTargetBaseInfluence",l),h.getUniforms().setValue(t,"morphTargetInfluences",d),h.getUniforms().setValue(t,"morphTargetsTexture",i.texture,r),h.getUniforms().setValue(t,"morphTargetsTextureSize",i.size)}else{const e=void 0===d?0:d.length;let r=n[u.id];if(void 0===r||r.length!==e){r=[];for(let t=0;t<e;t++)r[t]=[t,0];n[u.id]=r}for(let t=0;t<e;t++){const e=r[t];e[0]=t,e[1]=d[t]}r.sort(Wa);for(let t=0;t<8;t++)t<e&&r[t][1]?(s[t][0]=r[t][0],s[t][1]=r[t][1]):(s[t][0]=Number.MAX_SAFE_INTEGER,s[t][1]=0);s.sort(Ha);const a=u.morphAttributes.position,o=u.morphAttributes.normal;let l=0;for(let t=0;t<8;t++){const e=s[t],r=e[0],n=e[1];r!==Number.MAX_SAFE_INTEGER&&n?(a&&u.getAttribute("morphTarget"+t)!==a[r]&&u.setAttribute("morphTarget"+t,a[r]),o&&u.getAttribute("morphNormal"+t)!==o[r]&&u.setAttribute("morphNormal"+t,o[r]),i[t]=n,l+=n):(a&&!0===u.hasAttribute("morphTarget"+t)&&u.deleteAttribute("morphTarget"+t),o&&!0===u.hasAttribute("morphNormal"+t)&&u.deleteAttribute("morphNormal"+t),i[t]=0)}const c=u.morphTargetsRelative?1:1-l;h.getUniforms().setValue(t,"morphTargetBaseInfluence",c),h.getUniforms().setValue(t,"morphTargetInfluences",i)}}}}function Ya(t,e,r,n){let i=new WeakMap;function a(t){const e=t.target;e.removeEventListener("dispose",a),r.remove(e.instanceMatrix),null!==e.instanceColor&&r.remove(e.instanceColor)}return{update:function(t){const o=n.render.frame,s=t.geometry,l=e.get(t,s);return i.get(l)!==o&&(e.update(l),i.set(l,o)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",a)&&t.addEventListener("dispose",a),r.update(t.instanceMatrix,34962),null!==t.instanceColor&&r.update(t.instanceColor,34962)),l},dispose:function(){i=new WeakMap}}}Va.prototype.isDataTexture2DArray=!0;class Za extends vr{constructor(t=null,e=1,r=1,n=1){super(null),this.image={data:t,width:e,height:r,depth:n},this.magFilter=st,this.minFilter=st,this.wrapR=at,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Za.prototype.isDataTexture3D=!0;const Ka=new vr,Ja=new Va,Qa=new Za,$a=new Hi,to=[],eo=[],ro=new Float32Array(16),no=new Float32Array(9),io=new Float32Array(4);function ao(t,e,r){const n=t[0];if(n<=0||n>0)return t;const i=e*r;let a=to[i];if(void 0===a&&(a=new Float32Array(i),to[i]=a),0!==e){n.toArray(a,0);for(let n=1,i=0;n!==e;++n)i+=r,t[n].toArray(a,i)}return a}function oo(t,e){if(t.length!==e.length)return!1;for(let r=0,n=t.length;r<n;r++)if(t[r]!==e[r])return!1;return!0}function so(t,e){for(let r=0,n=e.length;r<n;r++)t[r]=e[r]}function lo(t,e){let r=eo[e];void 0===r&&(r=new Int32Array(e),eo[e]=r);for(let n=0;n!==e;++n)r[n]=t.allocateTextureUnit();return r}function uo(t,e){const r=this.cache;r[0]!==e&&(t.uniform1f(this.addr,e),r[0]=e)}function co(t,e){const r=this.cache;if(void 0!==e.x)r[0]===e.x&&r[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),r[0]=e.x,r[1]=e.y);else{if(oo(r,e))return;t.uniform2fv(this.addr,e),so(r,e)}}function ho(t,e){const r=this.cache;if(void 0!==e.x)r[0]===e.x&&r[1]===e.y&&r[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),r[0]=e.x,r[1]=e.y,r[2]=e.z);else if(void 0!==e.r)r[0]===e.r&&r[1]===e.g&&r[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),r[0]=e.r,r[1]=e.g,r[2]=e.b);else{if(oo(r,e))return;t.uniform3fv(this.addr,e),so(r,e)}}function fo(t,e){const r=this.cache;if(void 0!==e.x)r[0]===e.x&&r[1]===e.y&&r[2]===e.z&&r[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=e.w);else{if(oo(r,e))return;t.uniform4fv(this.addr,e),so(r,e)}}function po(t,e){const r=this.cache,n=e.elements;if(void 0===n){if(oo(r,e))return;t.uniformMatrix2fv(this.addr,!1,e),so(r,e)}else{if(oo(r,n))return;io.set(n),t.uniformMatrix2fv(this.addr,!1,io),so(r,n)}}function mo(t,e){const r=this.cache,n=e.elements;if(void 0===n){if(oo(r,e))return;t.uniformMatrix3fv(this.addr,!1,e),so(r,e)}else{if(oo(r,n))return;no.set(n),t.uniformMatrix3fv(this.addr,!1,no),so(r,n)}}function go(t,e){const r=this.cache,n=e.elements;if(void 0===n){if(oo(r,e))return;t.uniformMatrix4fv(this.addr,!1,e),so(r,e)}else{if(oo(r,n))return;ro.set(n),t.uniformMatrix4fv(this.addr,!1,ro),so(r,n)}}function vo(t,e){const r=this.cache;r[0]!==e&&(t.uniform1i(this.addr,e),r[0]=e)}function yo(t,e){const r=this.cache;oo(r,e)||(t.uniform2iv(this.addr,e),so(r,e))}function xo(t,e){const r=this.cache;oo(r,e)||(t.uniform3iv(this.addr,e),so(r,e))}function _o(t,e){const r=this.cache;oo(r,e)||(t.uniform4iv(this.addr,e),so(r,e))}function wo(t,e){const r=this.cache;r[0]!==e&&(t.uniform1ui(this.addr,e),r[0]=e)}function bo(t,e){const r=this.cache;oo(r,e)||(t.uniform2uiv(this.addr,e),so(r,e))}function Mo(t,e){const r=this.cache;oo(r,e)||(t.uniform3uiv(this.addr,e),so(r,e))}function So(t,e){const r=this.cache;oo(r,e)||(t.uniform4uiv(this.addr,e),so(r,e))}function To(t,e,r){const n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.safeSetTexture2D(e||Ka,i)}function Eo(t,e,r){const n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.setTexture3D(e||Qa,i)}function Ao(t,e,r){const n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.safeSetTextureCube(e||$a,i)}function Ro(t,e,r){const n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.setTexture2DArray(e||Ja,i)}function Po(t,e){t.uniform1fv(this.addr,e)}function Co(t,e){const r=ao(e,this.size,2);t.uniform2fv(this.addr,r)}function Io(t,e){const r=ao(e,this.size,3);t.uniform3fv(this.addr,r)}function Lo(t,e){const r=ao(e,this.size,4);t.uniform4fv(this.addr,r)}function Oo(t,e){const r=ao(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,r)}function Do(t,e){const r=ao(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,r)}function ko(t,e){const r=ao(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,r)}function Fo(t,e){t.uniform1iv(this.addr,e)}function No(t,e){t.uniform2iv(this.addr,e)}function Uo(t,e){t.uniform3iv(this.addr,e)}function Bo(t,e){t.uniform4iv(this.addr,e)}function zo(t,e){t.uniform1uiv(this.addr,e)}function Go(t,e){t.uniform2uiv(this.addr,e)}function jo(t,e){t.uniform3uiv(this.addr,e)}function Vo(t,e){t.uniform4uiv(this.addr,e)}function Ho(t,e,r){const n=e.length,i=lo(r,n);t.uniform1iv(this.addr,i);for(let t=0;t!==n;++t)r.safeSetTexture2D(e[t]||Ka,i[t])}function Wo(t,e,r){const n=e.length,i=lo(r,n);t.uniform1iv(this.addr,i);for(let t=0;t!==n;++t)r.setTexture3D(e[t]||Qa,i[t])}function qo(t,e,r){const n=e.length,i=lo(r,n);t.uniform1iv(this.addr,i);for(let t=0;t!==n;++t)r.safeSetTextureCube(e[t]||$a,i[t])}function Xo(t,e,r){const n=e.length,i=lo(r,n);t.uniform1iv(this.addr,i);for(let t=0;t!==n;++t)r.setTexture2DArray(e[t]||Ja,i[t])}function Yo(t,e,r){this.id=t,this.addr=r,this.cache=[],this.setValue=function(t){switch(t){case 5126:return uo;case 35664:return co;case 35665:return ho;case 35666:return fo;case 35674:return po;case 35675:return mo;case 35676:return go;case 5124:case 35670:return vo;case 35667:case 35671:return yo;case 35668:case 35672:return xo;case 35669:case 35673:return _o;case 5125:return wo;case 36294:return bo;case 36295:return Mo;case 36296:return So;case 35678:case 36198:case 36298:case 36306:case 35682:return To;case 35679:case 36299:case 36307:return Eo;case 35680:case 36300:case 36308:case 36293:return Ao;case 36289:case 36303:case 36311:case 36292:return Ro}}(e.type)}function Zo(t,e,r){this.id=t,this.addr=r,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Po;case 35664:return Co;case 35665:return Io;case 35666:return Lo;case 35674:return Oo;case 35675:return Do;case 35676:return ko;case 5124:case 35670:return Fo;case 35667:case 35671:return No;case 35668:case 35672:return Uo;case 35669:case 35673:return Bo;case 5125:return zo;case 36294:return Go;case 36295:return jo;case 36296:return Vo;case 35678:case 36198:case 36298:case 36306:case 35682:return Ho;case 35679:case 36299:case 36307:return Wo;case 35680:case 36300:case 36308:case 36293:return qo;case 36289:case 36303:case 36311:case 36292:return Xo}}(e.type)}function Ko(t){this.id=t,this.seq=[],this.map={}}Zo.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),so(e,t)},Ko.prototype.setValue=function(t,e,r){const n=this.seq;for(let i=0,a=n.length;i!==a;++i){const a=n[i];a.setValue(t,e[a.id],r)}};const Jo=/(\w+)(\])?(\[|\.)?/g;function Qo(t,e){t.seq.push(e),t.map[e.id]=e}function $o(t,e,r){const n=t.name,i=n.length;for(Jo.lastIndex=0;;){const a=Jo.exec(n),o=Jo.lastIndex;let s=a[1];const l="]"===a[2],u=a[3];if(l&&(s|=0),void 0===u||"["===u&&o+2===i){Qo(r,void 0===u?new Yo(s,t,e):new Zo(s,t,e));break}{let t=r.map[s];void 0===t&&(t=new Ko(s),Qo(r,t)),r=t}}}function ts(t,e){this.seq=[],this.map={};const r=t.getProgramParameter(e,35718);for(let n=0;n<r;++n){const r=t.getActiveUniform(e,n);$o(r,t.getUniformLocation(e,r.name),this)}}function es(t,e,r){const n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),n}ts.prototype.setValue=function(t,e,r,n){const i=this.map[e];void 0!==i&&i.setValue(t,r,n)},ts.prototype.setOptional=function(t,e,r){const n=e[r];void 0!==n&&this.setValue(t,r,n)},ts.upload=function(t,e,r,n){for(let i=0,a=e.length;i!==a;++i){const a=e[i],o=r[a.id];!1!==o.needsUpdate&&a.setValue(t,o.value,n)}},ts.seqWithValue=function(t,e){const r=[];for(let n=0,i=t.length;n!==i;++n){const i=t[n];i.id in e&&r.push(i)}return r};let rs=0;function ns(t){switch(t){case De:return["Linear","( value )"];case ke:return["sRGB","( value )"];case Ne:return["RGBE","( value )"];case Ue:return["RGBM","( value, 7.0 )"];case Be:return["RGBM","( value, 16.0 )"];case ze:return["RGBD","( value, 256.0 )"];case Fe:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function is(t,e,r){const n=t.getShaderParameter(e,35713),i=t.getShaderInfoLog(e).trim();return n&&""===i?"":r.toUpperCase()+"\n\n"+i+"\n\n"+function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function as(t,e){const r=ns(e);return"vec4 "+t+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function os(t,e){const r=ns(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}function ss(t,e){let r;switch(e){case q:r="Linear";break;case X:r="Reinhard";break;case Y:r="OptimizedCineon";break;case Z:r="ACESFilmic";break;case K:r="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),r="Linear"}return"vec3 "+t+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function ls(t){return""!==t}function us(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function cs(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const hs=/^[ \t]*#include +<([\w\d./]+)>/gm;function ds(t){return t.replace(hs,fs)}function fs(t,e){const r=ra[e];if(void 0===r)throw new Error("Can not resolve #include <"+e+">");return ds(r)}const ps=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,ms=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function gs(t){return t.replace(ms,ys).replace(ps,vs)}function vs(t,e,r,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),ys(t,e,r,n)}function ys(t,e,r,n){let i="";for(let t=parseInt(e);t<parseInt(r);t++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return i}function xs(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function _s(t,e,r,n){const i=t.getContext(),a=r.defines;let u=r.vertexShader,c=r.fragmentShader;const h=function(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===o?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===s?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===l&&(e="SHADOWMAP_TYPE_VSM"),e}(r),d=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Q:case $:e="ENVMAP_TYPE_CUBE";break;case rt:case nt:e="ENVMAP_TYPE_CUBE_UV"}return e}(r),f=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case $:case nt:e="ENVMAP_MODE_REFRACTION"}return e}(r),p=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case j:e="ENVMAP_BLENDING_MULTIPLY";break;case V:e="ENVMAP_BLENDING_MIX";break;case H:e="ENVMAP_BLENDING_ADD"}return e}(r),m=t.gammaFactor>0?t.gammaFactor:1,g=r.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ls).join("\n")}(r),v=function(t){const e=[];for(const r in t){const n=t[r];!1!==n&&e.push("#define "+r+" "+n)}return e.join("\n")}(a),y=i.createProgram();let x,_,w=r.glslVersion?"#version "+r.glslVersion+"\n":"";r.isRawShaderMaterial?(x=[v].filter(ls).join("\n"),x.length>0&&(x+="\n"),_=[g,v].filter(ls).join("\n"),_.length>0&&(_+="\n")):(x=[xs(r),"#define SHADER_NAME "+r.shaderName,v,r.instancing?"#define USE_INSTANCING":"",r.instancingColor?"#define USE_INSTANCING_COLOR":"",r.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+m,"#define MAX_BONES "+r.maxBones,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+f:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",r.specularColorMap?"#define USE_SPECULARCOLORMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.sheenColorMap?"#define USE_SHEENCOLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.morphTargets&&r.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",r.morphTargets&&r.isWebGL2?"#define MORPHTARGETS_COUNT "+r.morphTargetsCount:"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+h:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ls).join("\n"),_=[g,xs(r),"#define SHADER_NAME "+r.shaderName,v,"#define GAMMA_FACTOR "+m,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.matcap?"#define USE_MATCAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+d:"",r.envMap?"#define "+f:"",r.envMap?"#define "+p:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoat?"#define USE_CLEARCOAT":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",r.specularColorMap?"#define USE_SPECULARCOLORMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.alphaTest?"#define USE_ALPHATEST":"",r.sheen?"#define USE_SHEEN":"",r.sheenColorMap?"#define USE_SHEENCOLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors||r.instancingColor?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+h:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(r.extensionShaderTextureLOD||r.envMap)&&r.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",r.toneMapping!==W?"#define TONE_MAPPING":"",r.toneMapping!==W?ra.tonemapping_pars_fragment:"",r.toneMapping!==W?ss("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",r.format===Et?"#define OPAQUE":"",ra.encodings_pars_fragment,r.map?as("mapTexelToLinear",r.mapEncoding):"",r.matcap?as("matcapTexelToLinear",r.matcapEncoding):"",r.envMap?as("envMapTexelToLinear",r.envMapEncoding):"",r.emissiveMap?as("emissiveMapTexelToLinear",r.emissiveMapEncoding):"",r.specularColorMap?as("specularColorMapTexelToLinear",r.specularColorMapEncoding):"",r.sheenColorMap?as("sheenColorMapTexelToLinear",r.sheenColorMapEncoding):"",r.lightMap?as("lightMapTexelToLinear",r.lightMapEncoding):"",os("linearToOutputTexel",r.outputEncoding),r.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(ls).join("\n")),u=ds(u),u=us(u,r),u=cs(u,r),c=ds(c),c=us(c,r),c=cs(c,r),u=gs(u),c=gs(c),r.isWebGL2&&!0!==r.isRawShaderMaterial&&(w="#version 300 es\n",x=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+x,_=["#define varying in",r.glslVersion===Xe?"":"out highp vec4 pc_fragColor;",r.glslVersion===Xe?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+_);const b=w+_+c,M=es(i,35633,w+x+u),S=es(i,35632,b);if(i.attachShader(y,M),i.attachShader(y,S),void 0!==r.index0AttributeName?i.bindAttribLocation(y,0,r.index0AttributeName):!0===r.morphTargets&&i.bindAttribLocation(y,0,"position"),i.linkProgram(y),t.debug.checkShaderErrors){const t=i.getProgramInfoLog(y).trim(),e=i.getShaderInfoLog(M).trim(),r=i.getShaderInfoLog(S).trim();let n=!0,a=!0;if(!1===i.getProgramParameter(y,35714)){n=!1;const e=is(i,M,"vertex"),r=is(i,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(y,35715)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+r)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==e&&""!==r||(a=!1);a&&(this.diagnostics={runnable:n,programLog:t,vertexShader:{log:e,prefix:x},fragmentShader:{log:r,prefix:_}})}let T,E;return i.deleteShader(M),i.deleteShader(S),this.getUniforms=function(){return void 0===T&&(T=new ts(i,y)),T},this.getAttributes=function(){return void 0===E&&(E=function(t,e){const r={},n=t.getProgramParameter(e,35721);for(let i=0;i<n;i++){const n=t.getActiveAttrib(e,i),a=n.name;let o=1;35674===n.type&&(o=2),35675===n.type&&(o=3),35676===n.type&&(o=4),r[a]={type:n.type,location:t.getAttribLocation(e,a),locationSize:o}}return r}(i,y)),E},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(y),this.program=void 0},this.name=r.shaderName,this.id=rs++,this.cacheKey=e,this.usedTimes=1,this.program=y,this.vertexShader=M,this.fragmentShader=S,this}function ws(t,e,r,n,i,a,o){const s=[],l=i.isWebGL2,u=i.logarithmicDepthBuffer,d=i.floatVertexTextures,f=i.maxVertexUniforms,p=i.vertexTextures;let m=i.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},v=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap",,"roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","specularIntensityMap","specularColorMap","specularColorMapEncoding","transmission","transmissionMap","thicknessMap","sheen","sheenColorMap","sheenColorMapEncoding","sheenRoughnessMap"];function y(t){let e;return t&&t.isTexture?e=t.encoding:t&&t.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=De,e}return{getParameters:function(a,s,v,x,_){const w=x.fog,b=a.isMeshStandardMaterial?x.environment:null,M=(a.isMeshStandardMaterial?r:e).get(a.envMap||b),S=g[a.type],T=_.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(d)return 1024;{const t=f,r=Math.floor((t-20)/4),n=Math.min(r,e.length);return n<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+n+"."),0):n}}(_):0;let E,A;if(null!==a.precision&&(m=i.getMaxPrecision(a.precision),m!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",m,"instead.")),S){const t=ia[S];E=t.vertexShader,A=t.fragmentShader}else E=a.vertexShader,A=a.fragmentShader;const R=t.getRenderTarget(),P=a.alphaTest>0,C=a.clearcoat>0;return{isWebGL2:l,shaderID:S,shaderName:a.type,vertexShader:E,fragmentShader:A,defines:a.defines,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:m,instancing:!0===_.isInstancedMesh,instancingColor:!0===_.isInstancedMesh&&null!==_.instanceColor,supportsVertexTextures:p,outputEncoding:null!==R?y(R.texture):t.outputEncoding,map:!!a.map,mapEncoding:y(a.map),matcap:!!a.matcap,matcapEncoding:y(a.matcap),envMap:!!M,envMapMode:M&&M.mapping,envMapEncoding:y(M),envMapCubeUV:!!M&&(M.mapping===rt||M.mapping===nt),lightMap:!!a.lightMap,lightMapEncoding:y(a.lightMap),aoMap:!!a.aoMap,emissiveMap:!!a.emissiveMap,emissiveMapEncoding:y(a.emissiveMap),bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,objectSpaceNormalMap:a.normalMapType===Ve,tangentSpaceNormalMap:a.normalMapType===je,clearcoat:C,clearcoatMap:C&&!!a.clearcoatMap,clearcoatRoughnessMap:C&&!!a.clearcoatRoughnessMap,clearcoatNormalMap:C&&!!a.clearcoatNormalMap,displacementMap:!!a.displacementMap,roughnessMap:!!a.roughnessMap,metalnessMap:!!a.metalnessMap,specularMap:!!a.specularMap,specularIntensityMap:!!a.specularIntensityMap,specularColorMap:!!a.specularColorMap,specularColorMapEncoding:y(a.specularColorMap),alphaMap:!!a.alphaMap,alphaTest:P,gradientMap:!!a.gradientMap,sheen:a.sheen>0,sheenColorMap:!!a.sheenColorMap,sheenColorMapEncoding:y(a.sheenColorMap),sheenRoughnessMap:!!a.sheenRoughnessMap,transmission:a.transmission>0,transmissionMap:!!a.transmissionMap,thicknessMap:!!a.thicknessMap,combine:a.combine,vertexTangents:!!a.normalMap&&!!_.geometry&&!!_.geometry.attributes.tangent,vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!_.geometry&&!!_.geometry.attributes.color&&4===_.geometry.attributes.color.itemSize,vertexUvs:!!a.map||!!a.bumpMap||!!a.normalMap||!!a.specularMap||!!a.alphaMap||!!a.emissiveMap||!!a.roughnessMap||!!a.metalnessMap||!!a.clearcoatMap||!!a.clearcoatRoughnessMap||!!a.clearcoatNormalMap||!!a.displacementMap||!!a.transmissionMap||!!a.thicknessMap||!!a.specularIntensityMap||!!a.specularColorMap||!!a.sheenColorMap||a.sheenRoughnessMap,uvsVertexOnly:!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatNormalMap||a.transmission>0||a.transmissionMap||a.thicknessMap||a.specularIntensityMap||a.specularColorMap||a.sheen>0||a.sheenColorMap||a.sheenRoughnessMap||!a.displacementMap),fog:!!w,useFog:a.fog,fogExp2:w&&w.isFogExp2,flatShading:!!a.flatShading,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:u,skinning:!0===_.isSkinnedMesh&&T>0,maxBones:T,useVertexTexture:d,morphTargets:!!_.geometry&&!!_.geometry.morphAttributes.position,morphNormals:!!_.geometry&&!!_.geometry.morphAttributes.normal,morphTargetsCount:_.geometry&&_.geometry.morphAttributes.position?_.geometry.morphAttributes.position.length:0,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,format:a.format,dithering:a.dithering,shadowMapEnabled:t.shadowMap.enabled&&v.length>0,shadowMapType:t.shadowMap.type,toneMapping:a.toneMapped?t.toneMapping:W,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:a.premultipliedAlpha,doubleSided:a.side===h,flipSided:a.side===c,depthPacking:void 0!==a.depthPacking&&a.depthPacking,index0AttributeName:a.index0AttributeName,extensionDerivatives:a.extensions&&a.extensions.derivatives,extensionFragDepth:a.extensions&&a.extensions.fragDepth,extensionDrawBuffers:a.extensions&&a.extensions.drawBuffers,extensionShaderTextureLOD:a.extensions&&a.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||n.has("EXT_shader_texture_lod"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(e){const r=[];if(e.shaderID?r.push(e.shaderID):(r.push(fr(e.fragmentShader)),r.push(fr(e.vertexShader))),void 0!==e.defines)for(const t in e.defines)r.push(t),r.push(e.defines[t]);if(!1===e.isRawShaderMaterial){for(let t=0;t<v.length;t++)r.push(e[v[t]]);r.push(t.outputEncoding),r.push(t.gammaFactor)}return r.push(e.customProgramCacheKey),r.join()},getUniforms:function(t){const e=g[t.type];let r;if(e){const t=ia[e];r=Ui.clone(t.uniforms)}else r=t.uniforms;return r},acquireProgram:function(e,r){let n;for(let t=0,e=s.length;t<e;t++){const e=s[t];if(e.cacheKey===r){n=e,++n.usedTimes;break}}return void 0===n&&(n=new _s(t,r,e,a),s.push(n)),n},releaseProgram:function(t){if(0==--t.usedTimes){const e=s.indexOf(t);s[e]=s[s.length-1],s.pop(),t.destroy()}},programs:s}}function bs(){let t=new WeakMap;return{get:function(e){let r=t.get(e);return void 0===r&&(r={},t.set(e,r)),r},remove:function(e){t.delete(e)},update:function(e,r,n){t.get(e)[r]=n},dispose:function(){t=new WeakMap}}}function Ms(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Ss(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Ts(t){const e=[];let r=0;const n=[],i=[],a=[],o={id:-1};function s(n,i,a,s,l,u){let c=e[r];const h=t.get(a);return void 0===c?(c={id:n.id,object:n,geometry:i,material:a,program:h.program||o,groupOrder:s,renderOrder:n.renderOrder,z:l,group:u},e[r]=c):(c.id=n.id,c.object=n,c.geometry=i,c.material=a,c.program=h.program||o,c.groupOrder=s,c.renderOrder=n.renderOrder,c.z=l,c.group=u),r++,c}return{opaque:n,transmissive:i,transparent:a,init:function(){r=0,n.length=0,i.length=0,a.length=0},push:function(t,e,r,o,l,u){const c=s(t,e,r,o,l,u);r.transmission>0?i.push(c):!0===r.transparent?a.push(c):n.push(c)},unshift:function(t,e,r,o,l,u){const c=s(t,e,r,o,l,u);r.transmission>0?i.unshift(c):!0===r.transparent?a.unshift(c):n.unshift(c)},finish:function(){for(let t=r,n=e.length;t<n;t++){const r=e[t];if(null===r.id)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.program=null,r.group=null}},sort:function(t,e){n.length>1&&n.sort(t||Ms),i.length>1&&i.sort(e||Ss),a.length>1&&a.sort(e||Ss)}}}function Es(t){let e=new WeakMap;return{get:function(r,n){let i;return!1===e.has(r)?(i=new Ts(t),e.set(r,[i])):n>=e.get(r).length?(i=new Ts(t),e.get(r).push(i)):i=e.get(r)[n],i},dispose:function(){e=new WeakMap}}}function As(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let r;switch(e.type){case"DirectionalLight":r={direction:new Sr,color:new Xn};break;case"SpotLight":r={position:new Sr,direction:new Sr,color:new Xn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":r={position:new Sr,color:new Xn,distance:0,decay:0};break;case"HemisphereLight":r={direction:new Sr,skyColor:new Xn,groundColor:new Xn};break;case"RectAreaLight":r={color:new Xn,position:new Sr,halfWidth:new Sr,halfHeight:new Sr}}return t[e.id]=r,r}}}let Rs=0;function Ps(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function Cs(t,e){const r=new As,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let r;switch(e.type){case"DirectionalLight":case"SpotLight":r={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new sr};break;case"PointLight":r={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new sr,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=r,r}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)i.probe.push(new Sr);const a=new Sr,o=new en,s=new en;return{setup:function(a,o){let s=0,l=0,u=0;for(let t=0;t<9;t++)i.probe[t].set(0,0,0);let c=0,h=0,d=0,f=0,p=0,m=0,g=0,v=0;a.sort(Ps);const y=!0!==o?Math.PI:1;for(let t=0,e=a.length;t<e;t++){const e=a[t],o=e.color,x=e.intensity,_=e.distance,w=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)s+=o.r*x*y,l+=o.g*x*y,u+=o.b*x*y;else if(e.isLightProbe)for(let t=0;t<9;t++)i.probe[t].addScaledVector(e.sh.coefficients[t],x);else if(e.isDirectionalLight){const t=r.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),e.castShadow){const t=e.shadow,r=n.get(e);r.shadowBias=t.bias,r.shadowNormalBias=t.normalBias,r.shadowRadius=t.radius,r.shadowMapSize=t.mapSize,i.directionalShadow[c]=r,i.directionalShadowMap[c]=w,i.directionalShadowMatrix[c]=e.shadow.matrix,m++}i.directional[c]=t,c++}else if(e.isSpotLight){const t=r.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(o).multiplyScalar(x*y),t.distance=_,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,r=n.get(e);r.shadowBias=t.bias,r.shadowNormalBias=t.normalBias,r.shadowRadius=t.radius,r.shadowMapSize=t.mapSize,i.spotShadow[d]=r,i.spotShadowMap[d]=w,i.spotShadowMatrix[d]=e.shadow.matrix,v++}i.spot[d]=t,d++}else if(e.isRectAreaLight){const t=r.get(e);t.color.copy(o).multiplyScalar(x),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),i.rectArea[f]=t,f++}else if(e.isPointLight){const t=r.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,r=n.get(e);r.shadowBias=t.bias,r.shadowNormalBias=t.normalBias,r.shadowRadius=t.radius,r.shadowMapSize=t.mapSize,r.shadowCameraNear=t.camera.near,r.shadowCameraFar=t.camera.far,i.pointShadow[h]=r,i.pointShadowMap[h]=w,i.pointShadowMatrix[h]=e.shadow.matrix,g++}i.point[h]=t,h++}else if(e.isHemisphereLight){const t=r.get(e);t.skyColor.copy(e.color).multiplyScalar(x*y),t.groundColor.copy(e.groundColor).multiplyScalar(x*y),i.hemi[p]=t,p++}}f>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(i.rectAreaLTC1=na.LTC_FLOAT_1,i.rectAreaLTC2=na.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=na.LTC_HALF_1,i.rectAreaLTC2=na.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=s,i.ambient[1]=l,i.ambient[2]=u;const x=i.hash;x.directionalLength===c&&x.pointLength===h&&x.spotLength===d&&x.rectAreaLength===f&&x.hemiLength===p&&x.numDirectionalShadows===m&&x.numPointShadows===g&&x.numSpotShadows===v||(i.directional.length=c,i.spot.length=d,i.rectArea.length=f,i.point.length=h,i.hemi.length=p,i.directionalShadow.length=m,i.directionalShadowMap.length=m,i.pointShadow.length=g,i.pointShadowMap.length=g,i.spotShadow.length=v,i.spotShadowMap.length=v,i.directionalShadowMatrix.length=m,i.pointShadowMatrix.length=g,i.spotShadowMatrix.length=v,x.directionalLength=c,x.pointLength=h,x.spotLength=d,x.rectAreaLength=f,x.hemiLength=p,x.numDirectionalShadows=m,x.numPointShadows=g,x.numSpotShadows=v,i.version=Rs++)},setupView:function(t,e){let r=0,n=0,l=0,u=0,c=0;const h=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=i.directional[r];t.direction.setFromMatrixPosition(d.matrixWorld),a.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(a),t.direction.transformDirection(h),r++}else if(d.isSpotLight){const t=i.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),t.direction.setFromMatrixPosition(d.matrixWorld),a.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(a),t.direction.transformDirection(h),l++}else if(d.isRectAreaLight){const t=i.rectArea[u];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),s.identity(),o.copy(d.matrixWorld),o.premultiply(h),s.extractRotation(o),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(s),t.halfHeight.applyMatrix4(s),u++}else if(d.isPointLight){const t=i.point[n];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),n++}else if(d.isHemisphereLight){const t=i.hemi[c];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(h),t.direction.normalize(),c++}}},state:i}}function Is(t,e){const r=new Cs(t,e),n=[],i=[];return{init:function(){n.length=0,i.length=0},state:{lightsArray:n,shadowsArray:i,lights:r},setupLights:function(t){r.setup(n,t)},setupLightsView:function(t){r.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){i.push(t)}}}function Ls(t,e){let r=new WeakMap;return{get:function(n,i=0){let a;return!1===r.has(n)?(a=new Is(t,e),r.set(n,[a])):i>=r.get(n).length?(a=new Is(t,e),r.get(n).push(a)):a=r.get(n)[i],a},dispose:function(){r=new WeakMap}}}class Os extends zn{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}Os.prototype.isMeshDepthMaterial=!0;class Ds extends zn{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Sr,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}Ds.prototype.isMeshDistanceMaterial=!0;const ks="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",Fs="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function Ns(t,e,r){let n=new Qi;const i=new sr,a=new sr,s=new xr,f=new Os({depthPacking:Ge}),p=new Ds,m={},g=r.maxTextureSize,v={0:c,1:u,2:h},y=new Bi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new sr},radius:{value:4}},vertexShader:ks,fragmentShader:Fs}),x=y.clone();x.defines.HORIZONTAL_PASS=1;const _=new mi;_.setAttribute("position",new Jn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const w=new Oi(_,y),b=this;function M(r,n){const i=e.update(w);y.defines.VSM_SAMPLES!==r.blurSamples&&(y.defines.VSM_SAMPLES=r.blurSamples,x.defines.VSM_SAMPLES=r.blurSamples,y.needsUpdate=!0,x.needsUpdate=!0),y.uniforms.shadow_pass.value=r.map.texture,y.uniforms.resolution.value=r.mapSize,y.uniforms.radius.value=r.radius,t.setRenderTarget(r.mapPass),t.clear(),t.renderBufferDirect(n,null,i,y,w,null),x.uniforms.shadow_pass.value=r.mapPass.texture,x.uniforms.resolution.value=r.mapSize,x.uniforms.radius.value=r.radius,t.setRenderTarget(r.map),t.clear(),t.renderBufferDirect(n,null,i,x,w,null)}function S(e,r,n,i,a,o,s){let u=null;const c=!0===i.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(u=void 0!==c?c:!0===i.isPointLight?p:f,t.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){const t=u.uuid,e=n.uuid;let r=m[t];void 0===r&&(r={},m[t]=r);let i=r[e];void 0===i&&(i=u.clone(),r[e]=i),u=i}return u.visible=n.visible,u.wireframe=n.wireframe,u.side=s===l?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:v[n.side],u.alphaMap=n.alphaMap,u.alphaTest=n.alphaTest,u.clipShadows=n.clipShadows,u.clippingPlanes=n.clippingPlanes,u.clipIntersection=n.clipIntersection,u.displacementMap=n.displacementMap,u.displacementScale=n.displacementScale,u.displacementBias=n.displacementBias,u.wireframeLinewidth=n.wireframeLinewidth,u.linewidth=n.linewidth,!0===i.isPointLight&&!0===u.isMeshDistanceMaterial&&(u.referencePosition.setFromMatrixPosition(i.matrixWorld),u.nearDistance=a,u.farDistance=o),u}function T(r,i,a,o,s){if(!1===r.visible)return;if(r.layers.test(i.layers)&&(r.isMesh||r.isLine||r.isPoints)&&(r.castShadow||r.receiveShadow&&s===l)&&(!r.frustumCulled||n.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,r.matrixWorld);const n=e.update(r),i=r.material;if(Array.isArray(i)){const e=n.groups;for(let l=0,u=e.length;l<u;l++){const u=e[l],c=i[u.materialIndex];if(c&&c.visible){const e=S(r,0,c,o,a.near,a.far,s);t.renderBufferDirect(a,null,n,e,r,u)}}}else if(i.visible){const e=S(r,0,i,o,a.near,a.far,s);t.renderBufferDirect(a,null,n,e,r,null)}}const u=r.children;for(let t=0,e=u.length;t<e;t++)T(u[t],i,a,o,s)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=o,this.render=function(e,r,o){if(!1===b.enabled)return;if(!1===b.autoUpdate&&!1===b.needsUpdate)return;if(0===e.length)return;const u=t.getRenderTarget(),c=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),f=t.state;f.setBlending(d),f.buffers.color.setClear(1,1,1,1),f.buffers.depth.setTest(!0),f.setScissorTest(!1);for(let u=0,c=e.length;u<c;u++){const c=e[u],h=c.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;i.copy(h.mapSize);const d=h.getFrameExtents();if(i.multiply(d),a.copy(h.mapSize),(i.x>g||i.y>g)&&(i.x>g&&(a.x=Math.floor(g/d.x),i.x=a.x*d.x,h.mapSize.x=a.x),i.y>g&&(a.y=Math.floor(g/d.y),i.y=a.y*d.y,h.mapSize.y=a.y)),null===h.map&&!h.isPointLightShadow&&this.type===l){const t={minFilter:ct,magFilter:ct,format:At};h.map=new _r(i.x,i.y,t),h.map.texture.name=c.name+".shadowMap",h.mapPass=new _r(i.x,i.y,t),h.camera.updateProjectionMatrix()}if(null===h.map){const t={minFilter:st,magFilter:st,format:At};h.map=new _r(i.x,i.y,t),h.map.texture.name=c.name+".shadowMap",h.camera.updateProjectionMatrix()}t.setRenderTarget(h.map),t.clear();const p=h.getViewportCount();for(let t=0;t<p;t++){const e=h.getViewport(t);s.set(a.x*e.x,a.y*e.y,a.x*e.z,a.y*e.w),f.viewport(s),h.updateMatrices(c,t),n=h.getFrustum(),T(r,o,h.camera,c,this.type)}h.isPointLightShadow||this.type!==l||M(h,o),h.needsUpdate=!1}b.needsUpdate=!1,t.setRenderTarget(u,c,h)}}function Us(t,e,r){const o=r.isWebGL2;const s=new function(){let e=!1;const r=new xr;let n=null;const i=new xr(0,0,0,0);return{setMask:function(r){n===r||e||(t.colorMask(r,r,r,r),n=r)},setLocked:function(t){e=t},setClear:function(e,n,a,o,s){!0===s&&(e*=o,n*=o,a*=o),r.set(e,n,a,o),!1===i.equals(r)&&(t.clearColor(e,n,a,o),i.copy(r))},reset:function(){e=!1,n=null,i.set(-1,0,0,0)}}},l=new function(){let e=!1,r=null,n=null,i=null;return{setTest:function(t){t?vt(2929):yt(2929)},setMask:function(n){r===n||e||(t.depthMask(n),r=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case D:t.depthFunc(512);break;case k:t.depthFunc(519);break;case F:t.depthFunc(513);break;case N:t.depthFunc(515);break;case U:t.depthFunc(514);break;case B:t.depthFunc(518);break;case z:t.depthFunc(516);break;case G:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);n=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,r=null,n=null,i=null}}},u=new function(){let e=!1,r=null,n=null,i=null,a=null,o=null,s=null,l=null,u=null;return{setTest:function(t){e||(t?vt(2960):yt(2960))},setMask:function(n){r===n||e||(t.stencilMask(n),r=n)},setFunc:function(e,r,o){n===e&&i===r&&a===o||(t.stencilFunc(e,r,o),n=e,i=r,a=o)},setOp:function(e,r,n){o===e&&s===r&&l===n||(t.stencilOp(e,r,n),o=e,s=r,l=n)},setLocked:function(t){e=t},setClear:function(e){u!==e&&(t.clearStencil(e),u=e)},reset:function(){e=!1,r=null,n=null,i=null,a=null,o=null,s=null,l=null,u=null}}};let j={},V={},H=null,W=!1,q=null,X=null,Y=null,Z=null,K=null,J=null,Q=null,$=!1,tt=null,et=null,rt=null,nt=null,it=null;const at=t.getParameter(35661);let ot=!1,st=0;const lt=t.getParameter(7938);-1!==lt.indexOf("WebGL")?(st=parseFloat(/^WebGL (\d)/.exec(lt)[1]),ot=st>=1):-1!==lt.indexOf("OpenGL ES")&&(st=parseFloat(/^OpenGL ES (\d)/.exec(lt)[1]),ot=st>=2);let ut=null,ct={};const ht=t.getParameter(3088),dt=t.getParameter(2978),ft=(new xr).fromArray(ht),pt=(new xr).fromArray(dt);function mt(e,r,n){const i=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<n;e++)t.texImage2D(r+e,0,6408,1,1,0,6408,5121,i);return a}const gt={};function vt(e){!0!==j[e]&&(t.enable(e),j[e]=!0)}function yt(e){!1!==j[e]&&(t.disable(e),j[e]=!1)}gt[3553]=mt(3553,3553,1),gt[34067]=mt(34067,34069,6),s.setClear(0,0,0,1),l.setClear(1),u.setClear(0),vt(2929),l.setFunc(N),bt(!1),Mt(i),vt(2884),wt(d);const xt={[y]:32774,[x]:32778,[_]:32779};if(o)xt[w]=32775,xt[b]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(xt[w]=t.MIN_EXT,xt[b]=t.MAX_EXT)}const _t={[M]:0,[S]:1,[T]:768,[A]:770,[O]:776,[I]:774,[P]:772,[E]:769,[R]:771,[L]:775,[C]:773};function wt(e,r,n,i,a,o,s,l){if(e!==d){if(!1===W&&(vt(3042),W=!0),e===v)a=a||r,o=o||n,s=s||i,r===X&&a===K||(t.blendEquationSeparate(xt[r],xt[a]),X=r,K=a),n===Y&&i===Z&&o===J&&s===Q||(t.blendFuncSeparate(_t[n],_t[i],_t[o],_t[s]),Y=n,Z=i,J=o,Q=s),q=e,$=null;else if(e!==q||l!==$){if(X===y&&K===y||(t.blendEquation(32774),X=y,K=y),l)switch(e){case f:t.blendFuncSeparate(1,771,1,771);break;case p:t.blendFunc(1,1);break;case m:t.blendFuncSeparate(0,0,769,771);break;case g:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case f:t.blendFuncSeparate(770,771,1,771);break;case p:t.blendFunc(770,1);break;case m:t.blendFunc(0,769);break;case g:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}Y=null,Z=null,J=null,Q=null,q=e,$=l}}else!0===W&&(yt(3042),W=!1)}function bt(e){tt!==e&&(e?t.frontFace(2304):t.frontFace(2305),tt=e)}function Mt(e){e!==n?(vt(2884),e!==et&&(e===i?t.cullFace(1029):e===a?t.cullFace(1028):t.cullFace(1032))):yt(2884),et=e}function St(e,r,n){e?(vt(32823),nt===r&&it===n||(t.polygonOffset(r,n),nt=r,it=n)):yt(32823)}function Tt(e){void 0===e&&(e=33984+at-1),ut!==e&&(t.activeTexture(e),ut=e)}return{buffers:{color:s,depth:l,stencil:u},enable:vt,disable:yt,bindFramebuffer:function(e,r){return V[e]!==r&&(t.bindFramebuffer(e,r),V[e]=r,o&&(36009===e&&(V[36160]=r),36160===e&&(V[36009]=r)),!0)},useProgram:function(e){return H!==e&&(t.useProgram(e),H=e,!0)},setBlending:wt,setMaterial:function(t,e){t.side===h?yt(2884):vt(2884);let r=t.side===c;e&&(r=!r),bt(r),t.blending===f&&!1===t.transparent?wt(d):wt(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),l.setFunc(t.depthFunc),l.setTest(t.depthTest),l.setMask(t.depthWrite),s.setMask(t.colorWrite);const n=t.stencilWrite;u.setTest(n),n&&(u.setMask(t.stencilWriteMask),u.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),u.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),St(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?vt(32926):yt(32926)},setFlipSided:bt,setCullFace:Mt,setLineWidth:function(e){e!==rt&&(ot&&t.lineWidth(e),rt=e)},setPolygonOffset:St,setScissorTest:function(t){t?vt(3089):yt(3089)},activeTexture:Tt,bindTexture:function(e,r){null===ut&&Tt();let n=ct[ut];void 0===n&&(n={type:void 0,texture:void 0},ct[ut]=n),n.type===e&&n.texture===r||(t.bindTexture(e,r||gt[e]),n.type=e,n.texture=r)},unbindTexture:function(){const e=ct[ut];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===ft.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),ft.copy(e))},viewport:function(e){!1===pt.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),pt.copy(e))},reset:function(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===o&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),j={},ut=null,ct={},V={},H=null,W=!1,q=null,X=null,Y=null,Z=null,K=null,J=null,Q=null,$=!1,tt=null,et=null,rt=null,nt=null,it=null,ft.set(0,0,t.canvas.width,t.canvas.height),pt.set(0,0,t.canvas.width,t.canvas.height),s.reset(),l.reset(),u.reset()}}}function Bs(t,e,r,n,i,a,o){const s=i.isWebGL2,l=i.maxTextures,u=i.maxCubemapSize,c=i.maxTextureSize,h=i.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):void 0,f=new WeakMap;let p,m=!1;try{m="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function g(t,e){return m?new OffscreenCanvas(t,e):dr("canvas")}function v(t,e,r,n){let i=1;if((t.width>n||t.height>n)&&(i=n/Math.max(t.width,t.height)),i<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const n=e?ar:Math.floor,a=n(i*t.width),o=n(i*t.height);void 0===p&&(p=g(a,o));const s=r?g(a,o):p;s.width=a,s.height=o;return s.getContext("2d").drawImage(t,0,0,a,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+a+"x"+o+")."),s}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function y(t){return nr(t.width)&&nr(t.height)}function x(t,e){return t.generateMipmaps&&e&&t.minFilter!==st&&t.minFilter!==ct}function _(e){t.generateMipmap(e)}function w(r,n,i){if(!1===s)return n;if(null!==r){if(void 0!==t[r])return t[r];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+r+"'")}let a=n;return 6403===n&&(5126===i&&(a=33326),5131===i&&(a=33325),5121===i&&(a=33321)),6407===n&&(5126===i&&(a=34837),5131===i&&(a=34843),5121===i&&(a=32849)),6408===n&&(5126===i&&(a=34836),5131===i&&(a=34842),5121===i&&(a=32856)),33325!==a&&33326!==a&&34842!==a&&34836!==a||e.get("EXT_color_buffer_float"),a}function b(t){return t===st||t===lt||t===ut?9728:9729}function M(e){const r=e.target;r.removeEventListener("dispose",M),function(e){const r=n.get(e);if(void 0===r.__webglInit)return;t.deleteTexture(r.__webglTexture),n.remove(e)}(r),r.isVideoTexture&&f.delete(r),o.memory.textures--}function S(e){const r=e.target;r.removeEventListener("dispose",S),function(e){const r=e.texture,i=n.get(e),a=n.get(r);if(!e)return;void 0!==a.__webglTexture&&(t.deleteTexture(a.__webglTexture),o.memory.textures--);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(i.__webglFramebuffer[e]),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[e]);else t.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&t.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&t.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&t.deleteRenderbuffer(i.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let e=0,i=r.length;e<i;e++){const i=n.get(r[e]);i.__webglTexture&&(t.deleteTexture(i.__webglTexture),o.memory.textures--),n.remove(r[e])}n.remove(r),n.remove(e)}(r)}let T=0;function E(t,e){const i=n.get(t);if(t.isVideoTexture&&function(t){const e=o.render.frame;f.get(t)!==e&&(f.set(t,e),t.update())}(t),t.version>0&&i.__version!==t.version){const r=t.image;if(void 0===r)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==r.complete)return void L(i,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.activeTexture(33984+e),r.bindTexture(3553,i.__webglTexture)}function A(e,i){const o=n.get(e);e.version>0&&o.__version!==e.version?function(e,n,i){if(6!==n.image.length)return;I(e,n),r.activeTexture(33984+i),r.bindTexture(34067,e.__webglTexture),t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment),t.pixelStorei(37443,0);const o=n&&(n.isCompressedTexture||n.image[0].isCompressedTexture),l=n.image[0]&&n.image[0].isDataTexture,c=[];for(let t=0;t<6;t++)c[t]=o||l?l?n.image[t].image:n.image[t]:v(n.image[t],!1,!0,u);const h=y(c[0])||s,d=a.convert(n.format),f=a.convert(n.type),p=w(n.internalFormat,d,f,n.encoding);let m;if(C(34067,n,h),o)for(let t=0;t<6;t++){m=c[t].mipmaps;for(let e=0;e<m.length;e++){const i=m[e];n.format!==At&&n.format!==Et?null!==d?r.compressedTexImage2D(34069+t,e,p,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(34069+t,e,p,i.width,i.height,0,d,f,i.data)}}else{m=n.mipmaps;for(let t=0;t<6;t++)if(l){r.texImage2D(34069+t,0,p,c[t].width,c[t].height,0,d,f,c[t].data);for(let e=0;e<m.length;e++){const n=m[e].image[t].image;r.texImage2D(34069+t,e+1,p,n.width,n.height,0,d,f,n.data)}}else{r.texImage2D(34069+t,0,p,d,f,c[t]);for(let e=0;e<m.length;e++){const n=m[e];r.texImage2D(34069+t,e+1,p,d,f,n.image[t])}}}x(n,h)&&_(34067);e.__version=n.version,n.onUpdate&&n.onUpdate(n)}(o,e,i):(r.activeTexture(33984+i),r.bindTexture(34067,o.__webglTexture))}const R={[it]:10497,[at]:33071,[ot]:33648},P={[st]:9728,[lt]:9984,[ut]:9986,[ct]:9729,[ht]:9985,[dt]:9987};function C(r,a,o){if(o?(t.texParameteri(r,10242,R[a.wrapS]),t.texParameteri(r,10243,R[a.wrapT]),32879!==r&&35866!==r||t.texParameteri(r,32882,R[a.wrapR]),t.texParameteri(r,10240,P[a.magFilter]),t.texParameteri(r,10241,P[a.minFilter])):(t.texParameteri(r,10242,33071),t.texParameteri(r,10243,33071),32879!==r&&35866!==r||t.texParameteri(r,32882,33071),a.wrapS===at&&a.wrapT===at||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(r,10240,b(a.magFilter)),t.texParameteri(r,10241,b(a.minFilter)),a.minFilter!==st&&a.minFilter!==ct&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const o=e.get("EXT_texture_filter_anisotropic");if(a.type===xt&&!1===e.has("OES_texture_float_linear"))return;if(!1===s&&a.type===_t&&!1===e.has("OES_texture_half_float_linear"))return;(a.anisotropy>1||n.get(a).__currentAnisotropy)&&(t.texParameterf(r,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),n.get(a).__currentAnisotropy=a.anisotropy)}}function I(e,r){void 0===e.__webglInit&&(e.__webglInit=!0,r.addEventListener("dispose",M),e.__webglTexture=t.createTexture(),o.memory.textures++)}function L(e,n,i){let o=3553;n.isDataTexture2DArray&&(o=35866),n.isDataTexture3D&&(o=32879),I(e,n),r.activeTexture(33984+i),r.bindTexture(o,e.__webglTexture),t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment),t.pixelStorei(37443,0);const l=function(t){return!s&&(t.wrapS!==at||t.wrapT!==at||t.minFilter!==st&&t.minFilter!==ct)}(n)&&!1===y(n.image),u=v(n.image,l,!1,c),h=y(u)||s,d=a.convert(n.format);let f,p=a.convert(n.type),m=w(n.internalFormat,d,p,n.encoding);C(o,n,h);const g=n.mipmaps;if(n.isDepthTexture)m=6402,s?m=n.type===xt?36012:n.type===yt?33190:n.type===St?35056:33189:n.type===xt&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===It&&6402===m&&n.type!==gt&&n.type!==yt&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=gt,p=a.convert(n.type)),n.format===Lt&&6402===m&&(m=34041,n.type!==St&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=St,p=a.convert(n.type))),r.texImage2D(3553,0,m,u.width,u.height,0,d,p,null);else if(n.isDataTexture)if(g.length>0&&h){for(let t=0,e=g.length;t<e;t++)f=g[t],r.texImage2D(3553,t,m,f.width,f.height,0,d,p,f.data);n.generateMipmaps=!1}else r.texImage2D(3553,0,m,u.width,u.height,0,d,p,u.data);else if(n.isCompressedTexture)for(let t=0,e=g.length;t<e;t++)f=g[t],n.format!==At&&n.format!==Et?null!==d?r.compressedTexImage2D(3553,t,m,f.width,f.height,0,f.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(3553,t,m,f.width,f.height,0,d,p,f.data);else if(n.isDataTexture2DArray)r.texImage3D(35866,0,m,u.width,u.height,u.depth,0,d,p,u.data);else if(n.isDataTexture3D)r.texImage3D(32879,0,m,u.width,u.height,u.depth,0,d,p,u.data);else{const t=function(t,e,r){return!0===x(t,r)?Math.log2(Math.max(e.width,e.height))+1:t.mipmaps.length>0?t.mipmaps.length:1}(n,u,h),i=s&&!0!==n.isVideoTexture,a=void 0===e.__version;if(g.length>0&&h){i&&a&&r.texStorage2D(3553,t,m,g[0].width,g[0].height);for(let t=0,e=g.length;t<e;t++)f=g[t],i?r.texSubImage2D(3553,t,0,0,d,p,f):r.texImage2D(3553,t,m,d,p,f);n.generateMipmaps=!1}else i?(a&&r.texStorage2D(3553,t,m,u.width,u.height),r.texSubImage2D(3553,0,0,0,d,p,u)):r.texImage2D(3553,0,m,d,p,u)}x(n,h)&&_(o),e.__version=n.version,n.onUpdate&&n.onUpdate(n)}function O(e,i,o,s,l){const u=a.convert(o.format),c=a.convert(o.type),h=w(o.internalFormat,u,c,o.encoding);n.get(i).__hasExternalTextures||(32879===l||35866===l?r.texImage3D(l,0,h,i.width,i.height,i.depth,0,u,c,null):r.texImage2D(l,0,h,i.width,i.height,0,u,c,null)),r.bindFramebuffer(36160,e),i.useRenderToTexture?d.framebufferTexture2DMultisampleEXT(36160,s,l,n.get(o).__webglTexture,0,F(i)):t.framebufferTexture2D(36160,s,l,n.get(o).__webglTexture,0),r.bindFramebuffer(36160,null)}function D(e,r,n){if(t.bindRenderbuffer(36161,e),r.depthBuffer&&!r.stencilBuffer){let i=33189;if(n||r.useRenderToTexture){const e=r.depthTexture;e&&e.isDepthTexture&&(e.type===xt?i=36012:e.type===yt&&(i=33190));const n=F(r);r.useRenderToTexture?d.renderbufferStorageMultisampleEXT(36161,n,i,r.width,r.height):t.renderbufferStorageMultisample(36161,n,i,r.width,r.height)}else t.renderbufferStorage(36161,i,r.width,r.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(r.depthBuffer&&r.stencilBuffer){const i=F(r);n&&r.useRenderbuffer?t.renderbufferStorageMultisample(36161,i,35056,r.width,r.height):r.useRenderToTexture?d.renderbufferStorageMultisampleEXT(36161,i,35056,r.width,r.height):t.renderbufferStorage(36161,34041,r.width,r.height),t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=!0===r.isWebGLMultipleRenderTargets?r.texture[0]:r.texture,i=a.convert(e.format),o=a.convert(e.type),s=w(e.internalFormat,i,o,e.encoding),l=F(r);n&&r.useRenderbuffer?t.renderbufferStorageMultisample(36161,l,s,r.width,r.height):r.useRenderToTexture?d.renderbufferStorageMultisampleEXT(36161,l,s,r.width,r.height):t.renderbufferStorage(36161,s,r.width,r.height)}t.bindRenderbuffer(36161,null)}function k(e){const i=n.get(e),a=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!i.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(r.bindFramebuffer(36160,e),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),E(i.depthTexture,0);const a=n.get(i.depthTexture).__webglTexture,o=F(i);if(i.depthTexture.format===It)i.useRenderToTexture?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,a,0,o):t.framebufferTexture2D(36160,36096,3553,a,0);else{if(i.depthTexture.format!==Lt)throw new Error("Unknown depthTexture format");i.useRenderToTexture?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,a,0,o):t.framebufferTexture2D(36160,33306,3553,a,0)}}(i.__webglFramebuffer,e)}else if(a){i.__webglDepthbuffer=[];for(let n=0;n<6;n++)r.bindFramebuffer(36160,i.__webglFramebuffer[n]),i.__webglDepthbuffer[n]=t.createRenderbuffer(),D(i.__webglDepthbuffer[n],e,!1)}else r.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=t.createRenderbuffer(),D(i.__webglDepthbuffer,e,!1);r.bindFramebuffer(36160,null)}function F(t){return s&&(t.useRenderbuffer||t.useRenderToTexture)?Math.min(h,t.samples):0}let N=!1,U=!1;this.allocateTextureUnit=function(){const t=T;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),T+=1,t},this.resetTextureUnits=function(){T=0},this.setTexture2D=E,this.setTexture2DArray=function(t,e){const i=n.get(t);t.version>0&&i.__version!==t.version?L(i,t,e):(r.activeTexture(33984+e),r.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(t,e){const i=n.get(t);t.version>0&&i.__version!==t.version?L(i,t,e):(r.activeTexture(33984+e),r.bindTexture(32879,i.__webglTexture))},this.setTextureCube=A,this.rebindTextures=function(t,e,r){const i=n.get(t);void 0!==e&&O(i.__webglFramebuffer,t,t.texture,36064,3553),void 0!==r&&k(t)},this.setupRenderTarget=function(e){const l=e.texture,u=n.get(e),c=n.get(l);e.addEventListener("dispose",S),!0!==e.isWebGLMultipleRenderTargets&&(void 0===c.__webglTexture&&(c.__webglTexture=t.createTexture()),c.__version=l.version,o.memory.textures++);const h=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,f=l.isDataTexture3D||l.isDataTexture2DArray,p=y(e)||s;if(!s||l.format!==Et||l.type!==xt&&l.type!==_t||(l.format=At,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),h){u.__webglFramebuffer=[];for(let e=0;e<6;e++)u.__webglFramebuffer[e]=t.createFramebuffer()}else if(u.__webglFramebuffer=t.createFramebuffer(),d)if(i.drawBuffers){const r=e.texture;for(let e=0,i=r.length;e<i;e++){const i=n.get(r[e]);void 0===i.__webglTexture&&(i.__webglTexture=t.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(e.useRenderbuffer)if(s){u.__webglMultisampledFramebuffer=t.createFramebuffer(),u.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,u.__webglColorRenderbuffer);const n=a.convert(l.format),i=a.convert(l.type),o=w(l.internalFormat,n,i,l.encoding),s=F(e);t.renderbufferStorageMultisample(36161,s,o,e.width,e.height),r.bindFramebuffer(36160,u.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,u.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(u.__webglDepthRenderbuffer=t.createRenderbuffer(),D(u.__webglDepthRenderbuffer,e,!0)),r.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(h){r.bindTexture(34067,c.__webglTexture),C(34067,l,p);for(let t=0;t<6;t++)O(u.__webglFramebuffer[t],e,l,36064,34069+t);x(l,p)&&_(34067),r.unbindTexture()}else if(d){const t=e.texture;for(let i=0,a=t.length;i<a;i++){const a=t[i],o=n.get(a);r.bindTexture(3553,o.__webglTexture),C(3553,a,p),O(u.__webglFramebuffer,e,a,36064+i,3553),x(a,p)&&_(3553)}r.unbindTexture()}else{let t=3553;if(f)if(s){t=l.isDataTexture3D?32879:35866}else console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.");r.bindTexture(t,c.__webglTexture),C(t,l,p),O(u.__webglFramebuffer,e,l,36064,t),x(l,p)&&_(t),r.unbindTexture()}e.depthBuffer&&k(e)},this.updateRenderTargetMipmap=function(t){const e=y(t)||s,i=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let a=0,o=i.length;a<o;a++){const o=i[a];if(x(o,e)){const e=t.isWebGLCubeRenderTarget?34067:3553,i=n.get(o).__webglTexture;r.bindTexture(e,i),_(e),r.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(e.useRenderbuffer)if(s){const i=e.width,a=e.height;let o=16384;const s=[36064],l=e.stencilBuffer?33306:36096;e.depthBuffer&&s.push(l),e.ignoreDepthForMultisampleCopy||(e.depthBuffer&&(o|=256),e.stencilBuffer&&(o|=1024));const u=n.get(e);r.bindFramebuffer(36008,u.__webglMultisampledFramebuffer),r.bindFramebuffer(36009,u.__webglFramebuffer),e.ignoreDepthForMultisampleCopy&&(t.invalidateFramebuffer(36008,[l]),t.invalidateFramebuffer(36009,[l])),t.blitFramebuffer(0,0,i,a,0,0,i,a,o,9728),t.invalidateFramebuffer(36008,s),r.bindFramebuffer(36008,null),r.bindFramebuffer(36009,u.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.setupDepthRenderbuffer=k,this.setupFrameBufferTexture=O,this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===N&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),N=!0),t=t.texture),E(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===U&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),U=!0),t=t.texture),A(t,e)}}function zs(t,e,r){const n=r.isWebGL2;return{convert:function(t){let r;if(t===ft)return 5121;if(t===wt)return 32819;if(t===bt)return 32820;if(t===Mt)return 33635;if(t===pt)return 5120;if(t===mt)return 5122;if(t===gt)return 5123;if(t===vt)return 5124;if(t===yt)return 5125;if(t===xt)return 5126;if(t===_t)return n?5131:(r=e.get("OES_texture_half_float"),null!==r?r.HALF_FLOAT_OES:null);if(t===Tt)return 6406;if(t===Et)return 6407;if(t===At)return 6408;if(t===Rt)return 6409;if(t===Pt)return 6410;if(t===It)return 6402;if(t===Lt)return 34041;if(t===Ot)return 6403;if(t===Dt)return 36244;if(t===kt)return 33319;if(t===Ft)return 33320;if(t===Nt)return 36248;if(t===Ut)return 36249;if(t===Bt||t===zt||t===Gt||t===jt){if(r=e.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(t===Bt)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===zt)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===Gt)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===jt)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===Vt||t===Ht||t===Wt||t===qt){if(r=e.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(t===Vt)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===Ht)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===Wt)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===qt)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===Xt)return r=e.get("WEBGL_compressed_texture_etc1"),null!==r?r.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===Yt||t===Zt)&&(r=e.get("WEBGL_compressed_texture_etc"),null!==r)){if(t===Yt)return r.COMPRESSED_RGB8_ETC2;if(t===Zt)return r.COMPRESSED_RGBA8_ETC2_EAC}return t===Kt||t===Jt||t===Qt||t===$t||t===te||t===ee||t===re||t===ne||t===ie||t===ae||t===oe||t===se||t===le||t===ue||t===he||t===de||t===fe||t===pe||t===me||t===ge||t===ve||t===ye||t===xe||t===_e||t===we||t===be||t===Me||t===Se?(r=e.get("WEBGL_compressed_texture_astc"),null!==r?t:null):t===ce?(r=e.get("EXT_texture_compression_bptc"),null!==r?t:null):t===St?n?34042:(r=e.get("WEBGL_depth_texture"),null!==r?r.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class Gs extends Gi{constructor(t=[]){super(),this.cameras=t}}Gs.prototype.isArrayCamera=!0;class js extends An{constructor(){super(),this.type="Group"}}js.prototype.isGroup=!0;const Vs={type:"move"};class Hs{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new js,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new js,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Sr,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Sr),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new js,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Sr,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Sr),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,r){let n=null,i=null,a=null;const o=this._targetRay,s=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==o&&(n=e.getPose(t.targetRaySpace,r),null!==n&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Vs))),l&&t.hand){a=!0;for(const n of t.hand.values()){const t=e.getJointPose(n,r);if(void 0===l.joints[n.jointName]){const t=new js;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[n.jointName]=t,l.add(t)}const i=l.joints[n.jointName];null!==t&&(i.matrix.fromArray(t.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.jointRadius=t.radius),i.visible=null!==t}const n=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],o=n.position.distanceTo(i.position),s=.02,u=.005;l.inputState.pinching&&o>s+u?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&o<=s-u&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==s&&t.gripSpace&&(i=e.getPose(t.gripSpace,r),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1));return null!==o&&(o.visible=null!==n),null!==s&&(s.visible=null!==i),null!==l&&(l.visible=null!==a),this}}class Ws extends vr{constructor(t,e,r,n,i,a,o,s,l,u){if((u=void 0!==u?u:It)!==It&&u!==Lt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&u===It&&(r=gt),void 0===r&&u===Lt&&(r=St),super(null,n,i,a,o,s,u,r,l),this.image={width:t,height:e},this.magFilter=void 0!==o?o:st,this.minFilter=void 0!==s?s:st,this.flipY=!1,this.generateMipmaps=!1}}Ws.prototype.isDepthTexture=!0;class qs extends Ye{constructor(t,e){super();const r=this;let n=null,i=1,a=null,o="local-floor";const s=t.extensions.has("WEBGL_multisampled_render_to_texture");let l=null,u=null,c=null,h=null,d=!1,f=null;const p=e.getContextAttributes();let m=null,g=null;const v=[],y=new Map,x=new Gi;x.layers.enable(1),x.viewport=new xr;const _=new Gi;_.layers.enable(2),_.viewport=new xr;const w=[x,_],b=new Gs;b.layers.enable(1),b.layers.enable(2);let M=null,S=null;function T(t){const e=y.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function E(){y.forEach((function(t,e){t.disconnect(e)})),y.clear(),M=null,S=null,t.setRenderTarget(m),h=null,c=null,u=null,n=null,g=null,L.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}function A(t){const e=n.inputSources;for(let t=0;t<v.length;t++)y.set(e[t],v[t]);for(let e=0;e<t.removed.length;e++){const r=t.removed[e],n=y.get(r);n&&(n.dispatchEvent({type:"disconnected",data:r}),y.delete(r))}for(let e=0;e<t.added.length;e++){const r=t.added[e],n=y.get(r);n&&n.dispatchEvent({type:"connected",data:r})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=v[t];return void 0===e&&(e=new Hs,v[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=v[t];return void 0===e&&(e=new Hs,v[t]=e),e.getGripSpace()},this.getHand=function(t){let e=v[t];return void 0===e&&(e=new Hs,v[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){i=t,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getBaseLayer=function(){return null!==c?c:h},this.getBinding=function(){return u},this.getFrame=function(){return f},this.getSession=function(){return n},this.setSession=async function(l){if(n=l,null!==n){if(m=t.getRenderTarget(),n.addEventListener("select",T),n.addEventListener("selectstart",T),n.addEventListener("selectend",T),n.addEventListener("squeeze",T),n.addEventListener("squeezestart",T),n.addEventListener("squeezeend",T),n.addEventListener("end",E),n.addEventListener("inputsourceschange",A),!0!==p.xrCompatible&&await e.makeXRCompatible(),void 0===n.renderState.layers||!1===t.capabilities.isWebGL2){const t={antialias:void 0!==n.renderState.layers||p.antialias,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:i};h=new XRWebGLLayer(n,e,t),n.updateRenderState({baseLayer:h}),g=new _r(h.framebufferWidth,h.framebufferHeight)}else{d=p.antialias;let t=null,r=null,a=null;p.depth&&(a=p.stencil?35056:33189,t=p.stencil?Lt:It,r=p.stencil?St:gt);const o={colorFormat:p.alpha||d?32856:32849,depthFormat:a,scaleFactor:i};u=new XRWebGLBinding(n,e),c=u.createProjectionLayer(o),n.updateRenderState({layers:[c]}),g=d?new br(c.textureWidth,c.textureHeight,{format:At,type:ft,depthTexture:new Ws(c.textureWidth,c.textureHeight,r,void 0,void 0,void 0,void 0,void 0,void 0,t),stencilBuffer:p.stencil,ignoreDepth:c.ignoreDepthValues,useRenderToTexture:s}):new _r(c.textureWidth,c.textureHeight,{format:p.alpha?At:Et,type:ft,depthTexture:new Ws(c.textureWidth,c.textureHeight,r,void 0,void 0,void 0,void 0,void 0,void 0,t),stencilBuffer:p.stencil,ignoreDepth:c.ignoreDepthValues})}this.setFoveation(0),a=await n.requestReferenceSpace(o),L.setContext(n),L.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}};const R=new Sr,P=new Sr;function C(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===n)return;b.near=_.near=x.near=t.near,b.far=_.far=x.far=t.far,M===b.near&&S===b.far||(n.updateRenderState({depthNear:b.near,depthFar:b.far}),M=b.near,S=b.far);const e=t.parent,r=b.cameras;C(b,e);for(let t=0;t<r.length;t++)C(r[t],e);b.matrixWorld.decompose(b.position,b.quaternion,b.scale),t.position.copy(b.position),t.quaternion.copy(b.quaternion),t.scale.copy(b.scale),t.matrix.copy(b.matrix),t.matrixWorld.copy(b.matrixWorld);const i=t.children;for(let t=0,e=i.length;t<e;t++)i[t].updateMatrixWorld(!0);2===r.length?function(t,e,r){R.setFromMatrixPosition(e.matrixWorld),P.setFromMatrixPosition(r.matrixWorld);const n=R.distanceTo(P),i=e.projectionMatrix.elements,a=r.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],u=(i[9]-1)/i[5],c=(i[8]-1)/i[0],h=(a[8]+1)/a[0],d=o*c,f=o*h,p=n/(-c+h),m=p*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(p),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=o+p,v=s+p,y=d-m,x=f+(n-m),_=l*s/v*g,w=u*s/v*g;t.projectionMatrix.makePerspective(y,x,_,w,g,v)}(b,x,_):b.projectionMatrix.copy(x.projectionMatrix)},this.getCamera=function(){return b},this.getFoveation=function(){return null!==c?c.fixedFoveation:null!==h?h.fixedFoveation:void 0},this.setFoveation=function(t){null!==c&&(c.fixedFoveation=t),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=t)};let I=null;const L=new $i;L.setAnimationLoop((function(e,r){if(l=r.getViewerPose(a),f=r,null!==l){const e=l.views;null!==h&&(t.setRenderTargetFramebuffer(g,h.framebuffer),t.setRenderTarget(g));let r=!1;e.length!==b.cameras.length&&(b.cameras.length=0,r=!0);for(let n=0;n<e.length;n++){const i=e[n];let a=null;if(null!==h)a=h.getViewport(i);else{const e=u.getViewSubImage(c,i);a=e.viewport,0===n&&(t.setRenderTargetTextures(g,e.colorTexture,c.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(g))}const o=w[n];o.matrix.fromArray(i.transform.matrix),o.projectionMatrix.fromArray(i.projectionMatrix),o.viewport.set(a.x,a.y,a.width,a.height),0===n&&b.matrix.copy(o.matrix),!0===r&&b.cameras.push(o)}}const i=n.inputSources;for(let t=0;t<v.length;t++){const e=v[t],n=i[t];e.update(n,r,a)}I&&I(e,r),f=null})),this.setAnimationLoop=function(t){I=t},this.dispose=function(){}}}function Xs(t){function e(e,r){e.opacity.value=r.opacity,r.color&&e.diffuse.value.copy(r.color),r.emissive&&e.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(e.map.value=r.map),r.alphaMap&&(e.alphaMap.value=r.alphaMap),r.specularMap&&(e.specularMap.value=r.specularMap),r.alphaTest>0&&(e.alphaTest.value=r.alphaTest);const n=t.get(r).envMap;let i,a;n&&(e.envMap.value=n,e.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,e.reflectivity.value=r.reflectivity,e.ior.value=r.ior,e.refractionRatio.value=r.refractionRatio),r.lightMap&&(e.lightMap.value=r.lightMap,e.lightMapIntensity.value=r.lightMapIntensity),r.aoMap&&(e.aoMap.value=r.aoMap,e.aoMapIntensity.value=r.aoMapIntensity),r.map?i=r.map:r.specularMap?i=r.specularMap:r.displacementMap?i=r.displacementMap:r.normalMap?i=r.normalMap:r.bumpMap?i=r.bumpMap:r.roughnessMap?i=r.roughnessMap:r.metalnessMap?i=r.metalnessMap:r.alphaMap?i=r.alphaMap:r.emissiveMap?i=r.emissiveMap:r.clearcoatMap?i=r.clearcoatMap:r.clearcoatNormalMap?i=r.clearcoatNormalMap:r.clearcoatRoughnessMap?i=r.clearcoatRoughnessMap:r.specularIntensityMap?i=r.specularIntensityMap:r.specularColorMap?i=r.specularColorMap:r.transmissionMap?i=r.transmissionMap:r.thicknessMap?i=r.thicknessMap:r.sheenColorMap?i=r.sheenColorMap:r.sheenRoughnessMap&&(i=r.sheenRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix)),r.aoMap?a=r.aoMap:r.lightMap&&(a=r.lightMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),e.uv2Transform.value.copy(a.matrix))}function r(e,r){e.roughness.value=r.roughness,e.metalness.value=r.metalness,r.roughnessMap&&(e.roughnessMap.value=r.roughnessMap),r.metalnessMap&&(e.metalnessMap.value=r.metalnessMap),r.emissiveMap&&(e.emissiveMap.value=r.emissiveMap),r.bumpMap&&(e.bumpMap.value=r.bumpMap,e.bumpScale.value=r.bumpScale,r.side===c&&(e.bumpScale.value*=-1)),r.normalMap&&(e.normalMap.value=r.normalMap,e.normalScale.value.copy(r.normalScale),r.side===c&&e.normalScale.value.negate()),r.displacementMap&&(e.displacementMap.value=r.displacementMap,e.displacementScale.value=r.displacementScale,e.displacementBias.value=r.displacementBias);t.get(r).envMap&&(e.envMapIntensity.value=r.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,n,i,a,o){n.isMeshBasicMaterial?e(t,n):n.isMeshLambertMaterial?(e(t,n),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,n)):n.isMeshToonMaterial?(e(t,n),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===c&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===c&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshPhongMaterial?(e(t,n),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===c&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===c&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshStandardMaterial?(e(t,n),n.isMeshPhysicalMaterial?function(t,e,n){r(t,e),t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,e.side===c&&t.clearcoatNormalScale.value.negate()));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=n.texture,t.transmissionSamplerSize.value.set(n.width,n.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap);e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap)}(t,n,o):r(t,n)):n.isMeshMatcapMaterial?(e(t,n),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===c&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===c&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshDepthMaterial?(e(t,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshDistanceMaterial?(e(t,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,n)):n.isMeshNormalMaterial?(e(t,n),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===c&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===c&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,n),n.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,n)):n.isPointsMaterial?function(t,e,r,n){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*r,t.scale.value=.5*n,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let i;e.map?i=e.map:e.alphaMap&&(i=e.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,n,i,a):n.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let r;e.map?r=e.map:e.alphaMap&&(r=e.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,n):n.isShadowMaterial?(t.color.value.copy(n.color),t.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function Ys(e={}){const r=void 0!==e.canvas?e.canvas:function(){const t=dr("canvas");return t.style.display="block",t}(),n=void 0!==e.context?e.context:null,i=void 0!==e.alpha&&e.alpha,a=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,l=void 0===e.premultipliedAlpha||e.premultipliedAlpha,d=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,f=void 0!==e.powerPreference?e.powerPreference:"default",p=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let m=null,g=null;const v=[],y=[];this.domElement=r,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=De,this.physicallyCorrectLights=!1,this.toneMapping=W,this.toneMappingExposure=1;const x=this;let _=!1,w=0,b=0,M=null,S=-1,T=null;const E=new xr,A=new xr;let R=null,P=r.width,C=r.height,I=1,L=null,O=null;const D=new xr(0,0,P,C),k=new xr(0,0,P,C);let F=!1;const N=[],U=new Qi;let B=!1,z=!1,G=null;const j=new en,V=new Sr,H={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function q(){return null===M?I:1}let X,Y,Z,K,J,Q,$,tt,et,rt,nt,it,ot,lt,ut,ct,ht,pt,mt,gt,vt,yt,wt,bt=n;function Mt(t,e){for(let n=0;n<t.length;n++){const i=t[n],a=r.getContext(i,e);if(null!==a)return a}return null}try{const e={alpha:i,depth:a,stencil:o,antialias:s,premultipliedAlpha:l,preserveDrawingBuffer:d,powerPreference:f,failIfMajorPerformanceCaveat:p};if("setAttribute"in r&&r.setAttribute("data-engine",`three.js r${t}`),r.addEventListener("webglcontextlost",Et,!1),r.addEventListener("webglcontextrestored",Rt,!1),null===bt){const t=["webgl2","webgl","experimental-webgl"];if(!0===x.isWebGL1Renderer&&t.shift(),bt=Mt(t,e),null===bt)throw Mt(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===bt.getShaderPrecisionFormat&&(bt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function St(){X=new Ba(bt),Y=new la(bt,X,e),X.init(Y),yt=new zs(bt,X,Y),Z=new Us(bt,X,Y),N[0]=1029,K=new ja,J=new bs,Q=new Bs(bt,X,Z,J,Y,yt,K),$=new ca(x),tt=new Ua(x),et=new ta(bt,Y),wt=new oa(bt,X,et,Y),rt=new za(bt,et,K,wt),nt=new Ya(bt,rt,et,K),mt=new Xa(bt,Y,Q),ct=new ua(J),it=new ws(x,$,tt,X,Y,wt,ct),ot=new Xs(J),lt=new Es(J),ut=new Ls(X,Y),pt=new aa(x,$,Z,nt,l),ht=new Ns(x,nt,Y),gt=new sa(bt,X,K,Y),vt=new Ga(bt,X,K,Y),K.programs=it.programs,x.capabilities=Y,x.extensions=X,x.properties=J,x.renderLists=lt,x.shadowMap=ht,x.state=Z,x.info=K}St();const Tt=new qs(x,bt);function Et(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),_=!0}function Rt(){console.log("THREE.WebGLRenderer: Context Restored."),_=!1;const t=K.autoReset,e=ht.enabled,r=ht.autoUpdate,n=ht.needsUpdate,i=ht.type;St(),K.autoReset=t,ht.enabled=e,ht.autoUpdate=r,ht.needsUpdate=n,ht.type=i}function Pt(t){const e=t.target;e.removeEventListener("dispose",Pt),function(t){(function(t){const e=J.get(t).programs;void 0!==e&&e.forEach((function(t){it.releaseProgram(t)}))})(t),J.remove(t)}(e)}this.xr=Tt,this.getContext=function(){return bt},this.getContextAttributes=function(){return bt.getContextAttributes()},this.forceContextLoss=function(){const t=X.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=X.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return I},this.setPixelRatio=function(t){void 0!==t&&(I=t,this.setSize(P,C,!1))},this.getSize=function(t){return t.set(P,C)},this.setSize=function(t,e,n){Tt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(P=t,C=e,r.width=Math.floor(t*I),r.height=Math.floor(e*I),!1!==n&&(r.style.width=t+"px",r.style.height=e+"px"),this.setViewport(0,0,t,e))},this.getDrawingBufferSize=function(t){return t.set(P*I,C*I).floor()},this.setDrawingBufferSize=function(t,e,n){P=t,C=e,I=n,r.width=Math.floor(t*n),r.height=Math.floor(e*n),this.setViewport(0,0,t,e)},this.getCurrentViewport=function(t){return t.copy(E)},this.getViewport=function(t){return t.copy(D)},this.setViewport=function(t,e,r,n){t.isVector4?D.set(t.x,t.y,t.z,t.w):D.set(t,e,r,n),Z.viewport(E.copy(D).multiplyScalar(I).floor())},this.getScissor=function(t){return t.copy(k)},this.setScissor=function(t,e,r,n){t.isVector4?k.set(t.x,t.y,t.z,t.w):k.set(t,e,r,n),Z.scissor(A.copy(k).multiplyScalar(I).floor())},this.getScissorTest=function(){return F},this.setScissorTest=function(t){Z.setScissorTest(F=t)},this.setOpaqueSort=function(t){L=t},this.setTransparentSort=function(t){O=t},this.getClearColor=function(t){return t.copy(pt.getClearColor())},this.setClearColor=function(){pt.setClearColor.apply(pt,arguments)},this.getClearAlpha=function(){return pt.getClearAlpha()},this.setClearAlpha=function(){pt.setClearAlpha.apply(pt,arguments)},this.clear=function(t,e,r){let n=0;(void 0===t||t)&&(n|=16384),(void 0===e||e)&&(n|=256),(void 0===r||r)&&(n|=1024),bt.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){r.removeEventListener("webglcontextlost",Et,!1),r.removeEventListener("webglcontextrestored",Rt,!1),lt.dispose(),ut.dispose(),J.dispose(),$.dispose(),tt.dispose(),nt.dispose(),wt.dispose(),Tt.dispose(),Tt.removeEventListener("sessionstart",It),Tt.removeEventListener("sessionend",Lt),G&&(G.dispose(),G=null),Ot.stop()},this.renderBufferDirect=function(t,e,r,n,i,a){null===e&&(e=H);const o=i.isMesh&&i.matrixWorld.determinant()<0,s=function(t,e,r,n,i){!0!==e.isScene&&(e=H);Q.resetTextureUnits();const a=e.fog,o=n.isMeshStandardMaterial?e.environment:null,s=null===M?x.outputEncoding:M.texture.encoding,l=(n.isMeshStandardMaterial?tt:$).get(n.envMap||o),u=!0===n.vertexColors&&!!r.attributes.color&&4===r.attributes.color.itemSize,c=!!n.normalMap&&!!r.attributes.tangent,h=!!r.morphAttributes.position,d=!!r.morphAttributes.normal,f=r.morphAttributes.position?r.morphAttributes.position.length:0,p=J.get(n),m=g.state.lights;if(!0===B&&(!0===z||t!==T)){const e=t===T&&n.id===S;ct.setState(n,t,e)}let v=!1;n.version===p.__version?p.needsLights&&p.lightsStateVersion!==m.state.version||p.outputEncoding!==s||i.isInstancedMesh&&!1===p.instancing?v=!0:i.isInstancedMesh||!0!==p.instancing?i.isSkinnedMesh&&!1===p.skinning?v=!0:i.isSkinnedMesh||!0!==p.skinning?p.envMap!==l||n.fog&&p.fog!==a?v=!0:void 0===p.numClippingPlanes||p.numClippingPlanes===ct.numPlanes&&p.numIntersection===ct.numIntersection?(p.vertexAlphas!==u||p.vertexTangents!==c||p.morphTargets!==h||p.morphNormals!==d||!0===Y.isWebGL2&&p.morphTargetsCount!==f)&&(v=!0):v=!0:v=!0:v=!0:(v=!0,p.__version=n.version);let y=p.currentProgram;!0===v&&(y=Ut(n,e,i));let _=!1,w=!1,b=!1;const E=y.getUniforms(),A=p.uniforms;Z.useProgram(y.program)&&(_=!0,w=!0,b=!0);n.id!==S&&(S=n.id,w=!0);if(_||T!==t){if(E.setValue(bt,"projectionMatrix",t.projectionMatrix),Y.logarithmicDepthBuffer&&E.setValue(bt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),T!==t&&(T=t,w=!0,b=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=E.map.cameraPosition;void 0!==e&&e.setValue(bt,V.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&E.setValue(bt,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||i.isSkinnedMesh)&&E.setValue(bt,"viewMatrix",t.matrixWorldInverse)}if(i.isSkinnedMesh){E.setOptional(bt,i,"bindMatrix"),E.setOptional(bt,i,"bindMatrixInverse");const t=i.skeleton;t&&(Y.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),E.setValue(bt,"boneTexture",t.boneTexture,Q),E.setValue(bt,"boneTextureSize",t.boneTextureSize)):E.setOptional(bt,t,"boneMatrices"))}!r||void 0===r.morphAttributes.position&&void 0===r.morphAttributes.normal||mt.update(i,r,n,y);(w||p.receiveShadow!==i.receiveShadow)&&(p.receiveShadow=i.receiveShadow,E.setValue(bt,"receiveShadow",i.receiveShadow));w&&(E.setValue(bt,"toneMappingExposure",x.toneMappingExposure),p.needsLights&&(P=b,(R=A).ambientLightColor.needsUpdate=P,R.lightProbe.needsUpdate=P,R.directionalLights.needsUpdate=P,R.directionalLightShadows.needsUpdate=P,R.pointLights.needsUpdate=P,R.pointLightShadows.needsUpdate=P,R.spotLights.needsUpdate=P,R.spotLightShadows.needsUpdate=P,R.rectAreaLights.needsUpdate=P,R.hemisphereLights.needsUpdate=P),a&&n.fog&&ot.refreshFogUniforms(A,a),ot.refreshMaterialUniforms(A,n,I,C,G),ts.upload(bt,p.uniformsList,A,Q));var R,P;n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(ts.upload(bt,p.uniformsList,A,Q),n.uniformsNeedUpdate=!1);n.isSpriteMaterial&&E.setValue(bt,"center",i.center);return E.setValue(bt,"modelViewMatrix",i.modelViewMatrix),E.setValue(bt,"normalMatrix",i.normalMatrix),E.setValue(bt,"modelMatrix",i.matrixWorld),y}(t,e,r,n,i);Z.setMaterial(n,o);let l=r.index;const u=r.attributes.position;if(null===l){if(void 0===u||0===u.count)return}else if(0===l.count)return;let c,h=1;!0===n.wireframe&&(l=rt.getWireframeAttribute(r),h=2),wt.setup(i,n,s,r,l);let d=gt;null!==l&&(c=et.get(l),d=vt,d.setIndex(c));const f=null!==l?l.count:u.count,p=r.drawRange.start*h,m=r.drawRange.count*h,v=null!==a?a.start*h:0,y=null!==a?a.count*h:1/0,_=Math.max(p,v),w=Math.min(f,p+m,v+y)-1,b=Math.max(0,w-_+1);if(0!==b){if(i.isMesh)!0===n.wireframe?(Z.setLineWidth(n.wireframeLinewidth*q()),d.setMode(1)):d.setMode(4);else if(i.isLine){let t=n.linewidth;void 0===t&&(t=1),Z.setLineWidth(t*q()),i.isLineSegments?d.setMode(1):i.isLineLoop?d.setMode(2):d.setMode(3)}else i.isPoints?d.setMode(0):i.isSprite&&d.setMode(4);if(i.isInstancedMesh)d.renderInstances(_,b,i.count);else if(r.isInstancedBufferGeometry){const t=Math.min(r.instanceCount,r._maxInstanceCount);d.renderInstances(_,b,t)}else d.render(_,b)}},this.compile=function(t,e){g=ut.get(t),g.init(),y.push(g),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(g.pushLight(t),t.castShadow&&g.pushShadow(t))})),g.setupLights(x.physicallyCorrectLights),t.traverse((function(e){const r=e.material;if(r)if(Array.isArray(r))for(let n=0;n<r.length;n++){Ut(r[n],t,e)}else Ut(r,t,e)})),y.pop(),g=null};let Ct=null;function It(){Ot.stop()}function Lt(){Ot.start()}const Ot=new $i;function Dt(t,e,r,n){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)r=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)g.pushLight(t),t.castShadow&&g.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||U.intersectsSprite(t)){n&&V.setFromMatrixPosition(t.matrixWorld).applyMatrix4(j);const e=nt.update(t),i=t.material;i.visible&&m.push(t,e,i,r,V.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==K.render.frame&&(t.skeleton.update(),t.skeleton.frame=K.render.frame),!t.frustumCulled||U.intersectsObject(t))){n&&V.setFromMatrixPosition(t.matrixWorld).applyMatrix4(j);const e=nt.update(t),i=t.material;if(Array.isArray(i)){const n=e.groups;for(let a=0,o=n.length;a<o;a++){const o=n[a],s=i[o.materialIndex];s&&s.visible&&m.push(t,e,s,r,V.z,o)}}else i.visible&&m.push(t,e,i,r,V.z,null)}const i=t.children;for(let t=0,a=i.length;t<a;t++)Dt(i[t],e,r,n)}function kt(t,e,r,n){const i=t.opaque,a=t.transmissive,o=t.transparent;g.setupLightsView(r),a.length>0&&function(t,e,r){if(null===G){const t=!0===s&&!0===Y.isWebGL2;G=new(t?br:_r)(1024,1024,{generateMipmaps:!0,type:null!==yt.convert(_t)?_t:ft,minFilter:dt,magFilter:st,wrapS:at,wrapT:at,useRenderToTexture:X.has("WEBGL_multisampled_render_to_texture")})}const n=x.getRenderTarget();x.setRenderTarget(G),x.clear();const i=x.toneMapping;x.toneMapping=W,Ft(t,e,r),x.toneMapping=i,Q.updateMultisampleRenderTarget(G),Q.updateRenderTargetMipmap(G),x.setRenderTarget(n)}(i,e,r),n&&Z.viewport(E.copy(n)),i.length>0&&Ft(i,e,r),a.length>0&&Ft(a,e,r),o.length>0&&Ft(o,e,r)}function Ft(t,e,r){const n=!0===e.isScene?e.overrideMaterial:null;for(let i=0,a=t.length;i<a;i++){const a=t[i],o=a.object,s=a.geometry,l=null===n?a.material:n,u=a.group;o.layers.test(r.layers)&&Nt(o,e,r,s,l,u)}}function Nt(t,e,r,n,i,a){t.onBeforeRender(x,e,r,n,i,a),t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),i.onBeforeRender(x,e,r,n,t,a),!0===i.transparent&&i.side===h?(i.side=c,i.needsUpdate=!0,x.renderBufferDirect(r,e,n,i,t,a),i.side=u,i.needsUpdate=!0,x.renderBufferDirect(r,e,n,i,t,a),i.side=h):x.renderBufferDirect(r,e,n,i,t,a),t.onAfterRender(x,e,r,n,i,a)}function Ut(t,e,r){!0!==e.isScene&&(e=H);const n=J.get(t),i=g.state.lights,a=g.state.shadowsArray,o=i.state.version,s=it.getParameters(t,i.state,a,e,r),l=it.getProgramCacheKey(s);let u=n.programs;n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.envMap=(t.isMeshStandardMaterial?tt:$).get(t.envMap||n.environment),void 0===u&&(t.addEventListener("dispose",Pt),u=new Map,n.programs=u);let c=u.get(l);if(void 0!==c){if(n.currentProgram===c&&n.lightsStateVersion===o)return Bt(t,s),c}else s.uniforms=it.getUniforms(t),t.onBuild(r,s,x),t.onBeforeCompile(s,x),c=it.acquireProgram(s,l),u.set(l,c),n.uniforms=s.uniforms;const h=n.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(h.clippingPlanes=ct.uniform),Bt(t,s),n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=o,n.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);const d=c.getUniforms(),f=ts.seqWithValue(d.seq,h);return n.currentProgram=c,n.uniformsList=f,c}function Bt(t,e){const r=J.get(t);r.outputEncoding=e.outputEncoding,r.instancing=e.instancing,r.skinning=e.skinning,r.morphTargets=e.morphTargets,r.morphNormals=e.morphNormals,r.morphTargetsCount=e.morphTargetsCount,r.numClippingPlanes=e.numClippingPlanes,r.numIntersection=e.numClipIntersection,r.vertexAlphas=e.vertexAlphas,r.vertexTangents=e.vertexTangents}Ot.setAnimationLoop((function(t){Ct&&Ct(t)})),"undefined"!=typeof window&&Ot.setContext(window),this.setAnimationLoop=function(t){Ct=t,Tt.setAnimationLoop(t),null===t?Ot.stop():Ot.start()},Tt.addEventListener("sessionstart",It),Tt.addEventListener("sessionend",Lt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===_)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===Tt.enabled&&!0===Tt.isPresenting&&(!0===Tt.cameraAutoUpdate&&Tt.updateCamera(e),e=Tt.getCamera()),!0===t.isScene&&t.onBeforeRender(x,t,e,M),g=ut.get(t,y.length),g.init(),y.push(g),j.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),U.setFromProjectionMatrix(j),z=this.localClippingEnabled,B=ct.init(this.clippingPlanes,z,e),m=lt.get(t,v.length),m.init(),v.push(m),Dt(t,e,0,x.sortObjects),m.finish(),!0===x.sortObjects&&m.sort(L,O),!0===B&&ct.beginShadows();const r=g.state.shadowsArray;if(ht.render(r,t,e),!0===B&&ct.endShadows(),!0===this.info.autoReset&&this.info.reset(),pt.render(m,t),g.setupLights(x.physicallyCorrectLights),e.isArrayCamera){const r=e.cameras;for(let e=0,n=r.length;e<n;e++){const n=r[e];kt(m,t,n,n.viewport)}}else kt(m,t,e);null!==M&&(Q.updateMultisampleRenderTarget(M),Q.updateRenderTargetMipmap(M)),!0===t.isScene&&t.onAfterRender(x,t,e),Z.buffers.depth.setTest(!0),Z.buffers.depth.setMask(!0),Z.buffers.color.setMask(!0),Z.setPolygonOffset(!1),wt.resetDefaultState(),S=-1,T=null,y.pop(),g=y.length>0?y[y.length-1]:null,v.pop(),m=v.length>0?v[v.length-1]:null},this.getActiveCubeFace=function(){return w},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(t,e,r){J.get(t.texture).__webglTexture=e,J.get(t.depthTexture).__webglTexture=r;const n=J.get(t);n.__hasExternalTextures=!0,n.__hasExternalTextures&&(n.__autoAllocateDepthBuffer=void 0===r,n.__autoAllocateDepthBuffer||t.useRenderToTexture&&(console.warn("render-to-texture extension was disabled because an external texture was provided"),t.useRenderToTexture=!1,t.useRenderbuffer=!0))},this.setRenderTargetFramebuffer=function(t,e){const r=J.get(t);r.__webglFramebuffer=e,r.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,r=0){M=t,w=e,b=r;let n=!0;if(t){const e=J.get(t);void 0!==e.__useDefaultFramebuffer?(Z.bindFramebuffer(36160,null),n=!1):void 0===e.__webglFramebuffer?Q.setupRenderTarget(t):e.__hasExternalTextures&&Q.rebindTextures(t,J.get(t.texture).__webglTexture,J.get(t.depthTexture).__webglTexture)}let i=null,a=!1,o=!1;if(t){const r=t.texture;(r.isDataTexture3D||r.isDataTexture2DArray)&&(o=!0);const n=J.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(i=n[e],a=!0):i=t.useRenderbuffer?J.get(t).__webglMultisampledFramebuffer:n,E.copy(t.viewport),A.copy(t.scissor),R=t.scissorTest}else E.copy(D).multiplyScalar(I).floor(),A.copy(k).multiplyScalar(I).floor(),R=F;if(Z.bindFramebuffer(36160,i)&&Y.drawBuffers&&n){let e=!1;if(t)if(t.isWebGLMultipleRenderTargets){const r=t.texture;if(N.length!==r.length||36064!==N[0]){for(let t=0,e=r.length;t<e;t++)N[t]=36064+t;N.length=r.length,e=!0}}else 1===N.length&&36064===N[0]||(N[0]=36064,N.length=1,e=!0);else 1===N.length&&1029===N[0]||(N[0]=1029,N.length=1,e=!0);e&&(Y.isWebGL2?bt.drawBuffers(N):X.get("WEBGL_draw_buffers").drawBuffersWEBGL(N))}if(Z.viewport(E),Z.scissor(A),Z.setScissorTest(R),a){const n=J.get(t.texture);bt.framebufferTexture2D(36160,36064,34069+e,n.__webglTexture,r)}else if(o){const n=J.get(t.texture),i=e||0;bt.framebufferTextureLayer(36160,36064,n.__webglTexture,r||0,i)}S=-1},this.readRenderTargetPixels=function(t,e,r,n,i,a,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=J.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){Z.bindFramebuffer(36160,s);try{const o=t.texture,s=o.format,l=o.type;if(s!==At&&yt.convert(s)!==bt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const u=l===_t&&(X.has("EXT_color_buffer_half_float")||Y.isWebGL2&&X.has("EXT_color_buffer_float"));if(!(l===ft||yt.convert(l)===bt.getParameter(35738)||l===xt&&(Y.isWebGL2||X.has("OES_texture_float")||X.has("WEBGL_color_buffer_float"))||u))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===bt.checkFramebufferStatus(36160)?e>=0&&e<=t.width-n&&r>=0&&r<=t.height-i&&bt.readPixels(e,r,n,i,yt.convert(s),yt.convert(l),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const t=null!==M?J.get(M).__webglFramebuffer:null;Z.bindFramebuffer(36160,t)}}},this.copyFramebufferToTexture=function(t,e,r=0){const n=Math.pow(2,-r),i=Math.floor(e.image.width*n),a=Math.floor(e.image.height*n);let o=yt.convert(e.format);Y.isWebGL2&&(6407===o&&(o=32849),6408===o&&(o=32856)),Q.setTexture2D(e,0),bt.copyTexImage2D(3553,r,o,t.x,t.y,i,a,0),Z.unbindTexture()},this.copyTextureToTexture=function(t,e,r,n=0){const i=e.image.width,a=e.image.height,o=yt.convert(r.format),s=yt.convert(r.type);Q.setTexture2D(r,0),bt.pixelStorei(37440,r.flipY),bt.pixelStorei(37441,r.premultiplyAlpha),bt.pixelStorei(3317,r.unpackAlignment),e.isDataTexture?bt.texSubImage2D(3553,n,t.x,t.y,i,a,o,s,e.image.data):e.isCompressedTexture?bt.compressedTexSubImage2D(3553,n,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):bt.texSubImage2D(3553,n,t.x,t.y,o,s,e.image),0===n&&r.generateMipmaps&&bt.generateMipmap(3553),Z.unbindTexture()},this.copyTextureToTexture3D=function(t,e,r,n,i=0){if(x.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const a=t.max.x-t.min.x+1,o=t.max.y-t.min.y+1,s=t.max.z-t.min.z+1,l=yt.convert(n.format),u=yt.convert(n.type);let c;if(n.isDataTexture3D)Q.setTexture3D(n,0),c=32879;else{if(!n.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Q.setTexture2DArray(n,0),c=35866}bt.pixelStorei(37440,n.flipY),bt.pixelStorei(37441,n.premultiplyAlpha),bt.pixelStorei(3317,n.unpackAlignment);const h=bt.getParameter(3314),d=bt.getParameter(32878),f=bt.getParameter(3316),p=bt.getParameter(3315),m=bt.getParameter(32877),g=r.isCompressedTexture?r.mipmaps[0]:r.image;bt.pixelStorei(3314,g.width),bt.pixelStorei(32878,g.height),bt.pixelStorei(3316,t.min.x),bt.pixelStorei(3315,t.min.y),bt.pixelStorei(32877,t.min.z),r.isDataTexture||r.isDataTexture3D?bt.texSubImage3D(c,i,e.x,e.y,e.z,a,o,s,l,u,g.data):r.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),bt.compressedTexSubImage3D(c,i,e.x,e.y,e.z,a,o,s,l,g.data)):bt.texSubImage3D(c,i,e.x,e.y,e.z,a,o,s,l,u,g),bt.pixelStorei(3314,h),bt.pixelStorei(32878,d),bt.pixelStorei(3316,f),bt.pixelStorei(3315,p),bt.pixelStorei(32877,m),0===i&&n.generateMipmaps&&bt.generateMipmap(c),Z.unbindTexture()},this.initTexture=function(t){Q.setTexture2D(t,0),Z.unbindTexture()},this.resetState=function(){w=0,b=0,M=null,Z.reset(),wt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Ys.prototype.isWebGLRenderer=!0;class Zs extends Ys{}Zs.prototype.isWebGL1Renderer=!0;class Ks{constructor(t,e=25e-5){this.name="",this.color=new Xn(t),this.density=e}clone(){return new Ks(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}Ks.prototype.isFogExp2=!0;class Js{constructor(t,e=1,r=1e3){this.name="",this.color=new Xn(t),this.near=e,this.far=r}clone(){return new Js(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Js.prototype.isFog=!0;class Qs extends An{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}Qs.prototype.isScene=!0;class $s{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=We,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=$e()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,r){t*=this.stride,r*=e.stride;for(let n=0,i=this.stride;n<i;n++)this.array[t+n]=e.array[r+n];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=$e()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(e,this.stride);return r.setUsage(this.usage),r}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=$e()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}$s.prototype.isInterleavedBuffer=!0;const tl=new Sr;class el{constructor(t,e,r,n=!1){this.name="",this.data=t,this.itemSize=e,this.offset=r,this.normalized=!0===n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,r=this.data.count;e<r;e++)tl.x=this.getX(e),tl.y=this.getY(e),tl.z=this.getZ(e),tl.applyMatrix4(t),this.setXYZ(e,tl.x,tl.y,tl.z);return this}applyNormalMatrix(t){for(let e=0,r=this.count;e<r;e++)tl.x=this.getX(e),tl.y=this.getY(e),tl.z=this.getZ(e),tl.applyNormalMatrix(t),this.setXYZ(e,tl.x,tl.y,tl.z);return this}transformDirection(t){for(let e=0,r=this.count;e<r;e++)tl.x=this.getX(e),tl.y=this.getY(e),tl.z=this.getZ(e),tl.transformDirection(t),this.setXYZ(e,tl.x,tl.y,tl.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this}setXYZ(t,e,r,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this}setXYZW(t,e,r,n,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this.data.array[t+3]=i,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const r=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[r+e])}return new Jn(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new el(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const r=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[r+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}el.prototype.isInterleavedBufferAttribute=!0;class rl extends zn{constructor(t){super(),this.type="SpriteMaterial",this.color=new Xn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}}let nl;rl.prototype.isSpriteMaterial=!0;const il=new Sr,al=new Sr,ol=new Sr,sl=new sr,ll=new sr,ul=new en,cl=new Sr,hl=new Sr,dl=new Sr,fl=new sr,pl=new sr,ml=new sr;class gl extends An{constructor(t){if(super(),this.type="Sprite",void 0===nl){nl=new mi;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new $s(t,5);nl.setIndex([0,1,2,0,2,3]),nl.setAttribute("position",new el(e,3,0,!1)),nl.setAttribute("uv",new el(e,2,3,!1))}this.geometry=nl,this.material=void 0!==t?t:new rl,this.center=new sr(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),al.setFromMatrixScale(this.matrixWorld),ul.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),ol.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&al.multiplyScalar(-ol.z);const r=this.material.rotation;let n,i;0!==r&&(i=Math.cos(r),n=Math.sin(r));const a=this.center;vl(cl.set(-.5,-.5,0),ol,a,al,n,i),vl(hl.set(.5,-.5,0),ol,a,al,n,i),vl(dl.set(.5,.5,0),ol,a,al,n,i),fl.set(0,0),pl.set(1,0),ml.set(1,1);let o=t.ray.intersectTriangle(cl,hl,dl,!1,il);if(null===o&&(vl(hl.set(-.5,.5,0),ol,a,al,n,i),pl.set(0,1),o=t.ray.intersectTriangle(cl,dl,hl,!1,il),null===o))return;const s=t.ray.origin.distanceTo(il);s<t.near||s>t.far||e.push({distance:s,point:il.clone(),uv:Un.getUV(il,cl,hl,dl,fl,pl,ml,new sr),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function vl(t,e,r,n,i,a){sl.subVectors(t,r).addScalar(.5).multiply(n),void 0!==i?(ll.x=a*sl.x-i*sl.y,ll.y=i*sl.x+a*sl.y):ll.copy(sl),t.copy(e),t.x+=ll.x,t.y+=ll.y,t.applyMatrix4(ul)}gl.prototype.isSprite=!0;const yl=new Sr,xl=new Sr;class _l extends An{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let t=0,r=e.length;t<r;t++){const r=e[t];this.addLevel(r.object.clone(),r.distance)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0){e=Math.abs(e);const r=this.levels;let n;for(n=0;n<r.length&&!(e<r[n].distance);n++);return r.splice(n,0,{distance:e,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let r,n;for(r=1,n=e.length;r<n&&!(t<e[r].distance);r++);return e[r-1].object}return null}raycast(t,e){if(this.levels.length>0){yl.setFromMatrixPosition(this.matrixWorld);const r=t.ray.origin.distanceTo(yl);this.getObjectForDistance(r).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){yl.setFromMatrixPosition(t.matrixWorld),xl.setFromMatrixPosition(this.matrixWorld);const r=yl.distanceTo(xl)/t.zoom;let n,i;for(e[0].object.visible=!0,n=1,i=e.length;n<i&&r>=e[n].distance;n++)e[n-1].object.visible=!1,e[n].object.visible=!0;for(this._currentLevel=n-1;n<i;n++)e[n].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const r=this.levels;for(let t=0,n=r.length;t<n;t++){const n=r[t];e.object.levels.push({object:n.object.uuid,distance:n.distance})}return e}}const wl=new Sr,bl=new xr,Ml=new xr,Sl=new Sr,Tl=new en;class El extends Oi{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new en,this.bindMatrixInverse=new en}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new xr,e=this.geometry.attributes.skinWeight;for(let r=0,n=e.count;r<n;r++){t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.w=e.getW(r);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(r,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const r=this.skeleton,n=this.geometry;bl.fromBufferAttribute(n.attributes.skinIndex,t),Ml.fromBufferAttribute(n.attributes.skinWeight,t),wl.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const n=Ml.getComponent(t);if(0!==n){const i=bl.getComponent(t);Tl.multiplyMatrices(r.bones[i].matrixWorld,r.boneInverses[i]),e.addScaledVector(Sl.copy(wl).applyMatrix4(Tl),n)}}return e.applyMatrix4(this.bindMatrixInverse)}}El.prototype.isSkinnedMesh=!0;class Al extends An{constructor(){super(),this.type="Bone"}}Al.prototype.isBone=!0;class Rl extends vr{constructor(t=null,e=1,r=1,n,i,a,o,s,l=st,u=st,c,h){super(null,a,o,s,l,u,n,i,c,h),this.image={data:t,width:e,height:r},this.magFilter=l,this.minFilter=u,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Rl.prototype.isDataTexture=!0;const Pl=new en,Cl=new en;class Il{constructor(t=[],e=[]){this.uuid=$e(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new en)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new en;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,r=this.boneMatrices,n=this.boneTexture;for(let n=0,i=t.length;n<i;n++){const i=t[n]?t[n].matrixWorld:Cl;Pl.multiplyMatrices(i,e[n]),Pl.toArray(r,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new Il(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=ir(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const r=new Rl(e,t,t,At,xt);return this.boneMatrices=e,this.boneTexture=r,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,r=this.bones.length;e<r;e++){const r=this.bones[e];if(r.name===t)return r}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let r=0,n=t.bones.length;r<n;r++){const n=t.bones[r];let i=e[n];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),i=new Al),this.bones.push(i),this.boneInverses.push((new en).fromArray(t.boneInverses[r]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,r=this.boneInverses;for(let n=0,i=e.length;n<i;n++){const i=e[n];t.bones.push(i.uuid);const a=r[n];t.boneInverses.push(a.toArray())}return t}}class Ll extends Jn{constructor(t,e,r,n=1){"number"==typeof r&&(n=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,r),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}Ll.prototype.isInstancedBufferAttribute=!0;const Ol=new en,Dl=new en,kl=[],Fl=new Oi;class Nl extends Oi{constructor(t,e,r){super(t,e),this.instanceMatrix=new Ll(new Float32Array(16*r),16),this.instanceColor=null,this.count=r,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const r=this.matrixWorld,n=this.count;if(Fl.geometry=this.geometry,Fl.material=this.material,void 0!==Fl.material)for(let i=0;i<n;i++){this.getMatrixAt(i,Ol),Dl.multiplyMatrices(r,Ol),Fl.matrixWorld=Dl,Fl.raycast(t,kl);for(let t=0,r=kl.length;t<r;t++){const r=kl[t];r.instanceId=i,r.object=this,e.push(r)}kl.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new Ll(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}Nl.prototype.isInstancedMesh=!0;class Ul extends zn{constructor(t){super(),this.type="LineBasicMaterial",this.color=new Xn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this}}Ul.prototype.isLineBasicMaterial=!0;const Bl=new Sr,zl=new Sr,Gl=new en,jl=new tn,Vl=new qr;class Hl extends An{constructor(t=new mi,e=new Ul){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,r=[0];for(let t=1,n=e.count;t<n;t++)Bl.fromBufferAttribute(e,t-1),zl.fromBufferAttribute(e,t),r[t]=r[t-1],r[t]+=Bl.distanceTo(zl);t.setAttribute("lineDistance",new oi(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const r=this.geometry,n=this.matrixWorld,i=t.params.Line.threshold,a=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),Vl.copy(r.boundingSphere),Vl.applyMatrix4(n),Vl.radius+=i,!1===t.ray.intersectsSphere(Vl))return;Gl.copy(n).invert(),jl.copy(t.ray).applyMatrix4(Gl);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=new Sr,u=new Sr,c=new Sr,h=new Sr,d=this.isLineSegments?2:1;if(r.isBufferGeometry){const n=r.index,i=r.attributes.position;if(null!==n){for(let r=Math.max(0,a.start),o=Math.min(n.count,a.start+a.count)-1;r<o;r+=d){const a=n.getX(r),o=n.getX(r+1);l.fromBufferAttribute(i,a),u.fromBufferAttribute(i,o);if(jl.distanceSqToSegment(l,u,h,c)>s)continue;h.applyMatrix4(this.matrixWorld);const d=t.ray.origin.distanceTo(h);d<t.near||d>t.far||e.push({distance:d,point:c.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}else{for(let r=Math.max(0,a.start),n=Math.min(i.count,a.start+a.count)-1;r<n;r+=d){l.fromBufferAttribute(i,r),u.fromBufferAttribute(i,r+1);if(jl.distanceSqToSegment(l,u,h,c)>s)continue;h.applyMatrix4(this.matrixWorld);const n=t.ray.origin.distanceTo(h);n<t.near||n>t.far||e.push({distance:n,point:c.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}}else r.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,r=Object.keys(e);if(r.length>0){const t=e[r[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,r=t.length;e<r;e++){const r=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Hl.prototype.isLine=!0;const Wl=new Sr,ql=new Sr;class Xl extends Hl{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,r=[];for(let t=0,n=e.count;t<n;t+=2)Wl.fromBufferAttribute(e,t),ql.fromBufferAttribute(e,t+1),r[t]=0===t?0:r[t-1],r[t+1]=r[t]+Wl.distanceTo(ql);t.setAttribute("lineDistance",new oi(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Xl.prototype.isLineSegments=!0;class Yl extends Hl{constructor(t,e){super(t,e),this.type="LineLoop"}}Yl.prototype.isLineLoop=!0;let Zl=class extends zn{constructor(t){super(),this.type="PointsMaterial",this.color=new Xn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}};Zl.prototype.isPointsMaterial=!0;const Kl=new en,Jl=new tn,Ql=new qr,$l=new Sr;let tu=class extends An{constructor(t=new mi,e=new Zl){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const r=this.geometry,n=this.matrixWorld,i=t.params.Points.threshold,a=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),Ql.copy(r.boundingSphere),Ql.applyMatrix4(n),Ql.radius+=i,!1===t.ray.intersectsSphere(Ql))return;Kl.copy(n).invert(),Jl.copy(t.ray).applyMatrix4(Kl);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(r.isBufferGeometry){const i=r.index,o=r.attributes.position;if(null!==i){for(let r=Math.max(0,a.start),l=Math.min(i.count,a.start+a.count);r<l;r++){const a=i.getX(r);$l.fromBufferAttribute(o,a),eu($l,a,s,n,t,e,this)}}else{for(let r=Math.max(0,a.start),i=Math.min(o.count,a.start+a.count);r<i;r++)$l.fromBufferAttribute(o,r),eu($l,r,s,n,t,e,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,r=Object.keys(e);if(r.length>0){const t=e[r[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,r=t.length;e<r;e++){const r=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};function eu(t,e,r,n,i,a,o){const s=Jl.distanceSqToPoint(t);if(s<r){const r=new Sr;Jl.closestPointToPoint(t,r),r.applyMatrix4(n);const l=i.ray.origin.distanceTo(r);if(l<i.near||l>i.far)return;a.push({distance:l,distanceToRay:Math.sqrt(s),point:r,index:e,face:null,object:o})}}tu.prototype.isPoints=!0;class ru extends vr{constructor(t,e,r,n,i,a,o,s,l){super(t,e,r,n,i,a,o,s,l),this.format=void 0!==o?o:Et,this.minFilter=void 0!==a?a:ct,this.magFilter=void 0!==i?i:ct,this.generateMipmaps=!1;const u=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){u.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}ru.prototype.isVideoTexture=!0;class nu extends vr{constructor(t,e,r,n,i,a,o,s,l,u,c,h){super(null,a,o,s,l,u,n,i,c,h),this.image={width:e,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}nu.prototype.isCompressedTexture=!0;class iu extends vr{constructor(t,e,r,n,i,a,o,s,l){super(t,e,r,n,i,a,o,s,l),this.needsUpdate=!0}}iu.prototype.isCanvasTexture=!0;class au extends mi{constructor(t=1,e=8,r=0,n=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:n},e=Math.max(3,e);const i=[],a=[],o=[],s=[],l=new Sr,u=new sr;a.push(0,0,0),o.push(0,0,1),s.push(.5,.5);for(let i=0,c=3;i<=e;i++,c+=3){const h=r+i/e*n;l.x=t*Math.cos(h),l.y=t*Math.sin(h),a.push(l.x,l.y,l.z),o.push(0,0,1),u.x=(a[c]/t+1)/2,u.y=(a[c+1]/t+1)/2,s.push(u.x,u.y)}for(let t=1;t<=e;t++)i.push(t,t+1,0);this.setIndex(i),this.setAttribute("position",new oi(a,3)),this.setAttribute("normal",new oi(o,3)),this.setAttribute("uv",new oi(s,2))}static fromJSON(t){return new au(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class ou extends mi{constructor(t=1,e=1,r=1,n=8,i=1,a=!1,o=0,s=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:n,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s};const l=this;n=Math.floor(n),i=Math.floor(i);const u=[],c=[],h=[],d=[];let f=0;const p=[],m=r/2;let g=0;function v(r){const i=f,a=new sr,p=new Sr;let v=0;const y=!0===r?t:e,x=!0===r?1:-1;for(let t=1;t<=n;t++)c.push(0,m*x,0),h.push(0,x,0),d.push(.5,.5),f++;const _=f;for(let t=0;t<=n;t++){const e=t/n*s+o,r=Math.cos(e),i=Math.sin(e);p.x=y*i,p.y=m*x,p.z=y*r,c.push(p.x,p.y,p.z),h.push(0,x,0),a.x=.5*r+.5,a.y=.5*i*x+.5,d.push(a.x,a.y),f++}for(let t=0;t<n;t++){const e=i+t,n=_+t;!0===r?u.push(n,n+1,e):u.push(n+1,n,e),v+=3}l.addGroup(g,v,!0===r?1:2),g+=v}!function(){const a=new Sr,v=new Sr;let y=0;const x=(e-t)/r;for(let l=0;l<=i;l++){const u=[],g=l/i,y=g*(e-t)+t;for(let t=0;t<=n;t++){const e=t/n,i=e*s+o,l=Math.sin(i),p=Math.cos(i);v.x=y*l,v.y=-g*r+m,v.z=y*p,c.push(v.x,v.y,v.z),a.set(l,x,p).normalize(),h.push(a.x,a.y,a.z),d.push(e,1-g),u.push(f++)}p.push(u)}for(let t=0;t<n;t++)for(let e=0;e<i;e++){const r=p[e][t],n=p[e+1][t],i=p[e+1][t+1],a=p[e][t+1];u.push(r,n,a),u.push(n,i,a),y+=6}l.addGroup(g,y,0),g+=y}(),!1===a&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(u),this.setAttribute("position",new oi(c,3)),this.setAttribute("normal",new oi(h,3)),this.setAttribute("uv",new oi(d,2))}static fromJSON(t){return new ou(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class su extends ou{constructor(t=1,e=1,r=8,n=1,i=!1,a=0,o=2*Math.PI){super(0,t,e,r,n,i,a,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:a,thetaLength:o}}static fromJSON(t){return new su(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class lu extends mi{constructor(t=[],e=[],r=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:n};const i=[],a=[];function o(t,e,r,n){const i=n+1,a=[];for(let n=0;n<=i;n++){a[n]=[];const o=t.clone().lerp(r,n/i),s=e.clone().lerp(r,n/i),l=i-n;for(let t=0;t<=l;t++)a[n][t]=0===t&&n===i?o:o.clone().lerp(s,t/l)}for(let t=0;t<i;t++)for(let e=0;e<2*(i-t)-1;e++){const r=Math.floor(e/2);e%2==0?(s(a[t][r+1]),s(a[t+1][r]),s(a[t][r])):(s(a[t][r+1]),s(a[t+1][r+1]),s(a[t+1][r]))}}function s(t){i.push(t.x,t.y,t.z)}function l(e,r){const n=3*e;r.x=t[n+0],r.y=t[n+1],r.z=t[n+2]}function u(t,e,r,n){n<0&&1===t.x&&(a[e]=t.x-1),0===r.x&&0===r.z&&(a[e]=n/2/Math.PI+.5)}function c(t){return Math.atan2(t.z,-t.x)}!function(t){const r=new Sr,n=new Sr,i=new Sr;for(let a=0;a<e.length;a+=3)l(e[a+0],r),l(e[a+1],n),l(e[a+2],i),o(r,n,i,t)}(n),function(t){const e=new Sr;for(let r=0;r<i.length;r+=3)e.x=i[r+0],e.y=i[r+1],e.z=i[r+2],e.normalize().multiplyScalar(t),i[r+0]=e.x,i[r+1]=e.y,i[r+2]=e.z}(r),function(){const t=new Sr;for(let r=0;r<i.length;r+=3){t.x=i[r+0],t.y=i[r+1],t.z=i[r+2];const n=c(t)/2/Math.PI+.5,o=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);a.push(n,1-o)}var e;(function(){const t=new Sr,e=new Sr,r=new Sr,n=new Sr,o=new sr,s=new sr,l=new sr;for(let h=0,d=0;h<i.length;h+=9,d+=6){t.set(i[h+0],i[h+1],i[h+2]),e.set(i[h+3],i[h+4],i[h+5]),r.set(i[h+6],i[h+7],i[h+8]),o.set(a[d+0],a[d+1]),s.set(a[d+2],a[d+3]),l.set(a[d+4],a[d+5]),n.copy(t).add(e).add(r).divideScalar(3);const f=c(n);u(o,d+0,t,f),u(s,d+2,e,f),u(l,d+4,r,f)}})(),function(){for(let t=0;t<a.length;t+=6){const e=a[t+0],r=a[t+2],n=a[t+4],i=Math.max(e,r,n),o=Math.min(e,r,n);i>.9&&o<.1&&(e<.2&&(a[t+0]+=1),r<.2&&(a[t+2]+=1),n<.2&&(a[t+4]+=1))}}()}(),this.setAttribute("position",new oi(i,3)),this.setAttribute("normal",new oi(i.slice(),3)),this.setAttribute("uv",new oi(a,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(t){return new lu(t.vertices,t.indices,t.radius,t.details)}}class uu extends lu{constructor(t=1,e=0){const r=(1+Math.sqrt(5))/2,n=1/r;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new uu(t.radius,t.detail)}}const cu=new Sr,hu=new Sr,du=new Sr,fu=new Un;class pu extends mi{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const r=4,n=Math.pow(10,r),i=Math.cos(Je*e),a=t.getIndex(),o=t.getAttribute("position"),s=a?a.count:o.count,l=[0,0,0],u=["a","b","c"],c=new Array(3),h={},d=[];for(let t=0;t<s;t+=3){a?(l[0]=a.getX(t),l[1]=a.getX(t+1),l[2]=a.getX(t+2)):(l[0]=t,l[1]=t+1,l[2]=t+2);const{a:e,b:r,c:s}=fu;if(e.fromBufferAttribute(o,l[0]),r.fromBufferAttribute(o,l[1]),s.fromBufferAttribute(o,l[2]),fu.getNormal(du),c[0]=`${Math.round(e.x*n)},${Math.round(e.y*n)},${Math.round(e.z*n)}`,c[1]=`${Math.round(r.x*n)},${Math.round(r.y*n)},${Math.round(r.z*n)}`,c[2]=`${Math.round(s.x*n)},${Math.round(s.y*n)},${Math.round(s.z*n)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let t=0;t<3;t++){const e=(t+1)%3,r=c[t],n=c[e],a=fu[u[t]],o=fu[u[e]],s=`${r}_${n}`,f=`${n}_${r}`;f in h&&h[f]?(du.dot(h[f].normal)<=i&&(d.push(a.x,a.y,a.z),d.push(o.x,o.y,o.z)),h[f]=null):s in h||(h[s]={index0:l[t],index1:l[e],normal:du.clone()})}}for(const t in h)if(h[t]){const{index0:e,index1:r}=h[t];cu.fromBufferAttribute(o,e),hu.fromBufferAttribute(o,r),d.push(cu.x,cu.y,cu.z),d.push(hu.x,hu.y,hu.z)}this.setAttribute("position",new oi(d,3))}}}class mu{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const r=this.getUtoTmapping(t);return this.getPoint(r,e)}getPoints(t=5){const e=[];for(let r=0;r<=t;r++)e.push(this.getPoint(r/t));return e}getSpacedPoints(t=5){const e=[];for(let r=0;r<=t;r++)e.push(this.getPointAt(r/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let r,n=this.getPoint(0),i=0;e.push(0);for(let a=1;a<=t;a++)r=this.getPoint(a/t),i+=r.distanceTo(n),e.push(i),n=r;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const r=this.getLengths();let n=0;const i=r.length;let a;a=e||t*r[i-1];let o,s=0,l=i-1;for(;s<=l;)if(n=Math.floor(s+(l-s)/2),o=r[n]-a,o<0)s=n+1;else{if(!(o>0)){l=n;break}l=n-1}if(n=l,r[n]===a)return n/(i-1);const u=r[n];return(n+(a-u)/(r[n+1]-u))/(i-1)}getTangent(t,e){const r=1e-4;let n=t-r,i=t+r;n<0&&(n=0),i>1&&(i=1);const a=this.getPoint(n),o=this.getPoint(i),s=e||(a.isVector2?new sr:new Sr);return s.copy(o).sub(a).normalize(),s}getTangentAt(t,e){const r=this.getUtoTmapping(t);return this.getTangent(r,e)}computeFrenetFrames(t,e){const r=new Sr,n=[],i=[],a=[],o=new Sr,s=new en;for(let e=0;e<=t;e++){const r=e/t;n[e]=this.getTangentAt(r,new Sr)}i[0]=new Sr,a[0]=new Sr;let l=Number.MAX_VALUE;const u=Math.abs(n[0].x),c=Math.abs(n[0].y),h=Math.abs(n[0].z);u<=l&&(l=u,r.set(1,0,0)),c<=l&&(l=c,r.set(0,1,0)),h<=l&&r.set(0,0,1),o.crossVectors(n[0],r).normalize(),i[0].crossVectors(n[0],o),a[0].crossVectors(n[0],i[0]);for(let e=1;e<=t;e++){if(i[e]=i[e-1].clone(),a[e]=a[e-1].clone(),o.crossVectors(n[e-1],n[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(tr(n[e-1].dot(n[e]),-1,1));i[e].applyMatrix4(s.makeRotationAxis(o,t))}a[e].crossVectors(n[e],i[e])}if(!0===e){let e=Math.acos(tr(i[0].dot(i[t]),-1,1));e/=t,n[0].dot(o.crossVectors(i[0],i[t]))>0&&(e=-e);for(let r=1;r<=t;r++)i[r].applyMatrix4(s.makeRotationAxis(n[r],e*r)),a[r].crossVectors(n[r],i[r])}return{tangents:n,normals:i,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class gu extends mu{constructor(t=0,e=0,r=1,n=1,i=0,a=2*Math.PI,o=!1,s=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=r,this.yRadius=n,this.aStartAngle=i,this.aEndAngle=a,this.aClockwise=o,this.aRotation=s}getPoint(t,e){const r=e||new sr,n=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const a=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=a?0:n),!0!==this.aClockwise||a||(i===n?i=-n:i-=n);const o=this.aStartAngle+t*i;let s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),r=s-this.aX,n=l-this.aY;s=r*t-n*e+this.aX,l=r*e+n*t+this.aY}return r.set(s,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}gu.prototype.isEllipseCurve=!0;class vu extends gu{constructor(t,e,r,n,i,a){super(t,e,r,r,n,i,a),this.type="ArcCurve"}}function yu(){let t=0,e=0,r=0,n=0;function i(i,a,o,s){t=i,e=o,r=-3*i+3*a-2*o-s,n=2*i-2*a+o+s}return{initCatmullRom:function(t,e,r,n,a){i(e,r,a*(r-t),a*(n-e))},initNonuniformCatmullRom:function(t,e,r,n,a,o,s){let l=(e-t)/a-(r-t)/(a+o)+(r-e)/o,u=(r-e)/o-(n-e)/(o+s)+(n-r)/s;l*=o,u*=o,i(e,r,l,u)},calc:function(i){const a=i*i;return t+e*i+r*a+n*(a*i)}}}vu.prototype.isArcCurve=!0;const xu=new Sr,_u=new yu,wu=new yu,bu=new yu;class Mu extends mu{constructor(t=[],e=!1,r="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=r,this.tension=n}getPoint(t,e=new Sr){const r=e,n=this.points,i=n.length,a=(i-(this.closed?0:1))*t;let o,s,l=Math.floor(a),u=a-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/i)+1)*i:0===u&&l===i-1&&(l=i-2,u=1),this.closed||l>0?o=n[(l-1)%i]:(xu.subVectors(n[0],n[1]).add(n[0]),o=xu);const c=n[l%i],h=n[(l+1)%i];if(this.closed||l+2<i?s=n[(l+2)%i]:(xu.subVectors(n[i-1],n[i-2]).add(n[i-1]),s=xu),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(c),t),r=Math.pow(c.distanceToSquared(h),t),n=Math.pow(h.distanceToSquared(s),t);r<1e-4&&(r=1),e<1e-4&&(e=r),n<1e-4&&(n=r),_u.initNonuniformCatmullRom(o.x,c.x,h.x,s.x,e,r,n),wu.initNonuniformCatmullRom(o.y,c.y,h.y,s.y,e,r,n),bu.initNonuniformCatmullRom(o.z,c.z,h.z,s.z,e,r,n)}else"catmullrom"===this.curveType&&(_u.initCatmullRom(o.x,c.x,h.x,s.x,this.tension),wu.initCatmullRom(o.y,c.y,h.y,s.y,this.tension),bu.initCatmullRom(o.z,c.z,h.z,s.z,this.tension));return r.set(_u.calc(u),wu.calc(u),bu.calc(u)),r}copy(t){super.copy(t),this.points=[];for(let e=0,r=t.points.length;e<r;e++){const r=t.points[e];this.points.push(r.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,r=this.points.length;e<r;e++){const r=this.points[e];t.points.push(r.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,r=t.points.length;e<r;e++){const r=t.points[e];this.points.push((new Sr).fromArray(r))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function Su(t,e,r,n,i){const a=.5*(n-e),o=.5*(i-r),s=t*t;return(2*r-2*n+a+o)*(t*s)+(-3*r+3*n-2*a-o)*s+a*t+r}function Tu(t,e,r,n){return function(t,e){const r=1-t;return r*r*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,r)+function(t,e){return t*t*e}(t,n)}function Eu(t,e,r,n,i){return function(t,e){const r=1-t;return r*r*r*e}(t,e)+function(t,e){const r=1-t;return 3*r*r*t*e}(t,r)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,i)}Mu.prototype.isCatmullRomCurve3=!0;class Au extends mu{constructor(t=new sr,e=new sr,r=new sr,n=new sr){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=r,this.v3=n}getPoint(t,e=new sr){const r=e,n=this.v0,i=this.v1,a=this.v2,o=this.v3;return r.set(Eu(t,n.x,i.x,a.x,o.x),Eu(t,n.y,i.y,a.y,o.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Au.prototype.isCubicBezierCurve=!0;class Ru extends mu{constructor(t=new Sr,e=new Sr,r=new Sr,n=new Sr){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=r,this.v3=n}getPoint(t,e=new Sr){const r=e,n=this.v0,i=this.v1,a=this.v2,o=this.v3;return r.set(Eu(t,n.x,i.x,a.x,o.x),Eu(t,n.y,i.y,a.y,o.y),Eu(t,n.z,i.z,a.z,o.z)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Ru.prototype.isCubicBezierCurve3=!0;class Pu extends mu{constructor(t=new sr,e=new sr){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new sr){const r=e;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const r=e||new sr;return r.copy(this.v2).sub(this.v1).normalize(),r}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Pu.prototype.isLineCurve=!0;class Cu extends mu{constructor(t=new Sr,e=new Sr){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new Sr){const r=e;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Iu extends mu{constructor(t=new sr,e=new sr,r=new sr){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=r}getPoint(t,e=new sr){const r=e,n=this.v0,i=this.v1,a=this.v2;return r.set(Tu(t,n.x,i.x,a.x),Tu(t,n.y,i.y,a.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Iu.prototype.isQuadraticBezierCurve=!0;class Lu extends mu{constructor(t=new Sr,e=new Sr,r=new Sr){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=r}getPoint(t,e=new Sr){const r=e,n=this.v0,i=this.v1,a=this.v2;return r.set(Tu(t,n.x,i.x,a.x),Tu(t,n.y,i.y,a.y),Tu(t,n.z,i.z,a.z)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Lu.prototype.isQuadraticBezierCurve3=!0;class Ou extends mu{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new sr){const r=e,n=this.points,i=(n.length-1)*t,a=Math.floor(i),o=i-a,s=n[0===a?a:a-1],l=n[a],u=n[a>n.length-2?n.length-1:a+1],c=n[a>n.length-3?n.length-1:a+2];return r.set(Su(o,s.x,l.x,u.x,c.x),Su(o,s.y,l.y,u.y,c.y)),r}copy(t){super.copy(t),this.points=[];for(let e=0,r=t.points.length;e<r;e++){const r=t.points[e];this.points.push(r.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,r=this.points.length;e<r;e++){const r=this.points[e];t.points.push(r.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,r=t.points.length;e<r;e++){const r=t.points[e];this.points.push((new sr).fromArray(r))}return this}}Ou.prototype.isSplineCurve=!0;var Du=Object.freeze({__proto__:null,ArcCurve:vu,CatmullRomCurve3:Mu,CubicBezierCurve:Au,CubicBezierCurve3:Ru,EllipseCurve:gu,LineCurve:Pu,LineCurve3:Cu,QuadraticBezierCurve:Iu,QuadraticBezierCurve3:Lu,SplineCurve:Ou});class ku extends mu{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Pu(e,t))}getPoint(t,e){const r=t*this.getLength(),n=this.getCurveLengths();let i=0;for(;i<n.length;){if(n[i]>=r){const t=n[i]-r,a=this.curves[i],o=a.getLength(),s=0===o?0:1-t/o;return a.getPointAt(s,e)}i++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let r=0,n=this.curves.length;r<n;r++)e+=this.curves[r].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let r=0;r<=t;r++)e.push(this.getPoint(r/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let r;for(let n=0,i=this.curves;n<i.length;n++){const a=i[n],o=a&&a.isEllipseCurve?2*t:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?t*a.points.length:t,s=a.getPoints(o);for(let t=0;t<s.length;t++){const n=s[t];r&&r.equals(n)||(e.push(n),r=n)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,r=t.curves.length;e<r;e++){const r=t.curves[e];this.curves.push(r.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,r=this.curves.length;e<r;e++){const r=this.curves[e];t.curves.push(r.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,r=t.curves.length;e<r;e++){const r=t.curves[e];this.curves.push((new Du[r.type]).fromJSON(r))}return this}}class Fu extends ku{constructor(t){super(),this.type="Path",this.currentPoint=new sr,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,r=t.length;e<r;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const r=new Pu(this.currentPoint.clone(),new sr(t,e));return this.curves.push(r),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,r,n){const i=new Iu(this.currentPoint.clone(),new sr(t,e),new sr(r,n));return this.curves.push(i),this.currentPoint.set(r,n),this}bezierCurveTo(t,e,r,n,i,a){const o=new Au(this.currentPoint.clone(),new sr(t,e),new sr(r,n),new sr(i,a));return this.curves.push(o),this.currentPoint.set(i,a),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),r=new Ou(e);return this.curves.push(r),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,r,n,i,a){const o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(t+o,e+s,r,n,i,a),this}absarc(t,e,r,n,i,a){return this.absellipse(t,e,r,r,n,i,a),this}ellipse(t,e,r,n,i,a,o,s){const l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(t+l,e+u,r,n,i,a,o,s),this}absellipse(t,e,r,n,i,a,o,s){const l=new gu(t,e,r,n,i,a,o,s);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const u=l.getPoint(1);return this.currentPoint.copy(u),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Nu extends Fu{constructor(t){super(t),this.uuid=$e(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let r=0,n=this.holes.length;r<n;r++)e[r]=this.holes[r].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,r=t.holes.length;e<r;e++){const r=t.holes[e];this.holes.push(r.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,r=this.holes.length;e<r;e++){const r=this.holes[e];t.holes.push(r.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,r=t.holes.length;e<r;e++){const r=t.holes[e];this.holes.push((new Fu).fromJSON(r))}return this}}const Uu=function(t,e,r=2){const n=e&&e.length,i=n?e[0]*r:t.length;let a=Bu(t,0,i,r,!0);const o=[];if(!a||a.next===a.prev)return o;let s,l,u,c,h,d,f;if(n&&(a=function(t,e,r,n){const i=[];let a,o,s,l,u;for(a=0,o=e.length;a<o;a++)s=e[a]*n,l=a<o-1?e[a+1]*n:t.length,u=Bu(t,s,l,n,!1),u===u.next&&(u.steiner=!0),i.push(Ku(u));for(i.sort(qu),a=0;a<i.length;a++)Xu(i[a],r),r=zu(r,r.next);return r}(t,e,a,r)),t.length>80*r){s=u=t[0],l=c=t[1];for(let e=r;e<i;e+=r)h=t[e],d=t[e+1],h<s&&(s=h),d<l&&(l=d),h>u&&(u=h),d>c&&(c=d);f=Math.max(u-s,c-l),f=0!==f?1/f:0}return Gu(a,o,r,s,l,f),o};function Bu(t,e,r,n,i){let a,o;if(i===function(t,e,r,n){let i=0;for(let a=e,o=r-n;a<r;a+=n)i+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return i}(t,e,r,n)>0)for(a=e;a<r;a+=n)o=oc(a,t[a],t[a+1],o);else for(a=r-n;a>=e;a-=n)o=oc(a,t[a],t[a+1],o);return o&&tc(o,o.next)&&(sc(o),o=o.next),o}function zu(t,e){if(!t)return t;e||(e=t);let r,n=t;do{if(r=!1,n.steiner||!tc(n,n.next)&&0!==$u(n.prev,n,n.next))n=n.next;else{if(sc(n),n=e=n.prev,n===n.next)break;r=!0}}while(r||n!==e);return e}function Gu(t,e,r,n,i,a,o){if(!t)return;!o&&a&&function(t,e,r,n){let i=t;do{null===i.z&&(i.z=Zu(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){let e,r,n,i,a,o,s,l,u=1;do{for(r=t,t=null,a=null,o=0;r;){for(o++,n=r,s=0,e=0;e<u&&(s++,n=n.nextZ,n);e++);for(l=u;s>0||l>0&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),a?a.nextZ=i:t=i,i.prevZ=a,a=i;r=n}a.nextZ=null,u*=2}while(o>1)}(i)}(t,n,i,a);let s,l,u=t;for(;t.prev!==t.next;)if(s=t.prev,l=t.next,a?Vu(t,n,i,a):ju(t))e.push(s.i/r),e.push(t.i/r),e.push(l.i/r),sc(t),t=l.next,u=l.next;else if((t=l)===u){o?1===o?Gu(t=Hu(zu(t),e,r),e,r,n,i,a,2):2===o&&Wu(t,e,r,n,i,a):Gu(zu(t),e,r,n,i,a,1);break}}function ju(t){const e=t.prev,r=t,n=t.next;if($u(e,r,n)>=0)return!1;let i=t.next.next;for(;i!==t.prev;){if(Ju(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&$u(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Vu(t,e,r,n){const i=t.prev,a=t,o=t.next;if($u(i,a,o)>=0)return!1;const s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,l=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,u=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,c=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,h=Zu(s,l,e,r,n),d=Zu(u,c,e,r,n);let f=t.prevZ,p=t.nextZ;for(;f&&f.z>=h&&p&&p.z<=d;){if(f!==t.prev&&f!==t.next&&Ju(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&$u(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==t.prev&&p!==t.next&&Ju(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&$u(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&Ju(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&$u(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&Ju(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&$u(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Hu(t,e,r){let n=t;do{const i=n.prev,a=n.next.next;!tc(i,a)&&ec(i,n,n.next,a)&&ic(i,a)&&ic(a,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(a.i/r),sc(n),sc(n.next),n=t=a),n=n.next}while(n!==t);return zu(n)}function Wu(t,e,r,n,i,a){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&Qu(o,t)){let s=ac(o,t);return o=zu(o,o.next),s=zu(s,s.next),Gu(o,e,r,n,i,a),void Gu(s,e,r,n,i,a)}t=t.next}o=o.next}while(o!==t)}function qu(t,e){return t.x-e.x}function Xu(t,e){if(e=function(t,e){let r=e;const n=t.x,i=t.y;let a,o=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){const t=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(t<=n&&t>o){if(o=t,t===n){if(i===r.y)return r;if(i===r.next.y)return r.next}a=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!a)return null;if(n===o)return a;const s=a,l=a.x,u=a.y;let c,h=1/0;r=a;do{n>=r.x&&r.x>=l&&n!==r.x&&Ju(i<u?n:o,i,l,u,i<u?o:n,i,r.x,r.y)&&(c=Math.abs(i-r.y)/(n-r.x),ic(r,t)&&(c<h||c===h&&(r.x>a.x||r.x===a.x&&Yu(a,r)))&&(a=r,h=c)),r=r.next}while(r!==s);return a}(t,e),e){const r=ac(e,t);zu(e,e.next),zu(r,r.next)}}function Yu(t,e){return $u(t.prev,t,e.prev)<0&&$u(e.next,t,t.next)<0}function Zu(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Ku(t){let e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function Ju(t,e,r,n,i,a,o,s){return(i-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(n-s)-(r-o)*(e-s)>=0&&(r-o)*(a-s)-(i-o)*(n-s)>=0}function Qu(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&ec(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(ic(t,e)&&ic(e,t)&&function(t,e){let r=t,n=!1;const i=(t.x+e.x)/2,a=(t.y+e.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&($u(t.prev,t,e.prev)||$u(t,e.prev,e))||tc(t,e)&&$u(t.prev,t,t.next)>0&&$u(e.prev,e,e.next)>0)}function $u(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function tc(t,e){return t.x===e.x&&t.y===e.y}function ec(t,e,r,n){const i=nc($u(t,e,r)),a=nc($u(t,e,n)),o=nc($u(r,n,t)),s=nc($u(r,n,e));return i!==a&&o!==s||(!(0!==i||!rc(t,r,e))||(!(0!==a||!rc(t,n,e))||(!(0!==o||!rc(r,t,n))||!(0!==s||!rc(r,e,n)))))}function rc(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function nc(t){return t>0?1:t<0?-1:0}function ic(t,e){return $u(t.prev,t,t.next)<0?$u(t,e,t.next)>=0&&$u(t,t.prev,e)>=0:$u(t,e,t.prev)<0||$u(t,t.next,e)<0}function ac(t,e){const r=new lc(t.i,t.x,t.y),n=new lc(e.i,e.x,e.y),i=t.next,a=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function oc(t,e,r,n){const i=new lc(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function sc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function lc(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class uc{static area(t){const e=t.length;let r=0;for(let n=e-1,i=0;i<e;n=i++)r+=t[n].x*t[i].y-t[i].x*t[n].y;return.5*r}static isClockWise(t){return uc.area(t)<0}static triangulateShape(t,e){const r=[],n=[],i=[];cc(t),hc(r,t);let a=t.length;e.forEach(cc);for(let t=0;t<e.length;t++)n.push(a),a+=e[t].length,hc(r,e[t]);const o=Uu(r,n);for(let t=0;t<o.length;t+=3)i.push(o.slice(t,t+3));return i}}function cc(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function hc(t,e){for(let r=0;r<e.length;r++)t.push(e[r].x),t.push(e[r].y)}class dc extends mi{constructor(t=new Nu([new sr(.5,.5),new sr(-.5,.5),new sr(-.5,-.5),new sr(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const r=this,n=[],i=[];for(let e=0,r=t.length;e<r;e++){a(t[e])}function a(t){const a=[],o=void 0!==e.curveSegments?e.curveSegments:12,s=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:1,u=void 0===e.bevelEnabled||e.bevelEnabled,c=void 0!==e.bevelThickness?e.bevelThickness:.2,h=void 0!==e.bevelSize?e.bevelSize:c-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,f=void 0!==e.bevelSegments?e.bevelSegments:3;const p=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:fc;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);let g,v,y,x,_,w=!1;p&&(g=p.getSpacedPoints(s),w=!0,u=!1,v=p.computeFrenetFrames(s,!1),y=new Sr,x=new Sr,_=new Sr),u||(f=0,c=0,h=0,d=0);const b=t.extractPoints(o);let M=b.shape;const S=b.holes;if(!uc.isClockWise(M)){M=M.reverse();for(let t=0,e=S.length;t<e;t++){const e=S[t];uc.isClockWise(e)&&(S[t]=e.reverse())}}const T=uc.triangulateShape(M,S),E=M;for(let t=0,e=S.length;t<e;t++){const e=S[t];M=M.concat(e)}function A(t,e,r){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(r).add(t)}const R=M.length,P=T.length;function C(t,e,r){let n,i,a;const o=t.x-e.x,s=t.y-e.y,l=r.x-t.x,u=r.y-t.y,c=o*o+s*s,h=o*u-s*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(c),d=Math.sqrt(l*l+u*u),f=e.x-s/h,p=e.y+o/h,m=((r.x-u/d-f)*u-(r.y+l/d-p)*l)/(o*u-s*l);n=f+o*m-t.x,i=p+s*m-t.y;const g=n*n+i*i;if(g<=2)return new sr(n,i);a=Math.sqrt(g/2)}else{let t=!1;o>Number.EPSILON?l>Number.EPSILON&&(t=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(s)===Math.sign(u)&&(t=!0),t?(n=-s,i=o,a=Math.sqrt(c)):(n=o,i=s,a=Math.sqrt(c/2))}return new sr(n/a,i/a)}const I=[];for(let t=0,e=E.length,r=e-1,n=t+1;t<e;t++,r++,n++)r===e&&(r=0),n===e&&(n=0),I[t]=C(E[t],E[r],E[n]);const L=[];let O,D=I.concat();for(let t=0,e=S.length;t<e;t++){const e=S[t];O=[];for(let t=0,r=e.length,n=r-1,i=t+1;t<r;t++,n++,i++)n===r&&(n=0),i===r&&(i=0),O[t]=C(e[t],e[n],e[i]);L.push(O),D=D.concat(O)}for(let t=0;t<f;t++){const e=t/f,r=c*Math.cos(e*Math.PI/2),n=h*Math.sin(e*Math.PI/2)+d;for(let t=0,e=E.length;t<e;t++){const e=A(E[t],I[t],n);N(e.x,e.y,-r)}for(let t=0,e=S.length;t<e;t++){const e=S[t];O=L[t];for(let t=0,i=e.length;t<i;t++){const i=A(e[t],O[t],n);N(i.x,i.y,-r)}}}const k=h+d;for(let t=0;t<R;t++){const e=u?A(M[t],D[t],k):M[t];w?(x.copy(v.normals[0]).multiplyScalar(e.x),y.copy(v.binormals[0]).multiplyScalar(e.y),_.copy(g[0]).add(x).add(y),N(_.x,_.y,_.z)):N(e.x,e.y,0)}for(let t=1;t<=s;t++)for(let e=0;e<R;e++){const r=u?A(M[e],D[e],k):M[e];w?(x.copy(v.normals[t]).multiplyScalar(r.x),y.copy(v.binormals[t]).multiplyScalar(r.y),_.copy(g[t]).add(x).add(y),N(_.x,_.y,_.z)):N(r.x,r.y,l/s*t)}for(let t=f-1;t>=0;t--){const e=t/f,r=c*Math.cos(e*Math.PI/2),n=h*Math.sin(e*Math.PI/2)+d;for(let t=0,e=E.length;t<e;t++){const e=A(E[t],I[t],n);N(e.x,e.y,l+r)}for(let t=0,e=S.length;t<e;t++){const e=S[t];O=L[t];for(let t=0,i=e.length;t<i;t++){const i=A(e[t],O[t],n);w?N(i.x,i.y+g[s-1].y,g[s-1].x+r):N(i.x,i.y,l+r)}}}function F(t,e){let r=t.length;for(;--r>=0;){const n=r;let i=r-1;i<0&&(i=t.length-1);for(let t=0,r=s+2*f;t<r;t++){const r=R*t,a=R*(t+1);B(e+n+r,e+i+r,e+i+a,e+n+a)}}}function N(t,e,r){a.push(t),a.push(e),a.push(r)}function U(t,e,i){z(t),z(e),z(i);const a=n.length/3,o=m.generateTopUV(r,n,a-3,a-2,a-1);G(o[0]),G(o[1]),G(o[2])}function B(t,e,i,a){z(t),z(e),z(a),z(e),z(i),z(a);const o=n.length/3,s=m.generateSideWallUV(r,n,o-6,o-3,o-2,o-1);G(s[0]),G(s[1]),G(s[3]),G(s[1]),G(s[2]),G(s[3])}function z(t){n.push(a[3*t+0]),n.push(a[3*t+1]),n.push(a[3*t+2])}function G(t){i.push(t.x),i.push(t.y)}!function(){const t=n.length/3;if(u){let t=0,e=R*t;for(let t=0;t<P;t++){const r=T[t];U(r[2]+e,r[1]+e,r[0]+e)}t=s+2*f,e=R*t;for(let t=0;t<P;t++){const r=T[t];U(r[0]+e,r[1]+e,r[2]+e)}}else{for(let t=0;t<P;t++){const e=T[t];U(e[2],e[1],e[0])}for(let t=0;t<P;t++){const e=T[t];U(e[0]+R*s,e[1]+R*s,e[2]+R*s)}}r.addGroup(t,n.length/3-t,0)}(),function(){const t=n.length/3;let e=0;F(E,e),e+=E.length;for(let t=0,r=S.length;t<r;t++){const r=S[t];F(r,e),e+=r.length}r.addGroup(t,n.length/3-t,1)}()}this.setAttribute("position",new oi(n,3)),this.setAttribute("uv",new oi(i,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,r){if(r.shapes=[],Array.isArray(t))for(let e=0,n=t.length;e<n;e++){const n=t[e];r.shapes.push(n.uuid)}else r.shapes.push(t.uuid);void 0!==e.extrudePath&&(r.options.extrudePath=e.extrudePath.toJSON());return r}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const r=[];for(let n=0,i=t.shapes.length;n<i;n++){const i=e[t.shapes[n]];r.push(i)}const n=t.options.extrudePath;return void 0!==n&&(t.options.extrudePath=(new Du[n.type]).fromJSON(n)),new dc(r,t.options)}}const fc={generateTopUV:function(t,e,r,n,i){const a=e[3*r],o=e[3*r+1],s=e[3*n],l=e[3*n+1],u=e[3*i],c=e[3*i+1];return[new sr(a,o),new sr(s,l),new sr(u,c)]},generateSideWallUV:function(t,e,r,n,i,a){const o=e[3*r],s=e[3*r+1],l=e[3*r+2],u=e[3*n],c=e[3*n+1],h=e[3*n+2],d=e[3*i],f=e[3*i+1],p=e[3*i+2],m=e[3*a],g=e[3*a+1],v=e[3*a+2];return Math.abs(s-c)<Math.abs(o-u)?[new sr(o,1-l),new sr(u,1-h),new sr(d,1-p),new sr(m,1-v)]:[new sr(s,1-l),new sr(c,1-h),new sr(f,1-p),new sr(g,1-v)]}};class pc extends lu{constructor(t=1,e=0){const r=(1+Math.sqrt(5))/2;super([-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new pc(t.radius,t.detail)}}class mc extends mi{constructor(t=[new sr(0,.5),new sr(.5,0),new sr(0,-.5)],e=12,r=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:n},e=Math.floor(e),n=tr(n,0,2*Math.PI);const i=[],a=[],o=[],s=1/e,l=new Sr,u=new sr;for(let i=0;i<=e;i++){const c=r+i*s*n,h=Math.sin(c),d=Math.cos(c);for(let r=0;r<=t.length-1;r++)l.x=t[r].x*h,l.y=t[r].y,l.z=t[r].x*d,a.push(l.x,l.y,l.z),u.x=i/e,u.y=r/(t.length-1),o.push(u.x,u.y)}for(let r=0;r<e;r++)for(let e=0;e<t.length-1;e++){const n=e+r*t.length,a=n,o=n+t.length,s=n+t.length+1,l=n+1;i.push(a,o,l),i.push(o,s,l)}if(this.setIndex(i),this.setAttribute("position",new oi(a,3)),this.setAttribute("uv",new oi(o,2)),this.computeVertexNormals(),n===2*Math.PI){const r=this.attributes.normal.array,n=new Sr,i=new Sr,a=new Sr,o=e*t.length*3;for(let e=0,s=0;e<t.length;e++,s+=3)n.x=r[s+0],n.y=r[s+1],n.z=r[s+2],i.x=r[o+s+0],i.y=r[o+s+1],i.z=r[o+s+2],a.addVectors(n,i).normalize(),r[s+0]=r[o+s+0]=a.x,r[s+1]=r[o+s+1]=a.y,r[s+2]=r[o+s+2]=a.z}}static fromJSON(t){return new mc(t.points,t.segments,t.phiStart,t.phiLength)}}class gc extends lu{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new gc(t.radius,t.detail)}}class vc extends mi{constructor(t=.5,e=1,r=8,n=1,i=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:a},r=Math.max(3,r);const o=[],s=[],l=[],u=[];let c=t;const h=(e-t)/(n=Math.max(1,n)),d=new Sr,f=new sr;for(let t=0;t<=n;t++){for(let t=0;t<=r;t++){const n=i+t/r*a;d.x=c*Math.cos(n),d.y=c*Math.sin(n),s.push(d.x,d.y,d.z),l.push(0,0,1),f.x=(d.x/e+1)/2,f.y=(d.y/e+1)/2,u.push(f.x,f.y)}c+=h}for(let t=0;t<n;t++){const e=t*(r+1);for(let t=0;t<r;t++){const n=t+e,i=n,a=n+r+1,s=n+r+2,l=n+1;o.push(i,a,l),o.push(a,s,l)}}this.setIndex(o),this.setAttribute("position",new oi(s,3)),this.setAttribute("normal",new oi(l,3)),this.setAttribute("uv",new oi(u,2))}static fromJSON(t){return new vc(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class yc extends mi{constructor(t=new Nu([new sr(0,.5),new sr(-.5,-.5),new sr(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const r=[],n=[],i=[],a=[];let o=0,s=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(o,s,e),o+=s,s=0;function l(t){const o=n.length/3,l=t.extractPoints(e);let u=l.shape;const c=l.holes;!1===uc.isClockWise(u)&&(u=u.reverse());for(let t=0,e=c.length;t<e;t++){const e=c[t];!0===uc.isClockWise(e)&&(c[t]=e.reverse())}const h=uc.triangulateShape(u,c);for(let t=0,e=c.length;t<e;t++){const e=c[t];u=u.concat(e)}for(let t=0,e=u.length;t<e;t++){const e=u[t];n.push(e.x,e.y,0),i.push(0,0,1),a.push(e.x,e.y)}for(let t=0,e=h.length;t<e;t++){const e=h[t],n=e[0]+o,i=e[1]+o,a=e[2]+o;r.push(n,i,a),s+=3}}this.setIndex(r),this.setAttribute("position",new oi(n,3)),this.setAttribute("normal",new oi(i,3)),this.setAttribute("uv",new oi(a,2))}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let r=0,n=t.length;r<n;r++){const n=t[r];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const r=[];for(let n=0,i=t.shapes.length;n<i;n++){const i=e[t.shapes[n]];r.push(i)}return new yc(r,t.curveSegments)}}class xc extends mi{constructor(t=1,e=32,r=16,n=0,i=2*Math.PI,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:n,phiLength:i,thetaStart:a,thetaLength:o},e=Math.max(3,Math.floor(e)),r=Math.max(2,Math.floor(r));const s=Math.min(a+o,Math.PI);let l=0;const u=[],c=new Sr,h=new Sr,d=[],f=[],p=[],m=[];for(let d=0;d<=r;d++){const g=[],v=d/r;let y=0;0==d&&0==a?y=.5/e:d==r&&s==Math.PI&&(y=-.5/e);for(let r=0;r<=e;r++){const s=r/e;c.x=-t*Math.cos(n+s*i)*Math.sin(a+v*o),c.y=t*Math.cos(a+v*o),c.z=t*Math.sin(n+s*i)*Math.sin(a+v*o),f.push(c.x,c.y,c.z),h.copy(c).normalize(),p.push(h.x,h.y,h.z),m.push(s+y,1-v),g.push(l++)}u.push(g)}for(let t=0;t<r;t++)for(let n=0;n<e;n++){const e=u[t][n+1],i=u[t][n],o=u[t+1][n],l=u[t+1][n+1];(0!==t||a>0)&&d.push(e,i,l),(t!==r-1||s<Math.PI)&&d.push(i,o,l)}this.setIndex(d),this.setAttribute("position",new oi(f,3)),this.setAttribute("normal",new oi(p,3)),this.setAttribute("uv",new oi(m,2))}static fromJSON(t){return new xc(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class _c extends lu{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new _c(t.radius,t.detail)}}class wc extends mi{constructor(t=1,e=.4,r=8,n=6,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:n,arc:i},r=Math.floor(r),n=Math.floor(n);const a=[],o=[],s=[],l=[],u=new Sr,c=new Sr,h=new Sr;for(let a=0;a<=r;a++)for(let d=0;d<=n;d++){const f=d/n*i,p=a/r*Math.PI*2;c.x=(t+e*Math.cos(p))*Math.cos(f),c.y=(t+e*Math.cos(p))*Math.sin(f),c.z=e*Math.sin(p),o.push(c.x,c.y,c.z),u.x=t*Math.cos(f),u.y=t*Math.sin(f),h.subVectors(c,u).normalize(),s.push(h.x,h.y,h.z),l.push(d/n),l.push(a/r)}for(let t=1;t<=r;t++)for(let e=1;e<=n;e++){const r=(n+1)*t+e-1,i=(n+1)*(t-1)+e-1,o=(n+1)*(t-1)+e,s=(n+1)*t+e;a.push(r,i,s),a.push(i,o,s)}this.setIndex(a),this.setAttribute("position",new oi(o,3)),this.setAttribute("normal",new oi(s,3)),this.setAttribute("uv",new oi(l,2))}static fromJSON(t){return new wc(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class bc extends mi{constructor(t=1,e=.4,r=64,n=8,i=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:n,p:i,q:a},r=Math.floor(r),n=Math.floor(n);const o=[],s=[],l=[],u=[],c=new Sr,h=new Sr,d=new Sr,f=new Sr,p=new Sr,m=new Sr,g=new Sr;for(let o=0;o<=r;++o){const y=o/r*i*Math.PI*2;v(y,i,a,t,d),v(y+.01,i,a,t,f),m.subVectors(f,d),g.addVectors(f,d),p.crossVectors(m,g),g.crossVectors(p,m),p.normalize(),g.normalize();for(let t=0;t<=n;++t){const i=t/n*Math.PI*2,a=-e*Math.cos(i),f=e*Math.sin(i);c.x=d.x+(a*g.x+f*p.x),c.y=d.y+(a*g.y+f*p.y),c.z=d.z+(a*g.z+f*p.z),s.push(c.x,c.y,c.z),h.subVectors(c,d).normalize(),l.push(h.x,h.y,h.z),u.push(o/r),u.push(t/n)}}for(let t=1;t<=r;t++)for(let e=1;e<=n;e++){const r=(n+1)*(t-1)+(e-1),i=(n+1)*t+(e-1),a=(n+1)*t+e,s=(n+1)*(t-1)+e;o.push(r,i,s),o.push(i,a,s)}function v(t,e,r,n,i){const a=Math.cos(t),o=Math.sin(t),s=r/e*t,l=Math.cos(s);i.x=n*(2+l)*.5*a,i.y=n*(2+l)*o*.5,i.z=n*Math.sin(s)*.5}this.setIndex(o),this.setAttribute("position",new oi(s,3)),this.setAttribute("normal",new oi(l,3)),this.setAttribute("uv",new oi(u,2))}static fromJSON(t){return new bc(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class Mc extends mi{constructor(t=new Lu(new Sr(-1,-1,0),new Sr(-1,1,0),new Sr(1,1,0)),e=64,r=1,n=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:n,closed:i};const a=t.computeFrenetFrames(e,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new Sr,s=new Sr,l=new sr;let u=new Sr;const c=[],h=[],d=[],f=[];function p(i){u=t.getPointAt(i/e,u);const l=a.normals[i],d=a.binormals[i];for(let t=0;t<=n;t++){const e=t/n*Math.PI*2,i=Math.sin(e),a=-Math.cos(e);s.x=a*l.x+i*d.x,s.y=a*l.y+i*d.y,s.z=a*l.z+i*d.z,s.normalize(),h.push(s.x,s.y,s.z),o.x=u.x+r*s.x,o.y=u.y+r*s.y,o.z=u.z+r*s.z,c.push(o.x,o.y,o.z)}}!function(){for(let t=0;t<e;t++)p(t);p(!1===i?e:0),function(){for(let t=0;t<=e;t++)for(let r=0;r<=n;r++)l.x=t/e,l.y=r/n,d.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=n;e++){const r=(n+1)*(t-1)+(e-1),i=(n+1)*t+(e-1),a=(n+1)*t+e,o=(n+1)*(t-1)+e;f.push(r,i,o),f.push(i,a,o)}}()}(),this.setIndex(f),this.setAttribute("position",new oi(c,3)),this.setAttribute("normal",new oi(h,3)),this.setAttribute("uv",new oi(d,2))}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new Mc((new Du[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class Sc extends mi{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const e=[],r=new Set,n=new Sr,i=new Sr;if(null!==t.index){const a=t.attributes.position,o=t.index;let s=t.groups;0===s.length&&(s=[{start:0,count:o.count,materialIndex:0}]);for(let t=0,l=s.length;t<l;++t){const l=s[t],u=l.start;for(let t=u,s=u+l.count;t<s;t+=3)for(let s=0;s<3;s++){const l=o.getX(t+s),u=o.getX(t+(s+1)%3);n.fromBufferAttribute(a,l),i.fromBufferAttribute(a,u),!0===Tc(n,i,r)&&(e.push(n.x,n.y,n.z),e.push(i.x,i.y,i.z))}}}else{const a=t.attributes.position;for(let t=0,o=a.count/3;t<o;t++)for(let o=0;o<3;o++){const s=3*t+o,l=3*t+(o+1)%3;n.fromBufferAttribute(a,s),i.fromBufferAttribute(a,l),!0===Tc(n,i,r)&&(e.push(n.x,n.y,n.z),e.push(i.x,i.y,i.z))}}this.setAttribute("position",new oi(e,3))}}}function Tc(t,e,r){const n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,i=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==r.has(n)&&!0!==r.has(i)&&(r.add(n,i),!0)}var Ec=Object.freeze({__proto__:null,BoxGeometry:ki,BoxBufferGeometry:ki,CircleGeometry:au,CircleBufferGeometry:au,ConeGeometry:su,ConeBufferGeometry:su,CylinderGeometry:ou,CylinderBufferGeometry:ou,DodecahedronGeometry:uu,DodecahedronBufferGeometry:uu,EdgesGeometry:pu,ExtrudeGeometry:dc,ExtrudeBufferGeometry:dc,IcosahedronGeometry:pc,IcosahedronBufferGeometry:pc,LatheGeometry:mc,LatheBufferGeometry:mc,OctahedronGeometry:gc,OctahedronBufferGeometry:gc,PlaneGeometry:ea,PlaneBufferGeometry:ea,PolyhedronGeometry:lu,PolyhedronBufferGeometry:lu,RingGeometry:vc,RingBufferGeometry:vc,ShapeGeometry:yc,ShapeBufferGeometry:yc,SphereGeometry:xc,SphereBufferGeometry:xc,TetrahedronGeometry:_c,TetrahedronBufferGeometry:_c,TorusGeometry:wc,TorusBufferGeometry:wc,TorusKnotGeometry:bc,TorusKnotBufferGeometry:bc,TubeGeometry:Mc,TubeBufferGeometry:Mc,WireframeGeometry:Sc});class Ac extends zn{constructor(t){super(),this.type="ShadowMaterial",this.color=new Xn(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}}Ac.prototype.isShadowMaterial=!0;class Rc extends zn{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Xn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Xn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=je,this.normalScale=new sr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}Rc.prototype.isMeshStandardMaterial=!0;class Pc extends Rc{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new sr(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return tr(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new Xn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Xn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Xn(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}Pc.prototype.isMeshPhysicalMaterial=!0;class Cc extends zn{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new Xn(16777215),this.specular=new Xn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Xn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=je,this.normalScale=new sr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=j,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}Cc.prototype.isMeshPhongMaterial=!0;class Ic extends zn{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Xn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Xn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=je,this.normalScale=new sr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}Ic.prototype.isMeshToonMaterial=!0;class Lc extends zn{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=je,this.normalScale=new sr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}Lc.prototype.isMeshNormalMaterial=!0;class Oc extends zn{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new Xn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Xn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=j,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}Oc.prototype.isMeshLambertMaterial=!0;class Dc extends zn{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Xn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=je,this.normalScale=new sr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this}}Dc.prototype.isMeshMatcapMaterial=!0;class kc extends Ul{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}kc.prototype.isLineDashedMaterial=!0;var Fc=Object.freeze({__proto__:null,ShadowMaterial:Ac,SpriteMaterial:rl,RawShaderMaterial:da,ShaderMaterial:Bi,PointsMaterial:Zl,MeshPhysicalMaterial:Pc,MeshStandardMaterial:Rc,MeshPhongMaterial:Cc,MeshToonMaterial:Ic,MeshNormalMaterial:Lc,MeshLambertMaterial:Oc,MeshDepthMaterial:Os,MeshDistanceMaterial:Ds,MeshBasicMaterial:Yn,MeshMatcapMaterial:Dc,LineDashedMaterial:kc,LineBasicMaterial:Ul,Material:zn});const Nc={arraySlice:function(t,e,r){return Nc.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==r?r:t.length)):t.slice(e,r)},convertArray:function(t,e,r){return!t||!r&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,r=new Array(e);for(let t=0;t!==e;++t)r[t]=t;return r.sort((function(e,r){return t[e]-t[r]})),r},sortedArray:function(t,e,r){const n=t.length,i=new t.constructor(n);for(let a=0,o=0;o!==n;++a){const n=r[a]*e;for(let r=0;r!==e;++r)i[o++]=t[n+r]}return i},flattenJSON:function(t,e,r,n){let i=1,a=t[0];for(;void 0!==a&&void 0===a[n];)a=t[i++];if(void 0===a)return;let o=a[n];if(void 0!==o)if(Array.isArray(o))do{o=a[n],void 0!==o&&(e.push(a.time),r.push.apply(r,o)),a=t[i++]}while(void 0!==a);else if(void 0!==o.toArray)do{o=a[n],void 0!==o&&(e.push(a.time),o.toArray(r,r.length)),a=t[i++]}while(void 0!==a);else do{o=a[n],void 0!==o&&(e.push(a.time),r.push(o)),a=t[i++]}while(void 0!==a)},subclip:function(t,e,r,n,i=30){const a=t.clone();a.name=e;const o=[];for(let t=0;t<a.tracks.length;++t){const e=a.tracks[t],s=e.getValueSize(),l=[],u=[];for(let t=0;t<e.times.length;++t){const a=e.times[t]*i;if(!(a<r||a>=n)){l.push(e.times[t]);for(let r=0;r<s;++r)u.push(e.values[t*s+r])}}0!==l.length&&(e.times=Nc.convertArray(l,e.times.constructor),e.values=Nc.convertArray(u,e.values.constructor),o.push(e))}a.tracks=o;let s=1/0;for(let t=0;t<a.tracks.length;++t)s>a.tracks[t].times[0]&&(s=a.tracks[t].times[0]);for(let t=0;t<a.tracks.length;++t)a.tracks[t].shift(-1*s);return a.resetDuration(),a},makeClipAdditive:function(t,e=0,r=t,n=30){n<=0&&(n=30);const i=r.tracks.length,a=e/n;for(let e=0;e<i;++e){const n=r.tracks[e],i=n.ValueTypeName;if("bool"===i||"string"===i)continue;const o=t.tracks.find((function(t){return t.name===n.name&&t.ValueTypeName===i}));if(void 0===o)continue;let s=0;const l=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=l/3);let u=0;const c=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=c/3);const h=n.times.length-1;let d;if(a<=n.times[0]){const t=s,e=l-s;d=Nc.arraySlice(n.values,t,e)}else if(a>=n.times[h]){const t=h*l+s,e=t+l-s;d=Nc.arraySlice(n.values,t,e)}else{const t=n.createInterpolant(),e=s,r=l-s;t.evaluate(a),d=Nc.arraySlice(t.resultBuffer,e,r)}if("quaternion"===i){(new Mr).fromArray(d).normalize().conjugate().toArray(d)}const f=o.times.length;for(let t=0;t<f;++t){const e=t*c+u;if("quaternion"===i)Mr.multiplyQuaternionsFlat(o.values,e,d,0,o.values,e);else{const t=c-2*u;for(let r=0;r<t;++r)o.values[e+r]-=d[r]}}}return t.blendMode=Le,t}};class Uc{constructor(t,e,r,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(r),this.sampleValues=e,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let r=this._cachedIndex,n=e[r],i=e[r-1];t:{e:{let a;r:{n:if(!(t<n)){for(let a=r+2;;){if(void 0===n){if(t<i)break n;return r=e.length,this._cachedIndex=r,this.afterEnd_(r-1,t,i)}if(r===a)break;if(i=n,n=e[++r],t<n)break e}a=e.length;break r}if(t>=i)break t;{const o=e[1];t<o&&(r=2,i=o);for(let a=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(r===a)break;if(n=i,i=e[--r-1],t>=i)break e}a=r,r=0}}for(;r<a;){const n=r+a>>>1;t<e[n]?a=n:r=n+1}if(n=e[r],i=e[r-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return r=e.length,this._cachedIndex=r,this.afterEnd_(r-1,i,t)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=t*n;for(let t=0;t!==n;++t)e[t]=r[i+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Uc.prototype.beforeStart_=Uc.prototype.copySampleValue_,Uc.prototype.afterEnd_=Uc.prototype.copySampleValue_;class Bc extends Uc{constructor(t,e,r,n){super(t,e,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Re,endingEnd:Re}}intervalChanged_(t,e,r){const n=this.parameterPositions;let i=t-2,a=t+1,o=n[i],s=n[a];if(void 0===o)switch(this.getSettings_().endingStart){case Pe:i=t,o=2*e-r;break;case Ce:i=n.length-2,o=e+n[i]-n[i+1];break;default:i=t,o=r}if(void 0===s)switch(this.getSettings_().endingEnd){case Pe:a=t,s=2*r-e;break;case Ce:a=1,s=r+n[1]-n[0];break;default:a=t-1,s=e}const l=.5*(r-e),u=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(s-r),this._offsetPrev=i*u,this._offsetNext=a*u}interpolate_(t,e,r,n){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,l=s-o,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(r-e)/(n-e),p=f*f,m=p*f,g=-h*m+2*h*p-h*f,v=(1+h)*m+(-1.5-2*h)*p+(-.5+h)*f+1,y=(-1-d)*m+(1.5+d)*p+.5*f,x=d*m-d*p;for(let t=0;t!==o;++t)i[t]=g*a[u+t]+v*a[l+t]+y*a[s+t]+x*a[c+t];return i}}class zc extends Uc{constructor(t,e,r,n){super(t,e,r,n)}interpolate_(t,e,r,n){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,l=s-o,u=(r-e)/(n-e),c=1-u;for(let t=0;t!==o;++t)i[t]=a[l+t]*c+a[s+t]*u;return i}}class Gc extends Uc{constructor(t,e,r,n){super(t,e,r,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class jc{constructor(t,e,r,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Nc.convertArray(e,this.TimeBufferType),this.values=Nc.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let r;if(e.toJSON!==this.toJSON)r=e.toJSON(t);else{r={name:t.name,times:Nc.convertArray(t.times,Array),values:Nc.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(r.interpolation=e)}return r.type=t.ValueTypeName,r}InterpolantFactoryMethodDiscrete(t){return new Gc(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new zc(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Bc(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Te:e=this.InterpolantFactoryMethodDiscrete;break;case Ee:e=this.InterpolantFactoryMethodLinear;break;case Ae:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Te;case this.InterpolantFactoryMethodLinear:return Ee;case this.InterpolantFactoryMethodSmooth:return Ae}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let r=0,n=e.length;r!==n;++r)e[r]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let r=0,n=e.length;r!==n;++r)e[r]*=t}return this}trim(t,e){const r=this.times,n=r.length;let i=0,a=n-1;for(;i!==n&&r[i]<t;)++i;for(;-1!==a&&r[a]>e;)--a;if(++a,0!==i||a!==n){i>=a&&(a=Math.max(a,1),i=a-1);const t=this.getValueSize();this.times=Nc.arraySlice(r,i,a),this.values=Nc.arraySlice(this.values,i*t,a*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const r=this.times,n=this.values,i=r.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let a=null;for(let e=0;e!==i;e++){const n=r[e];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,n),t=!1;break}if(null!==a&&a>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,n,a),t=!1;break}a=n}if(void 0!==n&&Nc.isTypedArray(n))for(let e=0,r=n.length;e!==r;++e){const r=n[e];if(isNaN(r)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,r),t=!1;break}}return t}optimize(){const t=Nc.arraySlice(this.times),e=Nc.arraySlice(this.values),r=this.getValueSize(),n=this.getInterpolation()===Ae,i=t.length-1;let a=1;for(let o=1;o<i;++o){let i=!1;const s=t[o];if(s!==t[o+1]&&(1!==o||s!==t[0]))if(n)i=!0;else{const t=o*r,n=t-r,a=t+r;for(let o=0;o!==r;++o){const r=e[t+o];if(r!==e[n+o]||r!==e[a+o]){i=!0;break}}}if(i){if(o!==a){t[a]=t[o];const n=o*r,i=a*r;for(let t=0;t!==r;++t)e[i+t]=e[n+t]}++a}}if(i>0){t[a]=t[i];for(let t=i*r,n=a*r,o=0;o!==r;++o)e[n+o]=e[t+o];++a}return a!==t.length?(this.times=Nc.arraySlice(t,0,a),this.values=Nc.arraySlice(e,0,a*r)):(this.times=t,this.values=e),this}clone(){const t=Nc.arraySlice(this.times,0),e=Nc.arraySlice(this.values,0),r=new(0,this.constructor)(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}}jc.prototype.TimeBufferType=Float32Array,jc.prototype.ValueBufferType=Float32Array,jc.prototype.DefaultInterpolation=Ee;class Vc extends jc{}Vc.prototype.ValueTypeName="bool",Vc.prototype.ValueBufferType=Array,Vc.prototype.DefaultInterpolation=Te,Vc.prototype.InterpolantFactoryMethodLinear=void 0,Vc.prototype.InterpolantFactoryMethodSmooth=void 0;class Hc extends jc{}Hc.prototype.ValueTypeName="color";class Wc extends jc{}Wc.prototype.ValueTypeName="number";class qc extends Uc{constructor(t,e,r,n){super(t,e,r,n)}interpolate_(t,e,r,n){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(r-e)/(n-e);let l=t*o;for(let t=l+o;l!==t;l+=4)Mr.slerpFlat(i,0,a,l-o,a,l,s);return i}}class Xc extends jc{InterpolantFactoryMethodLinear(t){return new qc(this.times,this.values,this.getValueSize(),t)}}Xc.prototype.ValueTypeName="quaternion",Xc.prototype.DefaultInterpolation=Ee,Xc.prototype.InterpolantFactoryMethodSmooth=void 0;class Yc extends jc{}Yc.prototype.ValueTypeName="string",Yc.prototype.ValueBufferType=Array,Yc.prototype.DefaultInterpolation=Te,Yc.prototype.InterpolantFactoryMethodLinear=void 0,Yc.prototype.InterpolantFactoryMethodSmooth=void 0;class Zc extends jc{}Zc.prototype.ValueTypeName="vector";class Kc{constructor(t,e=-1,r,n=2500){this.name=t,this.tracks=r,this.duration=e,this.blendMode=n,this.uuid=$e(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],r=t.tracks,n=1/(t.fps||1);for(let t=0,i=r.length;t!==i;++t)e.push(Jc(r[t]).scale(n));const i=new this(t.name,t.duration,e,t.blendMode);return i.uuid=t.uuid,i}static toJSON(t){const e=[],r=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,n=r.length;t!==n;++t)e.push(jc.toJSON(r[t]));return n}static CreateFromMorphTargetSequence(t,e,r,n){const i=e.length,a=[];for(let t=0;t<i;t++){let o=[],s=[];o.push((t+i-1)%i,t,(t+1)%i),s.push(0,1,0);const l=Nc.getKeyframeOrder(o);o=Nc.sortedArray(o,1,l),s=Nc.sortedArray(s,1,l),n||0!==o[0]||(o.push(i),s.push(s[0])),a.push(new Wc(".morphTargetInfluences["+e[t].name+"]",o,s).scale(1/r))}return new this(t,-1,a)}static findByName(t,e){let r=t;if(!Array.isArray(t)){const e=t;r=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<r.length;t++)if(r[t].name===e)return r[t];return null}static CreateClipsFromMorphTargetSequences(t,e,r){const n={},i=/^([\w-]*?)([\d]+)$/;for(let e=0,r=t.length;e<r;e++){const r=t[e],a=r.name.match(i);if(a&&a.length>1){const t=a[1];let e=n[t];e||(n[t]=e=[]),e.push(r)}}const a=[];for(const t in n)a.push(this.CreateFromMorphTargetSequence(t,n[t],e,r));return a}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(t,e,r,n,i){if(0!==r.length){const a=[],o=[];Nc.flattenJSON(r,a,o,n),0!==a.length&&i.push(new t(e,a,o))}},n=[],i=t.name||"default",a=t.fps||30,o=t.blendMode;let s=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const i=l[t].keys;if(i&&0!==i.length)if(i[0].morphTargets){const t={};let e;for(e=0;e<i.length;e++)if(i[e].morphTargets)for(let r=0;r<i[e].morphTargets.length;r++)t[i[e].morphTargets[r]]=-1;for(const r in t){const t=[],a=[];for(let n=0;n!==i[e].morphTargets.length;++n){const n=i[e];t.push(n.time),a.push(n.morphTarget===r?1:0)}n.push(new Wc(".morphTargetInfluence["+r+"]",t,a))}s=t.length*(a||1)}else{const a=".bones["+e[t].name+"]";r(Zc,a+".position",i,"pos",n),r(Xc,a+".quaternion",i,"rot",n),r(Zc,a+".scale",i,"scl",n)}}if(0===n.length)return null;return new this(i,s,n,o)}resetDuration(){let t=0;for(let e=0,r=this.tracks.length;e!==r;++e){const r=this.tracks[e];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Jc(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Wc;case"vector":case"vector2":case"vector3":case"vector4":return Zc;case"color":return Hc;case"quaternion":return Xc;case"bool":case"boolean":return Vc;case"string":return Yc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],r=[];Nc.flattenJSON(t.keys,e,r,"value"),t.times=e,t.values=r}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Qc={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class $c{constructor(t,e,r){const n=this;let i,a=!1,o=0,s=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=r,this.itemStart=function(t){s++,!1===a&&void 0!==n.onStart&&n.onStart(t,o,s),a=!0},this.itemEnd=function(t){o++,void 0!==n.onProgress&&n.onProgress(t,o,s),o===s&&(a=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return i?i(t):t},this.setURLModifier=function(t){return i=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,r=l.length;e<r;e+=2){const r=l[e],n=l[e+1];if(r.global&&(r.lastIndex=0),r.test(t))return n}return null}}}const th=new $c;class eh{constructor(t){this.manager=void 0!==t?t:th,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const r=this;return new Promise((function(n,i){r.load(t,n,e,i)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const rh={};class nh extends eh{constructor(t){super(t)}load(t,e,r,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=Qc.get(t);if(void 0!==i)return this.manager.itemStart(t),setTimeout((()=>{e&&e(i),this.manager.itemEnd(t)}),0),i;if(void 0!==rh[t])return void rh[t].push({onLoad:e,onProgress:r,onError:n});rh[t]=[],rh[t].push({onLoad:e,onProgress:r,onError:n});const a=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});fetch(a).then((e=>{if(200===e.status||0===e.status){0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");const r=rh[t],n=e.body.getReader(),i=e.headers.get("Content-Length"),a=i?parseInt(i):0,o=0!==a;let s=0;return new ReadableStream({start(t){!function e(){n.read().then((({done:n,value:i})=>{if(n)t.close();else{s+=i.byteLength;const n=new ProgressEvent("progress",{lengthComputable:o,loaded:s,total:a});for(let t=0,e=r.length;t<e;t++){const e=r[t];e.onProgress&&e.onProgress(n)}t.enqueue(i),e()}}))}()}})}throw Error(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`)})).then((t=>{const e=new Response(t);switch(this.responseType){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((t=>(new DOMParser).parseFromString(t,this.mimeType)));case"json":return e.json();default:return e.text()}})).then((e=>{Qc.add(t,e);const r=rh[t];delete rh[t];for(let t=0,n=r.length;t<n;t++){const n=r[t];n.onLoad&&n.onLoad(e)}this.manager.itemEnd(t)})).catch((e=>{const r=rh[t];delete rh[t];for(let t=0,n=r.length;t<n;t++){const n=r[t];n.onError&&n.onError(e)}this.manager.itemError(t),this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class ih extends eh{constructor(t){super(t)}load(t,e,r,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,a=Qc.get(t);if(void 0!==a)return i.manager.itemStart(t),setTimeout((function(){e&&e(a),i.manager.itemEnd(t)}),0),a;const o=dr("img");function s(){u(),Qc.add(t,this),e&&e(this),i.manager.itemEnd(t)}function l(e){u(),n&&n(e),i.manager.itemError(t),i.manager.itemEnd(t)}function u(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(t),o.src=t,o}}class ah extends eh{constructor(t){super(t)}load(t,e,r,n){const i=new Hi,a=new ih(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function s(r){a.load(t[r],(function(t){i.images[r]=t,o++,6===o&&(i.needsUpdate=!0,e&&e(i))}),void 0,n)}for(let e=0;e<t.length;++e)s(e);return i}}class oh extends eh{constructor(t){super(t)}load(t,e,r,n){const i=this,a=new Rl,o=new nh(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(i.withCredentials),o.load(t,(function(t){const r=i.parse(t);r&&(void 0!==r.image?a.image=r.image:void 0!==r.data&&(a.image.width=r.width,a.image.height=r.height,a.image.data=r.data),a.wrapS=void 0!==r.wrapS?r.wrapS:at,a.wrapT=void 0!==r.wrapT?r.wrapT:at,a.magFilter=void 0!==r.magFilter?r.magFilter:ct,a.minFilter=void 0!==r.minFilter?r.minFilter:ct,a.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.encoding&&(a.encoding=r.encoding),void 0!==r.flipY&&(a.flipY=r.flipY),void 0!==r.format&&(a.format=r.format),void 0!==r.type&&(a.type=r.type),void 0!==r.mipmaps&&(a.mipmaps=r.mipmaps,a.minFilter=dt),1===r.mipmapCount&&(a.minFilter=ct),void 0!==r.generateMipmaps&&(a.generateMipmaps=r.generateMipmaps),a.needsUpdate=!0,e&&e(a,r))}),r,n),a}}class sh extends eh{constructor(t){super(t)}load(t,e,r,n){const i=new vr,a=new ih(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,(function(t){i.image=t,i.needsUpdate=!0,void 0!==e&&e(i)}),r,n),i}}class lh extends An{constructor(t,e=1){super(),this.type="Light",this.color=new Xn(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}lh.prototype.isLight=!0;class uh extends lh{constructor(t,e,r){super(t,r),this.type="HemisphereLight",this.position.copy(An.DefaultUp),this.updateMatrix(),this.groundColor=new Xn(e)}copy(t){return lh.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}uh.prototype.isHemisphereLight=!0;const ch=new en,hh=new Sr,dh=new Sr;class fh{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new sr(512,512),this.map=null,this.mapPass=null,this.matrix=new en,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Qi,this._frameExtents=new sr(1,1),this._viewportCount=1,this._viewports=[new xr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,r=this.matrix;hh.setFromMatrixPosition(t.matrixWorld),e.position.copy(hh),dh.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(dh),e.updateMatrixWorld(),ch.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ch),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(e.projectionMatrix),r.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class ph extends fh{constructor(){super(new Gi(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,r=2*Qe*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;r===e.fov&&n===e.aspect&&i===e.far||(e.fov=r,e.aspect=n,e.far=i,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}ph.prototype.isSpotLightShadow=!0;class mh extends lh{constructor(t,e,r=0,n=Math.PI/3,i=0,a=1){super(t,e),this.type="SpotLight",this.position.copy(An.DefaultUp),this.updateMatrix(),this.target=new An,this.distance=r,this.angle=n,this.penumbra=i,this.decay=a,this.shadow=new ph}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}mh.prototype.isSpotLight=!0;const gh=new en,vh=new Sr,yh=new Sr;class xh extends fh{constructor(){super(new Gi(90,1,.5,500)),this._frameExtents=new sr(4,2),this._viewportCount=6,this._viewports=[new xr(2,1,1,1),new xr(0,1,1,1),new xr(3,1,1,1),new xr(1,1,1,1),new xr(3,0,1,1),new xr(1,0,1,1)],this._cubeDirections=[new Sr(1,0,0),new Sr(-1,0,0),new Sr(0,0,1),new Sr(0,0,-1),new Sr(0,1,0),new Sr(0,-1,0)],this._cubeUps=[new Sr(0,1,0),new Sr(0,1,0),new Sr(0,1,0),new Sr(0,1,0),new Sr(0,0,1),new Sr(0,0,-1)]}updateMatrices(t,e=0){const r=this.camera,n=this.matrix,i=t.distance||r.far;i!==r.far&&(r.far=i,r.updateProjectionMatrix()),vh.setFromMatrixPosition(t.matrixWorld),r.position.copy(vh),yh.copy(r.position),yh.add(this._cubeDirections[e]),r.up.copy(this._cubeUps[e]),r.lookAt(yh),r.updateMatrixWorld(),n.makeTranslation(-vh.x,-vh.y,-vh.z),gh.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(gh)}}xh.prototype.isPointLightShadow=!0;class _h extends lh{constructor(t,e,r=0,n=1){super(t,e),this.type="PointLight",this.distance=r,this.decay=n,this.shadow=new xh}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}_h.prototype.isPointLight=!0;class wh extends fh{constructor(){super(new ha(-5,5,5,-5,.5,500))}}wh.prototype.isDirectionalLightShadow=!0;class bh extends lh{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(An.DefaultUp),this.updateMatrix(),this.target=new An,this.shadow=new wh}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}bh.prototype.isDirectionalLight=!0;class Mh extends lh{constructor(t,e){super(t,e),this.type="AmbientLight"}}Mh.prototype.isAmbientLight=!0;class Sh extends lh{constructor(t,e,r=10,n=10){super(t,e),this.type="RectAreaLight",this.width=r,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}Sh.prototype.isRectAreaLight=!0;class Th{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Sr)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const r=t.x,n=t.y,i=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.282095),e.addScaledVector(a[1],.488603*n),e.addScaledVector(a[2],.488603*i),e.addScaledVector(a[3],.488603*r),e.addScaledVector(a[4],r*n*1.092548),e.addScaledVector(a[5],n*i*1.092548),e.addScaledVector(a[6],.315392*(3*i*i-1)),e.addScaledVector(a[7],r*i*1.092548),e.addScaledVector(a[8],.546274*(r*r-n*n)),e}getIrradianceAt(t,e){const r=t.x,n=t.y,i=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.886227),e.addScaledVector(a[1],1.023328*n),e.addScaledVector(a[2],1.023328*i),e.addScaledVector(a[3],1.023328*r),e.addScaledVector(a[4],.858086*r*n),e.addScaledVector(a[5],.858086*n*i),e.addScaledVector(a[6],.743125*i*i-.247708),e.addScaledVector(a[7],.858086*r*i),e.addScaledVector(a[8],.429043*(r*r-n*n)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(t.coefficients[r],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let r=0;r<9;r++)this.coefficients[r].lerp(t.coefficients[r],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].fromArray(t,e+3*n);return this}toArray(t=[],e=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].toArray(t,e+3*n);return t}static getBasisAt(t,e){const r=t.x,n=t.y,i=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*i,e[3]=.488603*r,e[4]=1.092548*r*n,e[5]=1.092548*n*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*r*i,e[8]=.546274*(r*r-n*n)}}Th.prototype.isSphericalHarmonics3=!0;class Eh extends lh{constructor(t=new Th,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}Eh.prototype.isLightProbe=!0;class Ah extends eh{constructor(t){super(t),this.textures={}}load(t,e,r,n){const i=this,a=new nh(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(t,(function(r){try{e(i.parse(JSON.parse(r)))}catch(e){n?n(e):console.error(e),i.manager.itemError(t)}}),r,n)}parse(t){const e=this.textures;function r(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const n=new Fc[t.type];if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&void 0!==n.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.sheen&&(n.sheen=t.sheen),void 0!==t.sheenColor&&(n.sheenColor=(new Xn).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(n.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==n.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==n.specular&&n.specular.setHex(t.specular),void 0!==t.specularIntensity&&(n.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==n.specularColor&&n.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearcoat&&(n.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(n.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.transmission&&(n.transmission=t.transmission),void 0!==t.thickness&&(n.thickness=t.thickness),void 0!==t.attenuationDistance&&(n.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==n.attenuationColor&&n.attenuationColor.setHex(t.attenuationColor),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.combine&&(n.combine=t.combine),void 0!==t.side&&(n.side=t.side),void 0!==t.shadowSide&&(n.shadowSide=t.shadowSide),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.format&&(n.format=t.format),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(n.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(n.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(n.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(n.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(n.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(n.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(n.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(n.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),1!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.polygonOffset&&(n.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(n.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(n.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.alphaToCoverage&&(n.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(n.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.toneMapped&&(n.toneMapped=t.toneMapped),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?n.vertexColors=t.vertexColors>0:n.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const i=t.uniforms[e];switch(n.uniforms[e]={},i.type){case"t":n.uniforms[e].value=r(i.value);break;case"c":n.uniforms[e].value=(new Xn).setHex(i.value);break;case"v2":n.uniforms[e].value=(new sr).fromArray(i.value);break;case"v3":n.uniforms[e].value=(new Sr).fromArray(i.value);break;case"v4":n.uniforms[e].value=(new xr).fromArray(i.value);break;case"m3":n.uniforms[e].value=(new lr).fromArray(i.value);break;case"m4":n.uniforms[e].value=(new en).fromArray(i.value);break;default:n.uniforms[e].value=i.value}}if(void 0!==t.defines&&(n.defines=t.defines),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const e in t.extensions)n.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(n.flatShading=1===t.shading),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=r(t.map)),void 0!==t.matcap&&(n.matcap=r(t.matcap)),void 0!==t.alphaMap&&(n.alphaMap=r(t.alphaMap)),void 0!==t.bumpMap&&(n.bumpMap=r(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=r(t.normalMap)),void 0!==t.normalMapType&&(n.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),n.normalScale=(new sr).fromArray(e)}return void 0!==t.displacementMap&&(n.displacementMap=r(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=r(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=r(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=r(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=r(t.specularMap)),void 0!==t.specularIntensityMap&&(n.specularIntensityMap=r(t.specularIntensityMap)),void 0!==t.specularColorMap&&(n.specularColorMap=r(t.specularColorMap)),void 0!==t.envMap&&(n.envMap=r(t.envMap)),void 0!==t.envMapIntensity&&(n.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(n.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(n.lightMap=r(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=r(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=r(t.gradientMap)),void 0!==t.clearcoatMap&&(n.clearcoatMap=r(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=r(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(n.clearcoatNormalMap=r(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(n.clearcoatNormalScale=(new sr).fromArray(t.clearcoatNormalScale)),void 0!==t.transmissionMap&&(n.transmissionMap=r(t.transmissionMap)),void 0!==t.thicknessMap&&(n.thicknessMap=r(t.thicknessMap)),void 0!==t.sheenColorMap&&(n.sheenColorMap=r(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(n.sheenRoughnessMap=r(t.sheenRoughnessMap)),n}setTextures(t){return this.textures=t,this}}class Rh{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let r=0,n=t.length;r<n;r++)e+=String.fromCharCode(t[r]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class Ph extends mi{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}Ph.prototype.isInstancedBufferGeometry=!0;class Ch extends eh{constructor(t){super(t)}load(t,e,r,n){const i=this,a=new nh(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(t,(function(r){try{e(i.parse(JSON.parse(r)))}catch(e){n?n(e):console.error(e),i.manager.itemError(t)}}),r,n)}parse(t){const e={},r={};function n(t,n){if(void 0!==e[n])return e[n];const i=t.interleavedBuffers[n],a=function(t,e){if(void 0!==r[e])return r[e];const n=t.arrayBuffers,i=n[e],a=new Uint32Array(i).buffer;return r[e]=a,a}(t,i.buffer),o=hr(i.type,a),s=new $s(o,i.stride);return s.uuid=i.uuid,e[n]=s,s}const i=t.isInstancedBufferGeometry?new Ph:new mi,a=t.data.index;if(void 0!==a){const t=hr(a.type,a.array);i.setIndex(new Jn(t,1))}const o=t.data.attributes;for(const e in o){const r=o[e];let a;if(r.isInterleavedBufferAttribute){const e=n(t.data,r.data);a=new el(e,r.itemSize,r.offset,r.normalized)}else{const t=hr(r.type,r.array);a=new(r.isInstancedBufferAttribute?Ll:Jn)(t,r.itemSize,r.normalized)}void 0!==r.name&&(a.name=r.name),void 0!==r.usage&&a.setUsage(r.usage),void 0!==r.updateRange&&(a.updateRange.offset=r.updateRange.offset,a.updateRange.count=r.updateRange.count),i.setAttribute(e,a)}const s=t.data.morphAttributes;if(s)for(const e in s){const r=s[e],a=[];for(let e=0,i=r.length;e<i;e++){const i=r[e];let o;if(i.isInterleavedBufferAttribute){const e=n(t.data,i.data);o=new el(e,i.itemSize,i.offset,i.normalized)}else{const t=hr(i.type,i.array);o=new Jn(t,i.itemSize,i.normalized)}void 0!==i.name&&(o.name=i.name),a.push(o)}i.morphAttributes[e]=a}t.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let t=0,e=l.length;t!==e;++t){const e=l[t];i.addGroup(e.start,e.count,e.materialIndex)}const u=t.data.boundingSphere;if(void 0!==u){const t=new Sr;void 0!==u.center&&t.fromArray(u.center),i.boundingSphere=new qr(t,u.radius)}return t.name&&(i.name=t.name),t.userData&&(i.userData=t.userData),i}}const Ih={UVMapping:J,CubeReflectionMapping:Q,CubeRefractionMapping:$,EquirectangularReflectionMapping:tt,EquirectangularRefractionMapping:et,CubeUVReflectionMapping:rt,CubeUVRefractionMapping:nt},Lh={RepeatWrapping:it,ClampToEdgeWrapping:at,MirroredRepeatWrapping:ot},Oh={NearestFilter:st,NearestMipmapNearestFilter:lt,NearestMipmapLinearFilter:ut,LinearFilter:ct,LinearMipmapNearestFilter:ht,LinearMipmapLinearFilter:dt};class Dh extends eh{constructor(t){super(t),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,r,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,a=Qc.get(t);if(void 0!==a)return i.manager.itemStart(t),setTimeout((function(){e&&e(a),i.manager.itemEnd(t)}),0),a;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(r){Qc.add(t,r),e&&e(r),i.manager.itemEnd(t)})).catch((function(e){n&&n(e),i.manager.itemError(t),i.manager.itemEnd(t)})),i.manager.itemStart(t)}}let kh;Dh.prototype.isImageBitmapLoader=!0;const Fh={getContext:function(){return void 0===kh&&(kh=new(window.AudioContext||window.webkitAudioContext)),kh},setContext:function(t){kh=t}};class Nh extends eh{constructor(t){super(t)}load(t,e,r,n){const i=this,a=new nh(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(r){try{const t=r.slice(0);Fh.getContext().decodeAudioData(t,(function(t){e(t)}))}catch(e){n?n(e):console.error(e),i.manager.itemError(t)}}),r,n)}}class Uh extends Eh{constructor(t,e,r=1){super(void 0,r);const n=(new Xn).set(t),i=(new Xn).set(e),a=new Sr(n.r,n.g,n.b),o=new Sr(i.r,i.g,i.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(l)}}Uh.prototype.isHemisphereLightProbe=!0;class Bh extends Eh{constructor(t,e=1){super(void 0,e);const r=(new Xn).set(t);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}}Bh.prototype.isAmbientLightProbe=!0;const zh=new en,Gh=new en,jh=new en;class Vh{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Hh(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=Hh();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function Hh(){return("undefined"==typeof performance?Date:performance).now()}const Wh=new Sr,qh=new Mr,Xh=new Sr,Yh=new Sr;class Zh extends An{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const Kh=new Sr,Jh=new Mr,Qh=new Sr,$h=new Sr;class td{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let r=0;r<e.length;r++)t+=e[r];return t/e.length}}class ed{constructor(t,e,r){let n,i,a;switch(this.binding=t,this.valueSize=r,e){case"quaternion":n=this._slerp,i=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":n=this._select,i=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:n=this._lerp,i=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=i,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const r=this.buffer,n=this.valueSize,i=t*n+n;let a=this.cumulativeWeight;if(0===a){for(let t=0;t!==n;++t)r[i+t]=r[t];a=e}else{a+=e;const t=e/a;this._mixBufferRegion(r,i,0,t,n)}this.cumulativeWeight=a}accumulateAdditive(t){const e=this.buffer,r=this.valueSize,n=r*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,r),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,r=this.buffer,n=t*e+e,i=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const t=e*this._origIndex;this._mixBufferRegion(r,n,t,1-i,e)}a>0&&this._mixBufferRegionAdditive(r,n,this._addIndex*e,1,e);for(let t=e,i=e+e;t!==i;++t)if(r[t]!==r[t+e]){o.setValue(r,n);break}}saveOriginalState(){const t=this.binding,e=this.buffer,r=this.valueSize,n=r*this._origIndex;t.getValue(e,n);for(let t=r,i=n;t!==i;++t)e[t]=e[n+t%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let r=t;r<e;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[e+r]=this.buffer[t+r]}_select(t,e,r,n,i){if(n>=.5)for(let n=0;n!==i;++n)t[e+n]=t[r+n]}_slerp(t,e,r,n){Mr.slerpFlat(t,e,t,e,t,r,n)}_slerpAdditive(t,e,r,n,i){const a=this._workIndex*i;Mr.multiplyQuaternionsFlat(t,a,t,e,t,r),Mr.slerpFlat(t,e,t,e,t,a,n)}_lerp(t,e,r,n,i){const a=1-n;for(let o=0;o!==i;++o){const i=e+o;t[i]=t[i]*a+t[r+o]*n}}_lerpAdditive(t,e,r,n,i){for(let a=0;a!==i;++a){const i=e+a;t[i]=t[i]+t[r+a]*n}}}const rd="\\[\\]\\.:\\/",nd=new RegExp("["+rd+"]","g"),id="[^"+rd+"]",ad="[^"+rd.replace("\\.","")+"]",od=/((?:WC+[\/:])*)/.source.replace("WC",id),sd=/(WCOD+)?/.source.replace("WCOD",ad),ld=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",id),ud=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",id),cd=new RegExp("^"+od+sd+ld+ud+"$"),hd=["material","materials","bones"];class dd{constructor(t,e,r){this.path=e,this.parsedPath=r||dd.parseTrackName(e),this.node=dd.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,r){return t&&t.isAnimationObjectGroup?new dd.Composite(t,e,r):new dd(t,e,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(nd,"")}static parseTrackName(t){const e=cd.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const r={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const t=r.nodeName.substring(n+1);-1!==hd.indexOf(t)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=t)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const r=t.skeleton.getBoneByName(e);if(void 0!==r)return r}if(t.children){const r=function(t){for(let n=0;n<t.length;n++){const i=t[n];if(i.name===e||i.uuid===e)return i;const a=r(i.children);if(a)return a}return null},n=r(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)t[e++]=r[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)r[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,r=e.objectName,n=e.propertyName;let i=e.propertyIndex;if(t||(t=dd.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(r){let n=e.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===n){n=e;break}break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==n){if(void 0===t[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[n]}}const a=t[n];if(void 0===a){const r=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+r+"."+n+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}s=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=i}else void 0!==a.fromArray&&void 0!==a.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(s=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}dd.Composite=class{constructor(t,e,r){const n=r||dd.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const r=this._targetGroup.nCachedObjects_,n=this._bindings[r];void 0!==n&&n.getValue(t,e)}setValue(t,e){const r=this._bindings;for(let n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].unbind()}},dd.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},dd.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},dd.prototype.GetterByBindingType=[dd.prototype._getValue_direct,dd.prototype._getValue_array,dd.prototype._getValue_arrayElement,dd.prototype._getValue_toArray],dd.prototype.SetterByBindingTypeAndVersioning=[[dd.prototype._setValue_direct,dd.prototype._setValue_direct_setNeedsUpdate,dd.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[dd.prototype._setValue_array,dd.prototype._setValue_array_setNeedsUpdate,dd.prototype._setValue_array_setMatrixWorldNeedsUpdate],[dd.prototype._setValue_arrayElement,dd.prototype._setValue_arrayElement_setNeedsUpdate,dd.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[dd.prototype._setValue_fromArray,dd.prototype._setValue_fromArray_setNeedsUpdate,dd.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class fd{constructor(){this.uuid=$e(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,r=arguments.length;e!==r;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,r=this._paths,n=this._parsedPaths,i=this._bindings,a=i.length;let o,s=t.length,l=this.nCachedObjects_;for(let u=0,c=arguments.length;u!==c;++u){const c=arguments[u],h=c.uuid;let d=e[h];if(void 0===d){d=s++,e[h]=d,t.push(c);for(let t=0,e=a;t!==e;++t)i[t].push(new dd(c,r[t],n[t]))}else if(d<l){o=t[d];const s=--l,u=t[s];e[u.uuid]=d,t[d]=u,e[h]=s,t[s]=c;for(let t=0,e=a;t!==e;++t){const e=i[t],a=e[s];let o=e[d];e[d]=a,void 0===o&&(o=new dd(c,r[t],n[t])),e[s]=o}}else t[d]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const t=this._objects,e=this._indicesByUUID,r=this._bindings,n=r.length;let i=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a],s=o.uuid,l=e[s];if(void 0!==l&&l>=i){const a=i++,u=t[a];e[u.uuid]=l,t[l]=u,e[s]=a,t[a]=o;for(let t=0,e=n;t!==e;++t){const e=r[t],n=e[a],i=e[l];e[l]=n,e[a]=i}}}this.nCachedObjects_=i}uncache(){const t=this._objects,e=this._indicesByUUID,r=this._bindings,n=r.length;let i=this.nCachedObjects_,a=t.length;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o].uuid,l=e[s];if(void 0!==l)if(delete e[s],l<i){const o=--i,s=t[o],u=--a,c=t[u];e[s.uuid]=l,t[l]=s,e[c.uuid]=o,t[o]=c,t.pop();for(let t=0,e=n;t!==e;++t){const e=r[t],n=e[o],i=e[u];e[l]=n,e[o]=i,e.pop()}}else{const i=--a,o=t[i];i>0&&(e[o.uuid]=l),t[l]=o,t.pop();for(let t=0,e=n;t!==e;++t){const e=r[t];e[l]=e[i],e.pop()}}}this.nCachedObjects_=i}subscribe_(t,e){const r=this._bindingsIndicesByPath;let n=r[t];const i=this._bindings;if(void 0!==n)return i[n];const a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,u=this.nCachedObjects_,c=new Array(l);n=i.length,r[t]=n,a.push(t),o.push(e),i.push(c);for(let r=u,n=s.length;r!==n;++r){const n=s[r];c[r]=new dd(n,t,e)}return c}unsubscribe_(t){const e=this._bindingsIndicesByPath,r=e[t];if(void 0!==r){const n=this._paths,i=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];e[t[o]]=r,a[r]=s,a.pop(),i[r]=i[o],i.pop(),n[r]=n[o],n.pop()}}}fd.prototype.isAnimationObjectGroup=!0;class pd{constructor(t,e,r=null,n=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=r,this.blendMode=n;const i=e.tracks,a=i.length,o=new Array(a),s={endingStart:Re,endingEnd:Re};for(let t=0;t!==a;++t){const e=i[t].createInterpolant(null);o[t]=e,e.settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,r){if(t.fadeOut(e),this.fadeIn(e),r){const r=this._clip.duration,n=t._clip.duration,i=n/r,a=r/n;t.warp(1,i,e),this.warp(a,1,e)}return this}crossFadeTo(t,e,r){return t.crossFadeFrom(this,e,r)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,r){const n=this._mixer,i=n.time,a=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const s=o.parameterPositions,l=o.sampleValues;return s[0]=i,s[1]=i+r,l[0]=t/a,l[1]=e/a,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,r,n){if(!this.enabled)return void this._updateWeight(t);const i=this._startTime;if(null!==i){const n=(t-i)*r;if(n<0||0===r)return;this._startTime=null,e=r*n}e*=this._updateTimeScale(t);const a=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;if(this.blendMode===Le)for(let r=0,n=t.length;r!==n;++r)t[r].evaluate(a),e[r].accumulateAdditive(o);else for(let r=0,i=t.length;r!==i;++r)t[r].evaluate(a),e[r].accumulate(n,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const r=this._weightInterpolant;if(null!==r){const n=r.evaluate(t)[0];e*=n,t>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const r=this._timeScaleInterpolant;if(null!==r){e*=r.evaluate(t)[0],t>r.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,r=this.loop;let n=this.time+t,i=this._loopCount;const a=2202===r;if(0===t)return-1===i?n:a&&1==(1&i)?e-n:n;if(2200===r){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else{if(!(n<0)){this.time=n;break t}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),n>=e||n<0){const r=Math.floor(n/e);n-=e*r,i+=Math.abs(r);const o=this.repetitions-i;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,a)}else this._setEndings(!1,!1,a);this._loopCount=i,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:r})}}else this.time=n;if(a&&1==(1&i))return e-n}return n}_setEndings(t,e,r){const n=this._interpolantSettings;r?(n.endingStart=Pe,n.endingEnd=Pe):(n.endingStart=t?this.zeroSlopeAtStart?Pe:Re:Ce,n.endingEnd=e?this.zeroSlopeAtEnd?Pe:Re:Ce)}_scheduleFading(t,e,r){const n=this._mixer,i=n.time;let a=this._weightInterpolant;null===a&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,s=a.sampleValues;return o[0]=i,s[0]=e,o[1]=i+t,s[1]=r,this}}class md extends Ye{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const r=t._localRoot||this._root,n=t._clip.tracks,i=n.length,a=t._propertyBindings,o=t._interpolants,s=r.uuid,l=this._bindingsByRootAndName;let u=l[s];void 0===u&&(u={},l[s]=u);for(let t=0;t!==i;++t){const i=n[t],l=i.name;let c=u[l];if(void 0!==c)a[t]=c;else{if(c=a[t],void 0!==c){null===c._cacheIndex&&(++c.referenceCount,this._addInactiveBinding(c,s,l));continue}const n=e&&e._propertyBindings[t].binding.parsedPath;c=new ed(dd.create(r,l,n),i.ValueTypeName,i.getValueSize()),++c.referenceCount,this._addInactiveBinding(c,s,l),a[t]=c}o[t].resultBuffer=c.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,r=t._clip.uuid,n=this._actionsByClip[r];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,r,e)}const e=t._propertyBindings;for(let t=0,r=e.length;t!==r;++t){const r=e[t];0==r.useCount++&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,r=e.length;t!==r;++t){const r=e[t];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,r){const n=this._actions,i=this._actionsByClip;let a=i[e];if(void 0===a)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=a;else{const e=a.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=n.length,n.push(t),a.actionByRoot[r]=t}_removeInactiveAction(t){const e=this._actions,r=e[e.length-1],n=t._cacheIndex;r._cacheIndex=n,e[n]=r,e.pop(),t._cacheIndex=null;const i=t._clip.uuid,a=this._actionsByClip,o=a[i],s=o.knownActions,l=s[s.length-1],u=t._byClipCacheIndex;l._byClipCacheIndex=u,s[u]=l,s.pop(),t._byClipCacheIndex=null;delete o.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete a[i],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,r=e.length;t!==r;++t){const r=e[t];0==--r.referenceCount&&this._removeInactiveBinding(r)}}_lendAction(t){const e=this._actions,r=t._cacheIndex,n=this._nActiveActions++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i}_takeBackAction(t){const e=this._actions,r=t._cacheIndex,n=--this._nActiveActions,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i}_addInactiveBinding(t,e,r){const n=this._bindingsByRootAndName,i=this._bindings;let a=n[e];void 0===a&&(a={},n[e]=a),a[r]=t,t._cacheIndex=i.length,i.push(t)}_removeInactiveBinding(t){const e=this._bindings,r=t.binding,n=r.rootNode.uuid,i=r.path,a=this._bindingsByRootAndName,o=a[n],s=e[e.length-1],l=t._cacheIndex;s._cacheIndex=l,e[l]=s,e.pop(),delete o[i],0===Object.keys(o).length&&delete a[n]}_lendBinding(t){const e=this._bindings,r=t._cacheIndex,n=this._nActiveBindings++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i}_takeBackBinding(t){const e=this._bindings,r=t._cacheIndex,n=--this._nActiveBindings,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let r=t[e];return void 0===r&&(r=new zc(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),r.__cacheIndex=e,t[e]=r),r}_takeBackControlInterpolant(t){const e=this._controlInterpolants,r=t.__cacheIndex,n=--this._nActiveControlInterpolants,i=e[n];t.__cacheIndex=n,e[n]=t,i.__cacheIndex=r,e[r]=i}clipAction(t,e,r){const n=e||this._root,i=n.uuid;let a="string"==typeof t?Kc.findByName(n,t):t;const o=null!==a?a.uuid:t,s=this._actionsByClip[o];let l=null;if(void 0===r&&(r=null!==a?a.blendMode:Ie),void 0!==s){const t=s.actionByRoot[i];if(void 0!==t&&t.blendMode===r)return t;l=s.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;const u=new pd(this,a,e,r);return this._bindAction(u,l),this._addInactiveAction(u,o,i),u}existingAction(t,e){const r=e||this._root,n=r.uuid,i="string"==typeof t?Kc.findByName(r,t):t,a=i?i.uuid:t,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[n]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,r=this._nActiveActions,n=this.time+=t,i=Math.sign(t),a=this._accuIndex^=1;for(let o=0;o!==r;++o){e[o]._update(n,t,i,a)}const o=this._bindings,s=this._nActiveBindings;for(let t=0;t!==s;++t)o[t].apply(a);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,r=t.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){const t=i.knownActions;for(let r=0,n=t.length;r!==n;++r){const n=t[r];this._deactivateAction(n);const i=n._cacheIndex,a=e[e.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,a._cacheIndex=i,e[i]=a,e.pop(),this._removeInactiveBindingsForAction(n)}delete n[r]}}uncacheRoot(t){const e=t.uuid,r=this._actionsByClip;for(const t in r){const n=r[t].actionByRoot[e];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[e];if(void 0!==n)for(const t in n){const e=n[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const r=this.existingAction(t,e);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}md.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class gd{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new gd(void 0===this.value.clone?this.value:this.value.clone())}}class vd extends $s{constructor(t,e,r=1){super(t,e),this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}vd.prototype.isInstancedInterleavedBuffer=!0;class yd{constructor(t,e,r,n,i){this.buffer=t,this.type=e,this.itemSize=r,this.elementSize=n,this.count=i,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}yd.prototype.isGLBufferAttribute=!0;function xd(t,e){return t.distance-e.distance}function _d(t,e,r,n){if(t.layers.test(e.layers)&&t.raycast(e,r),!0===n){const n=t.children;for(let t=0,i=n.length;t<i;t++)_d(n[t],e,r,!0)}}class wd{constructor(t=1,e=0,r=0){return this.radius=t,this.phi=e,this.theta=r,this}set(t,e,r){return this.radius=t,this.phi=e,this.theta=r,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,r){return this.radius=Math.sqrt(t*t+e*e+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,r),this.phi=Math.acos(tr(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}const bd=new sr;class Md{constructor(t=new sr(1/0,1/0),e=new sr(-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const r=bd.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return bd.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Md.prototype.isBox2=!0;const Sd=new Sr,Td=new Sr;class Ed{constructor(t=new Sr,e=new Sr){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Sd.subVectors(t,this.start),Td.subVectors(this.end,this.start);const r=Td.dot(Td);let n=Td.dot(Sd)/r;return e&&(n=tr(n,0,1)),n}closestPointToPoint(t,e,r){const n=this.closestPointToPointParameter(t,e);return this.delta(r).multiplyScalar(n).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const Ad=new Sr;const Rd=new Sr,Pd=new en,Cd=new en;class Id extends Xl{constructor(t){const e=Ld(t),r=new mi,n=[],i=[],a=new Xn(0,0,1),o=new Xn(0,1,0);for(let t=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(a.r,a.g,a.b),i.push(o.r,o.g,o.b))}r.setAttribute("position",new oi(n,3)),r.setAttribute("color",new oi(i,3));super(r,new Ul({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,r=this.geometry,n=r.getAttribute("position");Cd.copy(this.root.matrixWorld).invert();for(let t=0,r=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(Pd.multiplyMatrices(Cd,i.matrixWorld),Rd.setFromMatrixPosition(Pd),n.setXYZ(r,Rd.x,Rd.y,Rd.z),Pd.multiplyMatrices(Cd,i.parent.matrixWorld),Rd.setFromMatrixPosition(Pd),n.setXYZ(r+1,Rd.x,Rd.y,Rd.z),r+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}function Ld(t){const e=[];t&&t.isBone&&e.push(t);for(let r=0;r<t.children.length;r++)e.push.apply(e,Ld(t.children[r]));return e}const Od=new Sr,Dd=new Xn,kd=new Xn;class Fd extends Xl{constructor(t=10,e=10,r=4473924,n=8947848){r=new Xn(r),n=new Xn(n);const i=e/2,a=t/e,o=t/2,s=[],l=[];for(let t=0,u=0,c=-o;t<=e;t++,c+=a){s.push(-o,0,c,o,0,c),s.push(c,0,-o,c,0,o);const e=t===i?r:n;e.toArray(l,u),u+=3,e.toArray(l,u),u+=3,e.toArray(l,u),u+=3,e.toArray(l,u),u+=3}const u=new mi;u.setAttribute("position",new oi(s,3)),u.setAttribute("color",new oi(l,3));super(u,new Ul({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const Nd=new Sr,Ud=new Sr,Bd=new Sr;const zd=new Sr,Gd=new zi;function jd(t,e,r,n,i,a,o){zd.set(i,a,o).unproject(n);const s=e[t];if(void 0!==s){const t=r.getAttribute("position");for(let e=0,r=s.length;e<r;e++)t.setXYZ(s[e],zd.x,zd.y,zd.z)}}const Vd=new Ar;class Hd extends Xl{constructor(t,e=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),i=new mi;i.setIndex(new Jn(r,1)),i.setAttribute("position",new Jn(n,3)),super(i,new Ul({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Vd.setFromObject(this.object),Vd.isEmpty())return;const e=Vd.min,r=Vd.max,n=this.geometry.attributes.position,i=n.array;i[0]=r.x,i[1]=r.y,i[2]=r.z,i[3]=e.x,i[4]=r.y,i[5]=r.z,i[6]=e.x,i[7]=e.y,i[8]=r.z,i[9]=r.x,i[10]=e.y,i[11]=r.z,i[12]=r.x,i[13]=r.y,i[14]=e.z,i[15]=e.x,i[16]=r.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=r.x,i[22]=e.y,i[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t){return Xl.prototype.copy.call(this,t),this.object=t.object,this}}const Wd=new Sr;let qd,Xd;class Yd extends Xl{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=new mi;r.setAttribute("position",new oi(e,3)),r.setAttribute("color",new oi([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(r,new Ul({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,r){const n=new Xn,i=this.geometry.attributes.color.array;return n.set(t),n.toArray(i,0),n.toArray(i,3),n.set(e),n.toArray(i,6),n.toArray(i,9),n.set(r),n.toArray(i,12),n.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const Zd=new Float32Array(1),Kd=new Int32Array(Zd.buffer);mu.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(mu.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Fu.prototype.fromPoints=function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)},Fd.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Id.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},eh.prototype.extractUrlBase=function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Rh.extractUrlBase(t)},eh.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Md.prototype.center=function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},Md.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Md.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Md.prototype.size=function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)},Ar.prototype.center=function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Ar.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Ar.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Ar.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},Ar.prototype.size=function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)},qr.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Qi.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},Ed.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},lr.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},lr.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},lr.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},lr.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},lr.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},lr.prototype.getInverse=function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},en.prototype.extractPosition=function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},en.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},en.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Sr).setFromMatrixColumn(this,3)},en.prototype.setRotationFromQuaternion=function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},en.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},en.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},en.prototype.multiplyVector4=function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},en.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},en.prototype.rotateAxis=function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},en.prototype.crossVector=function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},en.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},en.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},en.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},en.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},en.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},en.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},en.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},en.prototype.makeFrustum=function(t,e,r,n,i,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,r,i,a)},en.prototype.getInverse=function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},Zi.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Mr.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Mr.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},tn.prototype.isIntersectionBox=function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},tn.prototype.isIntersectionPlane=function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},tn.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},Un.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Un.prototype.barycoordFromPoint=function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},Un.prototype.midpoint=function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},Un.prototypenormal=function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},Un.prototype.plane=function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)},Un.barycoordFromPoint=function(t,e,r,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Un.getBarycoord(t,e,r,n,i)},Un.normal=function(t,e,r,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Un.getNormal(t,e,r,n)},Nu.prototype.extractAllPoints=function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},Nu.prototype.extrude=function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new dc(this,t)},Nu.prototype.makeGeometry=function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new yc(this,t)},sr.prototype.fromAttribute=function(t,e,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},sr.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},sr.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Sr.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Sr.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Sr.prototype.getPositionFromMatrix=function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},Sr.prototype.getScaleFromMatrix=function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},Sr.prototype.getColumnFromMatrix=function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},Sr.prototype.applyProjection=function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},Sr.prototype.fromAttribute=function(t,e,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},Sr.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Sr.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},xr.prototype.fromAttribute=function(t,e,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},xr.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},An.prototype.getChildByName=function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},An.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},An.prototype.translate=function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},An.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},An.prototype.applyMatrix=function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(An.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Oi.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Oi.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),El.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Gi.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(lh.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(Jn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===qe},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(qe)}}}),Jn.prototype.setDynamic=function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?qe:We),this},Jn.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Jn.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},mi.prototype.addIndex=function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},mi.prototype.addAttribute=function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new Jn(arguments[1],arguments[2])))},mi.prototype.addDrawCall=function(t,e,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},mi.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},mi.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},mi.prototype.removeAttribute=function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},mi.prototype.applyMatrix=function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(mi.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),$s.prototype.setDynamic=function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?qe:We),this},$s.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},dc.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},dc.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},dc.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Qs.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},gd.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(zn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Xn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Bi.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Ys.prototype.clearTarget=function(t,e,r,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,r,n)},Ys.prototype.animate=function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},Ys.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Ys.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Ys.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Ys.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Ys.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Ys.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Ys.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Ys.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Ys.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Ys.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Ys.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Ys.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Ys.prototype.enableScissorTest=function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},Ys.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Ys.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Ys.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Ys.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Ys.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Ys.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Ys.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Ys.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Ys.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Ys.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Ys.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?ke:De}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Ns.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(_r.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Zh.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new Nh).load(t,(function(t){e.setBuffer(t)})),this},td.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Vi.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},Vi.prototype.clear=function(t,e,r,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,r,n)},mr.crossOrigin=void 0,mr.loadTexture=function(t,e,r,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new sh;i.setCrossOrigin(this.crossOrigin);const a=i.load(t,r,void 0,n);return e&&(a.mapping=e),a},mr.loadTextureCube=function(t,e,r,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new ah;i.setCrossOrigin(this.crossOrigin);const a=i.load(t,r,void 0,n);return e&&(a.mapping=e),a},mr.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},mr.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Jd={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:t}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=t);const Qd=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:Z,AddEquation:y,AddOperation:H,AdditiveAnimationBlendMode:Le,AdditiveBlending:p,AlphaFormat:Tt,AlwaysDepth:k,AlwaysStencilFunc:519,AmbientLight:Mh,AmbientLightProbe:Bh,AnimationClip:Kc,AnimationLoader:class extends eh{constructor(t){super(t)}load(t,e,r,n){const i=this,a=new nh(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(r){try{e(i.parse(JSON.parse(r)))}catch(e){n?n(e):console.error(e),i.manager.itemError(t)}}),r,n)}parse(t){const e=[];for(let r=0;r<t.length;r++){const n=Kc.parse(t[r]);e.push(n)}return e}},AnimationMixer:md,AnimationObjectGroup:fd,AnimationUtils:Nc,ArcCurve:vu,ArrayCamera:Gs,ArrowHelper:class extends An{constructor(t=new Sr(0,0,1),e=new Sr(0,0,0),r=1,n=16776960,i=.2*r,a=.2*i){super(),this.type="ArrowHelper",void 0===qd&&(qd=new mi,qd.setAttribute("position",new oi([0,0,0,0,1,0],3)),Xd=new ou(0,.5,1,5,1),Xd.translate(0,-.5,0)),this.position.copy(e),this.line=new Hl(qd,new Ul({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Oi(Xd,new Yn({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,i,a)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{Wd.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(Wd,e)}}setLength(t,e=.2*t,r=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(r,e,r),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}},Audio:Zh,AudioAnalyser:td,AudioContext:Fh,AudioListener:class extends An{constructor(){super(),this.type="AudioListener",this.context=Fh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Vh}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Wh,qh,Xh),Yh.set(0,0,-1).applyQuaternion(qh),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(Wh.x,t),e.positionY.linearRampToValueAtTime(Wh.y,t),e.positionZ.linearRampToValueAtTime(Wh.z,t),e.forwardX.linearRampToValueAtTime(Yh.x,t),e.forwardY.linearRampToValueAtTime(Yh.y,t),e.forwardZ.linearRampToValueAtTime(Yh.z,t),e.upX.linearRampToValueAtTime(r.x,t),e.upY.linearRampToValueAtTime(r.y,t),e.upZ.linearRampToValueAtTime(r.z,t)}else e.setPosition(Wh.x,Wh.y,Wh.z),e.setOrientation(Yh.x,Yh.y,Yh.z,r.x,r.y,r.z)}},AudioLoader:Nh,AxesHelper:Yd,AxisHelper:function(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Yd(t)},BackSide:c,BasicDepthPacking:3200,BasicShadowMap:0,BinaryTextureLoader:function(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new oh(t)},Bone:Al,BooleanKeyframeTrack:Vc,BoundingBoxHelper:function(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Hd(t,e)},Box2:Md,Box3:Ar,Box3Helper:class extends Xl{constructor(t,e=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new mi;n.setIndex(new Jn(r,1)),n.setAttribute("position",new oi([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new Ul({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}},BoxBufferGeometry:ki,BoxGeometry:ki,BoxHelper:Hd,BufferAttribute:Jn,BufferGeometry:mi,BufferGeometryLoader:Ch,ByteType:pt,Cache:Qc,Camera:zi,CameraHelper:class extends Xl{constructor(t){const e=new mi,r=new Ul({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],i=[],a={},o=new Xn(16755200),s=new Xn(16711680),l=new Xn(43775),u=new Xn(16777215),c=new Xn(3355443);function h(t,e,r){d(t,r),d(e,r)}function d(t,e){n.push(0,0,0),i.push(e.r,e.g,e.b),void 0===a[t]&&(a[t]=[]),a[t].push(n.length/3-1)}h("n1","n2",o),h("n2","n4",o),h("n4","n3",o),h("n3","n1",o),h("f1","f2",o),h("f2","f4",o),h("f4","f3",o),h("f3","f1",o),h("n1","f1",o),h("n2","f2",o),h("n3","f3",o),h("n4","f4",o),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",u),h("p","c",c),h("cn1","cn2",c),h("cn3","cn4",c),h("cf1","cf2",c),h("cf3","cf4",c),e.setAttribute("position",new oi(n,3)),e.setAttribute("color",new oi(i,3)),super(e,r),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}update(){const t=this.geometry,e=this.pointMap;Gd.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),jd("c",e,t,Gd,0,0,-1),jd("t",e,t,Gd,0,0,1),jd("n1",e,t,Gd,-1,-1,-1),jd("n2",e,t,Gd,1,-1,-1),jd("n3",e,t,Gd,-1,1,-1),jd("n4",e,t,Gd,1,1,-1),jd("f1",e,t,Gd,-1,-1,1),jd("f2",e,t,Gd,1,-1,1),jd("f3",e,t,Gd,-1,1,1),jd("f4",e,t,Gd,1,1,1),jd("u1",e,t,Gd,.7,1.1,-1),jd("u2",e,t,Gd,-.7,1.1,-1),jd("u3",e,t,Gd,0,2,-1),jd("cf1",e,t,Gd,-1,0,1),jd("cf2",e,t,Gd,1,0,1),jd("cf3",e,t,Gd,0,-1,1),jd("cf4",e,t,Gd,0,1,1),jd("cn1",e,t,Gd,-1,0,-1),jd("cn2",e,t,Gd,1,0,-1),jd("cn3",e,t,Gd,0,-1,-1),jd("cn4",e,t,Gd,0,1,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},CanvasRenderer:function(){console.error("THREE.CanvasRenderer has been removed")},CanvasTexture:iu,CatmullRomCurve3:Mu,CineonToneMapping:Y,CircleBufferGeometry:au,CircleGeometry:au,ClampToEdgeWrapping:at,Clock:Vh,Color:Xn,ColorKeyframeTrack:Hc,CompressedTexture:nu,CompressedTextureLoader:class extends eh{constructor(t){super(t)}load(t,e,r,n){const i=this,a=[],o=new nu,s=new nh(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(i.withCredentials);let l=0;function u(u){s.load(t[u],(function(t){const r=i.parse(t,!0);a[u]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},l+=1,6===l&&(1===r.mipmapCount&&(o.minFilter=ct),o.image=a,o.format=r.format,o.needsUpdate=!0,e&&e(o))}),r,n)}if(Array.isArray(t))for(let e=0,r=t.length;e<r;++e)u(e);else s.load(t,(function(t){const r=i.parse(t,!0);if(r.isCubemap){const t=r.mipmaps.length/r.mipmapCount;for(let e=0;e<t;e++){a[e]={mipmaps:[]};for(let t=0;t<r.mipmapCount;t++)a[e].mipmaps.push(r.mipmaps[e*r.mipmapCount+t]),a[e].format=r.format,a[e].width=r.width,a[e].height=r.height}o.image=a}else o.image.width=r.width,o.image.height=r.height,o.mipmaps=r.mipmaps;1===r.mipmapCount&&(o.minFilter=ct),o.format=r.format,o.needsUpdate=!0,e&&e(o)}),r,n);return o}},ConeBufferGeometry:su,ConeGeometry:su,CubeCamera:Vi,CubeReflectionMapping:Q,CubeRefractionMapping:$,CubeTexture:Hi,CubeTextureLoader:ah,CubeUVReflectionMapping:rt,CubeUVRefractionMapping:nt,CubicBezierCurve:Au,CubicBezierCurve3:Ru,CubicInterpolant:Bc,CullFaceBack:i,CullFaceFront:a,CullFaceFrontBack:3,CullFaceNone:n,Curve:mu,CurvePath:ku,CustomBlending:v,CustomToneMapping:K,CylinderBufferGeometry:ou,CylinderGeometry:ou,Cylindrical:class{constructor(t=1,e=0,r=0){return this.radius=t,this.theta=e,this.y=r,this}set(t,e,r){return this.radius=t,this.theta=e,this.y=r,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,r){return this.radius=Math.sqrt(t*t+r*r),this.theta=Math.atan2(t,r),this.y=e,this}clone(){return(new this.constructor).copy(this)}},DataTexture:Rl,DataTexture2DArray:Va,DataTexture3D:Za,DataTextureLoader:oh,DataUtils:class{static toHalfFloat(t){t>65504&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),t=65504),Zd[0]=t;const e=Kd[0];let r=e>>16&32768,n=e>>12&2047;const i=e>>23&255;return i<103?r:i>142?(r|=31744,r|=(255==i?0:1)&&8388607&e,r):i<113?(n|=2048,r|=(n>>114-i)+(n>>113-i&1),r):(r|=i-112<<10|n>>1,r+=1&n,r)}},DecrementStencilOp:7683,DecrementWrapStencilOp:34056,DefaultLoadingManager:th,DepthFormat:It,DepthStencilFormat:Lt,DepthTexture:Ws,DirectionalLight:bh,DirectionalLightHelper:class extends An{constructor(t,e,r){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===e&&(e=1);let n=new mi;n.setAttribute("position",new oi([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const i=new Ul({fog:!1,toneMapped:!1});this.lightPlane=new Hl(n,i),this.add(this.lightPlane),n=new mi,n.setAttribute("position",new oi([0,0,0,0,0,1],3)),this.targetLine=new Hl(n,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Nd.setFromMatrixPosition(this.light.matrixWorld),Ud.setFromMatrixPosition(this.light.target.matrixWorld),Bd.subVectors(Ud,Nd),this.lightPlane.lookAt(Ud),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Ud),this.targetLine.scale.z=Bd.length()}},DiscreteInterpolant:Gc,DodecahedronBufferGeometry:uu,DodecahedronGeometry:uu,DoubleSide:h,DstAlphaFactor:P,DstColorFactor:I,DynamicBufferAttribute:function(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Jn(t,e).setUsage(qe)},DynamicCopyUsage:35050,DynamicDrawUsage:qe,DynamicReadUsage:35049,EdgesGeometry:pu,EdgesHelper:function(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Xl(new pu(t.geometry),new Ul({color:void 0!==e?e:16777215}))},EllipseCurve:gu,EqualDepth:U,EqualStencilFunc:514,EquirectangularReflectionMapping:tt,EquirectangularRefractionMapping:et,Euler:dn,EventDispatcher:Ye,ExtrudeBufferGeometry:dc,ExtrudeGeometry:dc,FaceColors:1,FileLoader:nh,FlatShading:1,Float16BufferAttribute:ai,Float32Attribute:function(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new oi(t,e)},Float32BufferAttribute:oi,Float64Attribute:function(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new si(t,e)},Float64BufferAttribute:si,FloatType:xt,Fog:Js,FogExp2:Ks,Font:function(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")},FontLoader:function(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")},FrontSide:u,Frustum:Qi,GLBufferAttribute:yd,GLSL1:"100",GLSL3:Xe,GammaEncoding:Fe,GreaterDepth:z,GreaterEqualDepth:B,GreaterEqualStencilFunc:518,GreaterStencilFunc:516,GridHelper:Fd,Group:js,HalfFloatType:_t,HemisphereLight:uh,HemisphereLightHelper:class extends An{constructor(t,e,r){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;const n=new gc(e);n.rotateY(.5*Math.PI),this.material=new Yn({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=n.getAttribute("position"),a=new Float32Array(3*i.count);n.setAttribute("color",new Jn(a,3)),this.add(new Oi(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");Dd.copy(this.light.color),kd.copy(this.light.groundColor);for(let t=0,r=e.count;t<r;t++){const n=t<r/2?Dd:kd;e.setXYZ(t,n.r,n.g,n.b)}e.needsUpdate=!0}t.lookAt(Od.setFromMatrixPosition(this.light.matrixWorld).negate())}},HemisphereLightProbe:Uh,IcosahedronBufferGeometry:pc,IcosahedronGeometry:pc,ImageBitmapLoader:Dh,ImageLoader:ih,ImageUtils:mr,ImmediateRenderObject:function(){console.error("THREE.ImmediateRenderObject has been removed.")},IncrementStencilOp:7682,IncrementWrapStencilOp:34055,InstancedBufferAttribute:Ll,InstancedBufferGeometry:Ph,InstancedInterleavedBuffer:vd,InstancedMesh:Nl,Int16Attribute:function(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new ei(t,e)},Int16BufferAttribute:ei,Int32Attribute:function(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new ni(t,e)},Int32BufferAttribute:ni,Int8Attribute:function(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Qn(t,e)},Int8BufferAttribute:Qn,IntType:vt,InterleavedBuffer:$s,InterleavedBufferAttribute:el,Interpolant:Uc,InterpolateDiscrete:Te,InterpolateLinear:Ee,InterpolateSmooth:Ae,InvertStencilOp:5386,JSONLoader:function(){console.error("THREE.JSONLoader has been removed.")},KeepStencilOp:He,KeyframeTrack:jc,LOD:_l,LatheBufferGeometry:mc,LatheGeometry:mc,Layers:fn,LensFlare:function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},LessDepth:F,LessEqualDepth:N,LessEqualStencilFunc:515,LessStencilFunc:513,Light:lh,LightProbe:Eh,Line:Hl,Line3:Ed,LineBasicMaterial:Ul,LineCurve:Pu,LineCurve3:Cu,LineDashedMaterial:kc,LineLoop:Yl,LinePieces:1,LineSegments:Xl,LineStrip:0,LinearEncoding:De,LinearFilter:ct,LinearInterpolant:zc,LinearMipMapLinearFilter:1008,LinearMipMapNearestFilter:1007,LinearMipmapLinearFilter:dt,LinearMipmapNearestFilter:ht,LinearToneMapping:q,Loader:eh,LoaderUtils:Rh,LoadingManager:$c,LoopOnce:2200,LoopPingPong:2202,LoopRepeat:2201,LuminanceAlphaFormat:Pt,LuminanceFormat:Rt,MOUSE:e,Material:zn,MaterialLoader:Ah,Math:or,MathUtils:or,Matrix3:lr,Matrix4:en,MaxEquation:b,Mesh:Oi,MeshBasicMaterial:Yn,MeshDepthMaterial:Os,MeshDistanceMaterial:Ds,MeshFaceMaterial:function(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t},MeshLambertMaterial:Oc,MeshMatcapMaterial:Dc,MeshNormalMaterial:Lc,MeshPhongMaterial:Cc,MeshPhysicalMaterial:Pc,MeshStandardMaterial:Rc,MeshToonMaterial:Ic,MinEquation:w,MirroredRepeatWrapping:ot,MixOperation:V,MultiMaterial:function(t=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t},MultiplyBlending:g,MultiplyOperation:j,NearestFilter:st,NearestMipMapLinearFilter:1005,NearestMipMapNearestFilter:1004,NearestMipmapLinearFilter:ut,NearestMipmapNearestFilter:lt,NeverDepth:D,NeverStencilFunc:512,NoBlending:d,NoColors:0,NoToneMapping:W,NormalAnimationBlendMode:Ie,NormalBlending:f,NotEqualDepth:G,NotEqualStencilFunc:517,NumberKeyframeTrack:Wc,Object3D:An,ObjectLoader:class extends eh{constructor(t){super(t)}load(t,e,r,n){const i=this,a=""===this.path?Rh.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||a;const o=new nh(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(r){let a=null;try{a=JSON.parse(r)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const o=a.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?i.parse(a,e):console.error("THREE.ObjectLoader: Can't load "+t)}),r,n)}async loadAsync(t,e){const r=""===this.path?Rh.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||r;const n=new nh(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials);const i=await n.loadAsync(t,e),a=JSON.parse(i),o=a.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await this.parseAsync(a)}parse(t,e){const r=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),i=this.parseGeometries(t.geometries,n),a=this.parseImages(t.images,(function(){void 0!==e&&e(l)})),o=this.parseTextures(t.textures,a),s=this.parseMaterials(t.materials,o),l=this.parseObject(t.object,i,s,o,r),u=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,u),void 0!==e){let t=!1;for(const e in a)if(a[e]instanceof HTMLImageElement){t=!0;break}!1===t&&e(l)}return l}async parseAsync(t){const e=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,r),i=await this.parseImagesAsync(t.images),a=this.parseTextures(t.textures,i),o=this.parseMaterials(t.materials,a),s=this.parseObject(t.object,n,o,a,e),l=this.parseSkeletons(t.skeletons,s);return this.bindSkeletons(s,l),s}parseShapes(t){const e={};if(void 0!==t)for(let r=0,n=t.length;r<n;r++){const n=(new Nu).fromJSON(t[r]);e[n.uuid]=n}return e}parseSkeletons(t,e){const r={},n={};if(e.traverse((function(t){t.isBone&&(n[t.uuid]=t)})),void 0!==t)for(let e=0,i=t.length;e<i;e++){const i=(new Il).fromJSON(t[e],n);r[i.uuid]=i}return r}parseGeometries(t,e){const r={};if(void 0!==t){const n=new Ch;for(let i=0,a=t.length;i<a;i++){let a;const o=t[i];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":a=n.parse(o);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:o.type in Ec?a=Ec[o.type].fromJSON(o,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${o.type}"`)}a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),!0===a.isBufferGeometry&&void 0!==o.userData&&(a.userData=o.userData),r[o.uuid]=a}}return r}parseMaterials(t,e){const r={},n={};if(void 0!==t){const i=new Ah;i.setTextures(e);for(let e=0,a=t.length;e<a;e++){const a=t[e];if("MultiMaterial"===a.type){const t=[];for(let e=0;e<a.materials.length;e++){const n=a.materials[e];void 0===r[n.uuid]&&(r[n.uuid]=i.parse(n)),t.push(r[n.uuid])}n[a.uuid]=t}else void 0===r[a.uuid]&&(r[a.uuid]=i.parse(a)),n[a.uuid]=r[a.uuid]}}return n}parseAnimations(t){const e={};if(void 0!==t)for(let r=0;r<t.length;r++){const n=t[r],i=Kc.parse(n);e[i.uuid]=i}return e}parseImages(t,e){const r=this,n={};let i;function a(t){if("string"==typeof t){const e=t;return function(t){return r.manager.itemStart(t),i.load(t,(function(){r.manager.itemEnd(t)}),void 0,(function(){r.manager.itemError(t),r.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:r.resourcePath+e)}return t.data?{data:hr(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const r=new $c(e);i=new ih(r),i.setCrossOrigin(this.crossOrigin);for(let e=0,r=t.length;e<r;e++){const r=t[e],i=r.url;if(Array.isArray(i)){n[r.uuid]=[];for(let t=0,e=i.length;t<e;t++){const e=a(i[t]);null!==e&&(e instanceof HTMLImageElement?n[r.uuid].push(e):n[r.uuid].push(new Rl(e.data,e.width,e.height)))}}else{const t=a(r.url);null!==t&&(n[r.uuid]=t)}}}return n}async parseImagesAsync(t){const e=this,r={};let n;async function i(t){if("string"==typeof t){const r=t,i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r)?r:e.resourcePath+r;return await n.loadAsync(i)}return t.data?{data:hr(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){n=new ih(this.manager),n.setCrossOrigin(this.crossOrigin);for(let e=0,n=t.length;e<n;e++){const n=t[e],a=n.url;if(Array.isArray(a)){r[n.uuid]=[];for(let t=0,e=a.length;t<e;t++){const e=a[t],o=await i(e);null!==o&&(o instanceof HTMLImageElement?r[n.uuid].push(o):r[n.uuid].push(new Rl(o.data,o.width,o.height)))}}else{const t=await i(n.url);null!==t&&(r[n.uuid]=t)}}}return r}parseTextures(t,e){function r(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const n={};if(void 0!==t)for(let i=0,a=t.length;i<a;i++){const a=t[i];let o;void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===e[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const s=e[a.image];Array.isArray(s)?(o=new Hi(s),6===s.length&&(o.needsUpdate=!0)):(o=s&&s.data?new Rl(s.data,s.width,s.height):new vr(s),s&&(o.needsUpdate=!0)),o.uuid=a.uuid,void 0!==a.name&&(o.name=a.name),void 0!==a.mapping&&(o.mapping=r(a.mapping,Ih)),void 0!==a.offset&&o.offset.fromArray(a.offset),void 0!==a.repeat&&o.repeat.fromArray(a.repeat),void 0!==a.center&&o.center.fromArray(a.center),void 0!==a.rotation&&(o.rotation=a.rotation),void 0!==a.wrap&&(o.wrapS=r(a.wrap[0],Lh),o.wrapT=r(a.wrap[1],Lh)),void 0!==a.format&&(o.format=a.format),void 0!==a.type&&(o.type=a.type),void 0!==a.encoding&&(o.encoding=a.encoding),void 0!==a.minFilter&&(o.minFilter=r(a.minFilter,Oh)),void 0!==a.magFilter&&(o.magFilter=r(a.magFilter,Oh)),void 0!==a.anisotropy&&(o.anisotropy=a.anisotropy),void 0!==a.flipY&&(o.flipY=a.flipY),void 0!==a.premultiplyAlpha&&(o.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(o.unpackAlignment=a.unpackAlignment),void 0!==a.userData&&(o.userData=a.userData),n[a.uuid]=o}return n}parseObject(t,e,r,n,i){let a,o,s;function l(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function u(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n];void 0===r[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),e.push(r[i])}return e}return void 0===r[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),r[t]}}function c(t){return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),n[t]}switch(t.type){case"Scene":a=new Qs,void 0!==t.background&&(Number.isInteger(t.background)?a.background=new Xn(t.background):a.background=c(t.background)),void 0!==t.environment&&(a.environment=c(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?a.fog=new Js(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(a.fog=new Ks(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":a=new Gi(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(a.focus=t.focus),void 0!==t.zoom&&(a.zoom=t.zoom),void 0!==t.filmGauge&&(a.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(a.filmOffset=t.filmOffset),void 0!==t.view&&(a.view=Object.assign({},t.view));break;case"OrthographicCamera":a=new ha(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(a.zoom=t.zoom),void 0!==t.view&&(a.view=Object.assign({},t.view));break;case"AmbientLight":a=new Mh(t.color,t.intensity);break;case"DirectionalLight":a=new bh(t.color,t.intensity);break;case"PointLight":a=new _h(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":a=new Sh(t.color,t.intensity,t.width,t.height);break;case"SpotLight":a=new mh(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":a=new uh(t.color,t.groundColor,t.intensity);break;case"LightProbe":a=(new Eh).fromJSON(t);break;case"SkinnedMesh":o=l(t.geometry),s=u(t.material),a=new El(o,s),void 0!==t.bindMode&&(a.bindMode=t.bindMode),void 0!==t.bindMatrix&&a.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(a.skeleton=t.skeleton);break;case"Mesh":o=l(t.geometry),s=u(t.material),a=new Oi(o,s);break;case"InstancedMesh":o=l(t.geometry),s=u(t.material);const e=t.count,r=t.instanceMatrix,n=t.instanceColor;a=new Nl(o,s,e),a.instanceMatrix=new Ll(new Float32Array(r.array),16),void 0!==n&&(a.instanceColor=new Ll(new Float32Array(n.array),n.itemSize));break;case"LOD":a=new _l;break;case"Line":a=new Hl(l(t.geometry),u(t.material));break;case"LineLoop":a=new Yl(l(t.geometry),u(t.material));break;case"LineSegments":a=new Xl(l(t.geometry),u(t.material));break;case"PointCloud":case"Points":a=new tu(l(t.geometry),u(t.material));break;case"Sprite":a=new gl(u(t.material));break;case"Group":a=new js;break;case"Bone":a=new Al;break;default:a=new An}if(a.uuid=t.uuid,void 0!==t.name&&(a.name=t.name),void 0!==t.matrix?(a.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(a.matrixAutoUpdate=t.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(void 0!==t.position&&a.position.fromArray(t.position),void 0!==t.rotation&&a.rotation.fromArray(t.rotation),void 0!==t.quaternion&&a.quaternion.fromArray(t.quaternion),void 0!==t.scale&&a.scale.fromArray(t.scale)),void 0!==t.castShadow&&(a.castShadow=t.castShadow),void 0!==t.receiveShadow&&(a.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(a.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(a.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(a.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&a.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(a.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(a.visible=t.visible),void 0!==t.frustumCulled&&(a.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(a.renderOrder=t.renderOrder),void 0!==t.userData&&(a.userData=t.userData),void 0!==t.layers&&(a.layers.mask=t.layers),void 0!==t.children){const o=t.children;for(let t=0;t<o.length;t++)a.add(this.parseObject(o[t],e,r,n,i))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const r=e[t];a.animations.push(i[r])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(a.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const r=e[t],n=a.getObjectByProperty("uuid",r.object);void 0!==n&&a.addLevel(n,r.distance)}}return a}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const r=e[t.skeleton];void 0===r?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(r,t.bindMatrix)}}))}setTexturePath(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}},ObjectSpaceNormalMap:Ve,OctahedronBufferGeometry:gc,OctahedronGeometry:gc,OneFactor:S,OneMinusDstAlphaFactor:C,OneMinusDstColorFactor:L,OneMinusSrcAlphaFactor:R,OneMinusSrcColorFactor:E,OrthographicCamera:ha,PCFShadowMap:o,PCFSoftShadowMap:s,PMREMGenerator:Pa,ParametricGeometry:function(){return console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),new mi},Particle:function(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new gl(t)},ParticleBasicMaterial:function(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Zl(t)},ParticleSystem:function(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new tu(t,e)},ParticleSystemMaterial:function(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Zl(t)},Path:Fu,PerspectiveCamera:Gi,Plane:Zi,PlaneBufferGeometry:ea,PlaneGeometry:ea,PlaneHelper:class extends Hl{constructor(t,e=1,r=16776960){const n=r,i=new mi;i.setAttribute("position",new oi([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),super(i,new Ul({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const a=new mi;a.setAttribute("position",new oi([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new Oi(a,new Yn({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?c:u,this.lookAt(this.plane.normal),super.updateMatrixWorld(t)}},PointCloud:function(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new tu(t,e)},PointCloudMaterial:function(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Zl(t)},PointLight:_h,PointLightHelper:class extends Oi{constructor(t,e,r){super(new xc(e,4,2),new Yn({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.light.updateMatrixWorld(),this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},Points:tu,PointsMaterial:Zl,PolarGridHelper:class extends Xl{constructor(t=10,e=16,r=8,n=64,i=4473924,a=8947848){i=new Xn(i),a=new Xn(a);const o=[],s=[];for(let r=0;r<=e;r++){const n=r/e*(2*Math.PI),l=Math.sin(n)*t,u=Math.cos(n)*t;o.push(0,0,0),o.push(l,0,u);const c=1&r?i:a;s.push(c.r,c.g,c.b),s.push(c.r,c.g,c.b)}for(let e=0;e<=r;e++){const l=1&e?i:a,u=t-t/r*e;for(let t=0;t<n;t++){let e=t/n*(2*Math.PI),r=Math.sin(e)*u,i=Math.cos(e)*u;o.push(r,0,i),s.push(l.r,l.g,l.b),e=(t+1)/n*(2*Math.PI),r=Math.sin(e)*u,i=Math.cos(e)*u,o.push(r,0,i),s.push(l.r,l.g,l.b)}}const l=new mi;l.setAttribute("position",new oi(o,3)),l.setAttribute("color",new oi(s,3));super(l,new Ul({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},PolyhedronBufferGeometry:lu,PolyhedronGeometry:lu,PositionalAudio:class extends Zh{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,r){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=r,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Kh,Jh,Qh),$h.set(0,0,1).applyQuaternion(Jh);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(Kh.x,t),e.positionY.linearRampToValueAtTime(Kh.y,t),e.positionZ.linearRampToValueAtTime(Kh.z,t),e.orientationX.linearRampToValueAtTime($h.x,t),e.orientationY.linearRampToValueAtTime($h.y,t),e.orientationZ.linearRampToValueAtTime($h.z,t)}else e.setPosition(Kh.x,Kh.y,Kh.z),e.setOrientation($h.x,$h.y,$h.z)}},PropertyBinding:dd,PropertyMixer:ed,QuadraticBezierCurve:Iu,QuadraticBezierCurve3:Lu,Quaternion:Mr,QuaternionKeyframeTrack:Xc,QuaternionLinearInterpolant:qc,REVISION:t,RGBADepthPacking:Ge,RGBAFormat:At,RGBAIntegerFormat:Ut,RGBA_ASTC_10x10_Format:se,RGBA_ASTC_10x5_Format:ie,RGBA_ASTC_10x6_Format:ae,RGBA_ASTC_10x8_Format:oe,RGBA_ASTC_12x10_Format:le,RGBA_ASTC_12x12_Format:ue,RGBA_ASTC_4x4_Format:Kt,RGBA_ASTC_5x4_Format:Jt,RGBA_ASTC_5x5_Format:Qt,RGBA_ASTC_6x5_Format:$t,RGBA_ASTC_6x6_Format:te,RGBA_ASTC_8x5_Format:ee,RGBA_ASTC_8x6_Format:re,RGBA_ASTC_8x8_Format:ne,RGBA_BPTC_Format:ce,RGBA_ETC2_EAC_Format:Zt,RGBA_PVRTC_2BPPV1_Format:qt,RGBA_PVRTC_4BPPV1_Format:Wt,RGBA_S3TC_DXT1_Format:zt,RGBA_S3TC_DXT3_Format:Gt,RGBA_S3TC_DXT5_Format:jt,RGBDEncoding:ze,RGBEEncoding:Ne,RGBEFormat:Ct,RGBFormat:Et,RGBIntegerFormat:Nt,RGBM16Encoding:Be,RGBM7Encoding:Ue,RGB_ETC1_Format:Xt,RGB_ETC2_Format:Yt,RGB_PVRTC_2BPPV1_Format:Ht,RGB_PVRTC_4BPPV1_Format:Vt,RGB_S3TC_DXT1_Format:Bt,RGFormat:kt,RGIntegerFormat:Ft,RawShaderMaterial:da,Ray:tn,Raycaster:class{constructor(t,e,r=0,n=1/0){this.ray=new tn(t,e),this.near=r,this.far=n,this.camera=null,this.layers=new fn,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,r=[]){return _d(t,this,r,e),r.sort(xd),r}intersectObjects(t,e=!0,r=[]){for(let n=0,i=t.length;n<i;n++)_d(t[n],this,r,e);return r.sort(xd),r}},RectAreaLight:Sh,RedFormat:Ot,RedIntegerFormat:Dt,ReinhardToneMapping:X,RepeatWrapping:it,ReplaceStencilOp:7681,ReverseSubtractEquation:_,RingBufferGeometry:vc,RingGeometry:vc,SRGB8_ALPHA8_ASTC_10x10_Format:be,SRGB8_ALPHA8_ASTC_10x5_Format:xe,SRGB8_ALPHA8_ASTC_10x6_Format:_e,SRGB8_ALPHA8_ASTC_10x8_Format:we,SRGB8_ALPHA8_ASTC_12x10_Format:Me,SRGB8_ALPHA8_ASTC_12x12_Format:Se,SRGB8_ALPHA8_ASTC_4x4_Format:he,SRGB8_ALPHA8_ASTC_5x4_Format:de,SRGB8_ALPHA8_ASTC_5x5_Format:fe,SRGB8_ALPHA8_ASTC_6x5_Format:pe,SRGB8_ALPHA8_ASTC_6x6_Format:me,SRGB8_ALPHA8_ASTC_8x5_Format:ge,SRGB8_ALPHA8_ASTC_8x6_Format:ve,SRGB8_ALPHA8_ASTC_8x8_Format:ye,Scene:Qs,SceneUtils:Jd,ShaderChunk:ra,ShaderLib:ia,ShaderMaterial:Bi,ShadowMaterial:Ac,Shape:Nu,ShapeBufferGeometry:yc,ShapeGeometry:yc,ShapePath:class{constructor(){this.type="ShapePath",this.color=new Xn,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new Fu,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,r,n){return this.currentPath.quadraticCurveTo(t,e,r,n),this}bezierCurveTo(t,e,r,n,i,a){return this.currentPath.bezierCurveTo(t,e,r,n,i,a),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t,e){function r(t){const e=[];for(let r=0,n=t.length;r<n;r++){const n=t[r],i=new Nu;i.curves=n.curves,e.push(i)}return e}function n(t,e){const r=e.length;let n=!1;for(let i=r-1,a=0;a<r;i=a++){let r=e[i],o=e[a],s=o.x-r.x,l=o.y-r.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(r=e[a],s=-s,o=e[i],l=-l),t.y<r.y||t.y>o.y)continue;if(t.y===r.y){if(t.x===r.x)return!0}else{const e=l*(t.x-r.x)-s*(t.y-r.y);if(0===e)return!0;if(e<0)continue;n=!n}}else{if(t.y!==r.y)continue;if(o.x<=t.x&&t.x<=r.x||r.x<=t.x&&t.x<=o.x)return!0}}return n}const i=uc.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===e)return r(a);let o,s,l;const u=[];if(1===a.length)return s=a[0],l=new Nu,l.curves=s.curves,u.push(l),u;let c=!i(a[0].getPoints());c=t?!c:c;const h=[],d=[];let f,p,m=[],g=0;d[g]=void 0,m[g]=[];for(let e=0,r=a.length;e<r;e++)s=a[e],f=s.getPoints(),o=i(f),o=t?!o:o,o?(!c&&d[g]&&g++,d[g]={s:new Nu,p:f},d[g].s.curves=s.curves,c&&g++,m[g]=[]):m[g].push({h:s,p:f[0]});if(!d[0])return r(a);if(d.length>1){let t=!1;const e=[];for(let t=0,e=d.length;t<e;t++)h[t]=[];for(let r=0,i=d.length;r<i;r++){const i=m[r];for(let a=0;a<i.length;a++){const o=i[a];let s=!0;for(let i=0;i<d.length;i++)n(o.p,d[i].p)&&(r!==i&&e.push({froms:r,tos:i,hole:a}),s?(s=!1,h[i].push(o)):t=!0);s&&h[r].push(o)}}e.length>0&&(t||(m=h))}for(let t=0,e=d.length;t<e;t++){l=d[t].s,u.push(l),p=m[t];for(let t=0,e=p.length;t<e;t++)l.holes.push(p[t].h)}return u}},ShapeUtils:uc,ShortType:mt,Skeleton:Il,SkeletonHelper:Id,SkinnedMesh:El,SmoothShading:2,Sphere:qr,SphereBufferGeometry:xc,SphereGeometry:xc,Spherical:wd,SphericalHarmonics3:Th,SplineCurve:Ou,SpotLight:mh,SpotLightHelper:class extends An{constructor(t,e){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const r=new mi,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,r=32;t<r;t++,e++){const i=t/r*Math.PI*2,a=e/r*Math.PI*2;n.push(Math.cos(i),Math.sin(i),1,Math.cos(a),Math.sin(a),1)}r.setAttribute("position",new oi(n,3));const i=new Ul({fog:!1,toneMapped:!1});this.cone=new Xl(r,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Ad.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Ad),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Sprite:gl,SpriteMaterial:rl,SrcAlphaFactor:A,SrcAlphaSaturateFactor:O,SrcColorFactor:T,StaticCopyUsage:35046,StaticDrawUsage:We,StaticReadUsage:35045,StereoCamera:class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Gi,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Gi,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,jh.copy(t.projectionMatrix);const r=e.eyeSep/2,n=r*e.near/e.focus,i=e.near*Math.tan(Je*e.fov*.5)/e.zoom;let a,o;Gh.elements[12]=-r,zh.elements[12]=r,a=-i*e.aspect+n,o=i*e.aspect+n,jh.elements[0]=2*e.near/(o-a),jh.elements[8]=(o+a)/(o-a),this.cameraL.projectionMatrix.copy(jh),a=-i*e.aspect-n,o=i*e.aspect-n,jh.elements[0]=2*e.near/(o-a),jh.elements[8]=(o+a)/(o-a),this.cameraR.projectionMatrix.copy(jh)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Gh),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(zh)}},StreamCopyUsage:35042,StreamDrawUsage:35040,StreamReadUsage:35041,StringKeyframeTrack:Yc,SubtractEquation:x,SubtractiveBlending:m,TOUCH:r,TangentSpaceNormalMap:je,TetrahedronBufferGeometry:_c,TetrahedronGeometry:_c,TextGeometry:function(){return console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),new mi},Texture:vr,TextureLoader:sh,TorusBufferGeometry:wc,TorusGeometry:wc,TorusKnotBufferGeometry:bc,TorusKnotGeometry:bc,Triangle:Un,TriangleFanDrawMode:Oe,TriangleStripDrawMode:1,TrianglesDrawMode:0,TubeBufferGeometry:Mc,TubeGeometry:Mc,UVMapping:J,Uint16Attribute:function(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new ri(t,e)},Uint16BufferAttribute:ri,Uint32Attribute:function(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new ii(t,e)},Uint32BufferAttribute:ii,Uint8Attribute:function(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new $n(t,e)},Uint8BufferAttribute:$n,Uint8ClampedAttribute:function(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new ti(t,e)},Uint8ClampedBufferAttribute:ti,Uniform:gd,UniformsLib:na,UniformsUtils:Ui,UnsignedByteType:ft,UnsignedInt248Type:St,UnsignedIntType:yt,UnsignedShort4444Type:wt,UnsignedShort5551Type:bt,UnsignedShort565Type:Mt,UnsignedShortType:gt,VSMShadowMap:l,Vector2:sr,Vector3:Sr,Vector4:xr,VectorKeyframeTrack:Zc,Vertex:function(t,e,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Sr(t,e,r)},VertexColors:2,VideoTexture:ru,WebGL1Renderer:Zs,WebGLCubeRenderTarget:Wi,WebGLMultipleRenderTargets:wr,WebGLMultisampleRenderTarget:br,WebGLRenderTarget:_r,WebGLRenderTargetCube:function(t,e,r){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Wi(t,r)},WebGLRenderer:Ys,WebGLUtils:zs,WireframeGeometry:Sc,WireframeHelper:function(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Xl(new Sc(t.geometry),new Ul({color:void 0!==e?e:16777215}))},WrapAroundEnding:Ce,XHRLoader:function(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new nh(t)},ZeroCurvatureEnding:Re,ZeroFactor:M,ZeroSlopeEnding:Pe,ZeroStencilOp:0,sRGBEncoding:ke},Symbol.toStringTag,{value:"Module"})),$d={type:"change"},tf={type:"start"},ef={type:"end"};class rf extends Ye{constructor(t,n){super(),void 0===n&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Sr,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:e.ROTATE,MIDDLE:e.DOLLY,RIGHT:e.PAN},this.touches={ONE:r.ROTATE,TWO:r.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",W),this._domElementKeyEvents=t},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent($d),i.update(),o=a.NONE},this.update=function(){const e=new Sr,r=(new Mr).setFromUnitVectors(t.up,new Sr(0,1,0)),n=r.clone().invert(),f=new Sr,p=new Mr,m=2*Math.PI;return function(){const t=i.object.position;e.copy(t).sub(i.target),e.applyQuaternion(r),l.setFromVector3(e),i.autoRotate&&o===a.NONE&&T(2*Math.PI/60/60*i.autoRotateSpeed),i.enableDamping?(l.theta+=u.theta*i.dampingFactor,l.phi+=u.phi*i.dampingFactor):(l.theta+=u.theta,l.phi+=u.phi);let g=i.minAzimuthAngle,v=i.maxAzimuthAngle;return isFinite(g)&&isFinite(v)&&(g<-Math.PI?g+=m:g>Math.PI&&(g-=m),v<-Math.PI?v+=m:v>Math.PI&&(v-=m),l.theta=g<=v?Math.max(g,Math.min(v,l.theta)):l.theta>(g+v)/2?Math.max(g,l.theta):Math.min(v,l.theta)),l.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,l.phi)),l.makeSafe(),l.radius*=c,l.radius=Math.max(i.minDistance,Math.min(i.maxDistance,l.radius)),!0===i.enableDamping?i.target.addScaledVector(h,i.dampingFactor):i.target.add(h),e.setFromSpherical(l),e.applyQuaternion(n),t.copy(i.target).add(e),i.object.lookAt(i.target),!0===i.enableDamping?(u.theta*=1-i.dampingFactor,u.phi*=1-i.dampingFactor,h.multiplyScalar(1-i.dampingFactor)):(u.set(0,0,0),h.set(0,0,0)),c=1,!!(d||f.distanceToSquared(i.object.position)>s||8*(1-p.dot(i.object.quaternion))>s)&&(i.dispatchEvent($d),f.copy(i.object.position),p.copy(i.object.quaternion),d=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",q),i.domElement.removeEventListener("pointerdown",z),i.domElement.removeEventListener("pointercancel",V),i.domElement.removeEventListener("wheel",H),i.domElement.removeEventListener("pointermove",G),i.domElement.removeEventListener("pointerup",j),null!==i._domElementKeyEvents&&i._domElementKeyEvents.removeEventListener("keydown",W)};const i=this,a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=a.NONE;const s=1e-6,l=new wd,u=new wd;let c=1;const h=new Sr;let d=!1;const f=new sr,p=new sr,m=new sr,g=new sr,v=new sr,y=new sr,x=new sr,_=new sr,w=new sr,b=[],M={};function S(){return Math.pow(.95,i.zoomSpeed)}function T(t){u.theta-=t}function E(t){u.phi-=t}const A=function(){const t=new Sr;return function(e,r){t.setFromMatrixColumn(r,0),t.multiplyScalar(-e),h.add(t)}}(),R=function(){const t=new Sr;return function(e,r){!0===i.screenSpacePanning?t.setFromMatrixColumn(r,1):(t.setFromMatrixColumn(r,0),t.crossVectors(i.object.up,t)),t.multiplyScalar(e),h.add(t)}}(),P=function(){const t=new Sr;return function(e,r){const n=i.domElement;if(i.object.isPerspectiveCamera){const a=i.object.position;t.copy(a).sub(i.target);let o=t.length();o*=Math.tan(i.object.fov/2*Math.PI/180),A(2*e*o/n.clientHeight,i.object.matrix),R(2*r*o/n.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(A(e*(i.object.right-i.object.left)/i.object.zoom/n.clientWidth,i.object.matrix),R(r*(i.object.top-i.object.bottom)/i.object.zoom/n.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function C(t){i.object.isPerspectiveCamera?c/=t:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*t)),i.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function I(t){i.object.isPerspectiveCamera?c*=t:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/t)),i.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function L(t){f.set(t.clientX,t.clientY)}function O(t){g.set(t.clientX,t.clientY)}function D(){if(1===b.length)f.set(b[0].pageX,b[0].pageY);else{const t=.5*(b[0].pageX+b[1].pageX),e=.5*(b[0].pageY+b[1].pageY);f.set(t,e)}}function k(){if(1===b.length)g.set(b[0].pageX,b[0].pageY);else{const t=.5*(b[0].pageX+b[1].pageX),e=.5*(b[0].pageY+b[1].pageY);g.set(t,e)}}function F(){const t=b[0].pageX-b[1].pageX,e=b[0].pageY-b[1].pageY,r=Math.sqrt(t*t+e*e);x.set(0,r)}function N(t){if(1==b.length)p.set(t.pageX,t.pageY);else{const e=Z(t),r=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);p.set(r,n)}m.subVectors(p,f).multiplyScalar(i.rotateSpeed);const e=i.domElement;T(2*Math.PI*m.x/e.clientHeight),E(2*Math.PI*m.y/e.clientHeight),f.copy(p)}function U(t){if(1===b.length)v.set(t.pageX,t.pageY);else{const e=Z(t),r=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);v.set(r,n)}y.subVectors(v,g).multiplyScalar(i.panSpeed),P(y.x,y.y),g.copy(v)}function B(t){const e=Z(t),r=t.pageX-e.x,n=t.pageY-e.y,a=Math.sqrt(r*r+n*n);_.set(0,a),w.set(0,Math.pow(_.y/x.y,i.zoomSpeed)),C(w.y),x.copy(_)}function z(t){!1!==i.enabled&&(0===b.length&&(i.domElement.setPointerCapture(t.pointerId),i.domElement.addEventListener("pointermove",G),i.domElement.addEventListener("pointerup",j)),function(t){b.push(t)}(t),"touch"===t.pointerType?function(t){switch(Y(t),b.length){case 1:switch(i.touches.ONE){case r.ROTATE:if(!1===i.enableRotate)return;D(),o=a.TOUCH_ROTATE;break;case r.PAN:if(!1===i.enablePan)return;k(),o=a.TOUCH_PAN;break;default:o=a.NONE}break;case 2:switch(i.touches.TWO){case r.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;i.enableZoom&&F(),i.enablePan&&k(),o=a.TOUCH_DOLLY_PAN;break;case r.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.enableZoom&&F(),i.enableRotate&&D(),o=a.TOUCH_DOLLY_ROTATE;break;default:o=a.NONE}break;default:o=a.NONE}o!==a.NONE&&i.dispatchEvent(tf)}(t):function(t){let r;switch(t.button){case 0:r=i.mouseButtons.LEFT;break;case 1:r=i.mouseButtons.MIDDLE;break;case 2:r=i.mouseButtons.RIGHT;break;default:r=-1}switch(r){case e.DOLLY:if(!1===i.enableZoom)return;!function(t){x.set(t.clientX,t.clientY)}(t),o=a.DOLLY;break;case e.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===i.enablePan)return;O(t),o=a.PAN}else{if(!1===i.enableRotate)return;L(t),o=a.ROTATE}break;case e.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===i.enableRotate)return;L(t),o=a.ROTATE}else{if(!1===i.enablePan)return;O(t),o=a.PAN}break;default:o=a.NONE}o!==a.NONE&&i.dispatchEvent(tf)}(t))}function G(t){!1!==i.enabled&&("touch"===t.pointerType?function(t){switch(Y(t),o){case a.TOUCH_ROTATE:if(!1===i.enableRotate)return;N(t),i.update();break;case a.TOUCH_PAN:if(!1===i.enablePan)return;U(t),i.update();break;case a.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(t){i.enableZoom&&B(t),i.enablePan&&U(t)}(t),i.update();break;case a.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(t){i.enableZoom&&B(t),i.enableRotate&&N(t)}(t),i.update();break;default:o=a.NONE}}(t):function(t){if(!1===i.enabled)return;switch(o){case a.ROTATE:if(!1===i.enableRotate)return;!function(t){p.set(t.clientX,t.clientY),m.subVectors(p,f).multiplyScalar(i.rotateSpeed);const e=i.domElement;T(2*Math.PI*m.x/e.clientHeight),E(2*Math.PI*m.y/e.clientHeight),f.copy(p),i.update()}(t);break;case a.DOLLY:if(!1===i.enableZoom)return;!function(t){_.set(t.clientX,t.clientY),w.subVectors(_,x),w.y>0?C(S()):w.y<0&&I(S()),x.copy(_),i.update()}(t);break;case a.PAN:if(!1===i.enablePan)return;!function(t){v.set(t.clientX,t.clientY),y.subVectors(v,g).multiplyScalar(i.panSpeed),P(y.x,y.y),g.copy(v),i.update()}(t)}}(t))}function j(t){X(t),0===b.length&&(i.domElement.releasePointerCapture(t.pointerId),i.domElement.removeEventListener("pointermove",G),i.domElement.removeEventListener("pointerup",j)),i.dispatchEvent(ef),o=a.NONE}function V(t){X(t)}function H(t){!1!==i.enabled&&!1!==i.enableZoom&&o===a.NONE&&(t.preventDefault(),i.dispatchEvent(tf),function(t){t.deltaY<0?I(S()):t.deltaY>0&&C(S()),i.update()}(t),i.dispatchEvent(ef))}function W(t){!1!==i.enabled&&!1!==i.enablePan&&function(t){let e=!1;switch(t.code){case i.keys.UP:P(0,i.keyPanSpeed),e=!0;break;case i.keys.BOTTOM:P(0,-i.keyPanSpeed),e=!0;break;case i.keys.LEFT:P(i.keyPanSpeed,0),e=!0;break;case i.keys.RIGHT:P(-i.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),i.update())}(t)}function q(t){!1!==i.enabled&&t.preventDefault()}function X(t){delete M[t.pointerId];for(let e=0;e<b.length;e++)if(b[e].pointerId==t.pointerId)return void b.splice(e,1)}function Y(t){let e=M[t.pointerId];void 0===e&&(e=new sr,M[t.pointerId]=e),e.set(t.pageX,t.pageY)}function Z(t){const e=t.pointerId===b[0].pointerId?b[1]:b[0];return M[e.pointerId]}i.domElement.addEventListener("contextmenu",q),i.domElement.addEventListener("pointerdown",z),i.domElement.addEventListener("pointercancel",V),i.domElement.addEventListener("wheel",H,{passive:!1}),this.update()}}class nf extends rf{constructor(t,n){super(t,n),this.screenSpacePanning=!1,this.mouseButtons.LEFT=e.PAN,this.mouseButtons.RIGHT=e.ROTATE,this.touches.ONE=r.PAN,this.touches.TWO=r.DOLLY_ROTATE}}var af="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function of(t){if(t.__esModule)return t;var e=t.default;if("function"==typeof e){var r=function t(){if(this instanceof t){var r=[null];return r.push.apply(r,arguments),new(Function.bind.apply(e,r))}return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var n=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(r,e,n.get?n:{enumerable:!0,get:function(){return t[e]}})})),r}var sf,lf={},uf={};(sf={get exports(){return uf},set exports(t){uf=t}}).exports=function(t){return t&&t.__esModule?t:{default:t}},sf.exports.__esModule=!0,sf.exports.default=sf.exports;var cf={};!function(t){function e(r){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}({get exports(){return cf},set exports(t){cf=t}});var hf,df={},ff={get exports(){return df},set exports(t){df=t}};function pf(){return hf||(hf=1,function(t){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports}(ff)),df}var mf,gf={},vf={get exports(){return gf},set exports(t){gf=t}};function yf(){return mf||(mf=1,function(t){function e(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports}(vf)),gf}var xf,_f={},wf={get exports(){return _f},set exports(t){_f=t}};function bf(){return xf||(xf=1,function(t){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.__esModule=!0,t.exports.default=t.exports}(wf)),_f}var Mf,Sf,Tf={},Ef={get exports(){return Tf},set exports(t){Tf=t}},Af={},Rf={get exports(){return Af},set exports(t){Af=t}};function Pf(){return Mf||(Mf=1,function(t){function e(r,n){return t.exports=e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},t.exports.__esModule=!0,t.exports.default=t.exports,e(r,n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(Rf)),Af}function Cf(){return Sf||(Sf=1,function(t){var e=Pf();t.exports=function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&e(t,r)},t.exports.__esModule=!0,t.exports.default=t.exports}(Ef)),Tf}var If,Lf={},Of={get exports(){return Lf},set exports(t){Lf=t}};function Df(){return If||(If=1,function(t){var e=cf.default,r=bf();t.exports=function(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return r(t)},t.exports.__esModule=!0,t.exports.default=t.exports}(Of)),Lf}var kf,Ff={},Nf={get exports(){return Ff},set exports(t){Ff=t}};function Uf(){return kf||(kf=1,function(t){function e(r){return t.exports=e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},t.exports.__esModule=!0,t.exports.default=t.exports,e(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(Nf)),Ff}const Bf=of(Qd);var zf=1,Gf=2,jf=3,Vf=4,Hf=5,Wf=6378137,qf=6356752.314,Xf=.0066943799901413165,Yf=484813681109536e-20,Zf=Math.PI/2,Kf=.16666666666666666,Jf=.04722222222222222,Qf=.022156084656084655,$f=1e-10,tp=.017453292519943295,ep=57.29577951308232,rp=Math.PI/4,np=2*Math.PI,ip=3.14159265359,ap={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};const op={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var sp=/[\s_\-\/\(\)]/g;function lp(t,e){if(t[e])return t[e];for(var r,n=Object.keys(t),i=e.toLowerCase().replace(sp,""),a=-1;++a<n.length;)if((r=n[a]).toLowerCase().replace(sp,"")===i)return t[r]}function up(t){var e,r,n,i={},a=t.split("+").map((function(t){return t.trim()})).filter((function(t){return t})).reduce((function(t,e){var r=e.split("=");return r.push(!0),t[r[0].toLowerCase()]=r[1],t}),{}),o={proj:"projName",datum:"datumCode",rf:function(t){i.rf=parseFloat(t)},lat_0:function(t){i.lat0=t*tp},lat_1:function(t){i.lat1=t*tp},lat_2:function(t){i.lat2=t*tp},lat_ts:function(t){i.lat_ts=t*tp},lon_0:function(t){i.long0=t*tp},lon_1:function(t){i.long1=t*tp},lon_2:function(t){i.long2=t*tp},alpha:function(t){i.alpha=parseFloat(t)*tp},gamma:function(t){i.rectified_grid_angle=parseFloat(t)},lonc:function(t){i.longc=t*tp},x_0:function(t){i.x0=parseFloat(t)},y_0:function(t){i.y0=parseFloat(t)},k_0:function(t){i.k0=parseFloat(t)},k:function(t){i.k0=parseFloat(t)},a:function(t){i.a=parseFloat(t)},b:function(t){i.b=parseFloat(t)},r_a:function(){i.R_A=!0},zone:function(t){i.zone=parseInt(t,10)},south:function(){i.utmSouth=!0},towgs84:function(t){i.datum_params=t.split(",").map((function(t){return parseFloat(t)}))},to_meter:function(t){i.to_meter=parseFloat(t)},units:function(t){i.units=t;var e=lp(op,t);e&&(i.to_meter=e.to_meter)},from_greenwich:function(t){i.from_greenwich=t*tp},pm:function(t){var e=lp(ap,t);i.from_greenwich=(e||parseFloat(t))*tp},nadgrids:function(t){"@null"===t?i.datumCode="none":i.nadgrids=t},axis:function(t){var e="ewnsud";3===t.length&&-1!==e.indexOf(t.substr(0,1))&&-1!==e.indexOf(t.substr(1,1))&&-1!==e.indexOf(t.substr(2,1))&&(i.axis=t)},approx:function(){i.approx=!0}};for(e in a)r=a[e],e in o?"function"==typeof(n=o[e])?n(r):i[n]=r:i[e]=r;return"string"==typeof i.datumCode&&"WGS84"!==i.datumCode&&(i.datumCode=i.datumCode.toLowerCase()),i}var cp=1,hp=/\s/,dp=/[A-Za-z]/,fp=/[A-Za-z84_]/,pp=/[,\]]/,mp=/[\d\.E\-\+]/;function gp(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=cp}function vp(t,e,r){Array.isArray(e)&&(r.unshift(e),e=null);var n=e?{}:t,i=r.reduce((function(t,e){return yp(e,t),t}),n);e&&(t[e]=i)}function yp(t,e){if(Array.isArray(t)){var r=t.shift();if("PARAMETER"===r&&(r=t.shift()),1===t.length)return Array.isArray(t[0])?(e[r]={},void yp(t[0],e[r])):void(e[r]=t[0]);if(t.length)if("TOWGS84"!==r){if("AXIS"===r)return r in e||(e[r]=[]),void e[r].push(t);var n;switch(Array.isArray(r)||(e[r]={}),r){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[r]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&yp(t[2],e[r]));case"SPHEROID":case"ELLIPSOID":return e[r]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&yp(t[3],e[r]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void vp(e,r,t);default:for(n=-1;++n<t.length;)if(!Array.isArray(t[n]))return yp(t,e[r]);return vp(e,r,t)}}else e[r]=t;else e[r]=!0}else e[t]=!0}gp.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;hp.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case cp:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},gp.prototype.afterquote=function(t){if('"'===t)return this.word+='"',void(this.state=4);if(pp.test(t))return this.word=this.word.trim(),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place)},gp.prototype.afterItem=function(t){return","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=cp)):"]"===t?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=cp,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},gp.prototype.number=function(t){if(!mp.test(t)){if(pp.test(t))return this.word=parseFloat(this.word),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in number yet, index '+this.place)}this.word+=t},gp.prototype.quoted=function(t){'"'!==t?this.word+=t:this.state=5},gp.prototype.keyword=function(t){if(fp.test(t))this.word+=t;else{if("["===t){var e=[];return e.push(this.word),this.level++,null===this.root?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=cp)}if(!pp.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},gp.prototype.neutral=function(t){if(dp.test(t))return this.word=t,void(this.state=2);if('"'===t)return this.word="",void(this.state=4);if(mp.test(t))return this.word=t,void(this.state=3);if(!pp.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)},gp.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var xp,_p=.017453292519943295;function wp(t){return t*_p}function bp(t){var e=new gp(t).output(),r=e.shift(),n=e.shift();e.unshift(["name",n]),e.unshift(["type",r]);var i={};return yp(e,i),function(t){if("GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var e="",r=0,n=t.AXIS.length;r<n;++r){var i=[t.AXIS[r][0].toLowerCase(),t.AXIS[r][1].toLowerCase()];-1!==i[0].indexOf("north")||("y"===i[0]||"lat"===i[0])&&"north"===i[1]?e+="n":-1!==i[0].indexOf("south")||("y"===i[0]||"lat"===i[0])&&"south"===i[1]?e+="s":-1!==i[0].indexOf("east")||("x"===i[0]||"lon"===i[0])&&"east"===i[1]?e+="e":-1===i[0].indexOf("west")&&("x"!==i[0]&&"lon"!==i[0]||"west"!==i[1])||(e+="w")}2===e.length&&(e+="u"),3===e.length&&(t.axis=e)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var a=t.GEOGCS;function o(e){return e*(t.to_meter||1)}"GEOGCS"===t.type&&(a=t),a&&(a.DATUM?t.datumCode=a.DATUM.name.toLowerCase():t.datumCode=a.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"!==t.datumCode&&"world_geodetic_system_1984"!==t.datumCode||("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),a.DATUM&&a.DATUM.SPHEROID&&(t.ellps=a.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=a.DATUM.SPHEROID.a,t.rf=parseFloat(a.DATUM.SPHEROID.rf,10)),a.DATUM&&a.DATUM.TOWGS84&&(t.datum_params=a.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),"ch1903+"===t.datumCode&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",wp],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",wp],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",wp],["lat0","latitude_of_origin",wp],["lat0","standard_parallel_1",wp],["lat1","standard_parallel_1",wp],["lat2","standard_parallel_2",wp],["azimuth","Azimuth"],["alpha","azimuth",wp],["srsCode","name"]].forEach((function(e){return r=t,i=(n=e)[0],a=n[1],void(!(i in r)&&a in r&&(r[i]=r[a],3===n.length&&(r[i]=n[2](r[i]))));var r,n,i,a})),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName||(t.lat0=wp(t.lat1>0?90:-90),t.lat_ts=t.lat1)}(i),i}function Mp(t){var e=this;if(2===arguments.length){var r=arguments[1];"string"==typeof r?"+"===r.charAt(0)?Mp[t]=up(arguments[1]):Mp[t]=bp(arguments[1]):Mp[t]=r}else if(1===arguments.length){if(Array.isArray(t))return t.map((function(t){Array.isArray(t)?Mp.apply(e,t):Mp(t)}));if("string"==typeof t){if(t in Mp)return Mp[t]}else"EPSG"in t?Mp["EPSG:"+t.EPSG]=t:"ESRI"in t?Mp["ESRI:"+t.ESRI]=t:"IAU2000"in t?Mp["IAU2000:"+t.IAU2000]=t:console.log(t);return}}(xp=Mp)("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),xp("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),xp("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),xp.WGS84=xp["EPSG:4326"],xp["EPSG:3785"]=xp["EPSG:3857"],xp.GOOGLE=xp["EPSG:3857"],xp["EPSG:900913"]=xp["EPSG:3857"],xp["EPSG:102113"]=xp["EPSG:3857"];var Sp=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];var Tp=["3857","900913","3785","102113"];function Ep(t){if(!function(t){return"string"==typeof t}(t))return t;if(function(t){return t in Mp}(t))return Mp[t];if(function(t){return Sp.some((function(e){return t.indexOf(e)>-1}))}(t)){var e=bp(t);if(function(t){var e=lp(t,"authority");if(e){var r=lp(e,"epsg");return r&&Tp.indexOf(r)>-1}}(e))return Mp["EPSG:3857"];var r=function(t){var e=lp(t,"extension");if(e)return lp(e,"proj4")}(e);return r?up(r):e}return function(t){return"+"===t[0]}(t)?up(t):void 0}function Ap(t,e){var r,n;if(t=t||{},!e)return t;for(n in e)void 0!==(r=e[n])&&(t[n]=r);return t}function Rp(t,e,r){var n=t*e;return r/Math.sqrt(1-n*n)}function Pp(t){return t<0?-1:1}function Cp(t){return Math.abs(t)<=ip?t:t-Pp(t)*np}function Ip(t,e,r){var n=t*r,i=.5*t;return n=Math.pow((1-n)/(1+n),i),Math.tan(.5*(Zf-e))/n}function Lp(t,e){for(var r,n,i=.5*t,a=Zf-2*Math.atan(e),o=0;o<=15;o++)if(r=t*Math.sin(a),a+=n=Zf-2*Math.atan(e*Math.pow((1-r)/(1+r),i))-a,Math.abs(n)<=1e-10)return a;return-9999}function Op(t){return t}var Dp=[{init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Rp(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(t){var e,r,n=t.x,i=t.y;if(i*ep>90&&i*ep<-90&&n*ep>180&&n*ep<-180)return null;if(Math.abs(Math.abs(i)-Zf)<=$f)return null;if(this.sphere)e=this.x0+this.a*this.k0*Cp(n-this.long0),r=this.y0+this.a*this.k0*Math.log(Math.tan(rp+.5*i));else{var a=Math.sin(i),o=Ip(this.e,i,a);e=this.x0+this.a*this.k0*Cp(n-this.long0),r=this.y0-this.a*this.k0*Math.log(o)}return t.x=e,t.y=r,t},inverse:function(t){var e,r,n=t.x-this.x0,i=t.y-this.y0;if(this.sphere)r=Zf-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var a=Math.exp(-i/(this.a*this.k0));if(-9999===(r=Lp(this.e,a)))return null}return e=Cp(this.long0+n/(this.a*this.k0)),t.x=e,t.y=r,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:Op,inverse:Op,names:["longlat","identity"]}],kp={},Fp=[];function Np(t,e){var r=Fp.length;return t.names?(Fp[r]=t,t.names.forEach((function(t){kp[t.toLowerCase()]=r})),this):(console.log(e),!0)}const Up={start:function(){Dp.forEach(Np)},add:Np,get:function(t){if(!t)return!1;var e=t.toLowerCase();return void 0!==kp[e]&&Fp[kp[e]]?Fp[kp[e]]:void 0}};var Bp={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},zp=Bp.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};Bp.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var Gp={};Gp.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},Gp.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},Gp.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},Gp.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},Gp.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},Gp.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},Gp.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},Gp.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},Gp.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},Gp.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},Gp.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},Gp.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},Gp.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},Gp.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},Gp.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},Gp.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},Gp.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};var jp={};function Vp(t){if(0===t.length)return null;var e="@"===t[0];return e&&(t=t.slice(1)),"null"===t?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:t,mandatory:!e,grid:jp[t]||null,isNull:!1}}function Hp(t){return t/3600*Math.PI/180}function Wp(t,e,r){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(e,r)))}function qp(t){return t.map((function(t){return[Hp(t.longitudeShift),Hp(t.latitudeShift)]}))}function Xp(t,e,r){return{name:Wp(t,e+8,e+16).trim(),parent:Wp(t,e+24,e+24+8).trim(),lowerLatitude:t.getFloat64(e+72,r),upperLatitude:t.getFloat64(e+88,r),lowerLongitude:t.getFloat64(e+104,r),upperLongitude:t.getFloat64(e+120,r),latitudeInterval:t.getFloat64(e+136,r),longitudeInterval:t.getFloat64(e+152,r),gridNodeCount:t.getInt32(e+168,r)}}function Yp(t,e,r,n){for(var i=e+176,a=[],o=0;o<r.gridNodeCount;o++){var s={latitudeShift:t.getFloat32(i+16*o,n),longitudeShift:t.getFloat32(i+16*o+4,n),latitudeAccuracy:t.getFloat32(i+16*o+8,n),longitudeAccuracy:t.getFloat32(i+16*o+12,n)};a.push(s)}return a}function Zp(t,e){if(!(this instanceof Zp))return new Zp(t);e=e||function(t){if(t)throw t};var r=Ep(t);if("object"==typeof r){var n=Zp.projections.get(r.projName);if(n){if(r.datumCode&&"none"!==r.datumCode){var i=lp(Gp,r.datumCode);i&&(r.datum_params=r.datum_params||(i.towgs84?i.towgs84.split(","):null),r.ellps=i.ellipse,r.datumName=i.datumName?i.datumName:r.datumCode)}r.k0=r.k0||1,r.axis=r.axis||"enu",r.ellps=r.ellps||"wgs84",r.lat1=r.lat1||r.lat0;var a,o,s,l,u,c,h,d=function(t,e,r,n,i){if(!t){var a=lp(Bp,n);a||(a=zp),t=a.a,e=a.b,r=a.rf}return r&&!e&&(e=(1-1/r)*t),(0===r||Math.abs(t-e)<$f)&&(i=!0,e=t),{a:t,b:e,rf:r,sphere:i}}(r.a,r.b,r.rf,r.ellps,r.sphere),f=(a=d.a,o=d.b,d.rf,s=r.R_A,c=((l=a*a)-(u=o*o))/l,h=0,s?(l=(a*=1-c*(Kf+c*(Jf+c*Qf)))*a,c=0):h=Math.sqrt(c),{es:c,e:h,ep2:(l-u)/u}),p=function(t){return void 0===t?null:t.split(",").map(Vp)}(r.nadgrids),m=r.datum||function(t,e,r,n,i,a,o){var s={};return s.datum_type=void 0===t||"none"===t?Hf:Vf,e&&(s.datum_params=e.map(parseFloat),0===s.datum_params[0]&&0===s.datum_params[1]&&0===s.datum_params[2]||(s.datum_type=zf),s.datum_params.length>3&&(0===s.datum_params[3]&&0===s.datum_params[4]&&0===s.datum_params[5]&&0===s.datum_params[6]||(s.datum_type=Gf,s.datum_params[3]*=Yf,s.datum_params[4]*=Yf,s.datum_params[5]*=Yf,s.datum_params[6]=s.datum_params[6]/1e6+1))),o&&(s.datum_type=jf,s.grids=o),s.a=r,s.b=n,s.es=i,s.ep2=a,s}(r.datumCode,r.datum_params,d.a,d.b,f.es,f.ep2,p);Ap(this,r),Ap(this,n),this.a=d.a,this.b=d.b,this.rf=d.rf,this.sphere=d.sphere,this.es=f.es,this.e=f.e,this.ep2=f.ep2,this.datum=m,this.init(),e(null,this)}else e(t)}else e(t)}function Kp(t,e,r){var n,i,a,o,s=t.x,l=t.y,u=t.z?t.z:0;if(l<-Zf&&l>-1.001*Zf)l=-Zf;else if(l>Zf&&l<1.001*Zf)l=Zf;else{if(l<-Zf)return{x:-1/0,y:-1/0,z:t.z};if(l>Zf)return{x:1/0,y:1/0,z:t.z}}return s>Math.PI&&(s-=2*Math.PI),i=Math.sin(l),o=Math.cos(l),a=i*i,{x:((n=r/Math.sqrt(1-e*a))+u)*o*Math.cos(s),y:(n+u)*o*Math.sin(s),z:(n*(1-e)+u)*i}}function Jp(t,e,r,n){var i,a,o,s,l,u,c,h,d,f,p,m,g,v,y,x=1e-12,_=t.x,w=t.y,b=t.z?t.z:0;if(i=Math.sqrt(_*_+w*w),a=Math.sqrt(_*_+w*w+b*b),i/r<x){if(v=0,a/r<x)return Zf,y=-n,{x:t.x,y:t.y,z:t.z}}else v=Math.atan2(w,_);o=b/a,h=(s=i/a)*(1-e)*(l=1/Math.sqrt(1-e*(2-e)*s*s)),d=o*l,g=0;do{g++,u=e*(c=r/Math.sqrt(1-e*d*d))/(c+(y=i*h+b*d-c*(1-e*d*d))),m=(p=o*(l=1/Math.sqrt(1-u*(2-u)*s*s)))*h-(f=s*(1-u)*l)*d,h=f,d=p}while(m*m>1e-24&&g<30);return{x:v,y:Math.atan(p/Math.abs(f)),z:y}}function Qp(t){return t===zf||t===Gf}function $p(t,e,r){if(function(t,e){return t.datum_type===e.datum_type&&!(t.a!==e.a||Math.abs(t.es-e.es)>5e-11)&&(t.datum_type===zf?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:t.datum_type!==Gf||t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6])}(t,e))return r;if(t.datum_type===Hf||e.datum_type===Hf)return r;var n=t.a,i=t.es;if(t.datum_type===jf){if(0!==tm(t,!1,r))return;n=Wf,i=Xf}var a=e.a,o=e.b,s=e.es;if(e.datum_type===jf&&(a=Wf,o=qf,s=Xf),i===s&&n===a&&!Qp(t.datum_type)&&!Qp(e.datum_type))return r;if((r=Kp(r,i,n),Qp(t.datum_type)&&(r=function(t,e,r){if(e===zf)return{x:t.x+r[0],y:t.y+r[1],z:t.z+r[2]};if(e===Gf){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],l=r[5],u=r[6];return{x:u*(t.x-l*t.y+s*t.z)+n,y:u*(l*t.x+t.y-o*t.z)+i,z:u*(-s*t.x+o*t.y+t.z)+a}}}(r,t.datum_type,t.datum_params)),Qp(e.datum_type)&&(r=function(t,e,r){if(e===zf)return{x:t.x-r[0],y:t.y-r[1],z:t.z-r[2]};if(e===Gf){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],l=r[5],u=r[6],c=(t.x-n)/u,h=(t.y-i)/u,d=(t.z-a)/u;return{x:c+l*h-s*d,y:-l*c+h+o*d,z:s*c-o*h+d}}}(r,e.datum_type,e.datum_params)),r=Jp(r,s,a,o),e.datum_type===jf)&&0!==tm(e,!0,r))return;return r}function tm(t,e,r){if(null===t.grids||0===t.grids.length)return console.log("Grid shift grids not found"),-1;for(var n={x:-r.x,y:r.y},i={x:Number.NaN,y:Number.NaN},a=[],o=0;o<t.grids.length;o++){var s=t.grids[o];if(a.push(s.name),s.isNull){i=n;break}if(s.mandatory,null!==s.grid){var l=s.grid.subgrids[0],u=(Math.abs(l.del[1])+Math.abs(l.del[0]))/1e4,c=l.ll[0]-u,h=l.ll[1]-u,d=l.ll[0]+(l.lim[0]-1)*l.del[0]+u,f=l.ll[1]+(l.lim[1]-1)*l.del[1]+u;if(!(h>n.y||c>n.x||f<n.y||d<n.x||(i=em(n,e,l),isNaN(i.x))))break}else if(s.mandatory)return console.log("Unable to find mandatory grid '"+s.name+"'"),-1}return isNaN(i.x)?(console.log("Failed to find a grid shift table for location '"+-n.x*ep+" "+n.y*ep+" tried: '"+a+"'"),-1):(r.x=-i.x,r.y=i.y,0)}function em(t,e,r){var n={x:Number.NaN,y:Number.NaN};if(isNaN(t.x))return n;var i={x:t.x,y:t.y};i.x-=r.ll[0],i.y-=r.ll[1],i.x=Cp(i.x-Math.PI)+Math.PI;var a=rm(i,r);if(e){if(isNaN(a.x))return n;a.x=i.x-a.x,a.y=i.y-a.y;var o,s,l=9;do{if(s=rm(a,r),isNaN(s.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}o={x:i.x-(s.x+a.x),y:i.y-(s.y+a.y)},a.x+=o.x,a.y+=o.y}while(l--&&Math.abs(o.x)>1e-12&&Math.abs(o.y)>1e-12);if(l<0)return console.log("Inverse grid shift iterator failed to converge."),n;n.x=Cp(a.x+r.ll[0]),n.y=a.y+r.ll[1]}else isNaN(a.x)||(n.x=t.x+a.x,n.y=t.y+a.y);return n}function rm(t,e){var r,n={x:t.x/e.del[0],y:t.y/e.del[1]},i=Math.floor(n.x),a=Math.floor(n.y),o=n.x-1*i,s=n.y-1*a,l={x:Number.NaN,y:Number.NaN};if(i<0||i>=e.lim[0])return l;if(a<0||a>=e.lim[1])return l;r=a*e.lim[0]+i;var u=e.cvs[r][0],c=e.cvs[r][1];r++;var h=e.cvs[r][0],d=e.cvs[r][1];r+=e.lim[0];var f=e.cvs[r][0],p=e.cvs[r][1];r--;var m=e.cvs[r][0],g=e.cvs[r][1],v=o*s,y=o*(1-s),x=(1-o)*(1-s),_=(1-o)*s;return l.x=x*u+y*h+_*m+v*f,l.y=x*c+y*d+_*g+v*p,l}function nm(t,e,r){var n,i,a,o=r.x,s=r.y,l=r.z||0,u={};for(a=0;a<3;a++)if(!e||2!==a||void 0!==r.z)switch(0===a?(n=o,i=-1!=="ew".indexOf(t.axis[a])?"x":"y"):1===a?(n=s,i=-1!=="ns".indexOf(t.axis[a])?"y":"x"):(n=l,i="z"),t.axis[a]){case"e":case"n":u[i]=n;break;case"w":case"s":u[i]=-n;break;case"u":void 0!==r[i]&&(u.z=n);break;case"d":void 0!==r[i]&&(u.z=-n);break;default:return null}return u}function im(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}function am(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function om(t,e,r,n){var i;if(Array.isArray(r)&&(r=im(r)),function(t){am(t.x),am(t.y)}(r),t.datum&&e.datum&&function(t,e){return(t.datum.datum_type===zf||t.datum.datum_type===Gf)&&"WGS84"!==e.datumCode||(e.datum.datum_type===zf||e.datum.datum_type===Gf)&&"WGS84"!==t.datumCode}(t,e)&&(r=om(t,i=new Zp("WGS84"),r,n),t=i),n&&"enu"!==t.axis&&(r=nm(t,!1,r)),"longlat"===t.projName)r={x:r.x*tp,y:r.y*tp,z:r.z||0};else if(t.to_meter&&(r={x:r.x*t.to_meter,y:r.y*t.to_meter,z:r.z||0}),!(r=t.inverse(r)))return;if(t.from_greenwich&&(r.x+=t.from_greenwich),r=$p(t.datum,e.datum,r))return e.from_greenwich&&(r={x:r.x-e.from_greenwich,y:r.y,z:r.z||0}),"longlat"===e.projName?r={x:r.x*ep,y:r.y*ep,z:r.z||0}:(r=e.forward(r),e.to_meter&&(r={x:r.x/e.to_meter,y:r.y/e.to_meter,z:r.z||0})),n&&"enu"!==e.axis?nm(e,!0,r):r}Zp.projections=Up,Zp.projections.start();var sm=Zp("WGS84");function lm(t,e,r,n){var i,a,o;return Array.isArray(r)?(i=om(t,e,r,n)||{x:NaN,y:NaN},r.length>2?void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name?"number"==typeof i.z?[i.x,i.y,i.z].concat(r.splice(3)):[i.x,i.y,r[2]].concat(r.splice(3)):[i.x,i.y].concat(r.splice(2)):[i.x,i.y]):(a=om(t,e,r,n),2===(o=Object.keys(r)).length||o.forEach((function(n){if(void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name){if("x"===n||"y"===n||"z"===n)return}else if("x"===n||"y"===n)return;a[n]=r[n]})),a)}function um(t){return t instanceof Zp?t:t.oProj?t.oProj:Zp(t)}function cm(t,e,r){t=um(t);var n,i=!1;return void 0===e?(e=t,t=sm,i=!0):(void 0!==e.x||Array.isArray(e))&&(r=e,e=t,t=sm,i=!0),e=um(e),r?lm(t,e,r):(n={forward:function(r,n){return lm(t,e,r,n)},inverse:function(r,n){return lm(e,t,r,n)}},i&&(n.oProj=e),n)}var hm=6,dm="AJSAJS",fm="AFAFAF",pm=65,mm=73,gm=79,vm=86,ym=90;const xm={forward:_m,inverse:function(t){var e=Sm(Am(t.toUpperCase()));if(e.lat&&e.lon)return[e.lon,e.lat,e.lon,e.lat];return[e.left,e.bottom,e.right,e.top]},toPoint:wm};function _m(t,e){return e=e||5,function(t,e){var r="00000"+t.easting,n="00000"+t.northing;return t.zoneNumber+t.zoneLetter+(f=t.easting,p=t.northing,m=t.zoneNumber,g=Em(m),v=Math.floor(f/1e5),y=Math.floor(p/1e5)%20,i=v,a=y,o=g,s=o-1,l=dm.charCodeAt(s),u=fm.charCodeAt(s),c=l+i-1,h=u+a,d=!1,c>ym&&(c=c-ym+pm-1,d=!0),(c===mm||l<mm&&c>mm||(c>mm||l<mm)&&d)&&c++,(c===gm||l<gm&&c>gm||(c>gm||l<gm)&&d)&&++c===mm&&c++,c>ym&&(c=c-ym+pm-1),h>vm?(h=h-vm+pm-1,d=!0):d=!1,(h===mm||u<mm&&h>mm||(h>mm||u<mm)&&d)&&h++,(h===gm||u<gm&&h>gm||(h>gm||u<gm)&&d)&&++h===mm&&h++,h>vm&&(h=h-vm+pm-1),String.fromCharCode(c)+String.fromCharCode(h))+r.substr(r.length-5,e)+n.substr(n.length-5,e);var i,a,o,s,l,u,c,h,d;var f,p,m,g,v,y}(function(t){var e,r,n,i,a,o,s,l,u=t.lat,c=t.lon,h=6378137,d=.00669438,f=.9996,p=bm(u),m=bm(c);l=Math.floor((c+180)/6)+1,180===c&&(l=60);u>=56&&u<64&&c>=3&&c<12&&(l=32);u>=72&&u<84&&(c>=0&&c<9?l=31:c>=9&&c<21?l=33:c>=21&&c<33?l=35:c>=33&&c<42&&(l=37));s=bm(6*(l-1)-180+3),e=d/(1-d),r=h/Math.sqrt(1-d*Math.sin(p)*Math.sin(p)),n=Math.tan(p)*Math.tan(p),i=e*Math.cos(p)*Math.cos(p),a=Math.cos(p)*(m-s),o=h*((1-d/4-3*d*d/64-5*d*d*d/256)*p-(3*d/8+3*d*d/32+45*d*d*d/1024)*Math.sin(2*p)+(15*d*d/256+45*d*d*d/1024)*Math.sin(4*p)-35*d*d*d/3072*Math.sin(6*p));var g=f*r*(a+(1-n+i)*a*a*a/6+(5-18*n+n*n+72*i-58*e)*a*a*a*a*a/120)+5e5,v=f*(o+r*Math.tan(p)*(a*a/2+(5-n+9*i+4*i*i)*a*a*a*a/24+(61-58*n+n*n+600*i-330*e)*a*a*a*a*a*a/720));u<0&&(v+=1e7);return{northing:Math.round(v),easting:Math.round(g),zoneNumber:l,zoneLetter:Tm(u)}}({lat:t[1],lon:t[0]}),e)}function wm(t){var e=Sm(Am(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function bm(t){return t*(Math.PI/180)}function Mm(t){return t/Math.PI*180}function Sm(t){var e=t.northing,r=t.easting,n=t.zoneLetter,i=t.zoneNumber;if(i<0||i>60)return null;var a,o,s,l,u,c,h,d,f,p=.9996,m=6378137,g=.00669438,v=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),y=r-5e5,x=e;n<"N"&&(x-=1e7),h=6*(i-1)-180+3,a=.006739496752268451,f=(d=x/p/6367449.145945056)+(3*v/2-27*v*v*v/32)*Math.sin(2*d)+(21*v*v/16-55*v*v*v*v/32)*Math.sin(4*d)+151*v*v*v/96*Math.sin(6*d),o=m/Math.sqrt(1-g*Math.sin(f)*Math.sin(f)),s=Math.tan(f)*Math.tan(f),l=a*Math.cos(f)*Math.cos(f),u=.99330562*m/Math.pow(1-g*Math.sin(f)*Math.sin(f),1.5),c=y/(o*p);var _=f-o*Math.tan(f)/u*(c*c/2-(5+3*s+10*l-4*l*l-9*a)*c*c*c*c/24+(61+90*s+298*l+45*s*s-1.6983531815716497-3*l*l)*c*c*c*c*c*c/720);_=Mm(_);var w,b=(c-(1+2*s+l)*c*c*c/6+(5-2*l+28*s-3*l*l+8*a+24*s*s)*c*c*c*c*c/120)/Math.cos(f);if(b=h+Mm(b),t.accuracy){var M=Sm({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});w={top:M.lat,right:M.lon,bottom:_,left:b}}else w={lat:_,lon:b};return w}function Tm(t){var e="Z";return 84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C"),e}function Em(t){var e=t%hm;return 0===e&&(e=hm),e}function Am(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,r=t.length,n=null,i="",a=0;!/[A-Z]/.test(e=t.charAt(a));){if(a>=2)throw"MGRSPoint bad conversion from: "+t;i+=e,a++}var o=parseInt(i,10);if(0===a||a+3>r)throw"MGRSPoint bad conversion from: "+t;var s=t.charAt(a++);if(s<="A"||"B"===s||"Y"===s||s>="Z"||"I"===s||"O"===s)throw"MGRSPoint zone letter "+s+" not handled: "+t;n=t.substring(a,a+=2);for(var l=Em(o),u=function(t,e){var r=dm.charCodeAt(e-1),n=1e5,i=!1;for(;r!==t.charCodeAt(0);){if(++r===mm&&r++,r===gm&&r++,r>ym){if(i)throw"Bad character: "+t;r=pm,i=!0}n+=1e5}return n}(n.charAt(0),l),c=function(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;var r=fm.charCodeAt(e-1),n=0,i=!1;for(;r!==t.charCodeAt(0);){if(++r===mm&&r++,r===gm&&r++,r>vm){if(i)throw"Bad character: "+t;r=pm,i=!0}n+=1e5}return n}(n.charAt(1),l);c<Rm(s);)c+=2e6;var h=r-a;if(h%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var d,f,p,m=h/2,g=0,v=0;return m>0&&(d=1e5/Math.pow(10,m),f=t.substring(a,a+m),g=parseFloat(f)*d,p=t.substring(a+m),v=parseFloat(p)*d),{easting:g+u,northing:v+c,zoneLetter:s,zoneNumber:o,accuracy:d}}function Rm(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}function Pm(t,e,r){if(!(this instanceof Pm))return new Pm(t,e,r);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===e){var n=t.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=t,this.y=e,this.z=r||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Pm.fromMGRS=function(t){return new Pm(wm(t))},Pm.prototype.toMGRS=function(t){return _m([this.x,this.y],t)};var Cm=1,Im=.25,Lm=.046875,Om=.01953125,Dm=.01068115234375,km=.75,Fm=.46875,Nm=.013020833333333334,Um=.007120768229166667,Bm=.3645833333333333,zm=.005696614583333333,Gm=.3076171875;function jm(t){var e=[];e[0]=Cm-t*(Im+t*(Lm+t*(Om+t*Dm))),e[1]=t*(km-t*(Lm+t*(Om+t*Dm)));var r=t*t;return e[2]=r*(Fm-t*(Nm+t*Um)),r*=t,e[3]=r*(Bm-t*zm),e[4]=r*t*Gm,e}function Vm(t,e,r,n){return r*=e,e*=e,n[0]*t-r*(n[1]+e*(n[2]+e*(n[3]+e*n[4])))}var Hm=20;function Wm(t,e,r){for(var n=1/(1-e),i=t,a=Hm;a;--a){var o=Math.sin(i),s=1-e*o*o;if(i-=s=(Vm(i,o,Math.cos(i),r)-t)*(s*Math.sqrt(s))*n,Math.abs(s)<$f)return i}return i}const qm={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=jm(this.es),this.ml0=Vm(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var e,r,n,i=t.x,a=t.y,o=Cp(i-this.long0),s=Math.sin(a),l=Math.cos(a);if(this.es){var u=l*o,c=Math.pow(u,2),h=this.ep2*Math.pow(l,2),d=Math.pow(h,2),f=Math.abs(l)>$f?Math.tan(a):0,p=Math.pow(f,2),m=Math.pow(p,2);e=1-this.es*Math.pow(s,2),u/=Math.sqrt(e);var g=Vm(a,s,l,this.en);r=this.a*(this.k0*u*(1+c/6*(1-p+h+c/20*(5-18*p+m+14*h-58*p*h+c/42*(61+179*m-m*p-479*p)))))+this.x0,n=this.a*(this.k0*(g-this.ml0+s*o*u/2*(1+c/12*(5-p+9*h+4*d+c/30*(61+m-58*p+270*h-330*p*h+c/56*(1385+543*m-m*p-3111*p))))))+this.y0}else{var v=l*Math.sin(o);if(Math.abs(Math.abs(v)-1)<$f)return 93;if(r=.5*this.a*this.k0*Math.log((1+v)/(1-v))+this.x0,n=l*Math.cos(o)/Math.sqrt(1-Math.pow(v,2)),(v=Math.abs(n))>=1){if(v-1>$f)return 93;n=0}else n=Math.acos(n);a<0&&(n=-n),n=this.a*this.k0*(n-this.lat0)+this.y0}return t.x=r,t.y=n,t},inverse:function(t){var e,r,n,i,a=(t.x-this.x0)*(1/this.a),o=(t.y-this.y0)*(1/this.a);if(this.es)if(r=Wm(e=this.ml0+o/this.k0,this.es,this.en),Math.abs(r)<Zf){var s=Math.sin(r),l=Math.cos(r),u=Math.abs(l)>$f?Math.tan(r):0,c=this.ep2*Math.pow(l,2),h=Math.pow(c,2),d=Math.pow(u,2),f=Math.pow(d,2);e=1-this.es*Math.pow(s,2);var p=a*Math.sqrt(e)/this.k0,m=Math.pow(p,2);n=r-(e*=u)*m/(1-this.es)*.5*(1-m/12*(5+3*d-9*c*d+c-4*h-m/30*(61+90*d-252*c*d+45*f+46*c-m/56*(1385+3633*d+4095*f+1574*f*d)))),i=Cp(this.long0+p*(1-m/6*(1+2*d+c-m/20*(5+28*d+24*f+8*c*d+6*c-m/42*(61+662*d+1320*f+720*f*d))))/l)}else n=Zf*Pp(o),i=0;else{var g=Math.exp(a/this.k0),v=.5*(g-1/g),y=this.lat0+o/this.k0,x=Math.cos(y);e=Math.sqrt((1-Math.pow(x,2))/(1+Math.pow(v,2))),n=Math.asin(e),o<0&&(n=-n),i=0===v&&0===x?0:Cp(Math.atan2(v,x)+this.long0)}return t.x=i,t.y=n,t},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]};function Xm(t){var e=Math.exp(t);return e=(e-1/e)/2}function Ym(t,e){t=Math.abs(t),e=Math.abs(e);var r=Math.max(t,e),n=Math.min(t,e)/(r||1);return r*Math.sqrt(1+Math.pow(n,2))}function Zm(t){var e=Math.abs(t);return e=function(t){var e=1+t,r=e-1;return 0===r?t:t*Math.log(e)/r}(e*(1+e/(Ym(1,e)+1))),t<0?-e:e}function Km(t,e){for(var r,n=2*Math.cos(2*e),i=t.length-1,a=t[i],o=0;--i>=0;)r=n*a-o+t[i],o=a,a=r;return e+r*Math.sin(2*e)}function Jm(t,e,r){for(var n,i,a=Math.sin(e),o=Math.cos(e),s=Xm(r),l=function(t){var e=Math.exp(t);return(e+1/e)/2}(r),u=2*o*l,c=-2*a*s,h=t.length-1,d=t[h],f=0,p=0,m=0;--h>=0;)n=p,i=f,d=u*(p=d)-n-c*(f=m)+t[h],m=c*p-i+u*f;return[(u=a*l)*d-(c=o*s)*m,u*m+c*d]}const Qm={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(qm.init.apply(this),this.forward=qm.forward,this.inverse=qm.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),r=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),r*=e,this.cgb[1]=r*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=r*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),r*=e,this.cgb[2]=r*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=r*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),r*=e,this.cgb[3]=r*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=r*(1237/630+e*(e*(-24832/14175)-2.4)),r*=e,this.cgb[4]=r*(4174/315+e*(-144838/6237)),this.cbg[4]=r*(-734/315+e*(109598/31185)),r*=e,this.cgb[5]=r*(601676/22275),this.cbg[5]=r*(444337/155925),r=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+r*(1/4+r*(1/64+r/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=r*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=r*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),r*=e,this.utg[2]=r*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=r*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),r*=e,this.utg[3]=r*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=r*(49561/161280+e*(-179/168+e*(6601661/7257600))),r*=e,this.utg[4]=r*(-4583/161280+e*(108847/3991680)),this.gtu[4]=r*(34729/80640+e*(-3418889/1995840)),r*=e,this.utg[5]=r*(-20648693/638668800),this.gtu[5]=.6650675310896665*r;var n=Km(this.cbg,this.lat0);this.Zb=-this.Qn*(n+function(t,e){for(var r,n=2*Math.cos(e),i=t.length-1,a=t[i],o=0;--i>=0;)r=n*a-o+t[i],o=a,a=r;return Math.sin(e)*r}(this.gtu,2*n))},forward:function(t){var e=Cp(t.x-this.long0),r=t.y;r=Km(this.cbg,r);var n=Math.sin(r),i=Math.cos(r),a=Math.sin(e),o=Math.cos(e);r=Math.atan2(n,o*i),e=Math.atan2(a*i,Ym(n,i*o)),e=Zm(Math.tan(e));var s,l,u=Jm(this.gtu,2*r,2*e);return r+=u[0],e+=u[1],Math.abs(e)<=2.623395162778?(s=this.a*(this.Qn*e)+this.x0,l=this.a*(this.Qn*r+this.Zb)+this.y0):(s=1/0,l=1/0),t.x=s,t.y=l,t},inverse:function(t){var e,r,n=(t.x-this.x0)*(1/this.a),i=(t.y-this.y0)*(1/this.a);if(i=(i-this.Zb)/this.Qn,n/=this.Qn,Math.abs(n)<=2.623395162778){var a=Jm(this.utg,2*i,2*n);i+=a[0],n+=a[1],n=Math.atan(Xm(n));var o=Math.sin(i),s=Math.cos(i),l=Math.sin(n),u=Math.cos(n);i=Math.atan2(o*u,Ym(l,u*s)),e=Cp((n=Math.atan2(l,u*s))+this.long0),r=Km(this.cgb,i)}else e=1/0,r=1/0;return t.x=e,t.y=r,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"]};const $m={init:function(){var t=function(t,e){if(void 0===t){if((t=Math.floor(30*(Cp(e)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t}(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*tp,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Qm.init.apply(this),this.forward=Qm.forward,this.inverse=Qm.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function tg(t,e){return Math.pow((1-t)/(1+t),e)}const eg={init:function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+rp)/(Math.pow(Math.tan(.5*this.lat0+rp),this.C)*tg(this.e*t,this.ratexp))},forward:function(t){var e=t.x,r=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*r+rp),this.C)*tg(this.e*Math.sin(r),this.ratexp))-Zf,t.x=this.C*e,t},inverse:function(t){for(var e=t.x/this.C,r=t.y,n=Math.pow(Math.tan(.5*r+rp)/this.K,1/this.C),i=20;i>0&&(r=2*Math.atan(n*tg(this.e*Math.sin(t.y),-.5*this.e))-Zf,!(Math.abs(r-t.y)<1e-14));--i)t.y=r;return i?(t.x=e,t.y=r,t):null},names:["gauss"]};const rg={init:function(){eg.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var e,r,n,i;return t.x=Cp(t.x-this.long0),eg.forward.apply(this,[t]),e=Math.sin(t.y),r=Math.cos(t.y),n=Math.cos(t.x),i=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*r*n),t.x=i*r*Math.sin(t.x),t.y=i*(this.cosc0*e-this.sinc0*r*n),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var e,r,n,i,a;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,a=Math.sqrt(t.x*t.x+t.y*t.y)){var o=2*Math.atan2(a,this.R2);e=Math.sin(o),r=Math.cos(o),i=Math.asin(r*this.sinc0+t.y*e*this.cosc0/a),n=Math.atan2(t.x*e,a*this.cosc0*r-t.y*this.sinc0*e)}else i=this.phic0,n=0;return t.x=n,t.y=i,eg.inverse.apply(this,[t]),t.x=Cp(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]};const ng={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=$f&&(this.k0=.5*(1+Pp(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=$f&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=$f&&(this.k0=.5*this.cons*Rp(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Ip(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Rp(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-Zf,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var e,r,n,i,a,o,s=t.x,l=t.y,u=Math.sin(l),c=Math.cos(l),h=Cp(s-this.long0);return Math.abs(Math.abs(s-this.long0)-Math.PI)<=$f&&Math.abs(l+this.lat0)<=$f?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*u+this.coslat0*c*Math.cos(h)),t.x=this.a*e*c*Math.sin(h)+this.x0,t.y=this.a*e*(this.coslat0*u-this.sinlat0*c*Math.cos(h))+this.y0,t):(r=2*Math.atan(this.ssfn_(l,u,this.e))-Zf,i=Math.cos(r),n=Math.sin(r),Math.abs(this.coslat0)<=$f?(a=Ip(this.e,l*this.con,this.con*u),o=2*this.a*this.k0*a/this.cons,t.x=this.x0+o*Math.sin(s-this.long0),t.y=this.y0-this.con*o*Math.cos(s-this.long0),t):(Math.abs(this.sinlat0)<$f?(e=2*this.a*this.k0/(1+i*Math.cos(h)),t.y=e*n):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*n+this.cosX0*i*Math.cos(h))),t.y=e*(this.cosX0*n-this.sinX0*i*Math.cos(h))+this.y0),t.x=e*i*Math.sin(h)+this.x0,t))},inverse:function(t){var e,r,n,i,a;t.x-=this.x0,t.y-=this.y0;var o=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var s=2*Math.atan(o/(2*this.a*this.k0));return e=this.long0,r=this.lat0,o<=$f?(t.x=e,t.y=r,t):(r=Math.asin(Math.cos(s)*this.sinlat0+t.y*Math.sin(s)*this.coslat0/o),e=Math.abs(this.coslat0)<$f?this.lat0>0?Cp(this.long0+Math.atan2(t.x,-1*t.y)):Cp(this.long0+Math.atan2(t.x,t.y)):Cp(this.long0+Math.atan2(t.x*Math.sin(s),o*this.coslat0*Math.cos(s)-t.y*this.sinlat0*Math.sin(s))),t.x=e,t.y=r,t)}if(Math.abs(this.coslat0)<=$f){if(o<=$f)return r=this.lat0,e=this.long0,t.x=e,t.y=r,t;t.x*=this.con,t.y*=this.con,n=o*this.cons/(2*this.a*this.k0),r=this.con*Lp(this.e,n),e=this.con*Cp(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else i=2*Math.atan(o*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,o<=$f?a=this.X0:(a=Math.asin(Math.cos(i)*this.sinX0+t.y*Math.sin(i)*this.cosX0/o),e=Cp(this.long0+Math.atan2(t.x*Math.sin(i),o*this.cosX0*Math.cos(i)-t.y*this.sinX0*Math.sin(i)))),r=-1*Lp(this.e,Math.tan(.5*(Zf+a)));return t.x=e,t.y=r,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(t,e,r){return e*=r,Math.tan(.5*(Zf+t))*Math.pow((1-e)/(1+e),.5*r)}};const ig={init:function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),r=this.a,n=1/this.rf,i=2*n-Math.pow(n,2),a=this.e=Math.sqrt(i);this.R=this.k0*r*Math.sqrt(1-i)/(1-i*Math.pow(e,2)),this.alpha=Math.sqrt(1+i/(1-i)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),s=Math.log(Math.tan(Math.PI/4+t/2)),l=Math.log((1+a*e)/(1-a*e));this.K=o-this.alpha*s+this.alpha*a/2*l},forward:function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),r=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),n=-this.alpha*(e+r)+this.K,i=2*(Math.atan(Math.exp(n))-Math.PI/4),a=this.alpha*(t.x-this.lambda0),o=Math.atan(Math.sin(a)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(a))),s=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(a));return t.y=this.R/2*Math.log((1+Math.sin(s))/(1-Math.sin(s)))+this.y0,t.x=this.R*o+this.x0,t},inverse:function(t){for(var e=t.x-this.x0,r=t.y-this.y0,n=e/this.R,i=2*(Math.atan(Math.exp(r/this.R))-Math.PI/4),a=Math.asin(Math.cos(this.b0)*Math.sin(i)+Math.sin(this.b0)*Math.cos(i)*Math.cos(n)),o=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(i))),s=this.lambda0+o/this.alpha,l=0,u=a,c=-1e3,h=0;Math.abs(u-c)>1e-7;){if(++h>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+a/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(u))/2)),c=u,u=2*Math.atan(Math.exp(l))-Math.PI/2}return t.x=s,t.y=u,t},names:["somerc"]};var ag=1e-7;const og={init:function(){var t,e,r,n,i,a,o,s,l,u,c,h,d,f=0,p=0,m=0,g=0,v=0,y=0,x=0;this.no_off=(d="object"==typeof(h=this).PROJECTION?Object.keys(h.PROJECTION)[0]:h.PROJECTION,"no_uoff"in h||"no_off"in h||-1!==["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(d)),this.no_rot="no_rot"in this;var _=!1;"alpha"in this&&(_=!0);var w=!1;if("rectified_grid_angle"in this&&(w=!0),_&&(x=this.alpha),w&&(f=this.rectified_grid_angle*tp),_||w)p=this.longc;else if(m=this.long1,v=this.lat1,g=this.long2,y=this.lat2,Math.abs(v-y)<=ag||(t=Math.abs(v))<=ag||Math.abs(t-Zf)<=ag||Math.abs(Math.abs(this.lat0)-Zf)<=ag||Math.abs(Math.abs(y)-Zf)<=ag)throw new Error;var b=1-this.es;e=Math.sqrt(b),Math.abs(this.lat0)>$f?(s=Math.sin(this.lat0),r=Math.cos(this.lat0),t=1-this.es*s*s,this.B=r*r,this.B=Math.sqrt(1+this.es*this.B*this.B/b),this.A=this.B*this.k0*e/t,(i=(n=this.B*e/(r*Math.sqrt(t)))*n-1)<=0?i=0:(i=Math.sqrt(i),this.lat0<0&&(i=-i)),this.E=i+=n,this.E*=Math.pow(Ip(this.e,this.lat0,s),this.B)):(this.B=1/e,this.A=this.k0,this.E=n=i=1),_||w?(_?(c=Math.asin(Math.sin(x)/n),w||(f=x)):(c=f,x=Math.asin(n*Math.sin(c))),this.lam0=p-Math.asin(.5*(i-1/i)*Math.tan(c))/this.B):(a=Math.pow(Ip(this.e,v,Math.sin(v)),this.B),o=Math.pow(Ip(this.e,y,Math.sin(y)),this.B),i=this.E/a,l=(o-a)/(o+a),u=((u=this.E*this.E)-o*a)/(u+o*a),(t=m-g)<-Math.pi?g-=np:t>Math.pi&&(g+=np),this.lam0=Cp(.5*(m+g)-Math.atan(u*Math.tan(.5*this.B*(m-g))/l)/this.B),c=Math.atan(2*Math.sin(this.B*Cp(m-this.lam0))/(i-1/i)),f=x=Math.asin(n*Math.sin(c))),this.singam=Math.sin(c),this.cosgam=Math.cos(c),this.sinrot=Math.sin(f),this.cosrot=Math.cos(f),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A,this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(n*n-1)/Math.cos(x))),this.lat0<0&&(this.u_0=-this.u_0)),i=.5*c,this.v_pole_n=this.ArB*Math.log(Math.tan(rp-i)),this.v_pole_s=this.ArB*Math.log(Math.tan(rp+i))},forward:function(t){var e,r,n,i,a,o,s,l,u={};if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-Zf)>$f){if(e=.5*((a=this.E/Math.pow(Ip(this.e,t.y,Math.sin(t.y)),this.B))-(o=1/a)),r=.5*(a+o),i=Math.sin(this.B*t.x),n=(e*this.singam-i*this.cosgam)/r,Math.abs(Math.abs(n)-1)<$f)throw new Error;l=.5*this.ArB*Math.log((1-n)/(1+n)),o=Math.cos(this.B*t.x),s=Math.abs(o)<ag?this.A*t.x:this.ArB*Math.atan2(e*this.cosgam+i*this.singam,o)}else l=t.y>0?this.v_pole_n:this.v_pole_s,s=this.ArB*t.y;return this.no_rot?(u.x=s,u.y=l):(s-=this.u_0,u.x=l*this.cosrot+s*this.sinrot,u.y=s*this.cosrot-l*this.sinrot),u.x=this.a*u.x+this.x0,u.y=this.a*u.y+this.y0,u},inverse:function(t){var e,r,n,i,a,o,s,l={};if(t.x=(t.x-this.x0)*(1/this.a),t.y=(t.y-this.y0)*(1/this.a),this.no_rot?(r=t.y,e=t.x):(r=t.x*this.cosrot-t.y*this.sinrot,e=t.y*this.cosrot+t.x*this.sinrot+this.u_0),i=.5*((n=Math.exp(-this.BrA*r))-1/n),a=.5*(n+1/n),s=((o=Math.sin(this.BrA*e))*this.cosgam+i*this.singam)/a,Math.abs(Math.abs(s)-1)<$f)l.x=0,l.y=s<0?-Zf:Zf;else{if(l.y=this.E/Math.sqrt((1+s)/(1-s)),l.y=Lp(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(i*this.cosgam-o*this.singam,Math.cos(this.BrA*e))}return l.x+=this.lam0,l},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]};const sg={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<$f)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),r=Math.cos(this.lat1),n=Rp(this.e,e,r),i=Ip(this.e,this.lat1,e),a=Math.sin(this.lat2),o=Math.cos(this.lat2),s=Rp(this.e,a,o),l=Ip(this.e,this.lat2,a),u=Ip(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>$f?this.ns=Math.log(n/s)/Math.log(i/l):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=n/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(u,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(t){var e=t.x,r=t.y;Math.abs(2*Math.abs(r)-Math.PI)<=$f&&(r=Pp(r)*(Zf-2*$f));var n,i,a=Math.abs(Math.abs(r)-Zf);if(a>$f)n=Ip(this.e,r,Math.sin(r)),i=this.a*this.f0*Math.pow(n,this.ns);else{if((a=r*this.ns)<=0)return null;i=0}var o=this.ns*Cp(e-this.long0);return t.x=this.k0*(i*Math.sin(o))+this.x0,t.y=this.k0*(this.rh-i*Math.cos(o))+this.y0,t},inverse:function(t){var e,r,n,i,a,o=(t.x-this.x0)/this.k0,s=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(o*o+s*s),r=1):(e=-Math.sqrt(o*o+s*s),r=-1);var l=0;if(0!==e&&(l=Math.atan2(r*o,r*s)),0!==e||this.ns>0){if(r=1/this.ns,n=Math.pow(e/(this.a*this.f0),r),-9999===(i=Lp(this.e,n)))return null}else i=-Zf;return a=Cp(l/this.ns+this.long0),t.x=a,t.y=i,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]};const lg={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var e,r,n,i,a,o,s,l=t.x,u=t.y,c=Cp(l-this.long0);return e=Math.pow((1+this.e*Math.sin(u))/(1-this.e*Math.sin(u)),this.alfa*this.e/2),r=2*(Math.atan(this.k*Math.pow(Math.tan(u/2+this.s45),this.alfa)/e)-this.s45),n=-c*this.alfa,i=Math.asin(Math.cos(this.ad)*Math.sin(r)+Math.sin(this.ad)*Math.cos(r)*Math.cos(n)),a=Math.asin(Math.cos(r)*Math.sin(n)/Math.cos(i)),o=this.n*a,s=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n),t.y=s*Math.cos(o)/1,t.x=s*Math.sin(o)/1,this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){var e,r,n,i,a,o,s,l=t.x;t.x=t.y,t.y=l,this.czech||(t.y*=-1,t.x*=-1),a=Math.sqrt(t.x*t.x+t.y*t.y),i=Math.atan2(t.y,t.x)/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(i)),r=Math.asin(Math.cos(n)*Math.sin(i)/Math.cos(e)),t.x=this.long0-r/this.alfa,o=e,s=0;var u=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-t.y)<1e-10&&(s=1),o=t.y,u+=1}while(0===s&&u<15);return u>=15?null:t},names:["Krovak","krovak"]};function ug(t,e,r,n,i){return t*i-e*Math.sin(2*i)+r*Math.sin(4*i)-n*Math.sin(6*i)}function cg(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function hg(t){return.375*t*(1+.25*t*(1+.46875*t))}function dg(t){return.05859375*t*t*(1+.75*t)}function fg(t){return t*t*t*(35/3072)}function pg(t,e,r){var n=e*r;return t/Math.sqrt(1-n*n)}function mg(t){return Math.abs(t)<Zf?t:t-Pp(t)*Math.PI}function gg(t,e,r,n,i){var a,o;a=t/e;for(var s=0;s<15;s++)if(a+=o=(t-(e*a-r*Math.sin(2*a)+n*Math.sin(4*a)-i*Math.sin(6*a)))/(e-2*r*Math.cos(2*a)+4*n*Math.cos(4*a)-6*i*Math.cos(6*a)),Math.abs(o)<=1e-10)return a;return NaN}const vg={init:function(){this.sphere||(this.e0=cg(this.es),this.e1=hg(this.es),this.e2=dg(this.es),this.e3=fg(this.es),this.ml0=this.a*ug(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var e,r,n=t.x,i=t.y;if(n=Cp(n-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(i)*Math.sin(n)),r=this.a*(Math.atan2(Math.tan(i),Math.cos(n))-this.lat0);else{var a=Math.sin(i),o=Math.cos(i),s=pg(this.a,this.e,a),l=Math.tan(i)*Math.tan(i),u=n*Math.cos(i),c=u*u,h=this.es*o*o/(1-this.es);e=s*u*(1-c*l*(1/6-(8-l+8*h)*c/120)),r=this.a*ug(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+s*a/o*c*(.5+(5-l+6*h)*c/24)}return t.x=e+this.x0,t.y=r+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,r,n=t.x/this.a,i=t.y/this.a;if(this.sphere){var a=i+this.lat0;e=Math.asin(Math.sin(a)*Math.cos(n)),r=Math.atan2(Math.tan(n),Math.cos(a))}else{var o=gg(this.ml0/this.a+i,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-Zf)<=$f)return t.x=this.long0,t.y=Zf,i<0&&(t.y*=-1),t;var s=pg(this.a,this.e,Math.sin(o)),l=s*s*s/this.a/this.a*(1-this.es),u=Math.pow(Math.tan(o),2),c=n*this.a/s,h=c*c;e=o-s*Math.tan(o)/l*c*c*(.5-(1+3*u)*c*c/24),r=c*(1-h*(u/3+(1+3*u)*u*h/15))/Math.cos(o)}return t.x=Cp(r+this.long0),t.y=mg(e),t},names:["Cassini","Cassini_Soldner","cass"]};function yg(t,e){var r;return t>1e-7?(1-t*t)*(e/(1-(r=t*e)*r)-.5/t*Math.log((1-r)/(1+r))):2*e}var xg=.3333333333333333,_g=.17222222222222222,wg=.10257936507936508,bg=.06388888888888888,Mg=.0664021164021164,Sg=.016415012942191543;const Tg={init:function(){var t,e=Math.abs(this.lat0);if(Math.abs(e-Zf)<$f?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<$f?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=yg(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var e,r=[];return r[0]=t*xg,e=t*t,r[0]+=e*_g,r[1]=e*bg,e*=t,r[0]+=e*wg,r[1]+=e*Mg,r[2]=e*Sg,r}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=yg(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var e,r,n,i,a,o,s,l,u,c,h=t.x,d=t.y;if(h=Cp(h-this.long0),this.sphere){if(a=Math.sin(d),c=Math.cos(d),n=Math.cos(h),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((r=this.mode===this.EQUIT?1+c*n:1+this.sinph0*a+this.cosph0*c*n)<=$f)return null;e=(r=Math.sqrt(2/r))*c*Math.sin(h),r*=this.mode===this.EQUIT?a:this.cosph0*a-this.sinph0*c*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(d+this.lat0)<$f)return null;r=rp-.5*d,e=(r=2*(this.mode===this.S_POLE?Math.cos(r):Math.sin(r)))*Math.sin(h),r*=n}}else{switch(s=0,l=0,u=0,n=Math.cos(h),i=Math.sin(h),a=Math.sin(d),o=yg(this.e,a),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(s=o/this.qp,l=Math.sqrt(1-s*s)),this.mode){case this.OBLIQ:u=1+this.sinb1*s+this.cosb1*l*n;break;case this.EQUIT:u=1+l*n;break;case this.N_POLE:u=Zf+d,o=this.qp-o;break;case this.S_POLE:u=d-Zf,o=this.qp+o}if(Math.abs(u)<$f)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:u=Math.sqrt(2/u),r=this.mode===this.OBLIQ?this.ymf*u*(this.cosb1*s-this.sinb1*l*n):(u=Math.sqrt(2/(1+l*n)))*s*this.ymf,e=this.xmf*u*l*i;break;case this.N_POLE:case this.S_POLE:o>=0?(e=(u=Math.sqrt(o))*i,r=n*(this.mode===this.S_POLE?u:-u)):e=r=0}}return t.x=this.a*e+this.x0,t.y=this.a*r+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,r,n,i,a,o,s,l,u,c,h=t.x/this.a,d=t.y/this.a;if(this.sphere){var f,p=0,m=0;if((r=.5*(f=Math.sqrt(h*h+d*d)))>1)return null;switch(r=2*Math.asin(r),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(m=Math.sin(r),p=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(f)<=$f?0:Math.asin(d*m/f),h*=m,d=p*f;break;case this.OBLIQ:r=Math.abs(f)<=$f?this.lat0:Math.asin(p*this.sinph0+d*m*this.cosph0/f),h*=m*this.cosph0,d=(p-Math.sin(r)*this.sinph0)*f;break;case this.N_POLE:d=-d,r=Zf-r;break;case this.S_POLE:r-=Zf}e=0!==d||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(h,d):0}else{if(s=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(h/=this.dd,d*=this.dd,(o=Math.sqrt(h*h+d*d))<$f)return t.x=this.long0,t.y=this.lat0,t;i=2*Math.asin(.5*o/this.rq),n=Math.cos(i),h*=i=Math.sin(i),this.mode===this.OBLIQ?(s=n*this.sinb1+d*i*this.cosb1/o,a=this.qp*s,d=o*this.cosb1*n-d*this.sinb1*i):(s=d*i/o,a=this.qp*s,d=o*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(d=-d),!(a=h*h+d*d))return t.x=this.long0,t.y=this.lat0,t;s=1-a/this.qp,this.mode===this.S_POLE&&(s=-s)}e=Math.atan2(h,d),l=Math.asin(s),u=this.apa,c=l+l,r=l+u[0]*Math.sin(c)+u[1]*Math.sin(c+c)+u[2]*Math.sin(c+c+c)}return t.x=Cp(this.long0+e),t.y=r,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function Eg(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}const Ag={init:function(){Math.abs(this.lat1+this.lat2)<$f||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Rp(this.e3,this.sin_po,this.cos_po),this.qs1=yg(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Rp(this.e3,this.sin_po,this.cos_po),this.qs2=yg(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=yg(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>$f?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var e=t.x,r=t.y;this.sin_phi=Math.sin(r),this.cos_phi=Math.cos(r);var n=yg(this.e3,this.sin_phi,this.cos_phi),i=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,a=this.ns0*Cp(e-this.long0),o=i*Math.sin(a)+this.x0,s=this.rh-i*Math.cos(a)+this.y0;return t.x=o,t.y=s,t},inverse:function(t){var e,r,n,i,a,o;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),n=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),n=-1),i=0,0!==e&&(i=Math.atan2(n*t.x,n*t.y)),n=e*this.ns0/this.a,this.sphere?o=Math.asin((this.c-n*n)/(2*this.ns0)):(r=(this.c-n*n)/this.ns0,o=this.phi1z(this.e3,r)),a=Cp(i/this.ns0+this.long0),t.x=a,t.y=o,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,e){var r,n,i,a,o=Eg(.5*e);if(t<$f)return o;for(var s=t*t,l=1;l<=25;l++)if(o+=a=.5*(i=1-(n=t*(r=Math.sin(o)))*n)*i/Math.cos(o)*(e/(1-s)-r/i+.5/t*Math.log((1-n)/(1+n))),Math.abs(a)<=1e-7)return o;return null}};const Rg={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var e,r,n,i,a,o,s,l=t.x,u=t.y;return n=Cp(l-this.long0),e=Math.sin(u),r=Math.cos(u),i=Math.cos(n),1,(a=this.sin_p14*e+this.cos_p14*r*i)>0||Math.abs(a)<=$f?(o=this.x0+1*this.a*r*Math.sin(n)/a,s=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*r*i)/a):(o=this.x0+this.infinity_dist*r*Math.sin(n),s=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*r*i)),t.x=o,t.y=s,t},inverse:function(t){var e,r,n,i,a,o;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(i=Math.atan2(e,this.rc),r=Math.sin(i),o=Eg((n=Math.cos(i))*this.sin_p14+t.y*r*this.cos_p14/e),a=Math.atan2(t.x*r,e*this.cos_p14*n-t.y*this.sin_p14*r),a=Cp(this.long0+a)):(o=this.phic0,a=0),t.x=a,t.y=o,t},names:["gnom"]};const Pg={init:function(){this.sphere||(this.k0=Rp(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var e,r,n=t.x,i=t.y,a=Cp(n-this.long0);if(this.sphere)e=this.x0+this.a*a*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);else{var o=yg(this.e,Math.sin(i));e=this.x0+this.a*this.k0*a,r=this.y0+this.a*o*.5/this.k0}return t.x=e,t.y=r,t},inverse:function(t){var e,r;return t.x-=this.x0,t.y-=this.y0,this.sphere?(e=Cp(this.long0+t.x/this.a/Math.cos(this.lat_ts)),r=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(r=function(t,e){var r=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-r)<1e-6)return e<0?-1*Zf:Zf;for(var n,i,a,o,s=Math.asin(.5*e),l=0;l<30;l++)if(i=Math.sin(s),a=Math.cos(s),o=t*i,s+=n=Math.pow(1-o*o,2)/(2*a)*(e/(1-t*t)-i/(1-o*o)+.5/t*Math.log((1-o)/(1+o))),Math.abs(n)<=1e-10)return s;return NaN}(this.e,2*t.y*this.k0/this.a),e=Cp(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=r,t},names:["cea"]};const Cg={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var e=t.x,r=t.y,n=Cp(e-this.long0),i=mg(r-this.lat0);return t.x=this.x0+this.a*n*this.rc,t.y=this.y0+this.a*i,t},inverse:function(t){var e=t.x,r=t.y;return t.x=Cp(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=mg(this.lat0+(r-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]};const Ig={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=cg(this.es),this.e1=hg(this.es),this.e2=dg(this.es),this.e3=fg(this.es),this.ml0=this.a*ug(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var e,r,n,i=t.x,a=t.y,o=Cp(i-this.long0);if(n=o*Math.sin(a),this.sphere)Math.abs(a)<=$f?(e=this.a*o,r=-1*this.a*this.lat0):(e=this.a*Math.sin(n)/Math.tan(a),r=this.a*(mg(a-this.lat0)+(1-Math.cos(n))/Math.tan(a)));else if(Math.abs(a)<=$f)e=this.a*o,r=-1*this.ml0;else{var s=pg(this.a,this.e,Math.sin(a))/Math.tan(a);e=s*Math.sin(n),r=this.a*ug(this.e0,this.e1,this.e2,this.e3,a)-this.ml0+s*(1-Math.cos(n))}return t.x=e+this.x0,t.y=r+this.y0,t},inverse:function(t){var e,r,n,i,a,o,s,l,u;if(n=t.x-this.x0,i=t.y-this.y0,this.sphere)if(Math.abs(i+this.a*this.lat0)<=$f)e=Cp(n/this.a+this.long0),r=0;else{var c;for(o=this.lat0+i/this.a,s=n*n/this.a/this.a+o*o,l=o,a=20;a;--a)if(l+=u=-1*(o*(l*(c=Math.tan(l))+1)-l-.5*(l*l+s)*c)/((l-o)/c-1),Math.abs(u)<=$f){r=l;break}e=Cp(this.long0+Math.asin(n*Math.tan(l)/this.a)/Math.sin(r))}else if(Math.abs(i+this.ml0)<=$f)r=0,e=Cp(this.long0+n/this.a);else{var h,d,f,p,m;for(o=(this.ml0+i)/this.a,s=n*n/this.a/this.a+o*o,l=o,a=20;a;--a)if(m=this.e*Math.sin(l),h=Math.sqrt(1-m*m)*Math.tan(l),d=this.a*ug(this.e0,this.e1,this.e2,this.e3,l),f=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),l-=u=(o*(h*(p=d/this.a)+1)-p-.5*h*(p*p+s))/(this.es*Math.sin(2*l)*(p*p+s-2*o*p)/(4*h)+(o-p)*(h*f-2/Math.sin(2*l))-f),Math.abs(u)<=$f){r=l;break}h=Math.sqrt(1-this.es*Math.pow(Math.sin(r),2))*Math.tan(r),e=Cp(this.long0+Math.asin(n*h/this.a)/Math.sin(r))}return t.x=e,t.y=r,t},names:["Polyconic","poly"]};const Lg={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(t){var e,r=t.x,n=t.y-this.lat0,i=r-this.long0,a=n/Yf*1e-5,o=i,s=1,l=0;for(e=1;e<=10;e++)s*=a,l+=this.A[e]*s;var u,c=l,h=o,d=1,f=0,p=0,m=0;for(e=1;e<=6;e++)u=f*c+d*h,d=d*c-f*h,f=u,p=p+this.B_re[e]*d-this.B_im[e]*f,m=m+this.B_im[e]*d+this.B_re[e]*f;return t.x=m*this.a+this.x0,t.y=p*this.a+this.y0,t},inverse:function(t){var e,r,n=t.x,i=t.y,a=n-this.x0,o=(i-this.y0)/this.a,s=a/this.a,l=1,u=0,c=0,h=0;for(e=1;e<=6;e++)r=u*o+l*s,l=l*o-u*s,u=r,c=c+this.C_re[e]*l-this.C_im[e]*u,h=h+this.C_im[e]*l+this.C_re[e]*u;for(var d=0;d<this.iterations;d++){var f,p=c,m=h,g=o,v=s;for(e=2;e<=6;e++)f=m*c+p*h,p=p*c-m*h,m=f,g+=(e-1)*(this.B_re[e]*p-this.B_im[e]*m),v+=(e-1)*(this.B_im[e]*p+this.B_re[e]*m);p=1,m=0;var y=this.B_re[1],x=this.B_im[1];for(e=2;e<=6;e++)f=m*c+p*h,p=p*c-m*h,m=f,y+=e*(this.B_re[e]*p-this.B_im[e]*m),x+=e*(this.B_im[e]*p+this.B_re[e]*m);var _=y*y+x*x;c=(g*y+v*x)/_,h=(v*y-g*x)/_}var w=c,b=h,M=1,S=0;for(e=1;e<=9;e++)M*=w,S+=this.D[e]*M;var T=this.lat0+S*Yf*1e5,E=this.long0+b;return t.x=E,t.y=T,t},names:["New_Zealand_Map_Grid","nzmg"]};const Og={init:function(){},forward:function(t){var e=t.x,r=t.y,n=Cp(e-this.long0),i=this.x0+this.a*n,a=this.y0+this.a*Math.log(Math.tan(Math.PI/4+r/2.5))*1.25;return t.x=i,t.y=a,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e=Cp(this.long0+t.x/this.a),r=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=r,t},names:["Miller_Cylindrical","mill"]};const Dg={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=jm(this.es)},forward:function(t){var e,r,n=t.x,i=t.y;if(n=Cp(n-this.long0),this.sphere){if(this.m)for(var a=this.n*Math.sin(i),o=20;o;--o){var s=(this.m*i+Math.sin(i)-a)/(this.m+Math.cos(i));if(i-=s,Math.abs(s)<$f)break}else i=1!==this.n?Math.asin(this.n*Math.sin(i)):i;e=this.a*this.C_x*n*(this.m+Math.cos(i)),r=this.a*this.C_y*i}else{var l=Math.sin(i),u=Math.cos(i);r=this.a*Vm(i,l,u,this.en),e=this.a*n*u/Math.sqrt(1-this.es*l*l)}return t.x=e,t.y=r,t},inverse:function(t){var e,r,n;return t.x-=this.x0,r=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,r/=this.C_x*(this.m+Math.cos(e)),this.m?e=Eg((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=Eg(Math.sin(e)/this.n)),r=Cp(r+this.long0),e=mg(e)):(e=Wm(t.y/this.a,this.es,this.en),(n=Math.abs(e))<Zf?(n=Math.sin(e),r=Cp(this.long0+t.x*Math.sqrt(1-this.es*n*n)/(this.a*Math.cos(e)))):n-$f<Zf&&(r=this.long0)),t.x=r,t.y=e,t},names:["Sinusoidal","sinu"]};const kg={init:function(){},forward:function(t){for(var e=t.x,r=t.y,n=Cp(e-this.long0),i=r,a=Math.PI*Math.sin(r);;){var o=-(i+Math.sin(i)-a)/(1+Math.cos(i));if(i+=o,Math.abs(o)<$f)break}i/=2,Math.PI/2-Math.abs(r)<$f&&(n=0);var s=.900316316158*this.a*n*Math.cos(i)+this.x0,l=1.4142135623731*this.a*Math.sin(i)+this.y0;return t.x=s,t.y=l,t},inverse:function(t){var e,r;t.x-=this.x0,t.y-=this.y0,r=t.y/(1.4142135623731*this.a),Math.abs(r)>.999999999999&&(r=.999999999999),e=Math.asin(r);var n=Cp(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),r=(2*e+Math.sin(2*e))/Math.PI,Math.abs(r)>1&&(r=1);var i=Math.asin(r);return t.x=n,t.y=i,t},names:["Mollweide","moll"]};const Fg={init:function(){Math.abs(this.lat1+this.lat2)<$f||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=cg(this.es),this.e1=hg(this.es),this.e2=dg(this.es),this.e3=fg(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Rp(this.e,this.sinphi,this.cosphi),this.ml1=ug(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<$f?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Rp(this.e,this.sinphi,this.cosphi),this.ml2=ug(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=ug(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var e,r=t.x,n=t.y;if(this.sphere)e=this.a*(this.g-n);else{var i=ug(this.e0,this.e1,this.e2,this.e3,n);e=this.a*(this.g-i)}var a=this.ns*Cp(r-this.long0),o=this.x0+e*Math.sin(a),s=this.y0+this.rh-e*Math.cos(a);return t.x=o,t.y=s,t},inverse:function(t){var e,r,n,i;t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns>=0?(r=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(r=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var a=0;return 0!==r&&(a=Math.atan2(e*t.x,e*t.y)),this.sphere?(i=Cp(this.long0+a/this.ns),n=mg(this.g-r/this.a),t.x=i,t.y=n,t):(n=gg(this.g-r/this.a,this.e0,this.e1,this.e2,this.e3),i=Cp(this.long0+a/this.ns),t.x=i,t.y=n,t)},names:["Equidistant_Conic","eqdc"]};const Ng={init:function(){this.R=this.a},forward:function(t){var e,r,n=t.x,i=t.y,a=Cp(n-this.long0);Math.abs(i)<=$f&&(e=this.x0+this.R*a,r=this.y0);var o=Eg(2*Math.abs(i/Math.PI));(Math.abs(a)<=$f||Math.abs(Math.abs(i)-Zf)<=$f)&&(e=this.x0,r=i>=0?this.y0+Math.PI*this.R*Math.tan(.5*o):this.y0+Math.PI*this.R*-Math.tan(.5*o));var s=.5*Math.abs(Math.PI/a-a/Math.PI),l=s*s,u=Math.sin(o),c=Math.cos(o),h=c/(u+c-1),d=h*h,f=h*(2/u-1),p=f*f,m=Math.PI*this.R*(s*(h-p)+Math.sqrt(l*(h-p)*(h-p)-(p+l)*(d-p)))/(p+l);a<0&&(m=-m),e=this.x0+m;var g=l+h;return m=Math.PI*this.R*(f*g-s*Math.sqrt((p+l)*(l+1)-g*g))/(p+l),r=i>=0?this.y0+m:this.y0-m,t.x=e,t.y=r,t},inverse:function(t){var e,r,n,i,a,o,s,l,u,c,h,d;return t.x-=this.x0,t.y-=this.y0,h=Math.PI*this.R,a=(n=t.x/h)*n+(i=t.y/h)*i,h=3*(i*i/(l=-2*(o=-Math.abs(i)*(1+a))+1+2*i*i+a*a)+(2*(s=o-2*i*i+n*n)*s*s/l/l/l-9*o*s/l/l)/27)/(u=(o-s*s/3/l)/l)/(c=2*Math.sqrt(-u/3)),Math.abs(h)>1&&(h=h>=0?1:-1),d=Math.acos(h)/3,r=t.y>=0?(-c*Math.cos(d+Math.PI/3)-s/3/l)*Math.PI:-(-c*Math.cos(d+Math.PI/3)-s/3/l)*Math.PI,e=Math.abs(n)<$f?this.long0:Cp(this.long0+Math.PI*(a-1+Math.sqrt(1+2*(n*n-i*i)+a*a))/2/n),t.x=e,t.y=r,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]};const Ug={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var e,r,n,i,a,o,s,l,u,c,h,d,f,p,m,g,v,y,x,_,w,b,M=t.x,S=t.y,T=Math.sin(t.y),E=Math.cos(t.y),A=Cp(M-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=$f?(t.x=this.x0+this.a*(Zf-S)*Math.sin(A),t.y=this.y0-this.a*(Zf-S)*Math.cos(A),t):Math.abs(this.sin_p12+1)<=$f?(t.x=this.x0+this.a*(Zf+S)*Math.sin(A),t.y=this.y0+this.a*(Zf+S)*Math.cos(A),t):(y=this.sin_p12*T+this.cos_p12*E*Math.cos(A),v=(g=Math.acos(y))?g/Math.sin(g):1,t.x=this.x0+this.a*v*E*Math.sin(A),t.y=this.y0+this.a*v*(this.cos_p12*T-this.sin_p12*E*Math.cos(A)),t):(e=cg(this.es),r=hg(this.es),n=dg(this.es),i=fg(this.es),Math.abs(this.sin_p12-1)<=$f?(a=this.a*ug(e,r,n,i,Zf),o=this.a*ug(e,r,n,i,S),t.x=this.x0+(a-o)*Math.sin(A),t.y=this.y0-(a-o)*Math.cos(A),t):Math.abs(this.sin_p12+1)<=$f?(a=this.a*ug(e,r,n,i,Zf),o=this.a*ug(e,r,n,i,S),t.x=this.x0+(a+o)*Math.sin(A),t.y=this.y0+(a+o)*Math.cos(A),t):(s=T/E,l=pg(this.a,this.e,this.sin_p12),u=pg(this.a,this.e,T),c=Math.atan((1-this.es)*s+this.es*l*this.sin_p12/(u*E)),x=0===(h=Math.atan2(Math.sin(A),this.cos_p12*Math.tan(c)-this.sin_p12*Math.cos(A)))?Math.asin(this.cos_p12*Math.sin(c)-this.sin_p12*Math.cos(c)):Math.abs(Math.abs(h)-Math.PI)<=$f?-Math.asin(this.cos_p12*Math.sin(c)-this.sin_p12*Math.cos(c)):Math.asin(Math.sin(A)*Math.cos(c)/Math.sin(h)),d=this.e*this.sin_p12/Math.sqrt(1-this.es),g=l*x*(1-(_=x*x)*(m=(f=this.e*this.cos_p12*Math.cos(h)/Math.sqrt(1-this.es))*f)*(1-m)/6+(w=_*x)/8*(p=d*f)*(1-2*m)+(b=w*x)/120*(m*(4-7*m)-3*d*d*(1-7*m))-b*x/48*p),t.x=this.x0+g*Math.sin(h),t.y=this.y0+g*Math.cos(h),t))},inverse:function(t){var e,r,n,i,a,o,s,l,u,c,h,d,f,p,m,g,v,y,x,_,w,b,M;if(t.x-=this.x0,t.y-=this.y0,this.sphere){if((e=Math.sqrt(t.x*t.x+t.y*t.y))>2*Zf*this.a)return;return r=e/this.a,n=Math.sin(r),i=Math.cos(r),a=this.long0,Math.abs(e)<=$f?o=this.lat0:(o=Eg(i*this.sin_p12+t.y*n*this.cos_p12/e),s=Math.abs(this.lat0)-Zf,a=Math.abs(s)<=$f?this.lat0>=0?Cp(this.long0+Math.atan2(t.x,-t.y)):Cp(this.long0-Math.atan2(-t.x,t.y)):Cp(this.long0+Math.atan2(t.x*n,e*this.cos_p12*i-t.y*this.sin_p12*n))),t.x=a,t.y=o,t}return l=cg(this.es),u=hg(this.es),c=dg(this.es),h=fg(this.es),Math.abs(this.sin_p12-1)<=$f?(o=gg(((d=this.a*ug(l,u,c,h,Zf))-(e=Math.sqrt(t.x*t.x+t.y*t.y)))/this.a,l,u,c,h),a=Cp(this.long0+Math.atan2(t.x,-1*t.y)),t.x=a,t.y=o,t):Math.abs(this.sin_p12+1)<=$f?(d=this.a*ug(l,u,c,h,Zf),o=gg(((e=Math.sqrt(t.x*t.x+t.y*t.y))-d)/this.a,l,u,c,h),a=Cp(this.long0+Math.atan2(t.x,t.y)),t.x=a,t.y=o,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),m=Math.atan2(t.x,t.y),f=pg(this.a,this.e,this.sin_p12),g=Math.cos(m),y=-(v=this.e*this.cos_p12*g)*v/(1-this.es),x=3*this.es*(1-y)*this.sin_p12*this.cos_p12*g/(1-this.es),b=1-y*(w=(_=e/f)-y*(1+y)*Math.pow(_,3)/6-x*(1+3*y)*Math.pow(_,4)/24)*w/2-_*w*w*w/6,p=Math.asin(this.sin_p12*Math.cos(w)+this.cos_p12*Math.sin(w)*g),a=Cp(this.long0+Math.asin(Math.sin(m)*Math.sin(w)/Math.cos(p))),M=Math.sin(p),o=Math.atan2((M-this.es*b*this.sin_p12)*Math.tan(p),M*(1-this.es)),t.x=a,t.y=o,t)},names:["Azimuthal_Equidistant","aeqd"]};const Bg={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var e,r,n,i,a,o,s,l=t.x,u=t.y;return n=Cp(l-this.long0),e=Math.sin(u),r=Math.cos(u),i=Math.cos(n),1,((a=this.sin_p14*e+this.cos_p14*r*i)>0||Math.abs(a)<=$f)&&(o=1*this.a*r*Math.sin(n),s=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*r*i)),t.x=o,t.y=s,t},inverse:function(t){var e,r,n,i,a,o,s;return t.x-=this.x0,t.y-=this.y0,r=Eg((e=Math.sqrt(t.x*t.x+t.y*t.y))/this.a),n=Math.sin(r),i=Math.cos(r),o=this.long0,Math.abs(e)<=$f?(s=this.lat0,t.x=o,t.y=s,t):(s=Eg(i*this.sin_p14+t.y*n*this.cos_p14/e),a=Math.abs(this.lat0)-Zf,Math.abs(a)<=$f?(o=this.lat0>=0?Cp(this.long0+Math.atan2(t.x,-t.y)):Cp(this.long0-Math.atan2(-t.x,t.y)),t.x=o,t.y=s,t):(o=Cp(this.long0+Math.atan2(t.x*n,e*this.cos_p14*i-t.y*this.sin_p14*n)),t.x=o,t.y=s,t))},names:["ortho"]};var zg=1,Gg=2,jg=3,Vg=4,Hg=5,Wg=6,qg={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function Xg(t,e,r,n){var i;return t<$f?(n.value=qg.AREA_0,i=0):(i=Math.atan2(e,r),Math.abs(i)<=rp?n.value=qg.AREA_0:i>rp&&i<=Zf+rp?(n.value=qg.AREA_1,i-=Zf):i>Zf+rp||i<=-(Zf+rp)?(n.value=qg.AREA_2,i=i>=0?i-ip:i+ip):(n.value=qg.AREA_3,i+=Zf)),i}function Yg(t,e){var r=t+e;return r<-ip?r+=np:r>+ip&&(r-=np),r}const Zg={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Zf-rp/2?this.face=Hg:this.lat0<=-(Zf-rp/2)?this.face=Wg:Math.abs(this.long0)<=rp?this.face=zg:Math.abs(this.long0)<=Zf+rp?this.face=this.long0>0?Gg:Vg:this.face=jg,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(t){var e,r,n,i,a,o,s={x:0,y:0},l={value:0};if(t.x-=this.long0,e=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,r=t.x,this.face===Hg)i=Zf-e,r>=rp&&r<=Zf+rp?(l.value=qg.AREA_0,n=r-Zf):r>Zf+rp||r<=-(Zf+rp)?(l.value=qg.AREA_1,n=r>0?r-ip:r+ip):r>-(Zf+rp)&&r<=-rp?(l.value=qg.AREA_2,n=r+Zf):(l.value=qg.AREA_3,n=r);else if(this.face===Wg)i=Zf+e,r>=rp&&r<=Zf+rp?(l.value=qg.AREA_0,n=-r+Zf):r<rp&&r>=-rp?(l.value=qg.AREA_1,n=-r):r<-rp&&r>=-(Zf+rp)?(l.value=qg.AREA_2,n=-r-Zf):(l.value=qg.AREA_3,n=r>0?-r+ip:-r-ip);else{var u,c,h,d,f,p;this.face===Gg?r=Yg(r,+Zf):this.face===jg?r=Yg(r,+ip):this.face===Vg&&(r=Yg(r,-Zf)),d=Math.sin(e),f=Math.cos(e),p=Math.sin(r),u=f*Math.cos(r),c=f*p,h=d,this.face===zg?n=Xg(i=Math.acos(u),h,c,l):this.face===Gg?n=Xg(i=Math.acos(c),h,-u,l):this.face===jg?n=Xg(i=Math.acos(-u),h,-c,l):this.face===Vg?n=Xg(i=Math.acos(-c),h,u,l):(i=n=0,l.value=qg.AREA_0)}return o=Math.atan(12/ip*(n+Math.acos(Math.sin(n)*Math.cos(rp))-Zf)),a=Math.sqrt((1-Math.cos(i))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(n))))),l.value===qg.AREA_1?o+=Zf:l.value===qg.AREA_2?o+=ip:l.value===qg.AREA_3&&(o+=1.5*ip),s.x=a*Math.cos(o),s.y=a*Math.sin(o),s.x=s.x*this.a+this.x0,s.y=s.y*this.a+this.y0,t.x=s.x,t.y=s.y,t},inverse:function(t){var e,r,n,i,a,o,s,l,u,c,h,d,f={lam:0,phi:0},p={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,r=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),e=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?p.value=qg.AREA_0:t.y>=0&&t.y>=Math.abs(t.x)?(p.value=qg.AREA_1,e-=Zf):t.x<0&&-t.x>=Math.abs(t.y)?(p.value=qg.AREA_2,e=e<0?e+ip:e-ip):(p.value=qg.AREA_3,e+=Zf),u=ip/12*Math.tan(e),a=Math.sin(u)/(Math.cos(u)-1/Math.sqrt(2)),o=Math.atan(a),(s=1-(n=Math.cos(e))*n*(i=Math.tan(r))*i*(1-Math.cos(Math.atan(1/Math.cos(o)))))<-1?s=-1:s>1&&(s=1),this.face===Hg)l=Math.acos(s),f.phi=Zf-l,p.value===qg.AREA_0?f.lam=o+Zf:p.value===qg.AREA_1?f.lam=o<0?o+ip:o-ip:p.value===qg.AREA_2?f.lam=o-Zf:f.lam=o;else if(this.face===Wg)l=Math.acos(s),f.phi=l-Zf,p.value===qg.AREA_0?f.lam=-o+Zf:p.value===qg.AREA_1?f.lam=-o:p.value===qg.AREA_2?f.lam=-o-Zf:f.lam=o<0?-o-ip:-o+ip;else{var m,g,v;u=(m=s)*m,g=(u+=(v=u>=1?0:Math.sqrt(1-u)*Math.sin(o))*v)>=1?0:Math.sqrt(1-u),p.value===qg.AREA_1?(u=g,g=-v,v=u):p.value===qg.AREA_2?(g=-g,v=-v):p.value===qg.AREA_3&&(u=g,g=v,v=-u),this.face===Gg?(u=m,m=-g,g=u):this.face===jg?(m=-m,g=-g):this.face===Vg&&(u=m,m=g,g=-u),f.phi=Math.acos(-v)-Zf,f.lam=Math.atan2(g,m),this.face===Gg?f.lam=Yg(f.lam,-Zf):this.face===jg?f.lam=Yg(f.lam,-ip):this.face===Vg&&(f.lam=Yg(f.lam,+Zf))}return 0!==this.es&&(c=f.phi<0?1:0,h=Math.tan(f.phi),d=this.b/Math.sqrt(h*h+this.one_minus_f_squared),f.phi=Math.atan(Math.sqrt(this.a*this.a-d*d)/(this.one_minus_f*d)),c&&(f.phi=-f.phi)),f.lam+=this.long0,t.x=f.lam,t.y=f.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]};var Kg=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Jg=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Qg=.8487,$g=1.3523,tv=ep/5,ev=1/tv,rv=18,nv=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))};const iv={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(t){var e=Cp(t.x-this.long0),r=Math.abs(t.y),n=Math.floor(r*tv);n<0?n=0:n>=rv&&(n=17);var i={x:nv(Kg[n],r=ep*(r-ev*n))*e,y:nv(Jg[n],r)};return t.y<0&&(i.y=-i.y),i.x=i.x*this.a*Qg+this.x0,i.y=i.y*this.a*$g+this.y0,i},inverse:function(t){var e={x:(t.x-this.x0)/(this.a*Qg),y:Math.abs(t.y-this.y0)/(this.a*$g)};if(e.y>=1)e.x/=Kg[18][0],e.y=t.y<0?-Zf:Zf;else{var r=Math.floor(e.y*rv);for(r<0?r=0:r>=rv&&(r=17);;)if(Jg[r][0]>e.y)--r;else{if(!(Jg[r+1][0]<=e.y))break;++r}var n=Jg[r],i=5*(e.y-n[0])/(Jg[r+1][0]-n[0]);i=function(t,e,r,n){for(var i=e;n;--n){var a=t(i);if(i-=a,Math.abs(a)<r)break}return i}((function(t){return(nv(n,t)-e.y)/function(t,e){return t[1]+e*(2*t[2]+3*e*t[3])}(n,t)}),i,$f,100),e.x/=nv(Kg[r],i),e.y=(5*r+i)*tp,t.y<0&&(e.y=-e.y)}return e.x=Cp(e.x+this.long0),e},names:["Robinson","robin"]};const av={init:function(){this.name="geocent"},forward:function(t){return Kp(t,this.es,this.a)},inverse:function(t){return Jp(t,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]};var ov=0,sv=1,lv=2,uv=3,cv={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};const hv={init:function(){if(Object.keys(cv).forEach(function(t){if(void 0===this[t])this[t]=cv[t].def;else{if(cv[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);cv[t].num&&(this[t]=parseFloat(this[t]))}cv[t].degrees&&(this[t]=this[t]*tp)}.bind(this)),Math.abs(Math.abs(this.lat0)-Zf)<$f?this.mode=this.lat0<0?sv:ov:Math.abs(this.lat0)<$f?this.mode=lv:(this.mode=uv,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(t),this.sw=Math.sin(t)},forward:function(t){t.x-=this.long0;var e,r,n,i,a=Math.sin(t.y),o=Math.cos(t.y),s=Math.cos(t.x);switch(this.mode){case uv:r=this.sinph0*a+this.cosph0*o*s;break;case lv:r=o*s;break;case sv:r=-a;break;case ov:r=a}switch(e=(r=this.pn1/(this.p-r))*o*Math.sin(t.x),this.mode){case uv:r*=this.cosph0*a-this.sinph0*o*s;break;case lv:r*=a;break;case ov:r*=-o*s;break;case sv:r*=o*s}return i=1/((n=r*this.cg+e*this.sg)*this.sw*this.h1+this.cw),e=(e*this.cg-r*this.sg)*this.cw*i,r=n*i,t.x=e*this.a,t.y=r*this.a,t},inverse:function(t){t.x/=this.a,t.y/=this.a;var e,r,n,i={x:t.x,y:t.y};n=1/(this.pn1-t.y*this.sw),e=this.pn1*t.x*n,r=this.pn1*t.y*this.cw*n,t.x=e*this.cg+r*this.sg,t.y=r*this.cg-e*this.sg;var a=Ym(t.x,t.y);if(Math.abs(a)<$f)i.x=0,i.y=t.y;else{var o,s;switch(s=1-a*a*this.pfact,s=(this.p-Math.sqrt(s))/(this.pn1/a+a/this.pn1),o=Math.sqrt(1-s*s),this.mode){case uv:i.y=Math.asin(o*this.sinph0+t.y*s*this.cosph0/a),t.y=(o-this.sinph0*Math.sin(i.y))*a,t.x*=s*this.cosph0;break;case lv:i.y=Math.asin(t.y*s/a),t.y=o*a,t.x*=s;break;case ov:i.y=Math.asin(o),t.y=-t.y;break;case sv:i.y=-Math.asin(o)}i.x=Math.atan2(t.x,t.y)}return t.x=i.x+this.long0,t.y=i.y,t},names:["Tilted_Perspective","tpers"]};const dv={init:function(){if(this.flip_axis="x"===this.sweep?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,0!==this.es){var t=1-this.es,e=1/t;this.radius_p=Math.sqrt(t),this.radius_p2=t,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")},forward:function(t){var e,r,n,i,a=t.x,o=t.y;if(a-=this.long0,"ellipse"===this.shape){o=Math.atan(this.radius_p2*Math.tan(o));var s=this.radius_p/Ym(this.radius_p*Math.cos(o),Math.sin(o));if(r=s*Math.cos(a)*Math.cos(o),n=s*Math.sin(a)*Math.cos(o),i=s*Math.sin(o),(this.radius_g-r)*r-n*n-i*i*this.radius_p_inv2<0)return t.x=Number.NaN,t.y=Number.NaN,t;e=this.radius_g-r,this.flip_axis?(t.x=this.radius_g_1*Math.atan(n/Ym(i,e)),t.y=this.radius_g_1*Math.atan(i/e)):(t.x=this.radius_g_1*Math.atan(n/e),t.y=this.radius_g_1*Math.atan(i/Ym(n,e)))}else"sphere"===this.shape&&(e=Math.cos(o),r=Math.cos(a)*e,n=Math.sin(a)*e,i=Math.sin(o),e=this.radius_g-r,this.flip_axis?(t.x=this.radius_g_1*Math.atan(n/Ym(i,e)),t.y=this.radius_g_1*Math.atan(i/e)):(t.x=this.radius_g_1*Math.atan(n/e),t.y=this.radius_g_1*Math.atan(i/Ym(n,e))));return t.x=t.x*this.a,t.y=t.y*this.a,t},inverse:function(t){var e,r,n,i,a=-1,o=0,s=0;if(t.x=t.x/this.a,t.y=t.y/this.a,"ellipse"===this.shape){this.flip_axis?(s=Math.tan(t.y/this.radius_g_1),o=Math.tan(t.x/this.radius_g_1)*Ym(1,s)):(o=Math.tan(t.x/this.radius_g_1),s=Math.tan(t.y/this.radius_g_1)*Ym(1,o));var l=s/this.radius_p;if(e=o*o+l*l+a*a,(n=(r=2*this.radius_g*a)*r-4*e*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;i=(-r-Math.sqrt(n))/(2*e),a=this.radius_g+i*a,o*=i,s*=i,t.x=Math.atan2(o,a),t.y=Math.atan(s*Math.cos(t.x)/a),t.y=Math.atan(this.radius_p_inv2*Math.tan(t.y))}else if("sphere"===this.shape){if(this.flip_axis?(s=Math.tan(t.y/this.radius_g_1),o=Math.tan(t.x/this.radius_g_1)*Math.sqrt(1+s*s)):(o=Math.tan(t.x/this.radius_g_1),s=Math.tan(t.y/this.radius_g_1)*Math.sqrt(1+o*o)),e=o*o+s*s+a*a,(n=(r=2*this.radius_g*a)*r-4*e*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;i=(-r-Math.sqrt(n))/(2*e),a=this.radius_g+i*a,o*=i,s*=i,t.x=Math.atan2(o,a),t.y=Math.atan(s*Math.cos(t.x)/a)}return t.x=t.x+this.long0,t},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]};var fv;cm.defaultDatum="WGS84",cm.Proj=Zp,cm.WGS84=new cm.Proj("WGS84"),cm.Point=Pm,cm.toPoint=im,cm.defs=Mp,cm.nadgrid=function(t,e){var r=new DataView(e),n=function(t){var e=t.getInt32(8,!1);if(11===e)return!1;e=t.getInt32(8,!0),11!==e&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian");return!0}(r),i=function(t,e){return{nFields:t.getInt32(8,e),nSubgridFields:t.getInt32(24,e),nSubgrids:t.getInt32(40,e),shiftType:Wp(t,56,64).trim(),fromSemiMajorAxis:t.getFloat64(120,e),fromSemiMinorAxis:t.getFloat64(136,e),toSemiMajorAxis:t.getFloat64(152,e),toSemiMinorAxis:t.getFloat64(168,e)}}(r,n);i.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var a=function(t,e,r){for(var n=176,i=[],a=0;a<e.nSubgrids;a++){var o=Xp(t,n,r),s=Yp(t,n,o,r),l=Math.round(1+(o.upperLongitude-o.lowerLongitude)/o.longitudeInterval),u=Math.round(1+(o.upperLatitude-o.lowerLatitude)/o.latitudeInterval);i.push({ll:[Hp(o.lowerLongitude),Hp(o.lowerLatitude)],del:[Hp(o.longitudeInterval),Hp(o.latitudeInterval)],lim:[l,u],count:o.gridNodeCount,cvs:qp(s)})}return i}(r,i,n),o={header:i,subgrids:a};return jp[t]=o,o},cm.transform=om,cm.mgrs=xm,cm.version="__VERSION__",(fv=cm).Proj.projections.add(qm),fv.Proj.projections.add(Qm),fv.Proj.projections.add($m),fv.Proj.projections.add(rg),fv.Proj.projections.add(ng),fv.Proj.projections.add(ig),fv.Proj.projections.add(og),fv.Proj.projections.add(sg),fv.Proj.projections.add(lg),fv.Proj.projections.add(vg),fv.Proj.projections.add(Tg),fv.Proj.projections.add(Ag),fv.Proj.projections.add(Rg),fv.Proj.projections.add(Pg),fv.Proj.projections.add(Cg),fv.Proj.projections.add(Ig),fv.Proj.projections.add(Lg),fv.Proj.projections.add(Og),fv.Proj.projections.add(Dg),fv.Proj.projections.add(kg),fv.Proj.projections.add(Fg),fv.Proj.projections.add(Ng),fv.Proj.projections.add(Ug),fv.Proj.projections.add(Bg),fv.Proj.projections.add(Zg),fv.Proj.projections.add(iv),fv.Proj.projections.add(av),fv.Proj.projections.add(hv),fv.Proj.projections.add(dv);const pv=of(Object.freeze(Object.defineProperty({__proto__:null,default:cm},Symbol.toStringTag,{value:"Module"})));var mv={RADIANS:"radians",DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},gv={};gv[mv.RADIANS]=6370997/(2*Math.PI),gv[mv.DEGREES]=2*Math.PI*6370997/360,gv[mv.FEET]=.3048,gv[mv.METERS]=1,gv[mv.USFEET]=1200/3937;const vv=mv;const yv=function(){function t(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}return t.prototype.canWrapX=function(){return this.canWrapX_},t.prototype.getCode=function(){return this.code_},t.prototype.getExtent=function(){return this.extent_},t.prototype.getUnits=function(){return this.units_},t.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||gv[this.units_]},t.prototype.getWorldExtent=function(){return this.worldExtent_},t.prototype.getAxisOrientation=function(){return this.axisOrientation_},t.prototype.isGlobal=function(){return this.global_},t.prototype.setGlobal=function(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)},t.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},t.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t},t.prototype.setExtent=function(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)},t.prototype.setWorldExtent=function(t){this.worldExtent_=t},t.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t},t.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},t}();function xv(t,e,r){return Math.min(Math.max(t,e),r)}var _v="cosh"in Math?Math.cosh:function(t){var e=Math.exp(t);return(e+1/e)/2},wv="log2"in Math?Math.log2:function(t){return Math.log(t)*Math.LOG2E};function bv(t){return t*Math.PI/180}function Mv(t,e){var r=t%e;return r*e<0?r+e:r}function Sv(t,e,r){return t+r*(e-t)}function Tv(t,e){var r=Math.pow(10,e);return Math.round(t*r)/r}function Ev(t,e){return Math.floor(Tv(t,e))}function Av(t,e){return Math.ceil(Tv(t,e))}var Rv,Pv=globalThis&&globalThis.__extends||(Rv=function(t,e){return(Rv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}Rv(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),Cv=6378137,Iv=Math.PI*Cv,Lv=[-Iv,-Iv,Iv,Iv],Ov=[-180,-85,180,85],Dv=Cv*Math.log(Math.tan(Math.PI/2)),kv=function(t){function e(e){return t.call(this,{code:e,units:vv.METERS,extent:Lv,global:!0,worldExtent:Ov,getPointResolution:function(t,e){return t/_v(e[1]/Cv)}})||this}return Pv(e,t),e}(yv),Fv=[new kv("EPSG:3857"),new kv("EPSG:102100"),new kv("EPSG:102113"),new kv("EPSG:900913"),new kv("http://www.opengis.net/def/crs/EPSG/0/3857"),new kv("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Nv(t,e,r){var n=t.length,i=r>1?r:2,a=e;void 0===a&&(a=i>2?t.slice():new Array(n));for(var o=0;o<n;o+=i){a[o]=Iv*t[o]/180;var s=Cv*Math.log(Math.tan(Math.PI*(+t[o+1]+90)/360));s>Dv?s=Dv:s<-Dv&&(s=-Dv),a[o+1]=s}return a}function Uv(t,e,r){var n=t.length,i=r>1?r:2,a=e;void 0===a&&(a=i>2?t.slice():new Array(n));for(var o=0;o<n;o+=i)a[o]=180*t[o]/Iv,a[o+1]=360*Math.atan(Math.exp(t[o+1]/Cv))/Math.PI-90;return a}var Bv=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),zv=[-180,-90,180,90],Gv=6378137*Math.PI/180,jv=function(t){function e(e,r){return t.call(this,{code:e,units:vv.DEGREES,extent:zv,axisOrientation:r,global:!0,metersPerUnit:Gv,worldExtent:zv})||this}return Bv(e,t),e}(yv),Vv=[new jv("CRS:84"),new jv("EPSG:4326","neu"),new jv("urn:ogc:def:crs:OGC:1.3:CRS84"),new jv("urn:ogc:def:crs:OGC:2:84"),new jv("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new jv("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new jv("http://www.opengis.net/def/crs/EPSG/0/4326","neu")],Hv={};var Wv="function"==typeof Object.assign?Object.assign:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(t),n=1,i=arguments.length;n<i;++n){var a=arguments[n];if(null!=a)for(var o in a)a.hasOwnProperty(o)&&(r[o]=a[o])}return r};function qv(t){for(var e in t)delete t[e]}var Xv="function"==typeof Object.values?Object.values:function(t){var e=[];for(var r in t)e.push(t[r]);return e};function Yv(t){var e;for(e in t)return!1;return!e}var Zv={};function Kv(t,e,r){var n=t.getCode(),i=e.getCode();n in Zv||(Zv[n]={}),Zv[n][i]=r}function Jv(t,e){var r;return t in Zv&&e in Zv[t]&&(r=Zv[t][e]),r}const Qv={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function $v(){return function(){throw new Error("Unimplemented abstract method.")}()}var ty=0;function ey(t){return t.ol_uid||(t.ol_uid=String(++ty))}var ry=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const ny=function(t){function e(e){var r=this,n="Assertion failed. See https://openlayers.org/en/"+("v"+"6.15.1".split("-")[0])+"/doc/errors/#"+e+" for details.";return(r=t.call(this,n)||this).code=e,r.name="AssertionError",r.message=n,r}return ry(e,t),e}(Error);function iy(t,e){if(!t)throw new ny(e)}function ay(t){for(var e=dy(),r=0,n=t.length;r<n;++r)vy(e,t[r]);return e}function oy(t,e,r){return r?(r[0]=t[0]-e,r[1]=t[1]-e,r[2]=t[2]+e,r[3]=t[3]+e,r):[t[0]-e,t[1]-e,t[2]+e,t[3]+e]}function sy(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t.slice()}function ly(t,e){return cy(t,e[0],e[1])}function uy(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}function cy(t,e,r){return t[0]<=e&&e<=t[2]&&t[1]<=r&&r<=t[3]}function hy(t,e){var r=t[0],n=t[1],i=t[2],a=t[3],o=e[0],s=e[1],l=Qv.UNKNOWN;return o<r?l|=Qv.LEFT:o>i&&(l|=Qv.RIGHT),s<n?l|=Qv.BELOW:s>a&&(l|=Qv.ABOVE),l===Qv.UNKNOWN&&(l=Qv.INTERSECTING),l}function dy(){return[1/0,1/0,-1/0,-1/0]}function fy(t,e,r,n,i){return i?(i[0]=t,i[1]=e,i[2]=r,i[3]=n,i):[t,e,r,n]}function py(t){return fy(1/0,1/0,-1/0,-1/0,t)}function my(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function gy(t,e){return e[0]<t[0]&&(t[0]=e[0]),e[2]>t[2]&&(t[2]=e[2]),e[1]<t[1]&&(t[1]=e[1]),e[3]>t[3]&&(t[3]=e[3]),t}function vy(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function yy(t,e){for(var r=0,n=e.length;r<n;++r)vy(t,e[r]);return t}function xy(t,e,r,n,i){for(;r<n;r+=i)wy(t,e[r],e[r+1]);return t}function _y(t,e){for(var r=0,n=e.length;r<n;++r)yy(t,e[r]);return t}function wy(t,e,r){t[0]=Math.min(t[0],e),t[1]=Math.min(t[1],r),t[2]=Math.max(t[2],e),t[3]=Math.max(t[3],r)}function by(t,e){var r;return(r=e(Sy(t)))||(r=e(Ty(t)))||(r=e(Ly(t)))?r:(r=e(Iy(t)))||!1}function My(t){var e=0;return ky(t)||(e=Oy(t)*Py(t)),e}function Sy(t){return[t[0],t[1]]}function Ty(t){return[t[2],t[1]]}function Ey(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function Ay(t,e){var r;return"bottom-left"===e?r=Sy(t):"bottom-right"===e?r=Ty(t):"top-left"===e?r=Iy(t):"top-right"===e?r=Ly(t):iy(!1,13),r}function Ry(t,e,r,n){var i=e*n[0]/2,a=e*n[1]/2,o=Math.cos(r),s=Math.sin(r),l=i*o,u=i*s,c=a*o,h=a*s,d=t[0],f=t[1];return[d-l+h,f-u-c,d-l-h,f-u+c,d+l-h,f+u+c,d+l+h,f+u-c,d-l+h,f-u-c]}function Py(t){return t[3]-t[1]}function Cy(t,e,r){var n=r||[1/0,1/0,-1/0,-1/0];return Dy(t,e)?(t[0]>e[0]?n[0]=t[0]:n[0]=e[0],t[1]>e[1]?n[1]=t[1]:n[1]=e[1],t[2]<e[2]?n[2]=t[2]:n[2]=e[2],t[3]<e[3]?n[3]=t[3]:n[3]=e[3]):py(n),n}function Iy(t){return[t[0],t[3]]}function Ly(t){return[t[2],t[3]]}function Oy(t){return t[2]-t[0]}function Dy(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function ky(t){return t[2]<t[0]||t[3]<t[1]}function Fy(t,e,r){var n=!1,i=hy(t,e),a=hy(t,r);if(i===Qv.INTERSECTING||a===Qv.INTERSECTING)n=!0;else{var o=t[0],s=t[1],l=t[2],u=t[3],c=e[0],h=e[1],d=r[0],f=r[1],p=(f-h)/(d-c),m=void 0,g=void 0;a&Qv.ABOVE&&!(i&Qv.ABOVE)&&(n=(m=d-(f-u)/p)>=o&&m<=l),n||!(a&Qv.RIGHT)||i&Qv.RIGHT||(n=(g=f-(d-l)*p)>=s&&g<=u),n||!(a&Qv.BELOW)||i&Qv.BELOW||(n=(m=d-(f-s)/p)>=o&&m<=l),n||!(a&Qv.LEFT)||i&Qv.LEFT||(n=(g=f-(d-o)*p)>=s&&g<=u)}return n}function Ny(t,e,r,n){var i=[];if(n>1)for(var a=t[2]-t[0],o=t[3]-t[1],s=0;s<n;++s)i.push(t[0]+a*s/n,t[1],t[2],t[1]+o*s/n,t[2]-a*s/n,t[3],t[0],t[3]-o*s/n);else i=[t[0],t[1],t[2],t[1],t[2],t[3],t[0],t[3]];e(i,i,2);for(var l=[],u=[],c=(s=0,i.length);s<c;s+=2)l.push(i[s]),u.push(i[s+1]);return function(t,e,r){return fy(Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e),r)}(l,u,r)}function Uy(t,e){var r=e.getExtent(),n=Ey(t);if(e.canWrapX()&&(n[0]<r[0]||n[0]>=r[2])){var i=Oy(r),a=Math.floor((n[0]-r[0])/i)*i;t[0]-=a,t[2]-=a}return t}function By(t,e){if(e.canWrapX()){var r=e.getExtent();if(!isFinite(t[0])||!isFinite(t[2]))return[[r[0],t[1],r[2],t[3]]];Uy(t,e);var n=Oy(r);if(Oy(t)>n)return[[r[0],t[1],r[2],t[3]]];if(t[0]<r[0])return[[t[0]+n,t[1],r[2],t[3]],[r[0],t[1],t[2],t[3]]];if(t[2]>r[2])return[[t[0],t[1],r[2],t[3]],[r[0],t[1],t[2]-n,t[3]]]}return[t]}const zy=Object.freeze(Object.defineProperty({__proto__:null,applyTransform:Ny,approximatelyEquals:function(t,e,r){return Math.abs(t[0]-e[0])<r&&Math.abs(t[2]-e[2])<r&&Math.abs(t[1]-e[1])<r&&Math.abs(t[3]-e[3])<r},boundingExtent:ay,buffer:oy,clone:sy,closestSquaredDistanceXY:function(t,e,r){var n,i;return(n=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0)*n+(i=r<t[1]?t[1]-r:t[3]<r?r-t[3]:0)*i},containsCoordinate:ly,containsExtent:uy,containsXY:cy,coordinateRelationship:hy,createEmpty:dy,createOrUpdate:fy,createOrUpdateEmpty:py,createOrUpdateFromCoordinate:function(t,e){var r=t[0],n=t[1];return fy(r,n,r,n,e)},createOrUpdateFromCoordinates:function(t,e){return yy(py(e),t)},createOrUpdateFromFlatCoordinates:function(t,e,r,n,i){return xy(py(i),t,e,r,n)},createOrUpdateFromRings:function(t,e){return _y(py(e),t)},equals:my,extend:gy,extendCoordinate:vy,extendCoordinates:yy,extendFlatCoordinates:xy,extendRings:_y,extendXY:wy,forEachCorner:by,getArea:My,getBottomLeft:Sy,getBottomRight:Ty,getCenter:Ey,getCorner:Ay,getEnlargedArea:function(t,e){var r=Math.min(t[0],e[0]),n=Math.min(t[1],e[1]);return(Math.max(t[2],e[2])-r)*(Math.max(t[3],e[3])-n)},getForViewAndSize:function(t,e,r,n,i){var a=Ry(t,e,r,n),o=a[0],s=a[1],l=a[2],u=a[3],c=a[4],h=a[5],d=a[6],f=a[7];return fy(Math.min(o,l,c,d),Math.min(s,u,h,f),Math.max(o,l,c,d),Math.max(s,u,h,f),i)},getHeight:Py,getIntersection:Cy,getIntersectionArea:function(t,e){return My(Cy(t,e))},getMargin:function(t){return Oy(t)+Py(t)},getRotatedViewport:Ry,getSize:function(t){return[t[2]-t[0],t[3]-t[1]]},getTopLeft:Iy,getTopRight:Ly,getWidth:Oy,intersects:Dy,intersectsSegment:Fy,isEmpty:ky,returnOrUpdate:function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t},scaleFromCenter:function(t,e){var r=(t[2]-t[0])/2*(e-1),n=(t[3]-t[1])/2*(e-1);t[0]-=r,t[2]+=r,t[1]-=n,t[3]+=n},wrapAndSliceX:By,wrapX:Uy},Symbol.toStringTag,{value:"Module"}));var Gy,jy,Vy,Hy=6371008.8;function Wy(t,e,r){var n=r||Hy,i=bv(t[1]),a=bv(e[1]),o=(a-i)/2,s=bv(e[0]-t[0])/2,l=Math.sin(o)*Math.sin(o)+Math.sin(s)*Math.sin(s)*Math.cos(i)*Math.cos(a);return 2*n*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}function qy(t,e,r){var n;if(void 0!==e){for(var i=0,a=t.length;i<a;++i)e[i]=t[i];n=e}else n=t.slice();return n}function Xy(t,e,r){if(void 0!==e&&t!==e){for(var n=0,i=t.length;n<i;++n)e[n]=t[n];t=e}return t}function Yy(t){!function(t,e){Hv[t]=e}(t.getCode(),t),Kv(t,t,qy)}function Zy(t){return"string"==typeof t?Hv[e=t]||Hv[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null:t||null;var e}function Ky(t,e,r,n){var i,a=(t=Zy(t)).getPointResolutionFunc();if(a){if(i=a(e,r),n&&n!==t.getUnits())(s=t.getMetersPerUnit())&&(i=i*s/gv[n])}else{var o=t.getUnits();if(o==vv.DEGREES&&!n||n==vv.DEGREES)i=e;else{var s,l=tx(t,Zy("EPSG:4326"));if(l===Xy&&o!==vv.DEGREES)i=e*t.getMetersPerUnit();else{var u=[r[0]-e/2,r[1],r[0]+e/2,r[1],r[0],r[1]-e/2,r[0],r[1]+e/2];i=(Wy((u=l(u,u,2)).slice(0,2),u.slice(2,4))+Wy(u.slice(4,6),u.slice(6,8)))/2}void 0!==(s=n?gv[n]:t.getMetersPerUnit())&&(i/=s)}}return i}function Jy(t){!function(t){t.forEach(Yy)}(t),t.forEach((function(e){t.forEach((function(t){e!==t&&Kv(e,t,qy)}))}))}function Qy(t){return function(e,r,n){for(var i=e.length,a=void 0!==n?n:2,o=void 0!==r?r:new Array(i),s=0;s<i;s+=a)for(var l=t(e.slice(s,s+a)),u=l.length,c=0,h=a;c<h;++c)o[s+c]=c>=u?e[s+c]:l[c];return o}}function $y(t,e){if(t===e)return!0;var r=t.getUnits()===e.getUnits();return(t.getCode()===e.getCode()||tx(t,e)===qy)&&r}function tx(t,e){var r=Jv(t.getCode(),e.getCode());return r||(r=Xy),r}function ex(t,e){return tx(Zy(t),Zy(e))}function rx(t,e,r){return ex(e,r)(t,void 0,t.length)}function nx(t,e,r){return function(n){var i,a;if(t.canWrapX()){var o=t.getExtent(),s=Oy(o);a=function(t,e,r){var n=e.getExtent(),i=0;if(e.canWrapX()&&(t[0]<n[0]||t[0]>n[2])){var a=r||Oy(n);i=Math.floor((t[0]-n[0])/a)}return i}(n=n.slice(0),t,s),a&&(n[0]=n[0]-a*s),n[0]=xv(n[0],o[0],o[2]),n[1]=xv(n[1],o[1],o[3]),i=r(n)}else i=r(n);return a&&e.canWrapX()&&(i[0]+=a*Oy(e.getExtent())),i}}Jy(Fv),Jy(Vv),Gy=Fv,jy=Nv,Vy=Uv,Vv.forEach((function(t){Gy.forEach((function(e){Kv(t,e,jy),Kv(e,t,Vy)}))}));const ix=Object.freeze(Object.defineProperty({__proto__:null,register:function(t){var e,r,n,i,a,o,s,l,u=Object.keys(t.defs),c=u.length;for(e=0;e<c;++e){var h=u[e];if(!Zy(h)){var d=t.defs(h),f=d.units;f||"longlat"!==d.projName||(f=vv.DEGREES),Yy(new yv({code:h,axisOrientation:d.axis,metersPerUnit:d.to_meter,units:f}))}}for(e=0;e<c;++e){var p=u[e],m=Zy(p);for(r=0;r<c;++r){var g=u[r],v=Zy(g);if(!Jv(p,g))if(t.defs[p]===t.defs[g])Jy([m,v]);else{var y=t(p,g);n=m,i=v,a=nx(m,v,y.forward),o=nx(v,m,y.inverse),s=void 0,l=void 0,s=Zy(n),l=Zy(i),Kv(s,l,Qy(a)),Kv(l,s,Qy(o))}}}}},Symbol.toStringTag,{value:"Module"})),ax=of(ix);var ox,sx,lx={},ux={},cx={},hx={get exports(){return cx},set exports(t){cx=t}},dx={},fx={get exports(){return dx},set exports(t){dx=t}};function px(){return sx||(sx=1,function(t){var e=Pf(),r=(ox||(ox=1,function(t){t.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}},t.exports.__esModule=!0,t.exports.default=t.exports}(fx)),dx);function n(i,a,o){return r()?(t.exports=n=Reflect.construct.bind(),t.exports.__esModule=!0,t.exports.default=t.exports):(t.exports=n=function(t,r,n){var i=[null];i.push.apply(i,r);var a=new(Function.bind.apply(t,i));return n&&e(a,n.prototype),a},t.exports.__esModule=!0,t.exports.default=t.exports),n.apply(null,arguments)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports}(hx)),cx}var mx,gx,vx={},yx={get exports(){return vx},set exports(t){vx=t}},xx={},_x={get exports(){return xx},set exports(t){xx=t}},wx={},bx={get exports(){return wx},set exports(t){wx=t}};function Mx(){return mx||(mx=1,function(t){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n},t.exports.__esModule=!0,t.exports.default=t.exports}(bx)),wx}var Sx,Tx={},Ex={get exports(){return Tx},set exports(t){Tx=t}};var Ax,Rx={},Px={get exports(){return Rx},set exports(t){Rx=t}};function Cx(){return Ax||(Ax=1,function(t){var e=Mx();t.exports=function(t,r){if(t){if("string"==typeof t)return e(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,r):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports}(Px)),Rx}var Ix,Lx,Ox,Dx,kx={},Fx={get exports(){return kx},set exports(t){kx=t}};function Nx(){return Lx||(Lx=1,function(t){var e=(gx||(gx=1,function(t){var e=Mx();t.exports=function(t){if(Array.isArray(t))return e(t)},t.exports.__esModule=!0,t.exports.default=t.exports}(_x)),xx),r=(Sx||(Sx=1,function(t){t.exports=function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},t.exports.__esModule=!0,t.exports.default=t.exports}(Ex)),Tx),n=Cx(),i=(Ix||(Ix=1,function(t){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports}(Fx)),kx);t.exports=function(t){return e(t)||r(t)||n(t)||i()},t.exports.__esModule=!0,t.exports.default=t.exports}(yx)),vx}function Ux(){if(Ox)return ux;Ox=1;var t=uf;Object.defineProperty(ux,"__esModule",{value:!0}),ux.UNIT=ux.C=void 0,ux.assertCrsIsValid=function(t){if(!o.default.defs[t])throw new Error("Invalid crs parameter value '".concat(t,"'. Did you define it with proj4?"))},ux.crsIsGeocentric=d,ux.crsIsGeographic=h,ux.crsToUnit=u,ux.default=void 0,ux.is4326=g,ux.reasonnableEpsilonForCRS=function(t,e){if(g(t))return.01;var r=e.dimensions();return.01*Math.min(r.x,r.y)};var e=t(px()),r=t(Nx()),n=t(pf()),i=t(yf()),a=Bf,o=t(pv),s={},l={DEGREE:1,METER:2};function u(t){switch(t){case"EPSG:4326":return l.DEGREE;case"EPSG:4978":return l.METER;default:var e=o.default.defs(t);if(!e)return;return"degrees"===(r=e.units)?l.DEGREE:"m"===r?l.METER:void 0}var r}function c(t){var e=u(t);if(void 0===t||void 0===e)throw new Error("Invalid crs parameter value '".concat(t,"'"));return e}function h(t){return c(t)!==l.METER}function d(t){return c(t)===l.METER}function f(t){if(!h(t))throw new Error("Can't query crs ".concat(t," long/lat"))}function p(t){if(!d(t))throw new Error("Can't query crs ".concat(t," x/y/z"))}function m(t,e){if(s[t]){var r=s[t];if(r[e])return r[e]}else s[t]={};var n=(0,o.default)(t,e);return s[t][e]=n,n}function g(t){return 0===t.indexOf("EPSG:4326")}ux.UNIT=l;var v=new a.Vector3(0,0,1),y=function(){function t(e){(0,n.default)(this,t),this._values=new Float64Array(3);for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];this.set.apply(this,[e].concat(i)),Object.defineProperty(this,"geodesicNormal",{configurable:!0,get:function(){return v}})}return(0,i.default)(t,[{key:"set",value:function(t){c(t),this.crs=t;for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];if(1===r.length&&r[0]instanceof a.Vector3)this._values[0]=r[0].x,this._values[1]=r[0].y,this._values[2]=r[0].z;else{for(var i=0;i<r.length&&i<3;i++)this._values[i]=r[i];for(var o=r.length;o<3;o++)this._values[o]=0}return this._normal=void 0,this}},{key:"clone",value:function(n){var i;return n?(t.call.apply(t,[n,this.crs].concat((0,r.default)(this._values))),i=n):i=(0,e.default)(t,[this.crs].concat((0,r.default)(this._values))),this._normal&&(i._normal=this._normal.clone()),i}},{key:"copy",value:function(t){return this.set.apply(this,[t.crs].concat((0,r.default)(t._values))),this}},{key:"longitude",value:function(){return f(this.crs),this._values[0]}},{key:"latitude",value:function(){return this._values[1]}},{key:"altitude",value:function(){return f(this.crs),this._values[2]}},{key:"setAltitude",value:function(t){f(this.crs),this._values[2]=t}},{key:"x",value:function(){return p(this.crs),this._values[0]}},{key:"y",value:function(){return p(this.crs),this._values[1]}},{key:"z",value:function(){return p(this.crs),this._values[2]}},{key:"xyz",value:function(t){p(this.crs);var e=t||new a.Vector3;return e.fromArray(this._values),e}},{key:"as",value:function(t,e){if(void 0===t||void 0===u(t))throw new Error("Invalid crs paramater value '".concat(t,"'"));return this._convert(t,e)}},{key:"_convert",value:function(e,r){if(r=r||new t(e,0,0),e===this.crs)return r.copy(this);if(this.crs in o.default.defs&&e in o.default.defs){var n=this._values[0],i=this._values[1],s=this.crs;if(g(s)&&"EPSG:3857"===e){i=a.MathUtils.clamp(i,-89.999999,89.999999);var l=m(s,e).forward([n,i]);return r.set(e,l[0],l[1],this._values[2])}var u=m(s,e).forward([n,i]);return r.set(e,u[0],u[1],this._values[2])}throw new Error("Cannot convert from crs ".concat(this.crs," to ").concat(e))}},{key:"offsetInExtent",value:function(t,e){if(this.crs!==t.crs())throw new Error("unsupported mix");var r=Math.abs(t.east()-t.west()),n=Math.abs(t.north()-t.south()),i=d(this.crs)?this.x():this.longitude(),o=d(this.crs)?this.y():this.latitude(),s=(i-t.west())/r,l=(t.north()-o)/n;return(e=e||new a.Vector2).set(s,l),e}}]),t}(),x={EPSG_4326:function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(0,e.default)(y,["EPSG:4326"].concat(r))}};ux.C=x;var _=y;return ux.default=_,ux}var Bx={},zx={};const Gx={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};const jx=function(){function t(){this.disposed=!1}return t.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposeInternal())},t.prototype.disposeInternal=function(){},t}();const Vx=function(){function t(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}return t.prototype.preventDefault=function(){this.defaultPrevented=!0},t.prototype.stopPropagation=function(){this.propagationStopped=!0},t}();function Hx(t,e){return t>e?1:t<e?-1:0}function Wx(t,e,r){for(;e<r;){var n=t[e];t[e]=t[r],t[r]=n,++e,--r}}function qx(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Xx(){return!0}function Yx(){}var Zx=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Kx=function(t){function e(e){var r=t.call(this)||this;return r.eventTarget_=e,r.pendingRemovals_=null,r.dispatching_=null,r.listeners_=null,r}return Zx(e,t),e.prototype.addEventListener=function(t,e){if(t&&e){var r=this.listeners_||(this.listeners_={}),n=r[t]||(r[t]=[]);-1===n.indexOf(e)&&n.push(e)}},e.prototype.dispatchEvent=function(t){var e="string"==typeof t,r=e?t:t.type,n=this.listeners_&&this.listeners_[r];if(n){var i=e?new Vx(t):t;i.target||(i.target=this.eventTarget_||this);var a,o=this.dispatching_||(this.dispatching_={}),s=this.pendingRemovals_||(this.pendingRemovals_={});r in o||(o[r]=0,s[r]=0),++o[r];for(var l=0,u=n.length;l<u;++l)if(!1===(a="handleEvent"in n[l]?n[l].handleEvent(i):n[l].call(this,i))||i.propagationStopped){a=!1;break}if(0==--o[r]){var c=s[r];for(delete s[r];c--;)this.removeEventListener(r,Yx);delete o[r]}return a}},e.prototype.disposeInternal=function(){this.listeners_&&qv(this.listeners_)},e.prototype.getListeners=function(t){return this.listeners_&&this.listeners_[t]||void 0},e.prototype.hasListener=function(t){return!!this.listeners_&&(t?t in this.listeners_:Object.keys(this.listeners_).length>0)},e.prototype.removeEventListener=function(t,e){var r=this.listeners_&&this.listeners_[t];if(r){var n=r.indexOf(e);-1!==n&&(this.pendingRemovals_&&t in this.pendingRemovals_?(r[n]=Yx,++this.pendingRemovals_[t]):(r.splice(n,1),0===r.length&&delete this.listeners_[t]))}},e}(jx),Jx={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},Qx=Object.freeze(Object.defineProperty({__proto__:null,default:Jx},Symbol.toStringTag,{value:"Module"}));var $x=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const t_=function(t){function e(e,r,n){var i=t.call(this)||this,a=n||{};return i.tileCoord=e,i.state=r,i.interimTile=null,i.key="",i.transition_=void 0===a.transition?250:a.transition,i.transitionStarts_={},i.interpolate=!!a.interpolate,i}return $x(e,t),e.prototype.changed=function(){this.dispatchEvent(Gx.CHANGE)},e.prototype.release=function(){},e.prototype.getKey=function(){return this.key+"/"+this.tileCoord},e.prototype.getInterimTile=function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(t.getState()==Jx.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this},e.prototype.refreshInterimChain=function(){if(this.interimTile){var t=this.interimTile,e=this;do{if(t.getState()==Jx.LOADED){t.interimTile=null;break}t.getState()==Jx.LOADING?e=t:t.getState()==Jx.IDLE?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}},e.prototype.getTileCoord=function(){return this.tileCoord},e.prototype.getState=function(){return this.state},e.prototype.setState=function(t){if(this.state!==Jx.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()},e.prototype.load=function(){$v()},e.prototype.getAlpha=function(t,e){if(!this.transition_)return 1;var r=this.transitionStarts_[t];if(r){if(-1===r)return 1}else r=e,this.transitionStarts_[t]=r;var n,i=e-r+1e3/60;return i>=this.transition_?1:(n=i/this.transition_,Math.pow(n,3))},e.prototype.inTransition=function(t){return!!this.transition_&&-1!==this.transitionStarts_[t]},e.prototype.endTransition=function(t){this.transition_&&(this.transitionStarts_[t]=-1)},e}(Kx);var e_="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"";e_.indexOf("firefox"),-1!==e_.indexOf("safari")&&-1==e_.indexOf("chrom")&&(e_.indexOf("version/15.4")>=0||e_.match(/cpu (os|iphone os) 15_4 like mac os x/)),-1!==e_.indexOf("webkit")&&e_.indexOf("edge"),e_.indexOf("macintosh");var r_="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope,n_="undefined"!=typeof Image&&Image.prototype.decode;function i_(t,e,r,n){var i;return i=r&&r.length?r.shift():r_?new OffscreenCanvas(t||300,e||300):document.createElement("canvas"),t&&(i.width=t),e&&(i.height=e),i.getContext("2d",n)}function a_(t){var e=t.canvas;e.width=1,e.height=1,t.clearRect(0,0,1,1)}!function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch(t){}}();var o_=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const s_=function(t){function e(e,r,n,i){var a=t.call(this)||this;return a.extent=e,a.pixelRatio_=n,a.resolution=r,a.state=i,a}return o_(e,t),e.prototype.changed=function(){this.dispatchEvent(Gx.CHANGE)},e.prototype.getExtent=function(){return this.extent},e.prototype.getImage=function(){return $v()},e.prototype.getPixelRatio=function(){return this.pixelRatio_},e.prototype.getResolution=function(){return this.resolution},e.prototype.getState=function(){return this.state},e.prototype.load=function(){$v()},e}(Kx),l_={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function u_(t,e,r,n,i){if(n&&n!==t&&(r=r.bind(n)),i){var a=r;r=function(){t.removeEventListener(e,r),a.apply(this,arguments)}}var o={target:t,type:e,listener:r};return t.addEventListener(e,r),o}function c_(t,e,r,n){return u_(t,e,r,n,!0)}function h_(t){t&&t.target&&(t.target.removeEventListener(t.type,t.listener),qv(t))}const d_=Object.freeze(Object.defineProperty({__proto__:null,listen:u_,listenOnce:c_,unlistenByKey:h_},Symbol.toStringTag,{value:"Module"}));var f_=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function p_(t,e,r){var n=t,i=!0,a=!1,o=!1,s=[c_(n,Gx.LOAD,(function(){o=!0,a||e()}))];return n.src&&n_?(a=!0,n.decode().then((function(){i&&e()})).catch((function(t){i&&(o?e():r())}))):s.push(c_(n,Gx.ERROR,r)),function(){i=!1,s.forEach(h_)}}!function(t){function e(e,r,n,i,a,o){var s=t.call(this,e,r,n,l_.IDLE)||this;return s.src_=i,s.image_=new Image,null!==a&&(s.image_.crossOrigin=a),s.unlisten_=null,s.state=l_.IDLE,s.imageLoadFunction_=o,s}f_(e,t),e.prototype.getImage=function(){return this.image_},e.prototype.handleImageError_=function(){this.state=l_.ERROR,this.unlistenImage_(),this.changed()},e.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=Py(this.extent)/this.image_.height),this.state=l_.LOADED,this.unlistenImage_(),this.changed()},e.prototype.load=function(){this.state!=l_.IDLE&&this.state!=l_.ERROR||(this.state=l_.LOADING,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=p_(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},e.prototype.setImage=function(t){this.image_=t,this.resolution=Py(this.extent)/this.image_.height},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}(s_);var m_=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const g_=function(t){function e(e,r,n,i,a,o){var s=t.call(this,e,r,o)||this;return s.crossOrigin_=i,s.src_=n,s.key=n,s.image_=new Image,null!==i&&(s.image_.crossOrigin=i),s.unlisten_=null,s.tileLoadFunction_=a,s}return m_(e,t),e.prototype.getImage=function(){return this.image_},e.prototype.setImage=function(t){this.image_=t,this.state=Jx.LOADED,this.unlistenImage_(),this.changed()},e.prototype.handleImageError_=function(){var t;this.state=Jx.ERROR,this.unlistenImage_(),this.image_=((t=i_(1,1)).fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas),this.changed()},e.prototype.handleImageLoad_=function(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=Jx.LOADED:this.state=Jx.EMPTY,this.unlistenImage_(),this.changed()},e.prototype.load=function(){this.state==Jx.ERROR&&(this.state=Jx.IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==Jx.IDLE&&(this.state=Jx.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=p_(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(t_);const v_=function(){function t(t,e,r,n,i,a){this.sourceProj_=t,this.targetProj_=e;var o={},s=ex(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){var e=t[0]+"/"+t[1];return o[e]||(o[e]=s(t)),o[e]},this.maxSourceExtent_=n,this.errorThresholdSquared_=i*i,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&Oy(n)==Oy(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Oy(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Oy(this.targetProj_.getExtent()):null;var l=Iy(r),u=Ly(r),c=Ty(r),h=Sy(r),d=this.transformInv_(l),f=this.transformInv_(u),p=this.transformInv_(c),m=this.transformInv_(h),g=10+(a?Math.max(0,Math.ceil(wv(My(r)/(a*a*256*256)))):0);if(this.addQuad_(l,u,c,h,d,f,p,m,g),this.wrapsXInSource_){var v=1/0;this.triangles_.forEach((function(t,e,r){v=Math.min(v,t.source[0][0],t.source[1][0],t.source[2][0])})),this.triangles_.forEach(function(t){if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-v>this.sourceWorldWidth_/2){var e=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];e[0][0]-v>this.sourceWorldWidth_/2&&(e[0][0]-=this.sourceWorldWidth_),e[1][0]-v>this.sourceWorldWidth_/2&&(e[1][0]-=this.sourceWorldWidth_),e[2][0]-v>this.sourceWorldWidth_/2&&(e[2][0]-=this.sourceWorldWidth_);var r=Math.min(e[0][0],e[1][0],e[2][0]);Math.max(e[0][0],e[1][0],e[2][0])-r<this.sourceWorldWidth_/2&&(t.source=e)}}.bind(this))}o={}}return t.prototype.addTriangle_=function(t,e,r,n,i,a){this.triangles_.push({source:[n,i,a],target:[t,e,r]})},t.prototype.addQuad_=function(t,e,r,n,i,a,o,s,l){var u=ay([i,a,o,s]),c=this.sourceWorldWidth_?Oy(u)/this.sourceWorldWidth_:null,h=this.sourceWorldWidth_,d=this.sourceProj_.canWrapX()&&c>.5&&c<1,f=!1;if(l>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_)f=Oy(ay([t,e,r,n]))/this.targetWorldWidth_>.25||f;!d&&this.sourceProj_.isGlobal()&&c&&(f=c>.25||f)}if(!(!f&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3]))||Dy(u,this.maxSourceExtent_)){var p=0;if(!(f||isFinite(i[0])&&isFinite(i[1])&&isFinite(a[0])&&isFinite(a[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(s[0])&&isFinite(s[1])))if(l>0)f=!0;else if(1!=(p=(isFinite(i[0])&&isFinite(i[1])?0:8)+(isFinite(a[0])&&isFinite(a[1])?0:4)+(isFinite(o[0])&&isFinite(o[1])?0:2)+(isFinite(s[0])&&isFinite(s[1])?0:1))&&2!=p&&4!=p&&8!=p)return;if(l>0){if(!f){var m=[(t[0]+r[0])/2,(t[1]+r[1])/2],g=this.transformInv_(m),v=void 0;if(d)v=(Mv(i[0],h)+Mv(o[0],h))/2-Mv(g[0],h);else v=(i[0]+o[0])/2-g[0];var y=(i[1]+o[1])/2-g[1];f=v*v+y*y>this.errorThresholdSquared_}if(f){if(Math.abs(t[0]-r[0])<=Math.abs(t[1]-r[1])){var x=[(e[0]+r[0])/2,(e[1]+r[1])/2],_=this.transformInv_(x),w=[(n[0]+t[0])/2,(n[1]+t[1])/2],b=this.transformInv_(w);this.addQuad_(t,e,x,w,i,a,_,b,l-1),this.addQuad_(w,x,r,n,b,_,o,s,l-1)}else{var M=[(t[0]+e[0])/2,(t[1]+e[1])/2],S=this.transformInv_(M),T=[(r[0]+n[0])/2,(r[1]+n[1])/2],E=this.transformInv_(T);this.addQuad_(t,M,T,n,i,S,E,s,l-1),this.addQuad_(M,e,r,T,S,a,o,E,l-1)}return}}if(d){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&p)&&this.addTriangle_(t,r,n,i,o,s),0==(14&p)&&this.addTriangle_(t,r,e,i,o,a),p&&(0==(13&p)&&this.addTriangle_(e,n,t,a,s,i),0==(7&p)&&this.addTriangle_(e,n,r,a,s,o))}},t.prototype.calculateSourceExtent=function(){var t=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach((function(e,r,n){var i=e.source;vy(t,i[0]),vy(t,i[1]),vy(t,i[2])})),t},t.prototype.getTriangles=function(){return this.triangles_},t}();var y_,x_={imageSmoothingEnabled:!1,msImageSmoothingEnabled:!1},__=[];function w_(t,e,r,n,i){t.beginPath(),t.moveTo(0,0),t.lineTo(e,r),t.lineTo(n,i),t.closePath(),t.save(),t.clip(),t.fillRect(0,0,Math.max(e,n)+1,Math.max(r,i)),t.restore()}function b_(t,e){return Math.abs(t[4*e]-210)>2||Math.abs(t[4*e+3]-191.25)>2}function M_(t,e,r,n){var i=rx(r,e,t),a=Ky(e,n,r),o=e.getMetersPerUnit();void 0!==o&&(a*=o);var s=t.getMetersPerUnit();void 0!==s&&(a/=s);var l=t.getExtent();if(!l||ly(l,i)){var u=Ky(t,a,i)/a;isFinite(u)&&u>0&&(a/=u)}return a}function S_(t,e,r,n,i,a,o,s,l,u,c,h){var d=i_(Math.round(r*t),Math.round(r*e),__);if(h||Wv(d,x_),0===l.length)return d.canvas;function f(t){return Math.round(t*r)/r}d.scale(r,r),d.globalCompositeOperation="lighter";var p=[1/0,1/0,-1/0,-1/0];l.forEach((function(t,e,r){gy(p,t.extent)}));var m=Oy(p),g=Py(p),v=i_(Math.round(r*m/n),Math.round(r*g/n));h||Wv(v,x_);var y=r/n;l.forEach((function(t,e,r){var n=t.extent[0]-p[0],i=-(t.extent[3]-p[3]),a=Oy(t.extent),o=Py(t.extent);t.image.width>0&&t.image.height>0&&v.drawImage(t.image,u,u,t.image.width-2*u,t.image.height-2*u,n*y,i*y,a*y,o*y)}));var x=Iy(o);return s.getTriangles().forEach((function(t,e,i){var o=t.source,s=t.target,l=o[0][0],u=o[0][1],c=o[1][0],m=o[1][1],g=o[2][0],y=o[2][1],_=f((s[0][0]-x[0])/a),w=f(-(s[0][1]-x[1])/a),b=f((s[1][0]-x[0])/a),M=f(-(s[1][1]-x[1])/a),S=f((s[2][0]-x[0])/a),T=f(-(s[2][1]-x[1])/a),E=l,A=u;l=0,u=0;var R=function(t){for(var e=t.length,r=0;r<e;r++){for(var n=r,i=Math.abs(t[r][r]),a=r+1;a<e;a++){var o=Math.abs(t[a][r]);o>i&&(i=o,n=a)}if(0===i)return null;var s=t[n];t[n]=t[r],t[r]=s;for(var l=r+1;l<e;l++)for(var u=-t[l][r]/t[r][r],c=r;c<e+1;c++)r==c?t[l][c]=0:t[l][c]+=u*t[r][c]}for(var h=new Array(e),d=e-1;d>=0;d--){h[d]=t[d][e]/t[d][d];for(var f=d-1;f>=0;f--)t[f][e]-=t[f][d]*h[d]}return h}([[c-=E,m-=A,0,0,b-_],[g-=E,y-=A,0,0,S-_],[0,0,c,m,M-w],[0,0,g,y,T-w]]);if(R){if(d.save(),d.beginPath(),function(){if(void 0===y_){var t=document.createElement("canvas").getContext("2d");t.globalCompositeOperation="lighter",t.fillStyle="rgba(210, 0, 0, 0.75)",w_(t,4,5,4,0),w_(t,4,5,0,5);var e=t.getImageData(0,0,3,3).data;y_=b_(e,0)||b_(e,4)||b_(e,8)}return y_}()||!h){d.moveTo(b,M);for(var P=_-b,C=w-M,I=0;I<4;I++)d.lineTo(b+f((I+1)*P/4),M+f(I*C/3)),3!=I&&d.lineTo(b+f((I+1)*P/4),M+f((I+1)*C/3));d.lineTo(S,T)}else d.moveTo(b,M),d.lineTo(_,w),d.lineTo(S,T);d.clip(),d.transform(R[0],R[2],R[1],R[3],_,w),d.translate(p[0]-E,p[3]-A),d.scale(n/r,-n/r),d.drawImage(v.canvas,0,0),d.restore()}})),c&&(d.save(),d.globalCompositeOperation="source-over",d.strokeStyle="black",d.lineWidth=1,s.getTriangles().forEach((function(t,e,r){var n=t.target,i=(n[0][0]-x[0])/a,o=-(n[0][1]-x[1])/a,s=(n[1][0]-x[0])/a,l=-(n[1][1]-x[1])/a,u=(n[2][0]-x[0])/a,c=-(n[2][1]-x[1])/a;d.beginPath(),d.moveTo(s,l),d.lineTo(i,o),d.lineTo(u,c),d.closePath(),d.stroke()})),d.restore()),d.canvas}var T_=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const E_=function(t){function e(e,r,n,i,a,o,s,l,u,c,h,d){var f=t.call(this,a,Jx.IDLE,{interpolate:!!d})||this;f.renderEdges_=void 0!==h&&h,f.pixelRatio_=s,f.gutter_=l,f.canvas_=null,f.sourceTileGrid_=r,f.targetTileGrid_=i,f.wrappedTileCoord_=o||a,f.sourceTiles_=[],f.sourcesListenerKeys_=null,f.sourceZ_=0;var p=i.getTileCoordExtent(f.wrappedTileCoord_),m=f.targetTileGrid_.getExtent(),g=f.sourceTileGrid_.getExtent(),v=m?Cy(p,m):p;if(0===My(v))return f.state=Jx.EMPTY,f;var y=e.getExtent();y&&(g=g?Cy(g,y):y);var x=i.getResolution(f.wrappedTileCoord_[0]),_=function(t,e,r,n){var i=Ey(r),a=M_(t,e,i,n);return(!isFinite(a)||a<=0)&&by(r,(function(r){return a=M_(t,e,r,n),isFinite(a)&&a>0})),a}(e,n,v,x);if(!isFinite(_)||_<=0)return f.state=Jx.EMPTY,f;var w=void 0!==c?c:.5;if(f.triangulation_=new v_(e,n,v,g,_*w,x),0===f.triangulation_.getTriangles().length)return f.state=Jx.EMPTY,f;f.sourceZ_=r.getZForResolution(_);var b=f.triangulation_.calculateSourceExtent();if(g&&(e.canWrapX()?(b[1]=xv(b[1],g[1],g[3]),b[3]=xv(b[3],g[1],g[3])):b=Cy(b,g)),My(b)){for(var M=r.getTileRangeForExtentAndZ(b,f.sourceZ_),S=M.minX;S<=M.maxX;S++)for(var T=M.minY;T<=M.maxY;T++){var E=u(f.sourceZ_,S,T,s);E&&f.sourceTiles_.push(E)}0===f.sourceTiles_.length&&(f.state=Jx.EMPTY)}else f.state=Jx.EMPTY;return f}return T_(e,t),e.prototype.getImage=function(){return this.canvas_},e.prototype.reproject_=function(){var t=[];if(this.sourceTiles_.forEach(function(e,r,n){e&&e.getState()==Jx.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}.bind(this)),this.sourceTiles_.length=0,0===t.length)this.state=Jx.ERROR;else{var e=this.wrappedTileCoord_[0],r=this.targetTileGrid_.getTileSize(e),n="number"==typeof r?r:r[0],i="number"==typeof r?r:r[1],a=this.targetTileGrid_.getResolution(e),o=this.sourceTileGrid_.getResolution(this.sourceZ_),s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=S_(n,i,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),a,s,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=Jx.LOADED}this.changed()},e.prototype.load=function(){if(this.state==Jx.IDLE){this.state=Jx.LOADING,this.changed();var t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(e,r,n){var i=e.getState();if(i==Jx.IDLE||i==Jx.LOADING){t++;var a=u_(e,Gx.CHANGE,(function(r){var n=e.getState();n!=Jx.LOADED&&n!=Jx.ERROR&&n!=Jx.EMPTY||(h_(a),0===--t&&(this.unlistenSources_(),this.reproject_()))}),this);this.sourcesListenerKeys_.push(a)}}.bind(this)),0===t?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach((function(t,e,r){t.getState()==Jx.IDLE&&t.load()}))}},e.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(h_),this.sourcesListenerKeys_=null},e.prototype.release=function(){this.canvas_&&(a_(this.canvas_.getContext("2d")),__.push(this.canvas_),this.canvas_=null),t.prototype.release.call(this)},e}(t_);const A_=function(){function t(t){this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return t.prototype.canExpireCache=function(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark},t.prototype.expireCache=function(t){for(;this.canExpireCache();)this.pop()},t.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null},t.prototype.containsKey=function(t){return this.entries_.hasOwnProperty(t)},t.prototype.forEach=function(t){for(var e=this.oldest_;e;)t(e.value_,e.key_,this),e=e.newer},t.prototype.get=function(t,e){var r=this.entries_[t];return iy(void 0!==r,15),r===this.newest_||(r===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(r.newer.older=r.older,r.older.newer=r.newer),r.newer=null,r.older=this.newest_,this.newest_.newer=r,this.newest_=r),r.value_},t.prototype.remove=function(t){var e=this.entries_[t];return iy(void 0!==e,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_},t.prototype.getCount=function(){return this.count_},t.prototype.getKeys=function(){var t,e=new Array(this.count_),r=0;for(t=this.newest_;t;t=t.older)e[r++]=t.key_;return e},t.prototype.getValues=function(){var t,e=new Array(this.count_),r=0;for(t=this.newest_;t;t=t.older)e[r++]=t.value_;return e},t.prototype.peekLast=function(){return this.oldest_.value_},t.prototype.peekLastKey=function(){return this.oldest_.key_},t.prototype.peekFirstKey=function(){return this.newest_.key_},t.prototype.peek=function(t){if(this.containsKey(t))return this.entries_[t].value_},t.prototype.pop=function(){var t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_},t.prototype.replace=function(t,e){this.get(t),this.entries_[t].value_=e},t.prototype.set=function(t,e){iy(!(t in this.entries_),16);var r={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=r:this.oldest_=r,this.newest_=r,this.entries_[t]=r,++this.count_},t.prototype.setSize=function(t){this.highWaterMark=t},t}();function R_(t,e,r,n){return void 0!==n?(n[0]=t,n[1]=e,n[2]=r,n):[t,e,r]}function P_(t,e,r){return t+"/"+e+"/"+r}function C_(t){return P_(t[0],t[1],t[2])}function I_(t){return t.split("/").map(Number)}function L_(t){return(t[1]<<t[0])+t[2]}var O_=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const D_=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return O_(e,t),e.prototype.expireCache=function(t){for(;this.canExpireCache();){if(this.peekLast().getKey()in t)break;this.pop().release()}},e.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var t=I_(this.peekFirstKey())[0];this.forEach(function(e){e.tileCoord[0]!==t&&(this.remove(C_(e.tileCoord)),e.release())}.bind(this))}},e}(A_),k_="tileloadstart",F_="tileloadend",N_="tileloaderror",U_="propertychange";var B_=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),z_=function(t){function e(){var e=t.call(this)||this;return e.on=e.onInternal,e.once=e.onceInternal,e.un=e.unInternal,e.revision_=0,e}return B_(e,t),e.prototype.changed=function(){++this.revision_,this.dispatchEvent(Gx.CHANGE)},e.prototype.getRevision=function(){return this.revision_},e.prototype.onInternal=function(t,e){if(Array.isArray(t)){for(var r=t.length,n=new Array(r),i=0;i<r;++i)n[i]=u_(this,t[i],e);return n}return u_(this,t,e)},e.prototype.onceInternal=function(t,e){var r;if(Array.isArray(t)){var n=t.length;r=new Array(n);for(var i=0;i<n;++i)r[i]=c_(this,t[i],e)}else r=c_(this,t,e);return e.ol_key=r,r},e.prototype.unInternal=function(t,e){var r=e.ol_key;if(r)!function(t){if(Array.isArray(t))for(var e=0,r=t.length;e<r;++e)h_(t[e]);else h_(t)}(r);else if(Array.isArray(t))for(var n=0,i=t.length;n<i;++n)this.removeEventListener(t[n],e);else this.removeEventListener(t,e)},e}(Kx);z_.prototype.on,z_.prototype.once,z_.prototype.un;const G_=z_;var j_=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),V_=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.key=r,i.oldValue=n,i}return j_(e,t),e}(Vx);const H_=function(t){function e(e){var r=t.call(this)||this;return r.on,r.once,r.un,ey(r),r.values_=null,void 0!==e&&r.setProperties(e),r}return j_(e,t),e.prototype.get=function(t){var e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e},e.prototype.getKeys=function(){return this.values_&&Object.keys(this.values_)||[]},e.prototype.getProperties=function(){return this.values_&&Wv({},this.values_)||{}},e.prototype.hasProperties=function(){return!!this.values_},e.prototype.notify=function(t,e){var r;r="change:".concat(t),this.hasListener(r)&&this.dispatchEvent(new V_(r,t,e)),r=U_,this.hasListener(r)&&this.dispatchEvent(new V_(r,t,e))},e.prototype.addChangeListener=function(t,e){this.addEventListener("change:".concat(t),e)},e.prototype.removeChangeListener=function(t,e){this.removeEventListener("change:".concat(t),e)},e.prototype.set=function(t,e,r){var n=this.values_||(this.values_={});if(r)n[t]=e;else{var i=n[t];n[t]=e,i!==e&&this.notify(t,i)}},e.prototype.setProperties=function(t,e){for(var r in t)this.set(r,t[r],e)},e.prototype.applyProperties=function(t){t.values_&&Wv(this.values_||(this.values_={}),t.values_)},e.prototype.unset=function(t,e){if(this.values_&&t in this.values_){var r=this.values_[t];delete this.values_[t],Yv(this.values_)&&(this.values_=null),e||this.notify(t,r)}},e}(G_);var W_=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function q_(t){return t?Array.isArray(t)?function(e){return t}:"function"==typeof t?t:function(e){return[t]}:null}const X_=function(t){function e(e){var r=t.call(this)||this;r.projection=Zy(e.projection),r.attributions_=q_(e.attributions),r.attributionsCollapsible_=void 0===e.attributionsCollapsible||e.attributionsCollapsible,r.loading=!1,r.state_=void 0!==e.state?e.state:"ready",r.wrapX_=void 0!==e.wrapX&&e.wrapX,r.interpolate_=!!e.interpolate,r.viewResolver=null,r.viewRejector=null;var n=r;return r.viewPromise_=new Promise((function(t,e){n.viewResolver=t,n.viewRejector=e})),r}return W_(e,t),e.prototype.getAttributions=function(){return this.attributions_},e.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},e.prototype.getProjection=function(){return this.projection},e.prototype.getResolutions=function(){return $v()},e.prototype.getView=function(){return this.viewPromise_},e.prototype.getState=function(){return this.state_},e.prototype.getWrapX=function(){return this.wrapX_},e.prototype.getInterpolate=function(){return this.interpolate_},e.prototype.refresh=function(){this.changed()},e.prototype.setAttributions=function(t){this.attributions_=q_(t),this.changed()},e.prototype.setState=function(t){this.state_=t,this.changed()},e}(H_);var Y_=function(){function t(t,e,r,n){this.minX=t,this.maxX=e,this.minY=r,this.maxY=n}return t.prototype.contains=function(t){return this.containsXY(t[1],t[2])},t.prototype.containsTileRange=function(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY},t.prototype.containsXY=function(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY},t.prototype.equals=function(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY},t.prototype.extend=function(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)},t.prototype.getHeight=function(){return this.maxY-this.minY+1},t.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},t.prototype.getWidth=function(){return this.maxX-this.minX+1},t.prototype.intersects=function(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY},t}();function Z_(t,e,r,n,i){return void 0!==i?(i.minX=t,i.maxX=e,i.minY=r,i.maxY=n,i):new Y_(t,e,r,n)}const K_=Y_;var J_=42,Q_=256;function $_(t,e,r,n,i,a){for(var o=0,s=t[r-n],l=t[r-n+1];e<r;e+=n){var u=t[e],c=t[e+1];l<=a?c>a&&(u-s)*(a-l)-(i-s)*(c-l)>0&&o++:c<=a&&(u-s)*(a-l)-(i-s)*(c-l)<0&&o--,s=u,l=c}return 0!==o}function tw(t,e,r,n,i){return!!function(t,e,r,n,i){var a=xy([1/0,1/0,-1/0,-1/0],t,e,r,n);return!!Dy(i,a)&&(!!uy(i,a)||a[0]>=i[0]&&a[2]<=i[2]||a[1]>=i[1]&&a[3]<=i[3]||function(t,e,r,n,i){var a;for(e+=n;e<r;e+=n)if(a=i(t.slice(e-n,e),t.slice(e,e+n)))return a;return!1}(t,e,r,n,(function(t,e){return Fy(i,t,e)})))}(t,e,r,n,i)||(!!$_(t,e,r,n,i[0],i[1])||(!!$_(t,e,r,n,i[0],i[3])||(!!$_(t,e,r,n,i[2],i[1])||!!$_(t,e,r,n,i[2],i[3]))))}function ew(t,e,r){return void 0===r&&(r=[0,0]),r[0]=t[0]+2*e,r[1]=t[1]+2*e,r}function rw(t,e,r){return void 0===r&&(r=[0,0]),r[0]=t[0]*e+.5|0,r[1]=t[1]*e+.5|0,r}function nw(t,e){return Array.isArray(t)?t:(void 0===e?e=[t,t]:(e[0]=t,e[1]=t),e)}var iw=[0,0,0];const aw=function(){function t(t){var e,r,n,i;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,iy((e=this.resolutions_,r=!0,n=function(t,e){return e-t}||Hx,e.every((function(t,i){if(0===i)return!0;var a=n(e[i-1],t);return!(a>0||r&&0===a)}))),17),!t.origins)for(var a=0,o=this.resolutions_.length-1;a<o;++a)if(i){if(this.resolutions_[a]/this.resolutions_[a+1]!==i){i=void 0;break}}else i=this.resolutions_[a]/this.resolutions_[a+1];this.zoomFactor_=i,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,iy(this.origins_.length==this.resolutions_.length,20));var s=t.extent;void 0===s||this.origin_||this.origins_||(this.origin_=Iy(s)),iy(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,iy(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:Q_,iy(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==s?s:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map((function(t,e){var r=new K_(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1));if(s){var n=this.getTileRangeForExtentAndZ(s,e);r.minX=Math.max(n.minX,r.minX),r.maxX=Math.min(n.maxX,r.maxX),r.minY=Math.max(n.minY,r.minY),r.maxY=Math.min(n.maxY,r.maxY)}return r}),this):s&&this.calculateTileRanges_(s)}return t.prototype.forEachTileCoord=function(t,e,r){for(var n=this.getTileRangeForExtentAndZ(t,e),i=n.minX,a=n.maxX;i<=a;++i)for(var o=n.minY,s=n.maxY;o<=s;++o)r([e,i,o])},t.prototype.forEachTileCoordParentTileRange=function(t,e,r,n){var i,a,o=null,s=t[0]-1;for(2===this.zoomFactor_?(i=t[1],a=t[2]):o=this.getTileCoordExtent(t,n);s>=this.minZoom;){if(e(s,2===this.zoomFactor_?Z_(i=Math.floor(i/2),i,a=Math.floor(a/2),a,r):this.getTileRangeForExtentAndZ(o,s,r)))return!0;--s}return!1},t.prototype.getExtent=function(){return this.extent_},t.prototype.getMaxZoom=function(){return this.maxZoom},t.prototype.getMinZoom=function(){return this.minZoom},t.prototype.getOrigin=function(t){return this.origin_?this.origin_:this.origins_[t]},t.prototype.getResolution=function(t){return this.resolutions_[t]},t.prototype.getResolutions=function(){return this.resolutions_},t.prototype.getTileCoordChildTileRange=function(t,e,r){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){var n=2*t[1],i=2*t[2];return Z_(n,n+1,i,i+1,e)}var a=this.getTileCoordExtent(t,r||this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t[0]+1,e)}return null},t.prototype.getTileRangeForTileCoordAndZ=function(t,e,r){if(e>this.maxZoom||e<this.minZoom)return null;var n=t[0],i=t[1],a=t[2];if(e===n)return Z_(i,a,i,a,r);if(this.zoomFactor_){var o=Math.pow(this.zoomFactor_,e-n),s=Math.floor(i*o),l=Math.floor(a*o);return e<n?Z_(s,s,l,l,r):Z_(s,Math.floor(o*(i+1))-1,l,Math.floor(o*(a+1))-1,r)}var u=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(u,e,r)},t.prototype.getTileRangeExtent=function(t,e,r){var n=this.getOrigin(t),i=this.getResolution(t),a=nw(this.getTileSize(t),this.tmpSize_),o=n[0]+e.minX*a[0]*i,s=n[0]+(e.maxX+1)*a[0]*i;return fy(o,n[1]+e.minY*a[1]*i,s,n[1]+(e.maxY+1)*a[1]*i,r)},t.prototype.getTileRangeForExtentAndZ=function(t,e,r){var n=iw;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,n);var i=n[1],a=n[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,n),Z_(i,n[1],a,n[2],r)},t.prototype.getTileCoordCenter=function(t){var e=this.getOrigin(t[0]),r=this.getResolution(t[0]),n=nw(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*n[0]*r,e[1]-(t[2]+.5)*n[1]*r]},t.prototype.getTileCoordExtent=function(t,e){var r=this.getOrigin(t[0]),n=this.getResolution(t[0]),i=nw(this.getTileSize(t[0]),this.tmpSize_),a=r[0]+t[1]*i[0]*n,o=r[1]-(t[2]+1)*i[1]*n;return fy(a,o,a+i[0]*n,o+i[1]*n,e)},t.prototype.getTileCoordForCoordAndResolution=function(t,e,r){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,r)},t.prototype.getTileCoordForXYAndResolution_=function(t,e,r,n,i){var a=this.getZForResolution(r),o=r/this.getResolution(a),s=this.getOrigin(a),l=nw(this.getTileSize(a),this.tmpSize_),u=o*(t-s[0])/r/l[0],c=o*(s[1]-e)/r/l[1];return n?(u=Av(u,5)-1,c=Av(c,5)-1):(u=Ev(u,5),c=Ev(c,5)),R_(a,u,c,i)},t.prototype.getTileCoordForXYAndZ_=function(t,e,r,n,i){var a=this.getOrigin(r),o=this.getResolution(r),s=nw(this.getTileSize(r),this.tmpSize_),l=(t-a[0])/o/s[0],u=(a[1]-e)/o/s[1];return n?(l=Av(l,5)-1,u=Av(u,5)-1):(l=Ev(l,5),u=Ev(u,5)),R_(r,l,u,i)},t.prototype.getTileCoordForCoordAndZ=function(t,e,r){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,r)},t.prototype.getTileCoordResolution=function(t){return this.resolutions_[t[0]]},t.prototype.getTileSize=function(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]},t.prototype.getFullTileRange=function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null},t.prototype.getZForResolution=function(t,e){return xv(function(t,e,r){var n=t.length;if(t[0]<=e)return 0;if(e<=t[n-1])return n-1;var i=void 0;if(r>0){for(i=1;i<n;++i)if(t[i]<e)return i-1}else if(r<0){for(i=1;i<n;++i)if(t[i]<=e)return i}else for(i=1;i<n;++i){if(t[i]==e)return i;if(t[i]<e)return"function"==typeof r?r(e,t[i-1],t[i])>0?i-1:i:t[i-1]-e<e-t[i]?i-1:i}return n-1}(this.resolutions_,t,e||0),this.minZoom,this.maxZoom)},t.prototype.tileCoordIntersectsViewport=function(t,e){return tw(e,0,e.length,2,this.getTileCoordExtent(t))},t.prototype.calculateTileRanges_=function(t){for(var e=this.resolutions_.length,r=new Array(e),n=this.minZoom;n<e;++n)r[n]=this.getTileRangeForExtentAndZ(t,n);this.fullTileRanges_=r},t}();function ow(t){var e=t.getDefaultTileGrid();return e||(e=function(t,e,r,n){var i=uw(t);return function(t,e,r,n){var i=void 0!==n?n:"top-left",a=lw(t,e,r);return new aw({extent:t,origin:Ay(t,i),resolutions:a,tileSize:r})}(i,e,r,n)}(t),t.setDefaultTileGrid(e)),e}function sw(t){var e=t||{},r=e.extent||Zy("EPSG:3857").getExtent(),n={extent:r,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:lw(r,e.maxZoom,e.tileSize,e.maxResolution)};return new aw(n)}function lw(t,e,r,n){for(var i=void 0!==e?e:J_,a=Py(t),o=Oy(t),s=nw(void 0!==r?r:Q_),l=n>0?n:Math.max(o/s[0],a/s[1]),u=i+1,c=new Array(u),h=0;h<u;++h)c[h]=l/Math.pow(2,h);return c}function uw(t){var e=(t=Zy(t)).getExtent();if(!e){var r=180*gv[vv.DEGREES]/t.getMetersPerUnit();e=fy(-r,-r,r,r)}return e}var cw=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),hw=function(t){function e(e){var r=t.call(this,{attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate})||this;r.on,r.once,r.un,r.opaque_=void 0!==e.opaque&&e.opaque,r.tilePixelRatio_=void 0!==e.tilePixelRatio?e.tilePixelRatio:1,r.tileGrid=void 0!==e.tileGrid?e.tileGrid:null;return r.tileGrid&&nw(r.tileGrid.getTileSize(r.tileGrid.getMinZoom()),[256,256]),r.tileCache=new D_(e.cacheSize||0),r.tmpSize=[0,0],r.key_=e.key||"",r.tileOptions={transition:e.transition,interpolate:e.interpolate},r.zDirection=e.zDirection?e.zDirection:0,r}return cw(e,t),e.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},e.prototype.expireCache=function(t,e){var r=this.getTileCacheForProjection(t);r&&r.expireCache(e)},e.prototype.forEachLoadedTile=function(t,e,r,n){var i=this.getTileCacheForProjection(t);if(!i)return!1;for(var a,o,s,l=!0,u=r.minX;u<=r.maxX;++u)for(var c=r.minY;c<=r.maxY;++c)o=P_(e,u,c),s=!1,i.containsKey(o)&&(s=(a=i.get(o)).getState()===Jx.LOADED)&&(s=!1!==n(a)),s||(l=!1);return l},e.prototype.getGutterForProjection=function(t){return 0},e.prototype.getKey=function(){return this.key_},e.prototype.setKey=function(t){this.key_!==t&&(this.key_=t,this.changed())},e.prototype.getOpaque=function(t){return this.opaque_},e.prototype.getResolutions=function(){return this.tileGrid?this.tileGrid.getResolutions():null},e.prototype.getTile=function(t,e,r,n,i){return $v()},e.prototype.getTileGrid=function(){return this.tileGrid},e.prototype.getTileGridForProjection=function(t){return this.tileGrid?this.tileGrid:ow(t)},e.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();return iy(null===e||$y(e,t),68),this.tileCache},e.prototype.getTilePixelRatio=function(t){return this.tilePixelRatio_},e.prototype.getTilePixelSize=function(t,e,r){var n=this.getTileGridForProjection(r),i=this.getTilePixelRatio(e),a=nw(n.getTileSize(t),this.tmpSize);return 1==i?a:rw(a,i,this.tmpSize)},e.prototype.getTileCoordForTileUrlFunction=function(t,e){var r=void 0!==e?e:this.getProjection(),n=this.getTileGridForProjection(r);return this.getWrapX()&&r.isGlobal()&&(t=function(t,e,r){var n=e[0],i=t.getTileCoordCenter(e),a=uw(r);if(ly(a,i))return e;var o=Oy(a),s=Math.ceil((a[0]-i[0])/o);return i[0]+=o*s,t.getTileCoordForCoordAndZ(i,n)}(n,t,r)),function(t,e){var r=t[0],n=t[1],i=t[2];if(e.getMinZoom()>r||r>e.getMaxZoom())return!1;var a=e.getFullTileRange(r);return!a||a.containsXY(n,i)}(t,n)?t:null},e.prototype.clear=function(){this.tileCache.clear()},e.prototype.refresh=function(){this.clear(),t.prototype.refresh.call(this)},e.prototype.updateCacheSize=function(t,e){var r=this.getTileCacheForProjection(e);t>r.highWaterMark&&(r.highWaterMark=t)},e.prototype.useTile=function(t,e,r,n){},e}(X_),dw=function(t){function e(e,r){var n=t.call(this,e)||this;return n.tile=r,n}return cw(e,t),e}(Vx);const fw=hw;function pw(t,e){var r=/\{z\}/g,n=/\{x\}/g,i=/\{y\}/g,a=/\{-y\}/g;return function(o,s,l){return o?t.replace(r,o[0].toString()).replace(n,o[1].toString()).replace(i,o[2].toString()).replace(a,(function(){var t=o[0],r=e.getFullTileRange(t);return iy(r,55),(r.getHeight()-o[2]-1).toString()})):void 0}}function mw(t,e){for(var r=t.length,n=new Array(r),i=0;i<r;++i)n[i]=pw(t[i],e);return function(t){if(1===t.length)return t[0];return function(e,r,n){if(e){var i=Mv(L_(e),t.length);return t[i](e,r,n)}}}(n)}var gw=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const vw=function(t){function e(r){var n=t.call(this,{attributions:r.attributions,cacheSize:r.cacheSize,opaque:r.opaque,projection:r.projection,state:r.state,tileGrid:r.tileGrid,tilePixelRatio:r.tilePixelRatio,wrapX:r.wrapX,transition:r.transition,interpolate:r.interpolate,key:r.key,attributionsCollapsible:r.attributionsCollapsible,zDirection:r.zDirection})||this;return n.generateTileUrlFunction_=n.tileUrlFunction===e.prototype.tileUrlFunction,n.tileLoadFunction=r.tileLoadFunction,r.tileUrlFunction&&(n.tileUrlFunction=r.tileUrlFunction),n.urls=null,r.urls?n.setUrls(r.urls):r.url&&n.setUrl(r.url),n.tileLoadingKeys_={},n}return gw(e,t),e.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},e.prototype.getTileUrlFunction=function(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction},e.prototype.getUrls=function(){return this.urls},e.prototype.handleTileChange=function(t){var e,r=t.target,n=ey(r),i=r.getState();i==Jx.LOADING?(this.tileLoadingKeys_[n]=!0,e=k_):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],e=i==Jx.ERROR?N_:i==Jx.LOADED?F_:void 0),null!=e&&this.dispatchEvent(new dw(e,r))},e.prototype.setTileLoadFunction=function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()},e.prototype.setTileUrlFunction=function(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()},e.prototype.setUrl=function(t){var e=function(t){var e=[],r=/\{([a-z])-([a-z])\}/.exec(t);if(r){var n=r[1].charCodeAt(0),i=r[2].charCodeAt(0),a=void 0;for(a=n;a<=i;++a)e.push(t.replace(r[0],String.fromCharCode(a)));return e}if(r=/\{(\d+)-(\d+)\}/.exec(t)){for(var o=parseInt(r[2],10),s=parseInt(r[1],10);s<=o;s++)e.push(t.replace(r[0],s.toString()));return e}return e.push(t),e}(t);this.urls=e,this.setUrls(e)},e.prototype.setUrls=function(t){this.urls=t;var e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(mw(t,this.tileGrid),e):this.setKey(e)},e.prototype.tileUrlFunction=function(t,e,r){},e.prototype.useTile=function(t,e,r){var n=P_(t,e,r);this.tileCache.containsKey(n)&&this.tileCache.get(n)},e}(fw);var yw=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),xw=function(t){function e(e){var r=this,n=void 0===e.imageSmoothing||e.imageSmoothing;return void 0!==e.interpolate&&(n=e.interpolate),(r=t.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:_w,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:n,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection})||this).crossOrigin=void 0!==e.crossOrigin?e.crossOrigin:null,r.tileClass=void 0!==e.tileClass?e.tileClass:g_,r.tileCacheForProjection={},r.tileGridForProjection={},r.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,r.renderReprojectionEdges_=!1,r}return yw(e,t),e.prototype.canExpireCache=function(){if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1},e.prototype.expireCache=function(t,e){var r=this.getTileCacheForProjection(t);for(var n in this.tileCache.expireCache(this.tileCache==r?e:{}),this.tileCacheForProjection){var i=this.tileCacheForProjection[n];i.expireCache(i==r?e:{})}},e.prototype.getGutterForProjection=function(t){return this.getProjection()&&t&&!$y(this.getProjection(),t)?0:this.getGutter()},e.prototype.getGutter=function(){return 0},e.prototype.getKey=function(){var e=t.prototype.getKey.call(this);return this.getInterpolate()||(e+=":disable-interpolation"),e},e.prototype.getOpaque=function(e){return!(this.getProjection()&&e&&!$y(this.getProjection(),e))&&t.prototype.getOpaque.call(this,e)},e.prototype.getTileGridForProjection=function(t){var e=this.getProjection();if(!this.tileGrid||e&&!$y(e,t)){var r=ey(t);return r in this.tileGridForProjection||(this.tileGridForProjection[r]=ow(t)),this.tileGridForProjection[r]}return this.tileGrid},e.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();if(!e||$y(e,t))return this.tileCache;var r=ey(t);return r in this.tileCacheForProjection||(this.tileCacheForProjection[r]=new D_(this.tileCache.highWaterMark)),this.tileCacheForProjection[r]},e.prototype.createTile_=function(t,e,r,n,i,a){var o=[t,e,r],s=this.getTileCoordForTileUrlFunction(o,i),l=s?this.tileUrlFunction(s,n,i):void 0,u=new this.tileClass(o,void 0!==l?Jx.IDLE:Jx.EMPTY,void 0!==l?l:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return u.key=a,u.addEventListener(Gx.CHANGE,this.handleTileChange.bind(this)),u},e.prototype.getTile=function(t,e,r,n,i){var a=this.getProjection();if(a&&i&&!$y(a,i)){var o=this.getTileCacheForProjection(i),s=[t,e,r],l=void 0,u=C_(s);o.containsKey(u)&&(l=o.get(u));var c=this.getKey();if(l&&l.key==c)return l;var h=this.getTileGridForProjection(a),d=this.getTileGridForProjection(i),f=this.getTileCoordForTileUrlFunction(s,i),p=new E_(a,h,i,d,s,f,this.getTilePixelRatio(n),this.getGutter(),function(t,e,r,n){return this.getTileInternal(t,e,r,n,a)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return p.key=c,l?(p.interimTile=l,p.refreshInterimChain(),o.replace(u,p)):o.set(u,p),p}return this.getTileInternal(t,e,r,n,a||i)},e.prototype.getTileInternal=function(t,e,r,n,i){var a=null,o=P_(t,e,r),s=this.getKey();if(this.tileCache.containsKey(o)){if((a=this.tileCache.get(o)).key!=s){var l=a;a=this.createTile_(t,e,r,n,i,s),l.getState()==Jx.IDLE?a.interimTile=l.interimTile:a.interimTile=l,a.refreshInterimChain(),this.tileCache.replace(o,a)}}else a=this.createTile_(t,e,r,n,i,s),this.tileCache.set(o,a);return a},e.prototype.setRenderReprojectionEdges=function(t){if(this.renderReprojectionEdges_!=t){for(var e in this.renderReprojectionEdges_=t,this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}},e.prototype.setTileGridForProjection=function(t,e){var r=Zy(t);if(r){var n=ey(r);n in this.tileGridForProjection||(this.tileGridForProjection[n]=e)}},e}(vw);function _w(t,e){t.getImage().src=e}const ww=xw;var bw="1.3.0";function Mw(t,e){var r=[];Object.keys(e).forEach((function(t){null!==e[t]&&void 0!==e[t]&&r.push(t+"="+encodeURIComponent(e[t]))}));var n=r.join("&");return(t=-1===(t=t.replace(/[?&]$/,"")).indexOf("?")?t+"?":t+"&")+n}var Sw=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Tw=function(t){function e(e){var r=this,n=e||{},i=void 0===n.imageSmoothing||n.imageSmoothing;void 0!==n.interpolate&&(i=n.interpolate);var a=n.params||{},o=!("TRANSPARENT"in a)||a.TRANSPARENT;return(r=t.call(this,{attributions:n.attributions,attributionsCollapsible:n.attributionsCollapsible,cacheSize:n.cacheSize,crossOrigin:n.crossOrigin,interpolate:i,opaque:!o,projection:n.projection,reprojectionErrorThreshold:n.reprojectionErrorThreshold,tileClass:n.tileClass,tileGrid:n.tileGrid,tileLoadFunction:n.tileLoadFunction,url:n.url,urls:n.urls,wrapX:void 0===n.wrapX||n.wrapX,transition:n.transition,zDirection:n.zDirection})||this).gutter_=void 0!==n.gutter?n.gutter:0,r.params_=a,r.v13_=!0,r.serverType_=n.serverType,r.hidpi_=void 0===n.hidpi||n.hidpi,r.tmpExtent_=[1/0,1/0,-1/0,-1/0],r.updateV13_(),r.setKey(r.getKeyForParams_()),r}return Sw(e,t),e.prototype.getFeatureInfoUrl=function(t,e,r,n){var i=Zy(r),a=this.getProjection(),o=this.getTileGrid();o||(o=this.getTileGridForProjection(i));var s=o.getZForResolution(e,this.zDirection),l=o.getTileCoordForCoordAndZ(t,s);if(!(o.getResolutions().length<=l[0])){var u,c=o.getResolution(l[0]),h=o.getTileCoordExtent(l,this.tmpExtent_),d=nw(o.getTileSize(l[0]),this.tmpSize),f=this.gutter_;0!==f&&(d=ew(d,f,this.tmpSize),h=oy(h,c*f,h)),a&&a!==i&&(c=M_(a,i,t,c),h=Ny(h,ex(i,a),void 0,u),t=rx(t,i,a));var p={SERVICE:"WMS",VERSION:bw,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};Wv(p,this.params_,n);var m=Math.floor((t[0]-h[0])/c),g=Math.floor((h[3]-t[1])/c);return p[this.v13_?"I":"X"]=m,p[this.v13_?"J":"Y"]=g,this.getRequestUrl_(l,d,h,1,a||i,p)}},e.prototype.getLegendUrl=function(t,e){if(void 0!==this.urls[0]){var r={SERVICE:"WMS",VERSION:bw,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===e||void 0===e.LAYER){var n=this.params_.LAYERS;if(!(!Array.isArray(n)||1===n.length))return;r.LAYER=n}if(void 0!==t){var i=this.getProjection()?this.getProjection().getMetersPerUnit():1;r.SCALE=t*i/28e-5}return Wv(r,e),Mw(this.urls[0],r)}},e.prototype.getGutter=function(){return this.gutter_},e.prototype.getParams=function(){return this.params_},e.prototype.getRequestUrl_=function(t,e,r,n,i,a){var o=this.urls;if(o){if(a.WIDTH=e[0],a.HEIGHT=e[1],a[this.v13_?"CRS":"SRS"]=i.getCode(),"STYLES"in this.params_||(a.STYLES=""),1!=n)switch(this.serverType_){case"geoserver":var s=90*n+.5|0;"FORMAT_OPTIONS"in a?a.FORMAT_OPTIONS+=";dpi:"+s:a.FORMAT_OPTIONS="dpi:"+s;break;case"mapserver":a.MAP_RESOLUTION=90*n;break;case"carmentaserver":case"qgis":a.DPI=90*n;break;default:iy(!1,52)}var l,u=i.getAxisOrientation(),c=r;if(this.v13_&&"ne"==u.substr(0,2)){var h=void 0;h=r[0],c[0]=r[1],c[1]=h,h=r[2],c[2]=r[3],c[3]=h}if(a.BBOX=c.join(","),1==o.length)l=o[0];else l=o[Mv(L_(t),o.length)];return Mw(l,a)}},e.prototype.getTilePixelRatio=function(t){return this.hidpi_&&void 0!==this.serverType_?t:1},e.prototype.getKeyForParams_=function(){var t=0,e=[];for(var r in this.params_)e[t++]=r+"-"+this.params_[r];return e.join("/")},e.prototype.updateParams=function(t){Wv(this.params_,t),this.updateV13_(),this.setKey(this.getKeyForParams_())},e.prototype.updateV13_=function(){var t=this.params_.VERSION||bw;this.v13_=function(t,e){for(var r=(""+t).split("."),n=(""+e).split("."),i=0;i<Math.max(r.length,n.length);i++){var a=parseInt(r[i]||"0",10),o=parseInt(n[i]||"0",10);if(a>o)return 1;if(o>a)return-1}return 0}(t,"1.3")>=0},e.prototype.tileUrlFunction=function(t,e,r){var n=this.getTileGrid();if(n||(n=this.getTileGridForProjection(r)),!(n.getResolutions().length<=t[0])){1==e||this.hidpi_&&void 0!==this.serverType_||(e=1);var i=n.getResolution(t[0]),a=n.getTileCoordExtent(t,this.tmpExtent_),o=nw(n.getTileSize(t[0]),this.tmpSize),s=this.gutter_;0!==s&&(o=ew(o,s,this.tmpSize),a=oy(a,i*s,a)),1!=e&&(o=rw(o,e,this.tmpSize));var l={SERVICE:"WMS",VERSION:bw,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};return Wv(l,this.params_),this.getRequestUrl_(t,o,a,e,r,l)}},e}(ww);const Ew=of(Object.freeze(Object.defineProperty({__proto__:null,default:Tw},Symbol.toStringTag,{value:"Module"}))),Aw="add",Rw="remove";var Pw=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Cw="length",Iw=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.element=r,i.index=n,i}return Pw(e,t),e}(Vx);const Lw=function(t){function e(e,r){var n=t.call(this)||this;n.on,n.once,n.un;var i=r||{};if(n.unique_=!!i.unique,n.array_=e||[],n.unique_)for(var a=0,o=n.array_.length;a<o;++a)n.assertUnique_(n.array_[a],a);return n.updateLength_(),n}return Pw(e,t),e.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},e.prototype.extend=function(t){for(var e=0,r=t.length;e<r;++e)this.push(t[e]);return this},e.prototype.forEach=function(t){for(var e=this.array_,r=0,n=e.length;r<n;++r)t(e[r],r,e)},e.prototype.getArray=function(){return this.array_},e.prototype.item=function(t){return this.array_[t]},e.prototype.getLength=function(){return this.get(Cw)},e.prototype.insertAt=function(t,e){this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new Iw(Aw,e,t))},e.prototype.pop=function(){return this.removeAt(this.getLength()-1)},e.prototype.push=function(t){this.unique_&&this.assertUnique_(t);var e=this.getLength();return this.insertAt(e,t),this.getLength()},e.prototype.remove=function(t){for(var e=this.array_,r=0,n=e.length;r<n;++r)if(e[r]===t)return this.removeAt(r)},e.prototype.removeAt=function(t){var e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Iw(Rw,e,t)),e},e.prototype.setAt=function(t,e){var r=this.getLength();if(t<r){this.unique_&&this.assertUnique_(e,t);var n=this.array_[t];this.array_[t]=e,this.dispatchEvent(new Iw(Rw,n,t)),this.dispatchEvent(new Iw(Aw,e,t))}else{for(var i=r;i<t;++i)this.insertAt(i,void 0);this.insertAt(t,e)}},e.prototype.updateLength_=function(){this.set(Cw,this.array_.length)},e.prototype.assertUnique_=function(t,e){for(var r=0,n=this.array_.length;r<n;++r)if(this.array_[r]===t&&r!==e)throw new ny(58)},e}(H_);function Ow(t,e,r,n,i){Dw(t,e,r||0,n||t.length-1,i||Fw)}function Dw(t,e,r,n,i){for(;n>r;){if(n-r>600){var a=n-r+1,o=e-r+1,s=Math.log(a),l=.5*Math.exp(2*s/3),u=.5*Math.sqrt(s*l*(a-l)/a)*(o-a/2<0?-1:1);Dw(t,e,Math.max(r,Math.floor(e-o*l/a+u)),Math.min(n,Math.floor(e+(a-o)*l/a+u)),i)}var c=t[e],h=r,d=n;for(kw(t,r,e),i(t[n],c)>0&&kw(t,r,n);h<d;){for(kw(t,h,d),h++,d--;i(t[h],c)<0;)h++;for(;i(t[d],c)>0;)d--}0===i(t[r],c)?kw(t,r,d):kw(t,++d,n),d<=e&&(r=d+1),e<=d&&(n=d-1)}}function kw(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function Fw(t,e){return t<e?-1:t>e?1:0}function Nw(t,e,r){if(!r)return e.indexOf(t);for(let n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}function Uw(t,e){Bw(t,0,t.children.length,e,t)}function Bw(t,e,r,n,i){i||(i=Yw(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let a=e;a<r;a++){const e=t.children[a];zw(i,t.leaf?n(e):e)}return i}function zw(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function Gw(t,e){return t.minX-e.minX}function jw(t,e){return t.minY-e.minY}function Vw(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Hw(t){return t.maxX-t.minX+(t.maxY-t.minY)}function Ww(t,e){const r=Math.max(t.minX,e.minX),n=Math.max(t.minY,e.minY),i=Math.min(t.maxX,e.maxX),a=Math.min(t.maxY,e.maxY);return Math.max(0,i-r)*Math.max(0,a-n)}function qw(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function Xw(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function Yw(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Zw(t,e,r,n,i){const a=[e,r];for(;a.length;){if((r=a.pop())-(e=a.pop())<=n)continue;const o=e+Math.ceil((r-e)/n/2)*n;Ow(t,o,e,r,i),a.push(e,o,o,r)}}const Kw=function(){function t(t){this.rbush_=new class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const r=[];if(!Xw(t,e))return r;const n=this.toBBox,i=[];for(;e;){for(let a=0;a<e.children.length;a++){const o=e.children[a],s=e.leaf?n(o):o;Xw(t,s)&&(e.leaf?r.push(o):qw(t,s)?this._all(o,r):i.push(o))}e=i.pop()}return r}collides(t){let e=this.data;if(!Xw(t,e))return!1;const r=[];for(;e;){for(let n=0;n<e.children.length;n++){const i=e.children[n],a=e.leaf?this.toBBox(i):i;if(Xw(t,a)){if(e.leaf||qw(t,a))return!0;r.push(i)}}e=r.pop()}return!1}load(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(let e=0;e<t.length;e++)this.insert(t[e]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const t=this.data;this.data=e,e=t}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=Yw([]),this}remove(t,e){if(!t)return this;let r=this.data;const n=this.toBBox(t),i=[],a=[];let o,s,l;for(;r||i.length;){if(r||(r=i.pop(),s=i[i.length-1],o=a.pop(),l=!0),r.leaf){const n=Nw(t,r.children,e);if(-1!==n)return r.children.splice(n,1),i.push(r),this._condense(i),this}l||r.leaf||!qw(r,n)?s?(o++,r=s.children[o],l=!1):r=null:(i.push(r),a.push(o),o=0,s=r,r=r.children[0])}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const r=[];for(;t;)t.leaf?e.push(...t.children):r.push(...t.children),t=r.pop();return e}_build(t,e,r,n){const i=r-e+1;let a,o=this._maxEntries;if(i<=o)return a=Yw(t.slice(e,r+1)),Uw(a,this.toBBox),a;n||(n=Math.ceil(Math.log(i)/Math.log(o)),o=Math.ceil(i/Math.pow(o,n-1))),a=Yw([]),a.leaf=!1,a.height=n;const s=Math.ceil(i/o),l=s*Math.ceil(Math.sqrt(o));Zw(t,e,r,l,this.compareMinX);for(let i=e;i<=r;i+=l){const e=Math.min(i+l-1,r);Zw(t,i,e,s,this.compareMinY);for(let r=i;r<=e;r+=s){const i=Math.min(r+s-1,e);a.children.push(this._build(t,r,i,n-1))}}return Uw(a,this.toBBox),a}_chooseSubtree(t,e,r,n){for(;n.push(e),!e.leaf&&n.length-1!==r;){let r,n=1/0,o=1/0;for(let s=0;s<e.children.length;s++){const l=e.children[s],u=Vw(l),c=(i=t,a=l,(Math.max(a.maxX,i.maxX)-Math.min(a.minX,i.minX))*(Math.max(a.maxY,i.maxY)-Math.min(a.minY,i.minY))-u);c<o?(o=c,n=u<n?u:n,r=l):c===o&&u<n&&(n=u,r=l)}e=r||e.children[0]}var i,a;return e}_insert(t,e,r){const n=r?t:this.toBBox(t),i=[],a=this._chooseSubtree(n,this.data,e,i);for(a.children.push(t),zw(a,n);e>=0&&i[e].children.length>this._maxEntries;)this._split(i,e),e--;this._adjustParentBBoxes(n,i,e)}_split(t,e){const r=t[e],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);const a=this._chooseSplitIndex(r,i,n),o=Yw(r.children.splice(a,r.children.length-a));o.height=r.height,o.leaf=r.leaf,Uw(r,this.toBBox),Uw(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(r,o)}_splitRoot(t,e){this.data=Yw([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Uw(this.data,this.toBBox)}_chooseSplitIndex(t,e,r){let n,i=1/0,a=1/0;for(let o=e;o<=r-e;o++){const e=Bw(t,0,o,this.toBBox),s=Bw(t,o,r,this.toBBox),l=Ww(e,s),u=Vw(e)+Vw(s);l<i?(i=l,n=o,a=u<a?u:a):l===i&&u<a&&(a=u,n=o)}return n||r-e}_chooseSplitAxis(t,e,r){const n=t.leaf?this.compareMinX:Gw,i=t.leaf?this.compareMinY:jw;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,i)&&t.children.sort(n)}_allDistMargin(t,e,r,n){t.children.sort(n);const i=this.toBBox,a=Bw(t,0,e,i),o=Bw(t,r-e,r,i);let s=Hw(a)+Hw(o);for(let n=e;n<r-e;n++){const e=t.children[n];zw(a,t.leaf?i(e):e),s+=Hw(a)}for(let n=r-e-1;n>=e;n--){const e=t.children[n];zw(o,t.leaf?i(e):e),s+=Hw(o)}return s}_adjustParentBBoxes(t,e,r){for(let n=r;n>=0;n--)zw(e[n],t)}_condense(t){for(let e,r=t.length-1;r>=0;r--)0===t[r].children.length?r>0?(e=t[r-1].children,e.splice(e.indexOf(t[r]),1)):this.clear():Uw(t[r],this.toBBox)}}(t),this.items_={}}return t.prototype.insert=function(t,e){var r={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(r),this.items_[ey(e)]=r},t.prototype.load=function(t,e){for(var r=new Array(e.length),n=0,i=e.length;n<i;n++){var a=t[n],o=e[n],s={minX:a[0],minY:a[1],maxX:a[2],maxY:a[3],value:o};r[n]=s,this.items_[ey(o)]=s}this.rbush_.load(r)},t.prototype.remove=function(t){var e=ey(t),r=this.items_[e];return delete this.items_[e],null!==this.rbush_.remove(r)},t.prototype.update=function(t,e){var r=this.items_[ey(e)];my([r.minX,r.minY,r.maxX,r.maxY],t)||(this.remove(e),this.insert(t,e))},t.prototype.getAll=function(){return this.rbush_.all().map((function(t){return t.value}))},t.prototype.getInExtent=function(t){var e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map((function(t){return t.value}))},t.prototype.forEach=function(t){return this.forEach_(this.getAll(),t)},t.prototype.forEachInExtent=function(t,e){return this.forEach_(this.getInExtent(t),e)},t.prototype.forEach_=function(t,e){for(var r,n=0,i=t.length;n<i;n++)if(r=e(t[n]))return r;return r},t.prototype.isEmpty=function(){return Yv(this.items_)},t.prototype.clear=function(){this.rbush_.clear(),this.items_={}},t.prototype.getExtent=function(t){var e=this.rbush_.toJSON();return fy(e.minX,e.minY,e.maxX,e.maxY,t)},t.prototype.concat=function(t){for(var e in this.rbush_.load(t.rbush_.all()),t.items_)this.items_[e]=t.items_[e]},t}(),Jw="addfeature",Qw="changefeature",$w="clear",tb="removefeature",eb="featuresloadstart",rb="featuresloadend",nb="featuresloaderror";function ib(t,e){return[[-1/0,-1/0,1/0,1/0]]}var ab=!1;function ob(t,e,r,n,i,a,o){var s=new XMLHttpRequest;s.open("GET","function"==typeof t?t(r,n,i):t,!0),"arraybuffer"==e.getType()&&(s.responseType="arraybuffer"),s.withCredentials=ab,s.onload=function(t){if(!s.status||s.status>=200&&s.status<300){var n=e.getType(),l=void 0;"json"==n||"text"==n?l=s.responseText:"xml"==n?(l=s.responseXML)||(l=(new DOMParser).parseFromString(s.responseText,"application/xml")):"arraybuffer"==n&&(l=s.response),l?a(e.readFeatures(l,{extent:r,featureProjection:i}),e.readProjection(l)):o()}else o()},s.onerror=o,s.send()}function sb(t,e){return function(r,n,i,a,o){var s=this;ob(t,e,r,n,i,(function(t,e){s.addFeatures(t),void 0!==a&&a(t)}),o||Yx)}}var lb=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ub=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.feature=r,i.features=n,i}return lb(e,t),e}(Vx),cb=function(t){function e(e){var r=this,n=e||{};(r=t.call(this,{attributions:n.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:void 0===n.wrapX||n.wrapX})||this).on,r.once,r.un,r.loader_=Yx,r.format_=n.format,r.overlaps_=void 0===n.overlaps||n.overlaps,r.url_=n.url,void 0!==n.loader?r.loader_=n.loader:void 0!==r.url_&&(iy(r.format_,7),r.loader_=sb(r.url_,r.format_)),r.strategy_=void 0!==n.strategy?n.strategy:ib;var i,a,o=void 0===n.useSpatialIndex||n.useSpatialIndex;return r.featuresRtree_=o?new Kw:null,r.loadedExtentsRtree_=new Kw,r.loadingExtentsCount_=0,r.nullGeometryFeatures_={},r.idIndex_={},r.uidIndex_={},r.featureChangeKeys_={},r.featuresCollection_=null,Array.isArray(n.features)?a=n.features:n.features&&(a=(i=n.features).getArray()),o||void 0!==i||(i=new Lw(a)),void 0!==a&&r.addFeaturesInternal(a),void 0!==i&&r.bindFeaturesCollection_(i),r}return lb(e,t),e.prototype.addFeature=function(t){this.addFeatureInternal(t),this.changed()},e.prototype.addFeatureInternal=function(t){var e=ey(t);if(this.addToIndex_(e,t)){this.setupChangeEvents_(e,t);var r=t.getGeometry();if(r){var n=r.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new ub(Jw,t))}else this.featuresCollection_&&this.featuresCollection_.remove(t)},e.prototype.setupChangeEvents_=function(t,e){this.featureChangeKeys_[t]=[u_(e,Gx.CHANGE,this.handleFeatureChange_,this),u_(e,U_,this.handleFeatureChange_,this)]},e.prototype.addToIndex_=function(t,e){var r=!0,n=e.getId();return void 0!==n&&(n.toString()in this.idIndex_?r=!1:this.idIndex_[n.toString()]=e),r&&(iy(!(t in this.uidIndex_),30),this.uidIndex_[t]=e),r},e.prototype.addFeatures=function(t){this.addFeaturesInternal(t),this.changed()},e.prototype.addFeaturesInternal=function(t){for(var e=[],r=[],n=[],i=0,a=t.length;i<a;i++){var o=ey(l=t[i]);this.addToIndex_(o,l)&&r.push(l)}i=0;for(var s=r.length;i<s;i++){var l;o=ey(l=r[i]);this.setupChangeEvents_(o,l);var u=l.getGeometry();if(u){var c=u.getExtent();e.push(c),n.push(l)}else this.nullGeometryFeatures_[o]=l}if(this.featuresRtree_&&this.featuresRtree_.load(e,n),this.hasListener(Jw)){i=0;for(var h=r.length;i<h;i++)this.dispatchEvent(new ub(Jw,r[i]))}},e.prototype.bindFeaturesCollection_=function(t){var e=!1;this.addEventListener(Jw,(function(r){e||(e=!0,t.push(r.feature),e=!1)})),this.addEventListener(tb,(function(r){e||(e=!0,t.remove(r.feature),e=!1)})),t.addEventListener(Aw,function(t){e||(e=!0,this.addFeature(t.element),e=!1)}.bind(this)),t.addEventListener(Rw,function(t){e||(e=!0,this.removeFeature(t.element),e=!1)}.bind(this)),this.featuresCollection_=t},e.prototype.clear=function(t){if(t){for(var e in this.featureChangeKeys_){this.featureChangeKeys_[e].forEach(h_)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){var r=function(t){this.removeFeatureInternal(t)}.bind(this);for(var n in this.featuresRtree_.forEach(r),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var i=new ub($w);this.dispatchEvent(i),this.changed()},e.prototype.forEachFeature=function(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)},e.prototype.forEachFeatureAtCoordinateDirect=function(t,e){var r=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(r,(function(r){return r.getGeometry().intersectsCoordinate(t)?e(r):void 0}))},e.prototype.forEachFeatureInExtent=function(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)},e.prototype.forEachFeatureIntersectingExtent=function(t,e){return this.forEachFeatureInExtent(t,(function(r){if(r.getGeometry().intersectsExtent(t)){var n=e(r);if(n)return n}}))},e.prototype.getFeaturesCollection=function(){return this.featuresCollection_},e.prototype.getFeatures=function(){var t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Yv(this.nullGeometryFeatures_)||function(t,e){for(var r=Array.isArray(e)?e:[e],n=r.length,i=0;i<n;i++)t[t.length]=r[i]}(t,Xv(this.nullGeometryFeatures_))),t},e.prototype.getFeaturesAtCoordinate=function(t){var e=[];return this.forEachFeatureAtCoordinateDirect(t,(function(t){e.push(t)})),e},e.prototype.getFeaturesInExtent=function(t,e){var r=this;if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);var n=By(t,e);return[].concat.apply([],n.map((function(t){return r.featuresRtree_.getInExtent(t)})))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]},e.prototype.getClosestFeatureToCoordinate=function(t,e){var r=t[0],n=t[1],i=null,a=[NaN,NaN],o=1/0,s=[-1/0,-1/0,1/0,1/0],l=e||Xx;return this.featuresRtree_.forEachInExtent(s,(function(t){if(l(t)){var e=t.getGeometry(),u=o;if((o=e.closestPointXY(r,n,a,o))<u){i=t;var c=Math.sqrt(o);s[0]=r-c,s[1]=n-c,s[2]=r+c,s[3]=n+c}}})),i},e.prototype.getExtent=function(t){return this.featuresRtree_.getExtent(t)},e.prototype.getFeatureById=function(t){var e=this.idIndex_[t.toString()];return void 0!==e?e:null},e.prototype.getFeatureByUid=function(t){var e=this.uidIndex_[t];return void 0!==e?e:null},e.prototype.getFormat=function(){return this.format_},e.prototype.getOverlaps=function(){return this.overlaps_},e.prototype.getUrl=function(){return this.url_},e.prototype.handleFeatureChange_=function(t){var e=t.target,r=ey(e),n=e.getGeometry();if(n){var i=n.getExtent();r in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[r],this.featuresRtree_&&this.featuresRtree_.insert(i,e)):this.featuresRtree_&&this.featuresRtree_.update(i,e)}else r in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[r]=e);var a=e.getId();if(void 0!==a){var o=a.toString();this.idIndex_[o]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[o]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[r]=e;this.changed(),this.dispatchEvent(new ub(Qw,e))},e.prototype.hasFeature=function(t){var e=t.getId();return void 0!==e?e in this.idIndex_:ey(t)in this.uidIndex_},e.prototype.isEmpty=function(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Yv(this.nullGeometryFeatures_):!this.featuresCollection_||0===this.featuresCollection_.getLength()},e.prototype.loadFeatures=function(t,e,r){for(var n=this.loadedExtentsRtree_,i=this.strategy_(t,e,r),a=function(t,a){var s=i[t];n.forEachInExtent(s,(function(t){return uy(t.extent,s)}))||(++o.loadingExtentsCount_,o.dispatchEvent(new ub(eb)),o.loader_.call(o,s,e,r,function(t){--this.loadingExtentsCount_,this.dispatchEvent(new ub(rb,void 0,t))}.bind(o),function(){--this.loadingExtentsCount_,this.dispatchEvent(new ub(nb))}.bind(o)),n.insert(s,{extent:s.slice()}))},o=this,s=0,l=i.length;s<l;++s)a(s);this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0},e.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),t.prototype.refresh.call(this)},e.prototype.removeLoadedExtent=function(t){var e,r=this.loadedExtentsRtree_;r.forEachInExtent(t,(function(r){if(my(r.extent,t))return e=r,!0})),e&&r.remove(e)},e.prototype.removeFeature=function(t){if(t){var e=ey(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t)&&this.changed()}},e.prototype.removeFeatureInternal=function(t){var e=ey(t),r=this.featureChangeKeys_[e];if(r){r.forEach(h_),delete this.featureChangeKeys_[e];var n=t.getId();return void 0!==n&&delete this.idIndex_[n.toString()],delete this.uidIndex_[e],this.dispatchEvent(new ub(tb,t)),t}},e.prototype.removeFromIdIndex_=function(t){var e=!1;for(var r in this.idIndex_)if(this.idIndex_[r]===t){delete this.idIndex_[r],e=!0;break}return e},e.prototype.setLoader=function(t){this.loader_=t},e.prototype.setUrl=function(t){iy(this.format_,7),this.url_=t,this.setLoader(sb(t,this.format_))},e}(X_);const hb=of(Object.freeze(Object.defineProperty({__proto__:null,VectorSourceEvent:ub,default:cb},Symbol.toStringTag,{value:"Module"})));var db=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const fb=function(t){function e(e,r,n,i,a,o){var s=t.call(this,e,r,o)||this;return s.extent=null,s.format_=i,s.features_=null,s.loader_,s.projection=null,s.resolution,s.tileLoadFunction_=a,s.url_=n,s.key=n,s}return db(e,t),e.prototype.getFormat=function(){return this.format_},e.prototype.getFeatures=function(){return this.features_},e.prototype.load=function(){this.state==Jx.IDLE&&(this.setState(Jx.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))},e.prototype.onLoad=function(t,e){this.setFeatures(t)},e.prototype.onError=function(){this.setState(Jx.ERROR)},e.prototype.setFeatures=function(t){this.features_=t,this.setState(Jx.LOADED)},e.prototype.setLoader=function(t){this.loader_=t},e}(t_);var pb=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),mb=[];const gb=function(t){function e(e,r,n,i){var a=t.call(this,e,r,{transition:0})||this;return a.context_={},a.executorGroups={},a.declutterExecutorGroups={},a.loadingSourceTiles=0,a.hitDetectionImageData={},a.replayState_={},a.sourceTiles=[],a.errorTileKeys={},a.wantedResolution,a.getSourceTiles=i.bind(void 0,a),a.wrappedTileCoord=n,a}return pb(e,t),e.prototype.getContext=function(t){var e=ey(t);return e in this.context_||(this.context_[e]=i_(1,1,mb)),this.context_[e]},e.prototype.hasContext=function(t){return ey(t)in this.context_},e.prototype.getImage=function(t){return this.hasContext(t)?this.getContext(t).canvas:null},e.prototype.getReplayState=function(t){var e=ey(t);return e in this.replayState_||(this.replayState_[e]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[e]},e.prototype.load=function(){this.getSourceTiles()},e.prototype.release=function(){for(var e in this.context_){var r=this.context_[e];a_(r),mb.push(r.canvas),delete this.context_[e]}t.prototype.release.call(this)},e}(t_);var vb=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),yb=function(t){function e(e){var r=this,n=e.projection||"EPSG:3857",i=e.extent||uw(n),a=e.tileGrid||sw({extent:i,maxResolution:e.maxResolution,maxZoom:void 0!==e.maxZoom?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});return(r=t.call(this,{attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,opaque:!1,projection:n,state:e.state,tileGrid:a,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:xb,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:void 0===e.zDirection?1:e.zDirection})||this).format_=e.format?e.format:null,r.sourceTileCache=new D_(r.tileCache.highWaterMark),r.overlaps_=null==e.overlaps||e.overlaps,r.tileClass=e.tileClass?e.tileClass:fb,r.tileGrids_={},r}return vb(e,t),e.prototype.getFeaturesInExtent=function(t){var e=[],r=this.tileCache;if(0===r.getCount())return e;var n=I_(r.peekFirstKey())[0],i=this.tileGrid;return r.forEach((function(r){if(r.tileCoord[0]===n&&r.getState()===Jx.LOADED)for(var a=r.getSourceTiles(),o=0,s=a.length;o<s;++o){var l=a[o],u=l.tileCoord;if(Dy(t,i.getTileCoordExtent(u))){var c=l.getFeatures();if(c)for(var h=0,d=c.length;h<d;++h){var f=c[h],p=f.getGeometry();Dy(t,p.getExtent())&&e.push(f)}}}})),e},e.prototype.getOverlaps=function(){return this.overlaps_},e.prototype.clear=function(){this.tileCache.clear(),this.sourceTileCache.clear()},e.prototype.expireCache=function(e,r){var n=this.getTileCacheForProjection(e),i=Object.keys(r).reduce((function(t,e){var r,i,a=P_((i=(r=e).substring(r.lastIndexOf("/")+1,r.length).split(",").map(Number))[0],i[1],i[2]),o=n.peek(a);if(o)for(var s=o.sourceTiles,l=0,u=s.length;l<u;++l)t[s[l].getKey()]=!0;return t}),{});t.prototype.expireCache.call(this,e,r),this.sourceTileCache.expireCache(i)},e.prototype.getSourceTiles=function(t,e,r){var n=this;if(r.getState()===Jx.IDLE){r.setState(Jx.LOADING);var i=r.wrappedTileCoord,a=this.getTileGridForProjection(e),o=a.getTileCoordExtent(i),s=i[0],l=a.getResolution(s);oy(o,-l,o);var u=this.tileGrid,c=u.getExtent();c&&Cy(o,c,o);var h=u.getZForResolution(l,this.zDirection);u.forEachTileCoord(o,h,(function(i){var a=n.tileUrlFunction(i,t,e),o=n.sourceTileCache.containsKey(a)?n.sourceTileCache.get(a):new n.tileClass(i,a?Jx.IDLE:Jx.EMPTY,a,n.format_,n.tileLoadFunction);r.sourceTiles.push(o);var s=o.getState();if(s<Jx.LOADED){var l=function(t){n.handleTileChange(t);var e=o.getState();if(e===Jx.LOADED||e===Jx.ERROR){var i=o.getKey();i in r.errorTileKeys?o.getState()===Jx.LOADED&&delete r.errorTileKeys[i]:r.loadingSourceTiles--,e===Jx.ERROR?r.errorTileKeys[i]=!0:o.removeEventListener(Gx.CHANGE,l),0===r.loadingSourceTiles&&r.setState(Yv(r.errorTileKeys)?Jx.LOADED:Jx.ERROR)}};o.addEventListener(Gx.CHANGE,l),r.loadingSourceTiles++}s===Jx.IDLE&&(o.extent=u.getTileCoordExtent(i),o.projection=e,o.resolution=u.getResolution(i[0]),n.sourceTileCache.set(a,o),o.load())})),r.loadingSourceTiles||r.setState(r.sourceTiles.some((function(t){return t.getState()===Jx.ERROR}))?Jx.ERROR:Jx.LOADED)}return r.sourceTiles},e.prototype.getTile=function(t,e,r,n,i){var a,o=P_(t,e,r),s=this.getKey();if(this.tileCache.containsKey(o)&&(a=this.tileCache.get(o)).key===s)return a;var l=[t,e,r],u=this.getTileCoordForTileUrlFunction(l,i),c=this.getTileGrid().getExtent(),h=this.getTileGridForProjection(i);if(u&&c){var d=h.getTileCoordExtent(u);oy(d,-h.getResolution(t),d),Dy(c,d)||(u=null)}var f=!0;if(null!==u){var p=this.tileGrid,m=h.getResolution(t),g=p.getZForResolution(m,1),v=h.getTileCoordExtent(u);oy(v,-m,v),p.forEachTileCoord(v,g,function(t){f=f&&!this.tileUrlFunction(t,n,i)}.bind(this))}var y=new gb(l,f?Jx.EMPTY:Jx.IDLE,u,this.getSourceTiles.bind(this,n,i));return y.key=s,a?(y.interimTile=a,y.refreshInterimChain(),this.tileCache.replace(o,y)):this.tileCache.set(o,y),y},e.prototype.getTileGridForProjection=function(t){var e=t.getCode(),r=this.tileGrids_[e];if(!r){for(var n=this.tileGrid,i=n.getResolutions().slice(),a=i.map((function(t,e){return n.getOrigin(e)})),o=i.map((function(t,e){return n.getTileSize(e)})),s=J_+1,l=i.length;l<s;++l)i.push(i[l-1]/2),a.push(a[l-1]),o.push(o[l-1]);r=new aw({extent:n.getExtent(),origins:a,resolutions:i,tileSizes:o}),this.tileGrids_[e]=r}return r},e.prototype.getTilePixelRatio=function(t){return t},e.prototype.getTilePixelSize=function(t,e,r){var n=nw(this.getTileGridForProjection(r).getTileSize(t),this.tmpSize);return[Math.round(n[0]*e),Math.round(n[1]*e)]},e.prototype.updateCacheSize=function(e,r){t.prototype.updateCacheSize.call(this,2*e,r),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(r).highWaterMark},e}(vw);function xb(t,e){t.setLoader((function(r,n,i){ob(e,t.getFormat(),r,n,i,t.onLoad.bind(t),t.onError.bind(t))}))}const _b=of(Object.freeze(Object.defineProperty({__proto__:null,default:yb,defaultLoadFunction:xb},Symbol.toStringTag,{value:"Module"})));var wb=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const bb=function(t){function e(e){var r=this,n=e||{},i=void 0===n.imageSmoothing||n.imageSmoothing;void 0!==n.interpolate&&(i=n.interpolate);var a=void 0!==n.projection?n.projection:"EPSG:3857",o=void 0!==n.tileGrid?n.tileGrid:sw({extent:uw(a),maxResolution:n.maxResolution,maxZoom:n.maxZoom,minZoom:n.minZoom,tileSize:n.tileSize});return(r=t.call(this,{attributions:n.attributions,cacheSize:n.cacheSize,crossOrigin:n.crossOrigin,interpolate:i,opaque:n.opaque,projection:a,reprojectionErrorThreshold:n.reprojectionErrorThreshold,tileGrid:o,tileLoadFunction:n.tileLoadFunction,tilePixelRatio:n.tilePixelRatio,tileUrlFunction:n.tileUrlFunction,url:n.url,urls:n.urls,wrapX:void 0===n.wrapX||n.wrapX,transition:n.transition,attributionsCollapsible:n.attributionsCollapsible,zDirection:n.zDirection})||this).gutter_=void 0!==n.gutter?n.gutter:0,r}return wb(e,t),e.prototype.getGutter=function(){return this.gutter_},e}(ww);var Mb=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Sb='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';!function(t){function e(e){var r,n=e||{},i=void 0===n.imageSmoothing||n.imageSmoothing;void 0!==n.interpolate&&(i=n.interpolate),r=void 0!==n.attributions?n.attributions:[Sb];var a=void 0!==n.crossOrigin?n.crossOrigin:"anonymous",o=void 0!==n.url?n.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png";return t.call(this,{attributions:r,attributionsCollapsible:!1,cacheSize:n.cacheSize,crossOrigin:a,interpolate:i,maxZoom:void 0!==n.maxZoom?n.maxZoom:19,opaque:void 0===n.opaque||n.opaque,reprojectionErrorThreshold:n.reprojectionErrorThreshold,tileLoadFunction:n.tileLoadFunction,transition:n.transition,url:o,wrapX:n.wrapX,zDirection:n.zDirection})||this}Mb(e,t)}(bb);var Tb=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Eb=['Map tiles by <a href="https://stamen.com/" target="_blank">Stamen Design</a>, under <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC BY 3.0</a>.',Sb],Ab={terrain:{extension:"jpg",opaque:!0},"terrain-background":{extension:"jpg",opaque:!0},"terrain-labels":{extension:"png",opaque:!1},"terrain-lines":{extension:"png",opaque:!1},"toner-background":{extension:"png",opaque:!0},toner:{extension:"png",opaque:!0},"toner-hybrid":{extension:"png",opaque:!1},"toner-labels":{extension:"png",opaque:!1},"toner-lines":{extension:"png",opaque:!1},"toner-lite":{extension:"png",opaque:!0},watercolor:{extension:"jpg",opaque:!0}},Rb={terrain:{minZoom:0,maxZoom:18},toner:{minZoom:0,maxZoom:20},watercolor:{minZoom:0,maxZoom:18}},Pb=function(t){function e(e){var r=void 0===e.imageSmoothing||e.imageSmoothing;void 0!==e.interpolate&&(r=e.interpolate);var n=e.layer.indexOf("-"),i=-1==n?e.layer:e.layer.slice(0,n),a=Rb[i],o=Ab[e.layer],s=void 0!==e.url?e.url:"https://stamen-tiles-{a-d}.a.ssl.fastly.net/"+e.layer+"/{z}/{x}/{y}."+o.extension;return t.call(this,{attributions:Eb,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:r,maxZoom:null!=e.maxZoom?e.maxZoom:a.maxZoom,minZoom:null!=e.minZoom?e.minZoom:a.minZoom,opaque:o.opaque,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:s,wrapX:e.wrapX,zDirection:e.zDirection})||this}return Tb(e,t),e}(bb);const Cb=of(Object.freeze(Object.defineProperty({__proto__:null,default:Pb},Symbol.toStringTag,{value:"Module"})));var Ib,Lb={};function Ob(){if(Ib)return Lb;Ib=1,Object.defineProperty(Lb,"__esModule",{value:!0}),Lb.STRATEGY_PROGRESSIVE=Lb.STRATEGY_MIN_NETWORK_TRAFFIC=Lb.STRATEGY_GROUP=Lb.STRATEGY_DICHOTOMY=void 0;Lb.STRATEGY_MIN_NETWORK_TRAFFIC=0;Lb.STRATEGY_GROUP=1;Lb.STRATEGY_PROGRESSIVE=2;return Lb.STRATEGY_DICHOTOMY=3,Lb}var Db,kb={};var Fb,Nb,Ub,Bb={},zb={};function Gb(){if(Fb)return zb;Fb=1,Object.defineProperty(zb,"__esModule",{value:!0}),zb.default=void 0;var t=new Bf.TextureLoader;function e(t){if(!t.ok){var e=new Error("Error loading ".concat(t.url,": status ").concat(t.status));throw e.response=t,e}}var r={text:function(t){return fetch(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).then((function(t){return e(t),t.text()}))},json:function(t){return fetch(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).then((function(t){return e(t),t.json()}))},xml:function(t){return fetch(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).then((function(t){return e(t),t.text()})).then((function(t){return(new window.DOMParser).parseFromString(t,"text/xml")}))},texture:function(e){var r,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.crossOrigin=i.crossOrigin;var a=new Promise((function(t,e){r=t,n=e}));return t.load(e,r,(function(){}),n),a},arrayBuffer:function(t){return fetch(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).then((function(t){return e(t),t.arrayBuffer()}))}};return zb.default=r,zb}function jb(){if(Ub)return zx;Ub=1;var t=uf;Object.defineProperty(zx,"__esModule",{value:!0}),zx.defineLayerProperty=zx.default=zx.MAX_RETRY=zx.ImageryLayers=void 0,zx.nodeCommandQueuePriorityFunction=function(t){var e=t.extent.dimensions();return e.x*e.y},zx.refinementCommandCancellationFn=function(t){if(!t.requester.parent||!t.requester.material)return!0;if(t.force)return!1;return!t.requester.material.visible};var e=t(pf()),r=t(yf()),n=t(bf()),i=t(Cf()),a=t(Df()),o=t(Uf()),s=Bf,l=t(Ew),u=t(hb),c=t(_b),h=t(Cb),d=Ob(),f=t(function(){if(Db)return kb;Db=1;var t=uf;Object.defineProperty(kb,"__esModule",{value:!0}),kb.default=void 0;var e=t(yf()),r=t(pf()),n=(0,e.default)((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,r.default)(this,t),this.url=e.url})),i=n;return kb.default=i,kb}()),p=t(function(){if(Nb)return Bb;Nb=1;var t=uf;Object.defineProperty(Bb,"__esModule",{value:!0}),Bb.default=void 0;var e=t(pf()),r=t(yf()),n=t(Gb()),i=function(){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,e.default)(this,t),this.url=new URL(r.url,window.location),this.networkOptions=r.networkOptions}return(0,r.default)(t,[{key:"buildUrl",value:function(t){return this.url.href.substr(0,this.url.href.lastIndexOf("/")+1)+t}},{key:"fetchMetadata",value:function(){return n.default.json(this.url.href,this.networkOptions)}}]),t}(),a=i;return Bb.default=a,Bb}());function m(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return g(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return g(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=(0,o.default)(t);if(e){var i=(0,o.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}zx.defineLayerProperty=function(t,e,r,n){var i=Object.getOwnPropertyDescriptor(t,e);if(!i||!i.set){var a=void 0===t[e]?r:t[e];Object.defineProperty(t,e,{get:function(){return a},set:function(r){if(a!==r){var i={type:"".concat(e,"-property-changed"),previous:{},new:{}};i.previous[e]=a,i.new[e]=r,a=r,n&&n(t,e),t.dispatchEvent(i)}}})}};zx.MAX_RETRY=4;var y=function(t){(0,i.default)(o,t);var a=v(o);function o(t,r){var i;if((0,e.default)(this,o),i=a.call(this),Object.defineProperty((0,n.default)(i),"id",{value:t,writable:!1}),i.standalone=!!r.standalone&&r.standalone,!i.standalone)switch(i.source=r.source,i.source.constructor){case l.default:case h.default:i.protocol="oltile";break;case u.default:i.protocol="olvector";break;case c.default:i.protocol="olvectortile";break;case f.default:i.protocol="cog";break;case p.default:i.protocol="customtiledimage";break;default:throw Error("Unsupported OpenLayers source")}return i.extent=r.extent,r.updateStrategy?i.updateStrategy=r.updateStrategy:i.updateStrategy={type:d.STRATEGY_MIN_NETWORK_TRAFFIC},i.projection=r.projection,i.backgroundColor=r.backgroundColor,i}return(0,r.default)(o,[{key:"_preprocessLayer",value:function(t,e){var r=this;if(this.standalone)return this.whenReady=Promise.resolve().then((function(){return r.ready=!0,r})),this;if(this.provider=e.mainLoop.scheduler.getProtocolProvider(this.protocol),this.provider&&(this.provider.tileInsideLimit&&(this.tileInsideLimit=this.provider.tileInsideLimit.bind(this.provider)),this.provider.getPossibleTextureImprovements&&(this.getPossibleTextureImprovements=this.provider.getPossibleTextureImprovements.bind(this.provider)),this.provider.tileTextureCount&&(this.tileTextureCount=this.provider.tileTextureCount.bind(this.provider))),!this.whenReady){var n=Promise.resolve();this.provider&&this.provider.preprocessDataLayer&&((n=this.provider.preprocessDataLayer(this))&&n.then||(n=Promise.resolve())),this.whenReady=n.then((function(){return r.ready=!0,r}))}return this}},{key:"update",value:function(){return null}},{key:"clean",value:function(){}}]),o}(s.EventDispatcher),x=function(){function t(){(0,e.default)(this,t)}return(0,r.default)(t,null,[{key:"moveLayerToIndex",value:function(t,e,r){e=Math.min(e,r.length-1),e=Math.max(e,0);var n,i=t.sequence,a=m(r);try{for(a.s();!(n=a.n()).done;){var o=n.value;o.id===t.id?o.sequence=e:o.sequence>i&&o.sequence<=e?o.sequence--:o.sequence>=e&&o.sequence<i&&o.sequence++}}catch(t){a.e(t)}finally{a.f()}}},{key:"moveLayerDown",value:function(t,e){t.sequence>0&&this.moveLayerToIndex(t,t.sequence-1,e)}},{key:"moveLayerUp",value:function(t,e){var r=e.length-1;t.sequence<r&&this.moveLayerToIndex(t,t.sequence+1,e)}},{key:"getColorLayersIdOrderedBySequence",value:function(t){var e=Array.from(t);return e.sort((function(t,e){return t.sequence-e.sequence})),e.map((function(t){return t.id}))}}]),t}();zx.ImageryLayers=x;var _=y;return zx.default=_,zx}var Vb,Hb={},Wb={},qb={};function Xb(){if(Vb)return qb;Vb=1,Object.defineProperty(qb,"__esModule",{value:!0}),qb.default=void 0;var t={IDLE:0,PENDING:1,ERROR:2,DEFINITIVE_ERROR:3,FINISHED:4},e=[1,3,7,60];function r(){this.state=t.IDLE,this.lastErrorTimestamp=0,this.errorCount=0}r.prototype.canTryUpdate=function(e){switch(this.state){case t.IDLE:return!0;case t.DEFINITIVE_ERROR:case t.PENDING:case t.FINISHED:return!1;case t.ERROR:default:return 1e3*this.secondsUntilNextTry()<=e-this.lastErrorTimestamp}},r.prototype.secondsUntilNextTry=function(){if(this.state!==t.ERROR)return 0;var r=Math.max(0,Math.min(this.errorCount,e.length)-1);return e[r]},r.prototype.newTry=function(){this.state=t.PENDING},r.prototype.success=function(){this.failureParams=void 0,this.lastErrorTimestamp=0,this.state=t.IDLE},r.prototype.noMoreUpdatePossible=function(){this.failureParams=void 0,this.state=t.FINISHED},r.prototype.failure=function(e,r,n){this.failureParams=n,this.lastErrorTimestamp=e,this.state=r?t.DEFINITIVE_ERROR:t.ERROR,this.errorCount++},r.prototype.inError=function(){return this.state===t.DEFINITIVE_ERROR||this.state===t.ERROR};var n=r;return qb.default=n,qb}var Yb,Zb,Kb={};function Jb(){if(Yb)return Kb;Yb=1;var t=uf;Object.defineProperty(Kb,"__esModule",{value:!0}),Kb.default=void 0;var e=t(pf()),r=t(yf()),n=function(){function t(r){(0,e.default)(this,t),this.command=r}return(0,r.default)(t,[{key:"toString",value:function(){return"Cancelled command ".concat(this.command.requester.id,"/").concat(this.command.layer.id)}}]),t}();return Kb.default=n,Kb}function Qb(){if(Zb)return Wb;Zb=1;var t=uf,e=cf;Object.defineProperty(Wb,"__esModule",{value:!0}),Wb.default=void 0;var r=t(pf()),n=t(yf()),i=t(bf()),a=t(Cf()),o=t(Df()),s=t(Uf()),l=t(Xb()),u=t(Jb()),c=function(t,r){if(!r&&t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var n=h(r);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=a?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=t[o]}i.default=t,n&&n.set(t,i);return i}(jb());function h(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(h=function(t){return t?r:e})(t)}function d(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=(0,s.default)(t);if(e){var i=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,o.default)(this,r)}}var f=function(t){(0,a.default)(o,t);var e=d(o);function o(t){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.default)(this,o),n=e.call(this,t,a),(0,c.defineLayerProperty)((0,i.default)(n),"frozen",!1),(0,c.defineLayerProperty)((0,i.default)(n),"visible",!0),(0,c.defineLayerProperty)((0,i.default)(n),"opacity",1),(0,c.defineLayerProperty)((0,i.default)(n),"sequence",0),n}return(0,n.default)(o,[{key:"clean",value:function(t){var e=this;t.object3d.traverse((function(r){r.layer===t&&(delete r.layerUpdateState[e.id],r.material&&-1!==r.material.indexOfColorLayer(e)&&r.material.removeLayer(e))}))}},{key:"initColorTexturesFromParent",value:function(t,e,r){if(!r.material||!r.material.getColorTexture)return!1;for(var n=e.getExtentForLayer(this);r&&r.material&&r.material.uniforms.colorTexture&&r.material.uniforms.colorTexture.value!==r.material.texturesInfo.color.atlasTexture;)r=r.parent;if(!r||!r.material)return!1;var i=r.material.getColorTexture(this);return!!i&&(!(!i||!i.extent)&&(e.material.uniforms.colorTexture.value=r.material.uniforms.colorTexture.value,e.material.setColorTextures(this,{texture:i,pitch:n.offsetToParent(i.extent)},!0,t.instance),!0))}},{key:"update",value:function(t,e,r){var n=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.material;if(!e.parent||!a)return null;if(void 0===e.layerUpdateState[this.id]){if(e.layerUpdateState[this.id]=new l.default,!this.tileInsideLimit(e,this)&&(this.noTextureParentOutsideLimit||!r||!r.material||!r.material.getColorTexture(this)))return e.layerUpdateState[this.id].noMoreUpdatePossible(),null;if(a.pushLayer(this,e.getExtentForLayer(this)),r&&this.initColorTexturesFromParent(t,e,r,this))return t.instance.notifyChange(e,!1),null}if(!e.material.visible||i)return null;a.setLayerVisibility(this,this.visible),a.setLayerOpacity(this,this.opacity);var o=Date.now();if(this.frozen||!this.visible||!e.layerUpdateState[this.id].canTryUpdate(o))return null;var s=this.getPossibleTextureImprovements(this,e.getExtentForLayer(this),e.material.getColorTexture(this),e.layerUpdateState[this.id].failureParams);if(void 0===s)return e.layerUpdateState[this.id].noMoreUpdatePossible(),null;if(null===s||!1===s)return null;e.layerUpdateState[this.id].newTry();var h={view:t.instance,layer:this,requester:e,priority:(0,c.nodeCommandQueuePriorityFunction)(e),earlyDropFunction:c.refinementCommandCancellationFn,toDownload:s};return t.scheduler.execute(h).then((function(r){return null===e.material?null:e.material.setColorTextures(n,r,!1,t.instance).then((function(){e.layerUpdateState[n.id].success()}))}),(function(r){if(r instanceof u.default)e.layerUpdateState[n.id].success();else{console.warn("Imagery texture update error for",e,r);var i=e.layerUpdateState[n.id].errorCount>c.MAX_RETRY;e.layerUpdateState[n.id].failure(Date.now(),i,r),i||window.setTimeout((function(){t.instance.notifyChange(e,!1)}),1e3*e.layerUpdateState[n.id].secondsUntilNextTry())}}))}}]),o}(c.default),p=f;return Wb.default=p,Wb}var $b,tM,eM={},rM={},nM={},iM={get exports(){return nM},set exports(t){nM=t}},aM={},oM={get exports(){return aM},set exports(t){aM=t}};function sM(){return tM||(tM=1,function(t){var e=($b||($b=1,function(t){var e=Uf();t.exports=function(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=e(t)););return t},t.exports.__esModule=!0,t.exports.default=t.exports}(oM)),aM);function r(){return"undefined"!=typeof Reflect&&Reflect.get?(t.exports=r=Reflect.get.bind(),t.exports.__esModule=!0,t.exports.default=t.exports):(t.exports=r=function(t,r,n){var i=e(t,r);if(i){var a=Object.getOwnPropertyDescriptor(i,r);return a.get?a.get.call(arguments.length<3?t:n):a.value}},t.exports.__esModule=!0,t.exports.default=t.exports),r.apply(this,arguments)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}(iM)),nM}var lM,uM={};function cM(){if(lM)return uM;lM=1,Object.defineProperty(uM,"__esModule",{value:!0}),uM.default=void 0;return uM.default={FINAL:0,DEPTH:1,ID:2,UV:3},uM}var hM,dM={},fM={};function pM(){if(hM)return fM;function t(t,r){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,r){if(!t)return;if("string"==typeof t)return e(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e(t,r)}(t))||r&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){l=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}hM=1,Object.defineProperty(fM,"__esModule",{value:!0}),fM.default=void 0;var r=new Map,n=new Map,i={POLICIES:{INFINITE:1/0,TEXTURE:9e5,ELEVATION:9e5},get:function(t){var e=r.get(t);n.has(t)||n.set(t,{hit:0,miss:0});var i=n.get(t);if(e)return i.hit++,e.lastTimeUsed=Date.now(),e.value;i.miss++},set:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,i={value:e,lastTimeUsed:Date.now(),lifetime:n};return r.set(t,i),e},deletePrefix:function(e){var n,i=t(r.keys());try{for(i.s();!(n=i.n()).done;){var a=n.value;a.startsWith&&a.startsWith(e)&&r.delete(a)}}catch(t){i.e(t)}finally{i.f()}},delete:function(t){return r.delete(t)},clear:r.clear(),flush:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),e=r.size;r.forEach((function(e,n){e.lifetime<t-e.lastTimeUsed&&r.delete(n)}));var i=0,a=0;return n.forEach((function(t){i+=t.hit,a+=t.miss})),n.clear(),{before:e,after:r.size,hit:i,miss:a}}};Object.freeze(i);var a=i;return fM.default=a,fM}var mM,gM={},vM={},yM={},xM={get exports(){return yM},set exports(t){yM=t}},_M={},wM={get exports(){return _M},set exports(t){_M=t}};var bM,MM={},SM={get exports(){return MM},set exports(t){MM=t}};var TM,EM,AM,RM,PM,CM,IM={},LM={get exports(){return IM},set exports(t){IM=t}};function OM(){return EM||(EM=1,function(t){var e=(mM||(mM=1,function(t){t.exports=function(t){if(Array.isArray(t))return t},t.exports.__esModule=!0,t.exports.default=t.exports}(wM)),_M),r=(bM||(bM=1,function(t){t.exports=function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}},t.exports.__esModule=!0,t.exports.default=t.exports}(SM)),MM),n=Cx(),i=(TM||(TM=1,function(t){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports}(LM)),IM);t.exports=function(t,a){return e(t)||r(t,a)||n(t,a)||i()},t.exports.__esModule=!0,t.exports.default=t.exports}(xM)),yM}function DM(){if(AM)return vM;AM=1;var t=uf,e=cf;Object.defineProperty(vM,"__esModule",{value:!0}),vM.default=void 0;var r=t(px()),n=t(Nx()),i=t(OM()),a=t(pf()),o=t(yf()),s=Bf,l=function(t,r){if(!r&&t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var n=u(r);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=a?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=t[o]}i.default=t,n&&n.set(t,i);return i}(Ux());function u(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(u=function(t){return t?r:e})(t)}function c(t){return s.MathUtils.radToDeg(2*(Math.atan(Math.exp(-(t-.5)*Math.PI*2))-Math.PI/4))}var h={WEST:0,EAST:1,SOUTH:2,NORTH:3};function d(t){return 0===t.indexOf("WMTS:")||"TMS"===t}var f=new l.default("EPSG:4326",0,0,0),p=function(){function t(e){for(var r=this,n=arguments.length,o=new Array(n>1?n-1:0),s=1;s<n;s++)o[s-1]=arguments[s];if((0,a.default)(this,t),this._crs=e,d(e)){if(3!==o.length)throw new Error("Unsupported constructor args '".concat(o,"'"));if(this.zoom=o[0],this.row=o[1],this.col=o[2],this.zoom<0)throw new Error("invlid WTMS values ".concat(o))}else if(2===o.length&&o[0]instanceof l.default&&o[1]instanceof l.default){this._values=new Float64Array(4);var u=(0,i.default)(o[0]._values,2);this._values[h.WEST]=u[0],this._values[h.SOUTH]=u[1];var c=(0,i.default)(o[1]._values,2);this._values[h.EAST]=c[0],this._values[h.NORTH]=c[1]}else if(1===o.length&&void 0!==o[0].west)this._values=new Float64Array(4),this._values[h.WEST]=o[0].west,this._values[h.EAST]=o[0].east,this._values[h.SOUTH]=o[0].south,this._values[h.NORTH]=o[0].north;else{if(4!==o.length)throw new Error("Unsupported constructor args '".concat(o,"'"));this._values=new Float64Array(4),Object.keys(h).forEach((function(t){var e=h[t];r._values[e]=o[e]}))}}return(0,o.default)(t,[{key:"clone",value:function(){return d(this._crs)?new t(this._crs,this.zoom,this.row,this.col):(0,r.default)(t,[this._crs].concat((0,n.default)(this._values)))}},{key:"as",value:function(e){if((0,l.assertCrsIsValid)(e),d(this._crs)){if("WMTS:PM"===this._crs){var r=Math.pow(2,this.zoom),n=360/r,i=180-n*(r-this.col),a=180-n*(r-(this.col+1)),o=r,s=1/o,u=1-s*(o-this.row),h=1-s*(o-(this.row+1)),f=c(u);return new t("EPSG:4326",{west:i,east:a,south:c(h),north:f}).as(e)}if("WMTS:WGS84G"===this._crs&&"EPSG:4326"===e){var p=Math.pow(2,this.zoom),m=180/p,g=m*(p-this.row)-90,v=m*(p-(this.row+1))-90;return new t(e,{west:180-m*(2*p-this.col),east:180-m*(2*p-(this.col+1)),south:v,north:g})}throw new Error("Unsupported yet")}if(!(this._crs===e||(0,l.is4326)(this._crs)&&(0,l.is4326)(e))){var y=[],x=this.center();y.push(new l.default(this._crs,this.west(),this.north())),y.push(new l.default(this._crs,x._values[0],this.north())),y.push(new l.default(this._crs,this.east(),this.north())),y.push(new l.default(this._crs,this.east(),x._values[1])),y.push(new l.default(this._crs,this.east(),this.south())),y.push(new l.default(this._crs,x._values[0],this.south())),y.push(new l.default(this._crs,this.west(),this.south())),y.push(new l.default(this._crs,this.west(),x._values[1]));for(var _=-1/0,w=1/0,b=-1/0,M=1/0,S=0;S<y.length;S++)y[S]=y[S].as(e),_=Math.max(_,y[S]._values[1]),w=Math.min(w,y[S]._values[1]),b=Math.max(b,y[S]._values[0]),M=Math.min(M,y[S]._values[0]);return new t(e,{north:_,south:w,east:b,west:M})}return this}},{key:"offsetToParent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Vector4;if(this.crs()!==t.crs())throw new Error("unsupported mix");if(d(this.crs())){var r=this.zoom-t.zoom,n=Math.pow(2,r),i=1/n,a=(this.row-this.row%n)*i,o=(this.col-this.col%n)*i;return e.set(this.col*i-o,this.row*i-a,i,i)}var l=t.dimensions(),u=this.dimensions(),c=.001*Math.round(1e3*(this.west()-t.west())/l.x),h=.001*Math.round(1e3*(t.north()-this.north())/l.y),f=.001*Math.round(1e3*u.x/l.x),p=.001*Math.round(1e3*u.y/l.y);return e.set(c,h,f,p)}},{key:"west",value:function(){return this._values[h.WEST]}},{key:"east",value:function(){return this._values[h.EAST]}},{key:"north",value:function(){return this._values[h.NORTH]}},{key:"south",value:function(){return this._values[h.SOUTH]}},{key:"crs",value:function(){return this._crs}},{key:"center",value:function(t){if(d(this._crs))throw new Error("Invalid operation for WMTS bbox");var e;t?(l.default.call(t,this._crs,this._values[0],this._values[2]),e=t):e=new l.default(this._crs,this._values[0],this._values[2]);var r=this.dimensions();return e._values[0]+=.5*r.x,e._values[1]+=.5*r.y,e}},{key:"dimensions",value:function(t){return(t=t||{x:0,y:0}).x=Math.abs(this.east()-this.west()),t.y=Math.abs(this.north()-this.south()),t}},{key:"isPointInside",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.crs()===t.crs?t:t.as(this.crs());return(0,l.crsIsGeographic)(this.crs())?r.longitude()<=this.east()+e&&r.longitude()>=this.west()-e&&r.latitude()<=this.north()+e&&r.latitude()>=this.south()-e:r.x()<=this.east()+e&&r.x()>=this.west()-e&&r.y()<=this.north()+e&&r.y()>=this.south()-e}},{key:"isInside",value:function(t,e){if(d(this.crs())){if(this.zoom===t.zoom)return this.row===t.row&&this.col===t.col;if(this.zoom<t.zoom)return!1;var r=this.zoom-t.zoom,n=Math.pow(2,r),i=1/n,a=(this.row-this.row%n)*i,o=(this.col-this.col%n)*i;return a===t.row&&o===t.col}var s=t.as(this._crs);return e=null==e?(0,l.reasonnableEpsilonForCRS)(this._crs,this):e,this.east()-s.east()<=e&&s.west()-this.west()<=e&&this.north()-s.north()<=e&&s.south()-this.south()<=e}},{key:"offsetScale",value:function(t){if(t.crs()!==this.crs())throw new Error("unsupported offscale between 2 diff crs");var e=Math.abs(this.east()-this.west()),r=Math.abs(this.north()-this.south()),n=(t.west()-this.west())/e,i=(t.north()-this.north())/r,a=Math.abs(t.east()-t.west())/e,o=Math.abs(t.north()-t.south())/r;return new s.Vector4(n,i,a,o)}},{key:"intersectsExtent",value:function(t){var e=t.as(this.crs());return!(this.west()>=e.east()||this.east()<=e.west()||this.south()>=e.north()||this.north()<=e.south())}},{key:"intersect",value:function(t){return this.intersectsExtent(t)?(t.crs()!==this.crs()&&(t=t.as(this.crs())),this.set(this.crs(),Math.max(this.west(),t.west()),Math.min(this.east(),t.east()),Math.max(this.south(),t.south()),Math.min(this.north(),t.north())),this):(this.set(this.crs(),0,0,0,0),this)}},{key:"set",value:function(t){for(var e=this,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return this._crs=t,d(this.crs())?(this.zoom=n[0],this.row=n[1],this.col=n[2]):Object.keys(h).forEach((function(t){var r=h[t];e._values[r]=n[r]})),this}},{key:"copy",value:function(t){var e=this;return this._crs=t.crs(),d(this.crs())?(this.zoom=t.zoom,this.row=t.row,this.col=t.col):Object.keys(h).forEach((function(r){var n=h[r];e._values[n]=t._values[n]})),this}},{key:"union",value:function(t){if(t.crs()!==this.crs())throw new Error("unsupported union between 2 diff crs");var e=t.west();e<this.west()&&(this._values[h.WEST]=e);var r=t.east();r>this.east()&&(this._values[h.EAST]=r);var n=t.south();n<this.south()&&(this._values[h.SOUTH]=n);var i=t.north();i>this.north()&&(this._values[h.NORTH]=i)}},{key:"expandByPoint",value:function(t){var e=t.as(this.crs()),r=e._values[0];r<this.west()&&(this._values[h.WEST]=r),r>this.east()&&(this._values[h.EAST]=r);var n=e._values[1];n<this.south()&&(this._values[h.SOUTH]=n),n>this.north()&&(this._values[h.NORTH]=n)}},{key:"shift",value:function(t,e){return this._values[h.WEST]+=t,this._values[h.EAST]+=t,this._values[h.SOUTH]+=e,this._values[h.NORTH]+=e,this}},{key:"quadtreeSplit",value:function(){return this.center(f),[new t(this.crs(),this.west(),f._values[0],f._values[1],this.north()),new t(this.crs(),f._values[0],this.east(),f._values[1],this.north()),new t(this.crs(),this.west(),f._values[0],this.south(),f._values[1]),new t(this.crs(),f._values[0],this.east(),this.south(),f._values[1])]}},{key:"externalBorders",value:function(t){var e=[this.clone(),this.clone(),this.clone(),this.clone()],r=this.dimensions();return e[0]._values[h.SOUTH]=e[0]._values[h.NORTH],e[0]._values[h.NORTH]+=r.y*t,e[1]._values[h.WEST]=e[1]._values[h.EAST],e[1]._values[h.EAST]+=r.x*t,e[2]._values[h.NORTH]=e[2]._values[h.SOUTH],e[2]._values[h.SOUTH]-=r.y*t,e[3]._values[h.EAST]=e[3]._values[h.WEST],e[3]._values[h.WEST]-=r.x*t,e}}],[{key:"fromBox3",value:function(t,e){return new this(t,{west:e.min.x,east:e.max.x,south:e.min.y,north:e.max.y})}}]),t}(),m=p;return vM.default=m,vM}function kM(){if(RM)return gM;RM=1;var t=uf;Object.defineProperty(gM,"__esModule",{value:!0}),gM.default=void 0;var e=Bf,r=t(Ux()),n=t(DM()),i=Math.PI/4,a=Math.PI/2,o=1/(2*Math.PI),s=Math.log(2);function l(t){return Math.min(84,Math.max(-86,t))}var u={x:0,y:0},c=new r.default("EPSG:4326",0,0,0),h={WGS84ToY:function(t){return.5-Math.log(Math.tan(i+.5*e.Math.degToRad(t)))*o},YToWGS84:function(t){return e.Math.radToDeg(2*(Math.atan(Math.exp(-(t-.5)/o))-i))},getCoordWMTS_WGS84:function(t,e,r){if("PM"===r)return function(t,e){var r,i=[],a=t.zoom+1,o=Math.pow(2,a),s=1/o,u=h.WGS84ToY(l(e.north())),c=h.WGS84ToY(l(e.south())),d=Math.floor(u/s);r=Math.ceil(c/s)-1,r=Math.min(r,o-1);for(var f=t.col,p=r;p>=d;p--)for(var m=f;m<=f;m++)i.push(new n.default("WMTS:PM",a,p,m));return i}(t,e);if("WGS84G"===r)return[t.clone()];throw new Error("Unsupported TileMatrixSet '".concat(r,"'"))},WGS84toWMTS:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n.default("WMTS:WGS84G",0,0,0);t.dimensions(u);var i=Math.floor(Math.log(Math.PI/e.Math.degToRad(u.y))/s+.5),o=Math.pow(2,i),l=2*Math.PI/(2*o),h=Math.PI/o;t.center(c);var d=Math.floor((Math.PI+e.Math.degToRad(c.longitude()))/l),f=Math.floor(o-(a+e.Math.degToRad(c.latitude()))/h);return r.set("WMTS:WGS84G",i,f,d)},UnitaryToLongitudeWGS84:function(t,e){return e.dimensions(u),e.west()+t*u.x},UnitaryToLatitudeWGS84:function(t,e){return e.dimensions(u),e.south()+t*u.y}};var d=h;return gM.default=d,gM}function FM(){if(PM)return dM;PM=1;var t=uf;Object.defineProperty(dM,"__esModule",{value:!0}),dM.default=dM.SIZE_TEXTURE_TILE=void 0;var e=Bf,r=t(Gb()),n=t(pM()),i=t(kM()),a=t(DM());dM.SIZE_TEXTURE_TILE=256;var o=new a.default("WMTS:WGS84G",0,0,0),s={getColorTextureByUrl:function(t,i){return n.default.get(t)||n.default.set(t,r.default.texture(t,i).then((function(t){return t.generateMipmaps=!1,t.magFilter=e.LinearFilter,t.minFilter=e.LinearFilter,t.anisotropy=16,t})),n.default.POLICIES.TEXTURE)},getXBilTextureByUrl:function(t,i){return n.default.get(t)||n.default.set(t,r.default.arrayBuffer(t,i).then((function(t){var r=function(t){var r=new e.DataTexture(t,256,256,e.AlphaFormat,e.FloatType);return r.needsUpdate=!0,r}(t);return r.generateMipmaps=!1,r.magFilter=e.LinearFilter,r.minFilter=e.LinearFilter,r})),n.default.POLICIES.TEXTURE)},computeTileMatrixSetCoordinates:function(t,e){if(!((e=e||"WGS84G")in t.wmtsCoords)){if(t.wmtsCoords.WGS84G){var r=t.wmtsCoords.WGS84G[0];o.zoom=r.zoom,o.col=r.col,o.row=r.row}else i.default.WGS84toWMTS(t.extent,o),t.wmtsCoords.WGS84G=[o.clone()];t.wmtsCoords[e]=i.default.getCoordWMTS_WGS84(o,t.extent,e)}},computeTMSCoordinates:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"bottom";if(t.crs()!==e.crs())throw new Error("Unsupported configuration. TMS is only supported when geometry has the same crs than TMS layer");var n,i=t.center(),o=e.dimensions(),s=Math.round(o.x/t.dimensions().x),l=Math.floor(Math.log2(s)),u=(i.x()-e.west())/o.x;return n="top"===r?(e.north()-i.y())/o.y:(i.y()-e.south())/o.y,[new a.default("TMS",l,Math.floor(n*s),Math.floor(u*s))]},WMTS_WGS84Parent:function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.default(t.crs(),0,0,0),i=t.zoom-e,o=Math.pow(2,i),s=1/o,l=(t.row-t.row%o)*s,u=(t.col-t.col%o)*s;return r&&(r.x=t.col*s-u,r.y=t.row*s-l,r.z=s,r.w=s),n.set(n.crs(),e,l,u)}};return dM.default=s,dM}function NM(){if(CM)return rM;CM=1;var t=uf;Object.defineProperty(rM,"__esModule",{value:!0}),rM.default=void 0;var e=t(pf()),r=t(yf()),n=t(sM()),i=t(Cf()),a=t(Df()),o=t(Uf()),s=Bf,l=t(cM()),u=t(FM());function c(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function d(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=(0,o.default)(t);if(e){var i=(0,o.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}function f(t,e){t.changeState&&t.changeState(e)}var p=function(t){(0,i.default)(s,t);var a=d(s);function s(t,r,n,i,o){var l;(0,e.default)(this,s),(l=a.call(this,r,n)).layer=t,l.matrixAutoUpdate=!1,l.rotationAutoUpdate=!1,l.level=o,l.extent=i,l.geometry=r,l.obb=l.geometry.OBB.clone(),l.frustumCulled=!1,l.setDisplayed(!1),l.layerUpdateState={},l.material.setUuid(l.id);var u=i.dimensions();return l.material.uniforms.tileDimensions.value.set(u.x,u.y),t.minMaxFromElevationLayer&&l.setBBoxZ(t.minMaxFromElevationLayer.min,t.minMaxFromElevationLayer.max),l}return(0,r.default)(s,[{key:"updateMatrixWorld",value:function(t){(0,n.default)((0,o.default)(s.prototype),"updateMatrixWorld",this).call(this,t),this.OBB().update()}},{key:"isVisible",value:function(){return this.visible}},{key:"setDisplayed",value:function(t){this.material.visible=t&&this.material.update(),this.material.transparent=1!==this.material.opacity||1!==this.material.uniforms.noTextureOpacity.value}},{key:"setVisibility",value:function(t){this.visible=t}},{key:"isDisplayed",value:function(){return this.material.visible}},{key:"changeState",value:function(t){t!==this.material.uniforms.renderingState.value&&(this.material.uniforms.renderingState.value=t,t>l.default.FINAL?this.material.transparent=!1:this.material.transparent=1!==this.material.opacity||1!==this.material.uniforms.noTextureOpacity.value,this.material.needsUpdate=!0)}},{key:"pushRenderState",value:function(t){var e=this;if(this.material.uniforms.renderingState.value===t)return function(){};var r=this.material.uniforms.renderingState.value;return this.traverse((function(e){return f(e,t)})),function(){e.traverse((function(t){return f(t,r)}))}}},{key:"setFog",value:function(t){this.material.setFogDistance(t)}},{key:"setSelected",value:function(t){this.material.setSelected(t)}},{key:"setTextureElevation",value:function(t,e){null!==this.material&&(this.setBBoxZ(e.min,e.max),this.material.setElevationTexture(t,e))}},{key:"setBBoxZ",value:function(t,e){null==t&&null==e||Math.floor(t)===Math.floor(this.obb.z.min)&&Math.floor(e)===Math.floor(this.obb.z.max)||this.OBB().updateZ(t,e)}},{key:"OBB",value:function(){return this.obb}},{key:"removeColorLayer",value:function(t){this.layerUpdateState&&this.layerUpdateState[t]&&delete this.layerUpdateState[t],this.material.removeColorLayer(t)}},{key:"changeSequenceLayers",value:function(t){this.material.getColorLayersCount()<2||this.material.setSequence(t)}},{key:"getExtentForLayer",value:function(t){if(t.extent.crs()!==this.extent.crs())throw new Error("Layer should be in the same CRS of their supporting tile geometry, but layer crs is ".concat(t.extent.crs()," and tile crs is ").concat(this.extent.crs()));return"tms"===t.protocol||"xyz"===t.protocol?u.default.computeTMSCoordinates(this.extent,t.extent,t.origin)[0]:this.extent}},{key:"findCommonAncestor",value:function(t){if(t)return t.level===this.level?t.id===this.id?t:0!==t.level?this.parent.findCommonAncestor(t.parent):void 0:t.level<this.level?this.parent.findCommonAncestor(t):this.findCommonAncestor(t.parent)}},{key:"isAncestorOf",value:function(t){return t.findCommonAncestor(this)===this}},{key:"findSmallestExtentCoveringGoingDown",value:function(t){if(this.children){var e,r=c(this.children);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.extent&&t.isInside(n.extent))return n.findSmallestExtentCoveringGoingDown(t)}}catch(t){r.e(t)}finally{r.f()}}return[this,t]}},{key:"findSmallestExtentCoveringGoingUp",value:function(t){if(t.isInside(this.extent))return this;if(this.parent&&this.parent.extent)return this.parent.findSmallestExtentCoveringGoingUp(t);if(0===this.level&&this.parent.children.length){var e,r=c(this.parent.children);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.extent&&t.isInside(n.extent))return n}}catch(t){r.e(t)}finally{r.f()}}}},{key:"findSmallestExtentCovering",value:function(t){var e=this.findSmallestExtentCoveringGoingUp(t);return e?e.findSmallestExtentCoveringGoingDown(t):null}},{key:"findNeighbours",value:function(){var t=this;return this.extent.externalBorders(.1).map((function(e){return t.findSmallestExtentCovering(e)}))}}]),s}(s.Mesh);return rM.default=p,rM}var UM,BM,zM,GM={},jM={};function VM(){if(UM)return jM;UM=1;var t=uf;Object.defineProperty(jM,"__esModule",{value:!0}),jM.default=jM.ELEVATION_FORMAT=void 0;var e,r,n=t(OM()),i=Bf,a=t(Ux()),o=0,s=1,l={MAPBOX_RGB:0,HEIGHFIELD:1,XBIL:2,RATP_GEOL:3};function u(t,e,r){return.1*(256*t*256+256*e+r)-1e4}function c(t,e){if(!e.extent)return null;if(e.extent.isPointInside(t)){for(var r=0;r<e.children.length;r++){var n=c(t,e.children[r]);if(n)return n}return e}}function h(t){for(var n=t.texture,a=t.elevationFormat,o=arguments.length,s=new Array(o>1?o-1:0),c=1;c<o;c++)s[c-1]=arguments[c];for(var h=0;h<s.length;h+=2)s[h]=i.MathUtils.clamp(s[h],0,n.image.width-1),s[h+1]=i.MathUtils.clamp(s[h+1],0,n.image.height-1);if(n.image.data){if(2===s.length)return n.image.data[s[1]*n.image.width+s[0]];for(var d=[],f=0;f<s.length;f+=2)d.push(n.image.data[s[f+1]*n.image.width+s[f]]);return d}e||((e=document.createElement("canvas")).width=2,e.height=2,r=e.getContext("2d"));for(var p=1/0,m=1/0,g=-1/0,v=-1/0,y=0;y<s.length;y+=2)p=Math.min(s[y],p),m=Math.min(s[y+1],m),g=Math.max(s[y],g),v=Math.max(s[y+1],v);var x=g-p+1,_=v-m+1;e.width=Math.max(e.width,x),e.height=Math.max(e.height,_),r.drawImage(n.image,p,m,x,_,0,0,x,_);for(var w=r.getImageData(0,0,x,_),b=[],M=0;M<s.length;M+=2){var S=s[M]-p,T=s[M+1]-m;if(a===l.MAPBOX_RGB)b.push(u(w.data[4*T*x+4*S],w.data[4*T*x+4*S+1],w.data[4*T*x+4*S+2]));else{if(a!==l.HEIGHFIELD)throw a===l.XBIL||a===l.RATP_GEOL?new Error('Unimplemented reading elevation value for layer.elevationFormat "'.concat(a,"'")):new Error('Unsupported layer.elevationFormat "'.concat(a,"'"));var E=w.data[4*T*x+4*S]/256,A=t.heightFieldOffset+E*t.heightFieldScale;b.push(A)}}return 2===s.length?b[0]:b}function d(t,e,r){var n=t.image.width,i=t.image.height,a=Math.max(0,e*n-.5),o=Math.max(0,r*i-.5),s=Math.floor(a),l=Math.ceil(a),u=Math.floor(o);return{u1:s,u2:l,v1:u,v2:Math.ceil(o),wu:a-s,wv:o-u}}function f(t,e,r){var a=d(t.texture,e,r),o=h(t,a.u1,a.v1,a.u2,a.v1,a.u1,a.v2,a.u2,a.v2),s=(0,n.default)(o,4),l=s[0],u=s[1],c=s[2],f=s[3],p=i.MathUtils.lerp(l,u,a.wu),m=i.MathUtils.lerp(c,f,a.wu);return i.MathUtils.lerp(p,m,a.wv)}function p(t,e){return function(t,e,r){var n=d(t.texture,e,r);return h(t,n.wu<=0?n.u1:n.u2,n.wv<=0?n.v1:n.v2)}(t,e.x,e.y)}jM.ELEVATION_FORMAT=l;var m=new i.Vector3;var g={v:new i.Vector3,coord1:new a.default("EPSG:4978"),coord2:new a.default("EPSG:4978"),offset:new i.Vector2};function v(t,e,r,n,a){var o=r.as(t.extent.crs(),g.coord1),l=null;a&&a.tile&&a.tile.material&&(l=c(o,a.tile));for(var u=0;!l&&u<n.length;u++)l=c(o,n[u]);if(!l)return null;var h=l.material.getElevationTextureInfo();if(!h)return{coord:o,tile:l};var d=h.texture;if(a&&a.id===d.id&&a.version===d.version)return{coord:o,texture:d,tile:l};var v=o.offsetInExtent(h.texture.extent);return o._values[2]=e===s?function(t,e,r,n){var a=r.x/n.x/16,o=Math.floor(e.x/a)*a,s=Math.floor(e.y/a)*a;1===o&&(o-=a),1===s&&(s-=a);var l=o,u=o+a,c=s,h=s+a,d=(e.x-o)/a,p=(e.y-s)/a,g=new i.Triangle(new i.Vector3(l,h),new i.Vector3(u,c),1===p||d/(1-p)>=1?new i.Vector3(u,h):new i.Vector3(l,c));g.getBarycoord(new i.Vector3(e.x,e.y),m);var v=f(t,g.a.x,g.a.y),y=f(t,g.b.x,g.b.y),x=f(t,g.c.x,g.c.y);return v*m.x+y*m.y+x*m.z}(h,v,l.extent.dimensions(),h.texture.extent.dimensions()):p(h,v),{coord:o,texture:d,tile:l}}function y(t,e,r,n,i,o){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},l=arguments.length>8?arguments[8]:void 0,u=(arguments.length>7?arguments[7]:void 0)||new a.default(n);s.worldFromLocal?u.set(n,g.v.copy(i).applyMatrix4(s.worldFromLocal)):u.set(n,i);var c=v(t,e,u,r,l);return c?(c.coord._values[2]+=o,c.coord.as(n,g.coord2).xyz(i),s.localFromWorld&&i.applyMatrix4(s.localFromWorld),{id:c.texture.id,version:c.texture.version,tile:c.tile}):null}var x={getElevationValueAt:function(t,e){var r=v(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:o,e,(arguments.length>3?arguments[3]:void 0)||t.level0Nodes);return r?{z:r.coord._values[2],texture:r.texture,tile:r.tile}:null},placeObjectOnGround:function(t,e,r){var n,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=arguments.length>4?arguments[4]:void 0;if(n=l?l.concat(t.level0Nodes):t.level0Nodes,!s.modifyGeometry){s.cache&&(s.cache.length=1);var u={worldFromLocal:r.parent?r.parent.matrixWorld:void 0,localFromWorld:r.parent?(new i.Matrix4).copy(r.parent.matrixWorld).invert():void 0};return!!(g=y(t,s.method||o,n,e,r.position,s.offset||0,u,void 0,s.cache?s.cache[0]:void 0))&&(s.cache&&(s.cache[0]=g),r.updateMatrix(),r.updateMatrixWorld(),!0)}var c={worldFromLocal:r.matrixWorld,localFromWorld:(new i.Matrix4).copy(r.matrixWorld).invert()},h=r.geometry;if(h.vertices){s.cache&&(s.cache.length=h.vertices.length);for(var d=!0,f=new a.default(e),p=0;p<h.vertices.length;p++){var m=s.cache?s.cache[p]:void 0,g=y(t,s.method||o,n,e,h.vertices[p],s.offset||0,c,f,m);s.cache&&(s.cache[p]=g),g||(d=!1)}return h.verticesNeedUpdate=!0,d}if(h instanceof i.BufferGeometry){s.cache&&(s.cache.length=h.attributes.position.count);for(var v=!0,x=new i.Vector3,_=new a.default(e),w=0;w<h.attributes.position.count;w++){var b=s.cache?s.cache[w]:void 0;x.fromBufferAttribute(h.attributes.position,w);var M=x.z,S=y(t,s.method||o,n,e,x,s.offset||0,c,_,b);s.cache&&(s.cache[w]=S),S||(v=!1),M!==x.z&&(h.attributes.position.needsUpdate=!0),h.attributes.position.setXYZ(w,x.x,x.y,x.z)}return v}return!1},decodeMapboxElevation:u,FAST_READ_Z:o,PRECISE_READ_Z:s};return jM.default=x,jM}function HM(){if(BM)return GM;BM=1;var t=uf;Object.defineProperty(GM,"__esModule",{value:!0}),GM.default=void 0,GM.initDebugTool=function(t){var e=document.createElement("div");e.style.top="0",e.style.right="0",e.style.width="100%",e.style.position="absolute",e.style.backgroundColor="lightgray",document.getElementById("viewerDiv").appendChild(e),document.addEventListener("click",(function(r){var n=t.tileLayer.pickObjectsAt(t,t.eventToViewCoords(r),1);if(n.length){for(var i=n[0].object;e.firstChild;)e.removeChild(e.firstChild);i.material.canvas&&(i.material.uniforms.colorTexture.value.image.style.width="100%",e.appendChild(i.material.uniforms.colorTexture.value.image),i.material.canvas.style.width="100%",e.appendChild(i.material.canvas))}}))},GM.unpack1K=function(t,e){var r=new o.Vector4(p/16777216,p/65536,p/256,p);return e?r.dot(t)*e:r.dot(t)};var e=t(pf()),r=t(yf()),n=t(Cf()),i=t(Df()),a=t(Uf()),o=Bf,s=t(cM()),l=VM();function u(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=(0,a.default)(t);if(e){var o=(0,a.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,i.default)(this,r)}}o.ShaderChunk.PrecisionQualifier="precision highp float;\nprecision highp int;\n",o.ShaderChunk.GetElevation="#if defined HEIGHTFIELD_ELEVATION\nuniform float heightFieldOffset;\nuniform float heightFieldScale;\n#endif\n#if defined(RATP_GEOL_ELEVATION)\nconst float lShift8 = 256.0;\nconst vec4 zShift = vec4(\n  1.0,\n  lShift8,\n  lShift8 * lShift8,\n  lShift8 * lShift8 * lShift8);\n#endif\n\nfloat getElevation(sampler2D texture, vec2 uv) {\n    #if defined(HEIGHTFIELD_ELEVATION)\n        vec4 c = texture2D(texture, uv);\n        vec4 color = heightFieldOffset + c * heightFieldScale;\n        return color.r;\n    #elif defined(MAPBOX_RGB_ELEVATION)\n        vec4 color = texture2D(texture, uv) * (255.0 * 0.1);\n        return\n            -10000.0 +\n            color.r * 256.0 * 256.0 +\n            color.g * 256.0 +\n            color.b;\n    #elif defined(RATP_GEOL_ELEVATION)\n        vec4 val = texture2D(texture, uv);\n        if (val.w > 0.0) {\n            val /= (1.0 - max(1.0, val.w));\n        }\n        val *= zShift;\n        return (val.x + val.y + val.z) - 2000.0;\n    #else\n    return 0.0;\n    #endif\n}\n",o.ShaderChunk.ComputeUV="vec2 computeUv(vec2 uv, vec2 offset, vec2 scale) {\n    return vec2(\n        uv.x * scale.x + offset.x,\n        1.0 - (offset.y + (1.0 - uv.y) * scale.y));\n}\n";var d=new o.Texture,f=new o.Vector4(0,0,0,0),p=255/256;function m(t,e){for(var r=0;r<t.length;r++)t[r]=e}var g=function(t){(0,n.default)(a,t);var i=h(a);function a(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;return(0,e.default)(this,a),(t=i.call(this)).atlasInfo=l,t.defines.STITCHING=1,t.uniforms.segments=new o.Uniform(n),r.side&&(t.side=r.side),t.uniforms.renderingState=new o.Uniform(s.default.FINAL),t.defines.TEX_UNITS=0,t.fragmentShader="#include <PrecisionQualifier>\n\nuniform int renderingState;\nuniform sampler2D colorTexture;\n\n#if TEX_UNITS\nuniform vec4      colorOffsetScale[TEX_UNITS];\nuniform float     colorOpacity[TEX_UNITS];\nuniform bool      colorVisible[TEX_UNITS];\nuniform vec3      colors[TEX_UNITS];\n#endif\n\n// backgroundColor\nuniform float      noTextureOpacity;\nuniform vec3      noTextureColor;\n// tile opacity\nuniform float     opacity;\n\nvarying vec2        vUv;\nvarying vec4 vColor;\nvarying vec4 vPosition;\n\n#if defined(HILLSHADE)\n// hillshade support\nuniform sampler2D   elevationTexture;\nuniform vec4        elevationOffsetScale;\nuniform vec2 tileDimensions;\n\n#include <GetElevation>\n\nfloat ZENITH = 0.7857142857;\nfloat AZIMUTH = 2.3571428571;\n\n#define M_PI 3.1415926535897932384626433832795\n\n// from https://github.com/PropellerAero/cesium-elevation-gradient/blob/master/lib/shaders/elevationGradientFrag.glsl\nfloat calcHillshade(float a, float b, float c, float d, float e, float f, float g, float h, float i, vec2 onePixel){\n    vec2 cellsize = tileDimensions / onePixel;\n    // http://edndoc.esri.com/arcobjects/9.2/net/shared/geoprocessing/spatial_analyst_tools/how_hillshade_works.htm\n\n    float dzdx = ((c + 2.0 * f + i) - (a + 2.0 * d + g)) / (8.0 * cellsize.x);\n    float dzdy = ((g + 2.0 * h + i) - (a + 2.0 * b + c)) / (8.0 * cellsize.y);\n    float slope = atan(1.0 * sqrt(dzdx * dzdx + dzdy * dzdy));\n\n    float aspect = atan(dzdy, -dzdx);\n\n    if(aspect < 0.0){\n        aspect = aspect +  2.0 * M_PI;\n    }\n\n    float hillshade = ((cos(ZENITH) * cos(slope)) + (sin(ZENITH) * sin(slope) * cos(AZIMUTH - aspect)));\n    return clamp(hillshade, 0., 1.);\n}\n#endif\n\nvec4 encodeHalfRGBA ( vec2 v ) {\n\tvec4 encoded = vec4( 0.0 );\n\tconst vec2 offset = vec2( 1.0 / 255.0, 0.0 );\n\tencoded.xy = vec2( v.x, fract( v.x * 255.0 ) );\n\tencoded.xy = encoded.xy - ( encoded.yy * offset );\n\tencoded.zw = vec2( v.y, fract( v.y * 255.0 ) );\n\tencoded.zw = encoded.zw - ( encoded.ww * offset );\n\treturn encoded;\n}\nvec2 decodeHalfRGBA( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\n\n#if defined(DEBUG)\nuniform bool showOutline;\nconst float sLine = 0.003;\n#endif\n\n#include <ComputeUV>\n\n#include <packing>\nuniform int  uuid;\n\nvoid main() {\n    if (renderingState == 2) {\n        gl_FragColor = packDepthToRGBA(float(uuid) / (256.0 * 256.0 * 256.0));\n    } else if (renderingState == 1) {\n        gl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n    } else if (renderingState == 3) {\n        gl_FragColor = encodeHalfRGBA(vUv);\n    } else {\n\n        vec4 diffuseColor = vec4(noTextureColor, 0.0);\n\n        bool hasTexture = false;\n\n        #if TEX_UNITS\n        #pragma unroll_loop_start\n        for (int i = 0; i < TEX_UNITS; i++) {\n            if (colorVisible[i] && colorOpacity[i] > 0.0 && colorOffsetScale[i].zw != vec2(0.0)) {\n                vec2 uv = computeUv(vUv, colorOffsetScale[i].xy, colorOffsetScale[i].zw);\n                vec4 layerColor = texture2D(colorTexture, uv);\n                if (layerColor.a > 0.0) {\n                    hasTexture = true;\n                }\n                layerColor.rgb *= colors[i];\n                diffuseColor = diffuseColor * (1.0 - layerColor.a * colorOpacity[i]) + layerColor * colorOpacity[i];\n            }\n        }\n        #pragma unroll_loop_end\n        #endif\n\n\n        gl_FragColor = diffuseColor;\n\n#if defined(HILLSHADE)\n        vec2 onePixel = vec2(1.0) / 256.0;\n\n        vec2 vVv = vec2(\n                vUv.x * elevationOffsetScale.z + elevationOffsetScale.x,\n                (1.0 - vUv.y) * elevationOffsetScale.w + elevationOffsetScale.y);\n\n        float a = getElevation(elevationTexture, vVv + onePixel * vec2(-1.0, 1.0));\n        float b = getElevation(elevationTexture, vVv + onePixel * vec2( 0.0, 1.0));\n        float c = getElevation(elevationTexture, vVv + onePixel * vec2( 1.0, 1.0));\n        float d = getElevation(elevationTexture, vVv + onePixel * vec2(-1.0, 0.0));\n        float e = getElevation(elevationTexture, vVv + onePixel * vec2( 0.0, 0.0));\n        float f = getElevation(elevationTexture, vVv + onePixel * vec2( 1.0, 0.0));\n        float g = getElevation(elevationTexture, vVv + onePixel * vec2(-1.0, -1.0));\n        float h = getElevation(elevationTexture, vVv + onePixel * vec2( 0.0, -1.0));\n        float i = getElevation(elevationTexture, vVv + onePixel * vec2( 1.0, -1.0));\n\n        float hillshade = calcHillshade(a, b, c, d, e, f, g, h, i, elevationOffsetScale.zw * 256.0);\n\n        gl_FragColor.rgb *= hillshade;\n#endif\n\n        // gl_FragColor.rgb = mix(gl_FragColor.rgb, vColor.rgb, vColor.a);\n        if (hasTexture) {\n            gl_FragColor.a = max(gl_FragColor.a, noTextureOpacity);\n        } else {\n            gl_FragColor = vec4(noTextureColor, noTextureOpacity);\n        }\n\n#if defined(DEBUG)\n        if (showOutline && (vUv.x < sLine || vUv.x > 1.0 - sLine || vUv.y < sLine || vUv.y > 1.0 - sLine)) {\n            gl_FragColor.rgb = mix(vec3(1.0, 0.0, 0.0), gl_FragColor.rgb, 0.2);\n        }\n#endif\n\n    }\n\n}\n",t.vertexShader="#include <PrecisionQualifier>\n\nattribute vec3      position;\nattribute vec2      uv;\n\nuniform sampler2D   elevationTexture;\nuniform vec4        elevationOffsetScale;\n#if defined(STITCHING)\nuniform sampler2D nTex[4];\nuniform vec4 nOff[4];\nuniform float segments;\n#endif\n\nuniform mat4        projectionMatrix;\nuniform mat4        modelMatrix;\nuniform mat4        viewMatrix;\nuniform mat4 modelViewMatrix;\n\nuniform vec4 neighbourdiffLevel;\nuniform vec2 tileDimensions;\n\nvarying vec2        vUv;\nvarying vec4 vColor;\nvarying vec4 vPosition;\n\nuniform vec4 validityExtent;\n\n#include <GetElevation>\n#include <ComputeUV>\n\n#if defined(STITCHING)\nfloat readNeighbourElevation(vec2 uv, int neighbour, sampler2D texture) {\n    vec2 vv = uv;\n    // top\n    if (neighbour == 1 || neighbour == 3) {\n        vv.x = 1.0 - vv.x;\n    } else {\n        vv.y = 1.0 - vv.y;\n    }\n    vec2 vVv = computeUv(\n        vv,\n        nOff[neighbour].xy, nOff[neighbour].zw);\n    return getElevation(texture, vVv);\n}\n#endif\n\n\nvoid main() {\n    vUv = uv;\n    vPosition = vec4(position, 1.0);\n    vColor = vec4(0., 0., 0., 0.);\n\n    if(elevationOffsetScale.z > 0.) {\n        vec2 vVv = computeUv(vUv, elevationOffsetScale.xy, elevationOffsetScale.zw);\n        int weight = 1;\n\n        float elevation = getElevation(elevationTexture, vVv);\n\n#if defined(STITCHING)\n        // We process the 4 borders separatly. The logic is:\n        // - identify if the current vertex is on the border\n        // - then, if the neighbour tile is:\n        //     - at the same level (= precision): we average\n        //       both elevations\n        //     - at a lower level (less precise): we use its\n        //       elevation. And if this vertex has no direct\n        //       v-neighbour, it is shifted along the other\n        //       (x when processing north/south border, else\n        //       y) to be at the same position than the vertex\n        //       on the other tile. Eg, for vertex 'o' below:\n        //\n        //    ---xx--x--       ---xx--x--\n        //       ||  |            ||⋱|\n        //       |o--x--  =>      ||  x--\n        //       ||  |            ||  |\n        //    ---xx--x--       ---xx--x--\n        //       ||  |            ||  |\n        //\n        // factor: num_vert_in_tile / num_vert_in_neighbour_tile\n        //       = 2^(level_difference)\n        vec4 neighbourFactor = pow(vec4(2.0), abs(neighbourdiffLevel));\n        // Interval in current tile is: 1.0 / segments. If a neighbour\n        // has less vertices on our shared edges, its interval size is\n        // going to be:\n        vec4 modulo = neighbourFactor / segments;\n        // West border\n        if (vUv.x < 0.01) {\n            if (neighbourdiffLevel.w < 0.0) {\n                float offset = fract(vUv.y / modulo.w) * modulo.w;\n                vPosition.y -= tileDimensions.y * offset;\n                vUv.y -= offset;\n\n                elevation = readNeighbourElevation(vUv, 3, nTex[3]);\n                weight = 1;\n                // vColor = vec4(0.0, 1.0, 0.0, 0.5);\n            } else if (neighbourdiffLevel.w == 0.0) {\n                elevation += readNeighbourElevation(uv, 3, nTex[3]);\n                weight += 1;\n            }\n        }\n        // East border\n        else if (vUv.x > 0.99) {\n            if (neighbourdiffLevel.y < 0.0) {\n                float offset = fract(vUv.y / modulo.y) * modulo.y;\n                vPosition.y -= tileDimensions.y * offset;\n                vUv.y -= offset;\n                elevation = readNeighbourElevation(vUv, 1, nTex[1]);\n                weight = 1;\n                // vColor = vec4(1.0, 1.0, 0.0, 0.5);\n            } else if (neighbourdiffLevel.y == 0.0) {\n                elevation += readNeighbourElevation(uv, 1, nTex[1]);\n                weight += 1;\n            }\n        }\n        // South border\n        else if (vUv.y < 0.01) {\n            if (neighbourdiffLevel.z < 0.0) {\n                float offset = fract(vUv.x / modulo.z) * modulo.z;\n                // move to the left\n                vPosition.x -= tileDimensions.x * offset;\n                vUv.x -= offset;\n\n                elevation = readNeighbourElevation(vUv, 2, nTex[2]);\n                weight = 1;\n                // vColor = vec4(0.0, 1.0, 1.0, 0.5);\n            } else if (neighbourdiffLevel.z == 0.0) {\n                elevation += readNeighbourElevation(uv, 2, nTex[2]);\n                weight += 1;\n            }\n        }\n        // North border\n        else if (vUv.y > 0.99) {\n            if (neighbourdiffLevel.x < 0.0) {\n                float offset = fract(vUv.x / modulo.x) * modulo.x;\n                vPosition.x -= tileDimensions.x * offset;\n                vUv.x -= offset;\n\n                elevation = readNeighbourElevation(vUv, 0, nTex[0]);\n                weight = 1;\n                // vColor = vec4(0.0, 0.0, 1.0, 0.5);\n            } else if (neighbourdiffLevel.x == 0.0) {\n                elevation += readNeighbourElevation(uv, 0, nTex[0]);\n                weight += 1;\n            }\n        }\n\n        if (weight > 1) {\n            elevation /= float(weight);\n        }\n#endif\n        vPosition.z = elevation;\n    }\n\n    // colors from OGC EL.GridCoverage.Default style\n    // float z = vPosition.z;\n    // if (z < -100.0) {\n    //     vColor = vec4(float(0x00) / 255.0, float(0x5C) / 255.0, float(0xE6) / 255.0, 1.0);\n    // } else if (z <= 0.0) {\n    //     vColor = mix(\n    //         vec4(float(0x00) / 255.0, float(0x5C) / 255.0, float(0xE6) / 255.0, 1.0),\n    //         vec4(float(0x28) / 255.0, float(0xED) / 255.0, float(0xD6) / 255.0, 1.0),\n    //         -z / 100.0);\n    // } else if (z <= 50.0) {\n    //     vColor = mix(\n    //         vec4(float(0x00) / 255.0, float(0x5C) / 255.0, float(0xE6) / 255.0, 1.0),\n    //         vec4(float(0x28) / 255.0, float(0xED) / 255.0, float(0xD6) / 255.0, 1.0),\n    //         -z / 100.0);\n    // } else if (z <= 50.0) {\n    //     vColor = mix(\n    //         vec4(float(0x28) / 255.0, float(0xED) / 255.0, float(0xD6) / 255.0, 1.0),\n    //         vec4(float(0x54) / 255.0, float(0xF7) / 255.0, float(0x6D) / 255.0, 1.0),\n    //         z / 50.0);\n    // } else if (z <= 100.0) {\n    //     vColor = mix(\n    //         vec4(float(0x54) / 255.0, float(0xF7) / 255.0, float(0x6D) / 255.0, 1.0),\n    //         vec4(float(0x9A) / 255.0, float(0xFA) / 255.0, float(0x66) / 255.0, 1.0),\n    //         (z - 50.0)/ 50.0);\n    // } else {\n    //     vColor = mix(\n    //         vec4(float(0x9A) / 255.0, float(0xFA) / 255.0, float(0x66) / 255.0, 1.0),\n    //         vec4(float(0x7B) / 255.0, float(0xF2) / 255.0, float(0x3A) / 255.0, 1.0),\n    //         (z - 100.0)/ 50.0);\n    // }\n    gl_Position = projectionMatrix * modelViewMatrix * vPosition;\n}\n",t.canvas=document.createElement("canvas"),t.canvas.width=l.maxX,t.canvas.height=l.maxY,t.pendingUpdates=[],t.texturesInfo={color:{offsetScale:[],originalOffsetScale:[],atlasTexture:new o.CanvasTexture(t.canvas),parentAtlasTexture:null,textures:[],opacity:[],visible:[],colors:[]},elevation:{offsetScale:new o.Vector4(0,0,0,0),texture:d,neighbours:{offsetScale:Array(4),texture:Array(4)},format:null}},m(t.texturesInfo.elevation.neighbours.texture,d),m(t.texturesInfo.elevation.neighbours.offsetScale,f),t.canvasRevision=0,t.uniforms.tileDimensions=new o.Uniform(new o.Vector2),t.uniforms.neighbourdiffLevel=new o.Uniform(new o.Vector4),t.uniforms.elevationTexture=new o.Uniform(t.texturesInfo.elevation.texture),t.uniforms.elevationOffsetScale=new o.Uniform(t.texturesInfo.elevation.offsetScale),t.uniforms.nTex=new o.Uniform(t.texturesInfo.elevation.neighbours.texture),t.uniforms.nOff=new o.Uniform(t.texturesInfo.elevation.neighbours.offsetScale),t.uniforms.colorTexture=new o.Uniform(t.texturesInfo.color.atlasTexture),t.uniforms.colorOffsetScale=new o.Uniform,t.uniforms.colorOpacity=new o.Uniform,t.uniforms.colorVisible=new o.Uniform,t.uniforms.colors=new o.Uniform(t.texturesInfo.color.colors),t.uniforms.uuid=new o.Uniform(0),t.uniforms.noTextureColor=new o.Uniform(new o.Color),t.uniforms.noTextureOpacity=new o.Uniform(1),t.uniforms.opacity=new o.Uniform(1),t.colorLayers=[],t.texturesInfo.color.atlasTexture.generateMipmaps=!1,t.texturesInfo.color.atlasTexture.magFilter=o.LinearFilter,t.texturesInfo.color.atlasTexture.minFilter=o.LinearFilter,t.texturesInfo.color.atlasTexture.anisotropy=1,t.texturesInfo.color.atlasTexture.premultiplyAlpha=!0,t.texturesInfo.color.atlasTexture.needsUpdate=!1,t}return(0,r.default)(a,[{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"}),this.disposed=!0,this.texturesInfo.color.atlasTexture.dispose(),this.texturesInfo.elevation.texture.dispose()}},{key:"getColorTexture",value:function(t){var e=this.indexOfColorLayer(t);return-1===e?null:this.texturesInfo.color.textures[e]}},{key:"setColorTextures",value:function(t,e,r,n){var i=this;Array.isArray(e)&&(e=e[0]);var a=this.indexOfColorLayer(t);return this.texturesInfo.color.originalOffsetScale[a].copy(e.pitch),this.texturesInfo.color.textures[a]=e.texture,r?(y(t.imageSize,this.atlasInfo.atlas[t.id],this.texturesInfo.color.originalOffsetScale[a],this.uniforms.colorTexture.value.image,this.texturesInfo.color.offsetScale[a]),Promise.resolve()):(this.pendingUpdates.push(t),null!==this.setTimeoutId&&clearTimeout(this.setTimeoutId),this.setTimeoutId=setTimeout((function(){if(i.uniforms.colorTexture.value!==i.texturesInfo.color.atlasTexture){i.uniforms.colorTexture.value=i.texturesInfo.color.atlasTexture;var t,e=u(i.colorLayers);try{for(e.s();!(t=e.n()).done;){var r=t.value;-1===i.pendingUpdates.indexOf(r)&&(console.warn("no new texture for ",r.id,". Redrawing the old one"),i.pendingUpdates.push(r))}}catch(t){e.e(t)}finally{e.f()}}var a,o=u(i.pendingUpdates);try{for(o.s();!(a=o.n()).done;){var s=a.value,l=i.indexOfColorLayer(s),c=i.atlasInfo.atlas[s.id];y(s.imageSize,i.atlasInfo.atlas[s.id],i.texturesInfo.color.originalOffsetScale[l],i.uniforms.colorTexture.value.image,i.texturesInfo.color.offsetScale[l]);var h=i.texturesInfo.color.textures[l].image;i.canvasRevision=v(s,i.texturesInfo.color.atlasTexture,c,h===i.canvas?null:h,i.texturesInfo.color.offsetScale[l],i.canvasRevision)}}catch(t){o.e(t)}finally{o.f()}i.pendingUpdates.length=0,i.texturesInfo.color.atlasTexture.needsUpdate=!0,i.visible&&n.notifyChange(),i.setTimeoutId=null}),1),Promise.resolve())}},{key:"getElevationTextureInfo",value:function(){return this.isElevationLayerTextureLoaded()?{texture:this.texturesInfo.elevation.texture,offsetScale:this.texturesInfo.elevation.offsetScale,elevationFormat:this.texturesInfo.elevation.format,heightFieldScale:this.texturesInfo.elevation.heightFieldScale,heightFieldOffset:this.texturesInfo.elevation.heightFieldOffset}:null}},{key:"setElevationTexture",value:function(t,e){if(t.elevationFormat===l.ELEVATION_FORMAT.MAPBOX_RGB)this.defines.MAPBOX_RGB_ELEVATION||(this.defines.MAPBOX_RGB_ELEVATION=1,this.needsUpdate=!0);else if(t.elevationFormat===l.ELEVATION_FORMAT.HEIGHFIELD){if(!this.defines.HEIGHTFIELD_ELEVATION){this.defines.HEIGHTFIELD_ELEVATION=1;var r=t.heightFieldOffset||0;this.texturesInfo.elevation.heightFieldOffset=r,this.uniforms.heightFieldOffset=new o.Uniform(r);var n=t.heightFieldScale||255;this.texturesInfo.elevation.heightFieldScale=n,this.uniforms.heightFieldScale=new o.Uniform(n),this.needsUpdate=!0}}else{if(t.elevationFormat!==l.ELEVATION_FORMAT.RATP_GEOL)throw new Error("Missing layer.elevationFormat handling",t.elevationFormat);this.defines.RATP_GEOL_ELEVATION||(this.defines.RATP_GEOL_ELEVATION=1)}return this.uniforms.elevationTexture.value=e.texture,this.texturesInfo.elevation.texture=e.texture,this.texturesInfo.elevation.offsetScale.copy(e.pitch),this.texturesInfo.elevation.format=t.elevationFormat,Promise.resolve(!0)}},{key:"pushLayer",value:function(t){this.texturesInfo.color.opacity.push(t.opacity),this.texturesInfo.color.visible.push(t.visible),this.texturesInfo.color.offsetScale.push(new o.Vector4(0,0,0,0)),this.texturesInfo.color.originalOffsetScale.push(new o.Vector4(0,0,0,0)),this.texturesInfo.color.textures.push(d),this.texturesInfo.color.colors.push(t.color||new o.Color(1,1,1)),this.colorLayers.push(t),1===this.colorLayers.length&&(this.uniforms.colorOffsetScale=new o.Uniform(this.texturesInfo.color.offsetScale),this.uniforms.colorOpacity=new o.Uniform(this.texturesInfo.color.opacity),this.uniforms.colorVisible=new o.Uniform(this.texturesInfo.color.visible)),this.defines.TEX_UNITS=this.colorLayers.length,this.needsUpdate=!0}},{key:"removeLayer",value:function(t){var e=this.indexOfColorLayer(t);-1!==e?(this.texturesInfo.color.opacity.splice(e,1),this.texturesInfo.color.visible.splice(e,1),this.texturesInfo.color.offsetScale.splice(e,1),this.texturesInfo.color.originalOffsetScale.splice(e,1),this.texturesInfo.color.textures.splice(e,1),this.texturesInfo.color.colors.splice(e,1),this.colorLayers.splice(e,1),this.defines.TEX_UNITS=this.colorLayers.length,this.needsUpdate=!0):console.warn("Layer ".concat(t.id," not found, so not removed..."))}},{key:"update",value:function(){if(0===this.colorLayers.length)return!0;if(this.atlasInfo.maxX>this.canvas.width||this.atlasInfo.maxY>this.canvas.height){var t=document.createElement("canvas");if(t.width=this.atlasInfo.maxX,t.height=this.atlasInfo.maxY,this.canvas.width>0)t.getContext("2d").drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height);this.texturesInfo.color.atlasTexture.dispose(),this.texturesInfo.color.atlasTexture=new o.CanvasTexture(t),this.texturesInfo.color.atlasTexture.magFilter=o.LinearFilter,this.texturesInfo.color.atlasTexture.minFilter=o.LinearFilter,this.texturesInfo.color.atlasTexture.anisotropy=1,this.texturesInfo.color.atlasTexture.premultiplyAlpha=!0,this.texturesInfo.color.atlasTexture.needsUpdate=!0;for(var e=0;e<this.colorLayers.length;e++){var r=this.colorLayers[e],n=this.atlasInfo.atlas[r.id],i=this.texturesInfo.color.originalOffsetScale[e],a=r.imageSize.w/t.width,s=r.imageSize.h/t.height;this.texturesInfo.color.offsetScale[e]=new o.Vector4(n.x/t.width+i.x*a,(n.y+n.offset)/t.height+i.y*s,i.z*a,i.w*s)}this.canvas=t,this.uniforms.colorTexture.value=this.texturesInfo.color.atlasTexture}return this.canvas.width>0}},{key:"indexOfColorLayer",value:function(t){return this.colorLayers.indexOf(t)}},{key:"setLayerOpacity",value:function(t,e){var r=Number.isInteger(t)?t:this.indexOfColorLayer(t);this.texturesInfo.color.opacity[r]=e}},{key:"setLayerVisibility",value:function(t,e){var r=Number.isInteger(t)?t:this.indexOfColorLayer(t);this.texturesInfo.color.visible[r]=e}},{key:"isElevationLayerTextureLoaded",value:function(){return this.texturesInfo.elevation.texture!==d}},{key:"isColorLayerTextureLoaded",value:function(t){var e=this.indexOfColorLayer(t);return e<0?null:this.texturesInfo.color.textures[e]!==d}},{key:"setUuid",value:function(t){this.uniforms.uuid.value=t}}]),a}(o.RawShaderMaterial);function v(t,e,r,n,i,a){var o=e.image.getContext("2d");return void 0!==n&&t.transparent&&o.clearRect(r.x,r.y,t.imageSize.w,t.imageSize.h+2*r.offset),n&&(o.drawImage(n,r.x,r.y+r.offset,t.imageSize.w,t.imageSize.h),r.offset&&(o.drawImage(n,0,0,t.imageSize.w,r.offset,r.x,r.y,t.imageSize.w,r.offset),o.drawImage(n,0,t.imageSize.h-1-r.offset,t.imageSize.w,r.offset,r.x,r.y+t.imageSize.h+r.offset,t.imageSize.w,r.offset))),e.needsUpdate=!0,a+1}function y(t,e,r,n,i){if(0!==r.z&&0!==r.w){var a=t.w/n.width,o=t.h/n.height;i.set(e.x/n.width+r.x*a,(e.y+e.offset)/n.height+r.y*o,r.z*a,r.w*o)}else i.set(0,0,0,0)}var x=g;return GM.default=x,GM}function WM(){if(zM)return eM;zM=1;var t=uf;Object.defineProperty(eM,"__esModule",{value:!0}),eM.default=void 0;var e=Bf,r=t(NM()),n=t(cM()),i=HM(),a=t(Ux()),o=t(VM());function s(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function u(t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=t.camera.camera3D.layers.mask;return t.camera.camera3D.layers.mask=1<<e,function(){t.camera.camera3D.layers.mask=r}}var c=new e.Vector4;function h(t,e){for(var r,n=0;n<=t;n++){for(var i=n*n,a=-n;a<=n;a++)for(var o=a*a,s=-n;s<=n;s++){var l=o+s*s;if(!(l>i)&&!(l<=r)){var u=t+a,c=t+s;if(!1===e(u,c,c*(2*t)+u))return}}r=i}}function d(t){return t.layer?t.layer:t.parent?d(t.parent):null}var f=new e.Raycaster,p=new a.default("EPSG:3857",0,0,0),m=new e.Color,g={pickTilesAt:function(t,l,d,f){var m,g=[],v=function(t,r,a,o){var s=t.mainLoop.gfxEngine.getWindowSize();a=a||new e.Vector2(Math.floor(s.x/2),Math.floor(s.y/2));var l=r.level0Nodes.map((function(t){return t.pushRenderState(n.default.ID)})),d=u(t,r.object3d,r.threejsLayer),f=t.mainLoop.gfxEngine.renderViewToBuffer({camera:t.camera,scene:r.object3d},{x:a.x-o,y:a.y-o,width:1+2*o,height:1+2*o});d(),l.forEach((function(t){return t()}));var p=[];return h(o,(function(t,e,r){var n=f.slice(4*r,4*r+4);c.fromArray(n).divideScalar(255);var a=(0,i.unpack1K)(c,Math.pow(256,3)),o=Math.round(a);p.indexOf(o)<0&&p.push(o)})),p}(t,f,l,d),y=function(i){if(v.indexOf(i.id)>=0&&i instanceof r.default){var s=i.pushRenderState(n.default.UV),u=t.mainLoop.gfxEngine.renderViewToBuffer({camera:t.camera,scene:i},{x:Math.max(0,l.x-d),y:Math.max(0,l.y-d),width:1+2*d,height:1+2*d}),m=[];h(d,(function(t,r,n){var i,a,o=u.slice(4*n,4*n+4);c.fromArray(o).divideScalar(255),m.push((i=c,a&&a.isVector2||(a=new e.Vector2),a.set(i.x+i.y/255,i.z+i.w/255)))}));for(var y=0,x=m;y<x.length;y++){var _=x[y];p.set(f.extent.crs(),i.extent.west()+_.x*(i.extent.east()-i.extent.west()),i.extent.south()+_.y*(i.extent.north()-i.extent.south()),0);var w=o.default.getElevationValueAt(f,p,o.default.FAST_READ_Z,[i]);if(w){p._values[2]=w.z;var b=p.as(t.referenceCrs,new a.default(t.referenceCrs)),M=p.xyz(new e.Vector3);g.push({object:i,layer:f,point:M,coord:b,distance:t.camera.camera3D.position.distanceTo(M)})}}s()}},x=s(f.level0Nodes);try{for(x.s();!(m=x.n()).done;){m.value.traverse(y)}}catch(t){x.e(t)}finally{x.f()}return g},pickPointsAt:function(t,r,n,i,a){n=Math.floor(n);var o=1;i.object3d.traverse((function(t){t.isPoints&&t.visible&&t.material.visible&&t.material.enablePicking&&(t.material.enablePicking(o++),4096===o&&console.warn("Too much visible point instance. The next one won't be pickable"))}));var s=u(t,i.object3d,i.threejsLayer),l=t.mainLoop.gfxEngine.renderViewToBuffer({camera:t.camera,scene:i.object3d},{x:Math.max(0,r.x-n),y:Math.max(0,r.y-n),width:1+2*n,height:1+2*n});s();var c=[];h(n,(function(t,e,n){var i={x:t+r.x,y:e+r.y,z:0};if(!a||a(i)){(4*n<0||4*(n+1)>l.length)&&console.error("azadaz");var s=l.slice(4*n,4*n+4);if(255!==s[0]||255!==s[1]){var u=s[0]+((240&s[1])<<4);u>o&&console.warn("weird: pickingId (".concat(u,") > visibleId (").concat(o,")"));for(var h={pickingId:u,index:((15&s[1])<<16)+(s[2]<<8)+s[3],coord:i},d=0;d<c.length;d++)if(c[d].pickingId===h.pickingId&&c[d].index===h.index)return;c.push(h)}}}));var d=[];return i.object3d.traverse((function(r){if(r.isPoints&&r.visible&&r.material.visible){for(var n=0;n<c.length;n++)if(c[n].pickingId===r.material.pickingId){var a=(new e.Vector3).fromArray(r.geometry.attributes.position.array,3*c[n].index).applyMatrix4(r.matrixWorld);d.push({object:r,index:c[n].index,layer:i,point:a,coord:c[n].coord,distance:t.camera.camera3D.position.distanceTo(a)})}r.material.enablePicking(0)}})),d},pickObjectsAt:function(t,e,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a={x:e.x-r,y:e.y-r,width:1+2*r,height:1+2*r},o=t.mainLoop.gfxEngine.renderViewToBuffer({scene:n,camera:t.camera},a),l=t.mainLoop.gfxEngine.renderer.getClearColor(m),u=Math.round(255*l.r),c=Math.round(255*l.g),p=Math.round(255*l.b),g=t.viewToNormalizedCoords(e),v=g.clone();return h(r,(function(e,a){var l=4*((a+r)*(2*r+1)+(e+r)),h=o[l],m=o[l+1],y=o[l+2];if(Math.abs(u-h)<=1&&Math.abs(c-m)<=1&&Math.abs(p-y)<=1)return null;v.setX(g.x+e/t.camera.width).setY(g.y+a/t.camera.height),f.setFromCamera(v,t.camera.camera3D);var x,_=s(f.intersectObject(n,!0));try{for(_.s();!(x=_.n()).done;){var w=x.value;w.layer=d(w.object),i.push(w)}}catch(t){_.e(t)}finally{_.f()}return 0===i.length})),i},preparePointGeometryForPicking:function(t){var r=t.attributes.position.count;r>=1<<20&&console.warn("picking issue: only ".concat(1<<20," points per Points object supported"));for(var n=new Uint8Array(4*r),i=0;i<r;i++)n[4*i+0]=0,n[4*i+1]=(983040&i)>>16,n[4*i+2]=(65280&i)>>8,n[4*i+3]=(255&i)>>0;t.setAttribute("unique_id",new e.BufferAttribute(n,4,!0))}};return eM.default=g,eM}var qM,XM,YM={},ZM={};function KM(){if(qM)return ZM;qM=1,Object.defineProperty(ZM,"__esModule",{value:!0}),ZM.default=void 0;var t=Bf;function e(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){l=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function n(t,e,r){return t.used?n(t.right,e,r)||n(t.down,e,r):e<=t.w&&r<=t.h?t:null}function i(t,e,r){return t.used=!0,t.down={x:t.x,y:t.y+r,w:t.w,h:t.h-r},t.right={x:t.x+e,y:t.y,w:t.w-e,h:r},t}var a=function(r,a,o,s){var l,u=s||{x:0,y:0,w:a,h:o},c=0,h=0,d=e(r);try{for(d.s();!(l=d.n()).done;){var f=l.value,p=n(u,f.w,f.h);p&&(f.fit=i(p,f.w,f.h),c=Math.max(c,p.x+f.w),h=Math.max(h,p.y+f.h))}}catch(t){d.e(t)}finally{d.f()}return t.MathUtils.isPowerOfTwo(c)||(c=t.MathUtils.ceilPowerOfTwo(c)),t.MathUtils.isPowerOfTwo(h)||(h=t.MathUtils.ceilPowerOfTwo(h)),{maxX:c,maxY:h}};return ZM.default=a,ZM}var JM,QM={};function $M(){if(JM)return QM;JM=1,Object.defineProperty(QM,"__esModule",{value:!0}),QM.default=void 0;var t,e=!1,r=8;function n(t,e,r){var n=t.getContext(),i=n.createShader(e);return n.shaderSource(i,r),n.compileShader(i),i}function i(){return navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().indexOf("firefox")>-1}var a={isLogDepthBufferSupported:function(){return e},isFirefox:i,isInternetExplorer:function(){return!!document.documentMode},getMaxTextureUnitsCount:function(){return r},getMaxTextureSize:function(){return t},updateCapabilities:function(a){var o=a.getContext();r=o.getParameter(o.MAX_TEXTURE_IMAGE_UNITS),t=o.getParameter(o.MAX_TEXTURE_SIZE);var s=o.createProgram(),l=n(a,o.VERTEX_SHADER,"void main() {\n    gl_Position = vec4( 0.0, 0.0, 0.0, 1.0 );\n}"),u="#define SAMPLE ".concat(r,"\n");u+="uniform sampler2D uni[SAMPLE];\nvoid main() {\n    gl_FragColor += texture2D(uni[SAMPLE-1], vec2(0));\n}";var c=n(a,o.FRAGMENT_SHADER,u);if(o.attachShader(s,l),o.attachShader(s,c),o.linkProgram(s),!1===o.getProgramParameter(s,o.LINK_STATUS)){if(!(r>16))throw new Error("The GPU capabilities could not be determined accurately.\n                    Impossible to link a shader with the Maximum texture units ".concat(r));var h=o.getProgramInfoLog(s);console.warn("".concat(h,": using a maximum of 16 texture units instead of the reported value (").concat(r,")")),i()&&console.warn("It can come from a Mesa/Firefox bug;\n                        the shader compiles to an error when using more than 16 sampler uniforms,\n                        see https://bugzilla.mozilla.org/show_bug.cgi?id=777028"),r=16}o.deleteProgram(s),o.deleteShader(l),o.deleteShader(c),e=a.capabilities.logarithmicDepthBuffer}};return QM.default=a,QM}var tS,eS={};function rS(){if(tS)return eS;tS=1;var t=uf;Object.defineProperty(eS,"__esModule",{value:!0}),eS.default=void 0;var e=t(pf()),r=t(yf()),n=function(){function t(r){if((0,e.default)(this,t),!r)throw new Error("Missing id parameter (Entity must have a unique id defined)");Object.defineProperty(this,"id",{value:r,writable:!1})}return(0,r.default)(t,[{key:"preUpdate",value:function(){return null}},{key:"update",value:function(){}},{key:"postUpdate",value:function(){}}]),t}();return eS.default=n,eS}var nS,iS,aS={};function oS(){if(iS)return Hb;iS=1;var t=uf;Object.defineProperty(Hb,"__esModule",{value:!0}),Hb.default=void 0;var e=t(pf()),r=t(yf()),n=t(bf()),i=t(Cf()),a=t(Df()),o=t(Uf()),s=Bf,l=jb(),u=t(Qb()),c=t(WM()),h=t(function(){if(XM)return YM;XM=1;var t=uf;Object.defineProperty(YM,"__esModule",{value:!0}),YM.default=void 0;var e=t(KM()),r={pack:function(t,r,n,i){t=2048;for(var a,o=[],s=0;s<n.length;s++)if(!i||!(r[s]in i)){var l=n[s].w,u=n[s].h;o.push({layerId:r[s],w:Math.min(t,l),h:Math.min(t,u+0)})}if(o.sort((function(t,e){return Math.max(t.w,t.h)<Math.max(e.w,e.h)})),i)for(var c=0,h=Object.keys(i);c<h.length;c++){var d=i[h[c]];if(0===d.x&&0===d.y){a=d;break}}i&&!a&&console.error("UH: oldAtlas is defined, but not previousRoot");var f=(0,e.default)(o,t,t,a),p=f.maxX,m=f.maxY,g=i||{};for(s=0;s<o.length;s++)g[o[s].layerId]=o[s].fit,g[o[s].layerId].offset=0;return{atlas:g,maxX:p,maxY:m}}};return YM.default=r,YM}()),d=t($M()),f=t(rS()),p=t(function(){if(nS)return aS;nS=1,Object.defineProperty(aS,"__esModule",{value:!0}),aS.default=void 0;var t=Bf,e={dispatchEvent:t.EventDispatcher.prototype.dispatchEvent,addEventListener:t.EventDispatcher.prototype.addEventListener,hasEventListener:t.EventDispatcher.prototype.hasEventListener,removeEventListener:t.EventDispatcher.prototype.removeEventListener};return aS.default=e,aS}());function m(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return g(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return g(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=(0,o.default)(t);if(e){var i=(0,o.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var y=function(t){(0,i.default)(o,t);var a=v(o);function o(t,r){var i;if((0,e.default)(this,o),i=a.call(this,t),!r||!r.isObject3D)throw new Error("Missing/Invalid object3d parameter (must be a three.js Object3D instance)");i._attachedLayers=[],i._instance=null,r&&"Group"===r.type&&""===r.name&&(r.name=t),i.type="geometry",Object.defineProperty((0,n.default)(i),"object3d",{value:r,writable:!1});var u=function(t){t.material&&(null!=t.material.opacity&&(t.material.transparent=i.noTextureOpacity<1||i.opacity<1,t.material.opacity=i.opacity),t.material.uniforms&&null!=t.material.uniforms.opacity&&(t.material.transparent=i.noTextureOpacity<1||i.opacity<1,t.material.uniforms.opacity.value=i.opacity),t.material.depthWrite=!t.material.transparent)};(0,l.defineLayerProperty)((0,n.default)(i),"opacity",1,(function(){i.object3d&&i.object3d.traverse((function(t){t.layer===(0,n.default)(i)&&(u(t),t.content&&t.content.traverse(u))}))}));var c=function(t){t.material&&(t.material.noTextureColor&&t.material.noTextureColor.value.copy(i.noTextureColor),t.material.uniforms&&t.material.uniforms.noTextureColor&&t.material.uniforms.noTextureColor.value.copy(i.noTextureColor),t.material.depthWrite=!t.material.transparent)};(0,l.defineLayerProperty)((0,n.default)(i),"noTextureColor",new s.Color(.04,.23,.35),(function(){i.object3d&&i.object3d.traverse((function(t){t.layer===(0,n.default)(i)&&(c(t),t.content&&t.content.traverse(c))}))}));var h=function(t){t.material&&(null!=t.material.noTextureOpacity&&(t.material.transparent=i.noTextureOpacity<1||i.opacity<1,t.material.noTextureOpacity=i.noTextureOpacity),t.material.uniforms&&null!=t.material.uniforms.noTextureOpacity&&(t.material.transparent=i.noTextureOpacity<1||i.opacity<1,t.material.uniforms.noTextureOpacity.value=i.noTextureOpacity),t.material.depthWrite=!t.material.transparent)};return(0,l.defineLayerProperty)((0,n.default)(i),"noTextureOpacity",1,(function(){i.object3d&&i.object3d.traverse((function(t){t.layer===(0,n.default)(i)&&(h(t),t.content&&t.content.traverse(h))}))})),i.atlasInfo={maxX:0,maxY:0},i.getObjectToUpdateForAttachedLayers=function(t){return t.parent&&t.material?{element:t,parent:t.parent}:null},i._distance={min:1/0,max:0},i}return(0,r.default)(o,[{key:"pickObjectsAt",value:function(t,e,r){return c.default.pickObjectsAt(t,e,r,this.object3d)}},{key:"attach",value:function(t){if(!t.update)throw new Error("Missing 'update' function -> can't attach layer ".concat(t.id));if(t=t._preprocessLayer(this,this._instance),this._attachedLayers.push(t),t instanceof u.default){var e=this._attachedLayers.filter((function(t){return t instanceof u.default})),r=h.default.pack(d.default.getMaxTextureSize(),e.map((function(t){return t.id})),e.map((function(t){return t.imageSize})),this.atlasInfo.atlas),n=r.atlas,i=r.maxX,a=r.maxY;this.atlasInfo.atlas=n,this.atlasInfo.maxX=Math.max(this.atlasInfo.maxX,i),this.atlasInfo.maxY=Math.max(this.atlasInfo.maxY,a)}}},{key:"detach",value:function(t){var e=this._attachedLayers.length;return this._attachedLayers=this._attachedLayers.filter((function(e){return e.id!==t.id})),this._attachedLayers.length<e}},{key:"getLayers",value:function(t){var e,r=[],n=m(this._attachedLayers);try{for(n.s();!(e=n.n()).done;){var i=e.value;t&&!t(i)||r.push(i)}}catch(t){n.e(t)}finally{n.f()}return r}}]),o}(f.default);Object.assign(y.prototype,p.default);var x=y;return Hb.default=x,Hb}var sS,lS,uS={};var cS,hS={};function dS(){if(cS)return hS;cS=1;var t=uf;Object.defineProperty(hS,"__esModule",{value:!0}),hS.default=void 0;var e=t(pf()),r=t(yf()),n=Bf,i=t($M());function a(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return o(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){l=!0,a=t},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw a}}}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var s=function(){function t(r){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,e.default)(this,t),void 0===a.antialias&&(a.antialias=!0),void 0===a.alpha&&(a.alpha=!0),void 0===a.logarithmicDepthBuffer&&(a.logarithmicDepthBuffer=!1),void 0===a.clearColor&&(a.clearColor=197896);var o=r.domElement?r:void 0,s=o?void 0:r;this.width=(o?o.domElement:s).clientWidth,this.height=(o?o.domElement:s).clientHeight,this.positionBuffer=null,this._nextThreejsLayer=1,this.fullSizeRenderTarget=new n.WebGLRenderTarget(this.width,this.height),this.fullSizeRenderTarget.texture.minFilter=n.LinearFilter,this.fullSizeRenderTarget.texture.magFilter=n.NearestFilter,this.fullSizeRenderTarget.texture.generateMipmaps=!1,this.fullSizeRenderTarget.depthBuffer=!0,this.fullSizeRenderTarget.depthTexture=new n.DepthTexture,this.fullSizeRenderTarget.depthTexture.type=n.UnsignedShortType;try{this.renderer=o||new n.WebGLRenderer({canvas:document.createElement("canvas"),antialias:a.antialias,alpha:a.alpha,logarithmicDepthBuffer:a.logarithmicDepthBuffer})}catch(t){console.error("Failed to create WebGLRenderer",t),this.renderer=null}if(!this.renderer){var l=document.createElement("div");throw l.id="webgl-error-message",l.style.fontFamily="monospace",l.style.fontSize="13px",l.style.fontWeight="normal",l.style.textAlign="center",l.style.background="#fff",l.style.color="#000",l.style.padding="1.5em",l.style.width="400px",l.style.margin="5em auto 0",l.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.<br>','See also <a href="https://www.khronos.org/webgl/wiki/BlacklistsAndWhitelists">graphics card blacklisting</a>'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.<br>',"You can also try another browser like Firefox or Chrome."].join("\n"),s.appendChild(l),new Error("WebGL unsupported")}if(!o&&a.logarithmicDepthBuffer&&!this.renderer.extensions.get("EXT_frag_depth")){var u=this.renderer.domElement;this.renderer.dispose(),this.renderer=new n.WebGLRenderer({canvas:u,antialias:a.antialias,alpha:a.alpha,logarithmicDepthBuffer:!1})}-1===this.renderer.domElement.tabIndex&&(this.renderer.domElement.tabIndex=-1),i.default.updateCapabilities(this.renderer),!1!==a.clearColor&&this.renderer.setClearColor(a.clearColor),this.renderer.autoClear=!1,this.renderer.sortObjects=!0,o||(this.renderer.setPixelRatio(s.devicePixelRatio),this.renderer.setSize(s.clientWidth,s.clientHeight),s.appendChild(this.renderer.domElement))}return(0,r.default)(t,[{key:"renderView",value:function(t,e){this.renderer.setViewport(0,0,this.width,this.height),this.renderer.clear(),this.renderer.render(t.scene,t.camera.camera3D),!1!==e&&(this.renderer.clearDepth(),this.renderer.render(t.scene2D,t.camera.camera2D))}},{key:"onWindowResize",value:function(t,e){this.width=t,this.height=e,this.fullSizeRenderTarget.setSize(this.width,this.height),this.renderer.setSize(this.width,this.height)}},{key:"getWindowSize",value:function(){return new n.Vector2(this.width,this.height)}},{key:"getRenderer",value:function(){return this.renderer}},{key:"renderViewToBuffer",value:function(t,e){e||(e={x:0,y:0,width:this.width,height:this.height}),this.renderViewToRenderTarget(t,this.fullSizeRenderTarget,e),e.x=Math.max(0,Math.min(e.x,this.width)),e.y=Math.max(0,Math.min(e.y,this.height));var r=new Uint8Array(4*e.width*e.height);return this.renderer.readRenderTargetPixels(this.fullSizeRenderTarget,e.x,this.height-(e.y+e.height),e.width,e.height,r),r}},{key:"renderViewToRenderTarget",value:function(t,e,r){e||(e=this.fullSizeRenderTarget);var n=this.renderer.getRenderTarget();return e.viewport.set(0,0,e.width,e.height),r&&(e.scissor.set(Math.max(0,r.x),Math.max(e.height-(r.y+r.height)),r.width,r.height),e.scissorTest=!0),this.renderer.setRenderTarget(e),this.renderer.clear(),this.renderer.render(t.scene,t.camera.camera3D),this.renderer.setRenderTarget(n),e.scissorTest=!1,e}},{key:"renderLayerTobuffer",value:function(t,e,r,n,i,o,s){var l,u=t._objects.map((function(t){return t.visible})),c=a(t._objects);try{for(c.s();!(l=c.n()).done;){l.value.visible=!1}}catch(t){c.e(t)}finally{c.f()}e.visible=!0;var h=this.renderer.getRenderTarget();this.renderer.setRenderTarget(r),this.renderer.setViewport(0,0,r.width,r.height),this.renderer.setScissor(n,i,o,s),this.renderer.setScissorTest(!0),this.renderer.clear(),this.renderer.render(e.object3d,t.camera.camera3D),this.renderer.setScissorTest(!1);var d=new Uint8Array(4*o*s);this.renderer.readRenderTargetPixels(r,n,i,o,s,d),this.renderer.setRenderTarget(h);for(var f=0;f<u.length;f++)t._objects[f].visible=u[f];return d}},{key:"getUniqueThreejsLayer",value:function(){return this._nextThreejsLayer>31&&(console.warn("Too much js layers. Starting from now all of them will use layerMask = 31"),this._nextThreejsLayer=31),this._nextThreejsLayer++}}],[{key:"bufferToImage",value:function(t,e,r){var n=document.createElement("canvas"),i=n.getContext("2d");n.width=e,n.height=r;var a=i.getImageData(0,0,e,r);a.data.set(t),i.putImageData(a,0,0);var o=new Image;return o.src=n.toDataURL(),o}}]),t}(),l=s;return hS.default=l,hS}var fS={};function pS(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var mS,gS={},vS={get exports(){return gS},set exports(t){gS=t}};function yS(){return mS||(mS=1,vS.exports=function t(e,r,n){function i(o,s){if(!r[o]){if(!e[o]){if(!s&&pS)return pS(o);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=r[o]={exports:{}};e[o][0].call(u.exports,(function(t){var r=e[o][1][t];return i(r||t)}),u,u.exports,t,e,r,n)}return r[o].exports}for(var a=pS,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(t,e,r){var n,i,a,o,s,l=function(t,e){for(var r in e)u.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;n=t("./PriorityQueue/AbstractPriorityQueue"),i=t("./PriorityQueue/ArrayStrategy"),o=t("./PriorityQueue/BinaryHeapStrategy"),a=t("./PriorityQueue/BHeapStrategy"),(s=function(t){function e(t){t||(t={}),t.strategy||(t.strategy=o),t.comparator||(t.comparator=function(t,e){return(t||0)-(e||0)}),e.__super__.constructor.call(this,t)}return l(e,t),e}(n)).ArrayStrategy=i,s.BinaryHeapStrategy=o,s.BHeapStrategy=a,e.exports=s},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(t,e,r){e.exports=function(){function t(t){var e;if(null==(null!=t?t.strategy:void 0))throw"Must pass options.strategy, a strategy";if(null==(null!=t?t.comparator:void 0))throw"Must pass options.comparator, a comparator";this.priv=new t.strategy(t),this.length=(null!=t&&null!=(e=t.initialValues)?e.length:void 0)||0}return t.prototype.queue=function(t){this.length++,this.priv.queue(t)},t.prototype.dequeue=function(t){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},t.prototype.peek=function(t){if(!this.length)throw"Empty queue";return this.priv.peek()},t.prototype.clear=function(){return this.length=0,this.priv.clear()},t}()},{}],3:[function(t,e,r){var n;n=function(t,e,r){var n,i,a;for(i=0,n=t.length;i<n;)r(t[a=i+n>>>1],e)>=0?i=a+1:n=a;return i},e.exports=function(){function t(t){var e;this.options=t,this.comparator=this.options.comparator,this.data=(null!=(e=this.options.initialValues)?e.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return t.prototype.queue=function(t){var e;e=n(this.data,t,this.comparator),this.data.splice(e,0,t)},t.prototype.dequeue=function(){return this.data.pop()},t.prototype.peek=function(){return this.data[this.data.length-1]},t.prototype.clear=function(){this.data.length=0},t}()},{}],4:[function(t,e,r){e.exports=function(){function t(t){var e,r,n,i,a,o,s,l;for(this.comparator=(null!=t?t.comparator:void 0)||function(t,e){return t-e},this.pageSize=(null!=t?t.pageSize:void 0)||512,this.length=0,s=0;1<<s<this.pageSize;)s+=1;if(1<<s!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=s,this._emptyMemoryPageTemplate=e=[],r=0,a=this.pageSize;0<=a?r<a:r>a;0<=a?++r:--r)e.push(null);if(this._memory=[],this._mask=this.pageSize-1,t.initialValues)for(n=0,i=(o=t.initialValues).length;n<i;n++)l=o[n],this.queue(l)}return t.prototype.queue=function(t){this.length+=1,this._write(this.length,t),this._bubbleUp(this.length,t)},t.prototype.dequeue=function(){var t,e;return t=this._read(1),e=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,e),this._bubbleDown(1,e)),t},t.prototype.peek=function(){return this._read(1)},t.prototype.clear=function(){this.length=0,this._memory.length=0},t.prototype._write=function(t,e){var r;for(r=t>>this._shift;r>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[r][t&this._mask]=e},t.prototype._read=function(t){return this._memory[t>>this._shift][t&this._mask]},t.prototype._bubbleUp=function(t,e){var r,n,i,a;for(r=this.comparator;t>1&&(n=t&this._mask,t<this.pageSize||n>3?i=t&~this._mask|n>>1:n<2?(i=t-this.pageSize>>this._shift,i+=i&~(this._mask>>1),i|=this.pageSize>>1):i=t-2,!(r(a=this._read(i),e)<0));)this._write(i,e),this._write(t,a),t=i},t.prototype._bubbleDown=function(t,e){var r,n,i,a,o;for(o=this.comparator;t<this.length;)if(t>this._mask&&!(t&this._mask-1)?r=n=t+2:t&this.pageSize>>1?(r=(t&~this._mask)>>1,n=1+(r=1+(r|=t&this._mask>>1)<<this._shift)):n=(r=t+(t&this._mask))+1,r!==n&&n<=this.length)if(i=this._read(r),a=this._read(n),o(i,e)<0&&o(i,a)<=0)this._write(r,e),this._write(t,i),t=r;else{if(!(o(a,e)<0))break;this._write(n,e),this._write(t,a),t=n}else{if(!(r<=this.length))break;if(!(o(i=this._read(r),e)<0))break;this._write(r,e),this._write(t,i),t=r}},t}()},{}],5:[function(t,e,r){e.exports=function(){function t(t){var e;this.comparator=(null!=t?t.comparator:void 0)||function(t,e){return t-e},this.length=0,this.data=(null!=(e=t.initialValues)?e.slice(0):void 0)||[],this._heapify()}return t.prototype._heapify=function(){var t,e,r;if(this.data.length>0)for(t=e=1,r=this.data.length;1<=r?e<r:e>r;t=1<=r?++e:--e)this._bubbleUp(t)},t.prototype.queue=function(t){this.data.push(t),this._bubbleUp(this.data.length-1)},t.prototype.dequeue=function(){var t,e;return e=this.data[0],t=this.data.pop(),this.data.length>0&&(this.data[0]=t,this._bubbleDown(0)),e},t.prototype.peek=function(){return this.data[0]},t.prototype.clear=function(){this.length=0,this.data.length=0},t.prototype._bubbleUp=function(t){for(var e,r;t>0&&(e=t-1>>>1,this.comparator(this.data[t],this.data[e])<0);)r=this.data[e],this.data[e]=this.data[t],this.data[t]=r,t=e},t.prototype._bubbleDown=function(t){var e,r,n,i,a;for(e=this.data.length-1;i=1+(r=1+(t<<1)),n=t,r<=e&&this.comparator(this.data[r],this.data[n])<0&&(n=r),i<=e&&this.comparator(this.data[i],this.data[n])<0&&(n=i),n!==t;)a=this.data[n],this.data[n]=this.data[t],this.data[t]=a,t=n},t}()},{}]},{},[1])(1)),gS}const xS=of(Qx);var _S,wS={},bS={},MS={};function SS(){if(_S)return MS;_S=1;var t=uf,e=cf;Object.defineProperty(MS,"__esModule",{value:!0}),MS.default=void 0;var r,n=t(pf()),i=t(yf()),a=t(bf()),o=t(sM()),s=t(Cf()),l=t(Df()),u=t(Uf()),c=m(VM()),h=t(Xb()),d=t(Jb()),f=m(jb());function p(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(p=function(t){return t?r:e})(t)}function m(t,r){if(!r&&t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var n=p(r);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=a?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=t[o]}return i.default=t,n&&n.set(t,i),i}function g(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return v(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return v(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function y(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=(0,u.default)(t);if(e){var i=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}var x=function(t){(0,s.default)(l,t);var e=y(l);function l(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.default)(this,l),(r=e.call(this,t,i)).elevationFormat=i.elevationFormat,r.elevationFormat===c.ELEVATION_FORMAT.HEIGHFIELD&&(r.heightFieldOffset=i.heightFieldOffset||0,r.heightFieldScale=i.heightFieldScale||255),(0,f.defineLayerProperty)((0,a.default)(r),"frozen",!1),r}return(0,i.default)(l,[{key:"minMaxFromTexture",value:function(t){if(null!=t.min&&null!=t.max)return{min:t.min,max:t.max};var e=1/0,r=-1/0;if(this.elevationFormat===c.ELEVATION_FORMAT.MAPBOX_RGB)for(var n=l.colorImageSetup(t),i=n.data,a=n.stride,o=n.h,s=0;s<o;s++)for(var u=0;u<a;u+=4){var h=c.default.decodeMapboxElevation(i[s*a+u],i[s*a+u+1],i[s*a+u+2]);h<e&&(e=h),h>r&&(r=h)}else if(this.elevationFormat===c.ELEVATION_FORMAT.HEIGHFIELD){for(var d=l.colorImageSetup(t),f=d.data,p=d.stride,m=d.h,g=0;g<m;g++)for(var v=0;v<p;v+=4)e=Math.min(e,f[g*p+v]),r=Math.max(r,f[g*p+v]);e=this.heightFieldOffset+this.heightFieldScale*(e/255),r=this.heightFieldOffset+this.heightFieldScale*(r/255)}else if(this.elevationFormat===c.ELEVATION_FORMAT.XBIL)for(var y=0;y<t.image.data.length;y++){var x=t.image.data[y];x>-1e3&&(e=Math.min(e,x),r=Math.max(r,x))}else{if(this.elevationFormat!==c.ELEVATION_FORMAT.RATP_GEOL)throw new Error('Unsupported layer.elevationFormat "'.concat(this.elevationFormat,"'"));e=-1e3,r=1e3}return t.min=e,t.max=r,{min:e,max:r}}},{key:"initNodeElevationTextureFromParent",value:function(t,e){var r=e.material.getElevationTextureInfo();if(r&&r.texture.extent){var n=r.texture,i=t.getExtentForLayer(this).offsetToParent(n.extent),a={texture:n,pitch:i},o=n.min,s=n.max;if(!o||!s){var l=this.minMaxFromTexture(n,i);o=l.min,s=l.max}a.min=o,a.max=s,t.setTextureElevation(this,a)}}},{key:"_preprocessLayer",value:function(t,e){var r=this;return(0,o.default)((0,u.default)(l.prototype),"_preprocessLayer",this).call(this,t,e),this.whenReady=this.whenReady.then((function(){var t=r.provider.getPossibleTextureImprovements(r,r.extent);return r.provider.executeCommand({layer:r,toDownload:t}).then((function(t){var e=r.minMaxFromTexture(t.texture,t.pitch);t.texture.min=e.min,t.texture.max=e.max,r.minmax=e}))})),this.whenReady=this.whenReady.then((function(){if(!r.minmax)throw new Error("At this point the whole min/max should be known");t.object3d.traverse((function(t){t.setBBoxZ&&t.setBBoxZ(r.minmax.min,r.minmax.max)})),t.minMaxFromElevationLayer={min:r.minmax.min,max:r.minmax.max};var e,n=g(t.level0Nodes);try{for(n.s();!(e=n.n()).done;){e.value.traverse((function(e){e.setBBoxZ&&e.setBBoxZ(t.minMaxFromElevationLayer.min,t.minMaxFromElevationLayer.max)}))}}catch(t){n.e(t)}finally{n.f()}return r})),this}},{key:"update",value:function(t,e,r){var n=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.material;if(!e.parent||!a)return null;if(void 0===e.layerUpdateState[this.id]&&(e.layerUpdateState[this.id]=new h.default,r&&r.material&&this.initNodeElevationTextureFromParent(e,r)))return t.instance.notifyChange(e,!1),null;var o=Date.now();if(i||this.frozen||!e.material.visible||!e.layerUpdateState[this.id].canTryUpdate(o))return null;var s=e.material.getElevationTextureInfo(),l=this.getPossibleTextureImprovements(this,e.getExtentForLayer(this),s&&s.texture,e.layerUpdateState[this.id].failureParams);if(!l)return e.layerUpdateState[this.id].noMoreUpdatePossible(),null;e.layerUpdateState[this.id].newTry();var u={view:t.instance,layer:this,requester:e,priority:(0,f.nodeCommandQueuePriorityFunction)(e),earlyDropFunction:f.refinementCommandCancellationFn,toDownload:l};return t.scheduler.execute(u).then((function(t){return null===e.material?null:(Array.isArray(t)&&(t=t[0]),t)}),(function(r){if(r instanceof d.default)e.layerUpdateState[n.id].success();else{console.warn("Elevation texture update error for",e,r);var i=e.layerUpdateState[n.id].errorCount>f.MAX_RETRY;e.layerUpdateState[n.id].failure(Date.now(),i,r),i||window.setTimeout((function(){t.instance.notifyChange(e,!1)}),1e3*e.layerUpdateState[n.id].secondsUntilNextTry())}})).then((function(t){if(t){var r=n.minMaxFromTexture(t.texture,t.pitch),i=r.min,a=r.max;t.min=i,t.max=a,e.setTextureElevation(n,t),e.layerUpdateState[n.id].success()}}))}}],[{key:"colorImageSetup",value:function(t){r||((r=document.createElement("canvas")).width=256,r.height=256);var e=t.image.width,n=t.image.height,i=r.getContext("2d");return r.width=e,r.height=n,i.drawImage(t.image,0,0),{data:i.getImageData(0,0,e,n).data,stride:4*e,h:n}}}]),l}(f.default),_=x;return MS.default=_,MS}var TS,ES,AS={},RS={};function PS(){if(TS)return RS;TS=1;var t=uf;Object.defineProperty(RS,"__esModule",{value:!0}),RS.default=void 0;var e=t(pf()),r=t(yf()),n=t(Cf()),i=t(Df()),a=t(Uf()),o=Bf;function s(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=(0,a.default)(t);if(e){var o=(0,a.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,i.default)(this,r)}}var l=function(t){(0,n.default)(a,t);var i=s(a);function a(t,r){var n;return(0,e.default)(this,a),(n=i.call(this)).box3D=new o.Box3(t.clone(),r.clone()),n.natBox=n.box3D.clone(),n.z={min:0,max:0},n.topPointsWorld=[new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3],n.update(),n}return(0,r.default)(a,[{key:"clone",value:function(){var t=new a(this.natBox.min,this.natBox.max);return t.position.copy(this.position),t.quaternion.copy(this.quaternion),t}},{key:"updateMinMax",value:function(t,e){this.box3D.min.copy(t),this.box3D.max.copy(e),this.natBox.copy(this.box3D),this.update(),this.oPosition.copy(this.position)}},{key:"update",value:function(){this.updateMatrixWorld(!0),this._cPointsWorld(this._points(this.topPointsWorld))}},{key:"updateZ",value:function(t,e){this.z={min:t,max:e},this.box3D.min.z=this.natBox.min.z+t,this.box3D.max.z=this.natBox.max.z+e,this.update()}},{key:"_points",value:function(t){return t[0].set(this.box3D.max.x,this.box3D.max.y,this.box3D.max.z),t[1].set(this.box3D.min.x,this.box3D.max.y,this.box3D.max.z),t[2].set(this.box3D.min.x,this.box3D.min.y,this.box3D.max.z),t[3].set(this.box3D.max.x,this.box3D.min.y,this.box3D.max.z),t.length>4&&(t[4].set(this.box3D.max.x,this.box3D.max.y,this.box3D.min.z),t[5].set(this.box3D.min.x,this.box3D.max.y,this.box3D.min.z),t[6].set(this.box3D.min.x,this.box3D.min.y,this.box3D.min.z),t[7].set(this.box3D.max.x,this.box3D.min.y,this.box3D.min.z)),t}},{key:"_cPointsWorld",value:function(t){for(var e=this.matrixWorld,r=0,n=t.length;r<n;r++)t[r].applyMatrix4(e);return t}}]),a}(o.Object3D);return RS.default=l,RS}var CS,IS={};function LS(){if(CS)return IS;CS=1;var t=uf;Object.defineProperty(IS,"__esModule",{value:!0}),IS.default=void 0;var e=t(Nx());function r(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){l=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}t(jb());var i={cleanup:function(t){t.layer=null,"function"==typeof t.dispose?t.dispose():(t.geometry&&(t.geometry.dispose(),t.geometry=null),t.material&&(t.material.dispose(),t.material=null))},removeChildren:function(t,r){var n=r.children.filter((function(e){return e.layer===t}));return r.remove.apply(r,(0,e.default)(n)),n},removeChildrenAndCleanup:function(t,r){var n=r.children.filter((function(e){return e.layer===t}));return r.layer===t&&this.cleanup(r),r.remove.apply(r,(0,e.default)(n)),n},removeChildrenAndCleanupRecursively:function(t,n){var i,a=n.children.filter((function(e){return e.layer===t})),o=r(a);try{for(o.s();!(i=o.n()).done;){var s=i.value;this.removeChildrenAndCleanupRecursively(t,s)}}catch(t){o.e(t)}finally{o.f()}return n.layer===t&&this.cleanup(n),n.remove.apply(n,(0,e.default)(a)),a}};return IS.default=i,IS}var OS,DS={};function kS(){if(OS)return DS;OS=1,Object.defineProperty(DS,"__esModule",{value:!0}),DS.default=void 0;var t=Bf,e=new t.Matrix4,r=[new t.Vector3,new t.Vector3,new t.Vector3,new t.Vector3,new t.Vector3,new t.Vector3];var n={MODE_2D:1,MODE_3D:2,computeFromBox3:function(n,i,a,o,s){if(!n.camera3D.isOrthographicCamera){var l=function(r,n,i){e.copy(i).invert();var a=new t.Vector3(0,0,0).applyMatrix4(r.camera3D.matrixWorld).applyMatrix4(e);return n.distanceToPoint(a)}(n,i,a);if(l<=o)return null}var u=function(t,e,n){var i=t.getSize(r[5]),a=Math.max(i.x,i.y);return n&&(a=Math.max(a,i.z)),i.multiplyScalar(e/a),i}(i,o,s===this.MODE_3D),c=function(e,n,i,a,o){r[0].copy(e),r[0].applyMatrix4(i),i.extractBasis(r[1],r[2],r[3]),r[1].normalize().multiplyScalar(n.x),r[2].normalize().multiplyScalar(n.y),r[3]=r[1].clone().add(r[2]),o&&r[4].normalize().multiplyScalar(n.z);for(var s=1;s<(o?5:4);s++)r[s].add(r[0]);for(var l=a._viewMatrix,u=0;u<(o?5:4);u++)r[u].applyMatrix4(l),r[u].z=0,r[u].x=(r[u].x+1)*a.width*.5,r[u].y=a.height-(r[u].y+1)*a.height*.5;var c,h=Math.abs(t.ShapeUtils.area([r[0],r[2],r[3],r[1]])),d={origin:r[0].clone(),x:r[1].clone(),y:r[2].clone(),lengths:{},area:h};return d.lengths.x=r[1].sub(r[0]).length(),d.lengths.y=r[2].sub(r[0]).length(),o&&(d.z=r[4].clone(),d.lengths.z=r[4].sub(r[0]).length()),d.ratio=(c=d.area/(d.lengths.x*d.lengths.y))<.5?2*c*c:(4-2*c)*c-1,d}(i.min,u,a,n,s===this.MODE_3D);return c},computeFromSphere:function(t,e,n,i){var a=e.clone().applyMatrix4(n),o=Math.max(0,a.distanceToPoint(t.camera3D.position));return r[0].set(i,0,-o),r[0].applyMatrix4(t.camera3D.projectionMatrix),r[0].x=r[0].x*t.width*.5,r[0].y=r[0].y*t.height*.5,r[0].z=0,r[0].length()},initDebugTool:function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.style.top="0px",e.style.left="0px",e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style.pointerEvents="none",document.getElementById("viewerDiv").appendChild(e),document.addEventListener("click",(function(r){var n=t.tileLayer.pickObjectsAt(t,t.eventToViewCoords(r),1);if(n.length){var i=n[0].object;for(console.log(i);e.firstChild;)e.removeChild(e.firstChild);s(i.sse.origin,i.sse.x,i.sse.lengths.x,"yellow"),s(i.sse.origin,i.sse.y,i.sse.lengths.y,"purple");var a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("cx",i.sse.origin.x.toFixed()),a.setAttribute("cy",i.sse.origin.y.toFixed()),a.setAttribute("r",5),a.setAttribute("stroke","black"),e.append(a);var o=document.createElementNS("http://www.w3.org/2000/svg","text");o.setAttribute("x",(i.sse.origin.x+10).toFixed()),o.setAttribute("y",(i.sse.origin.y-10).toFixed()),o.textContent=i.id,e.append(o)}function s(t,r,n,i){var a=document.createElementNS("http://www.w3.org/2000/svg","line");a.setAttribute("x1",t.x.toFixed()),a.setAttribute("y1",t.y.toFixed()),a.setAttribute("x2",r.x.toFixed()),a.setAttribute("y2",r.y.toFixed()),a.setAttribute("stroke",i),e.append(a);var o=document.createElementNS("http://www.w3.org/2000/svg","text");o.setAttribute("x",(.5*(t.x+r.x)).toFixed()),o.setAttribute("y",(.5*(t.y+r.y)-10).toFixed()),o.setAttribute("stroke",i),o.textContent=n.toFixed(),e.append(o)}}))}};return DS.default=n,DS}var FS,NS,US,BS={};function zS(){if(FS)return BS;FS=1;var t=uf;Object.defineProperty(BS,"__esModule",{value:!0}),BS.default=void 0;var e=t(pf()),r=t(yf()),n=t(Cf()),i=t(Df()),a=t(Uf()),o=Bf;function s(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=(0,a.default)(t);if(e){var o=(0,a.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,i.default)(this,r)}}function l(){this.index=null,this.position=null,this.uv=null}function u(t,e,r,n){t.uv.array[2*e+0]=r,t.uv.array[2*e+1]=n}function c(t,e,r,n,i){return t.index.array[i+0]=e,t.index.array[i+1]=r,t.index.array[i+2]=n,i+3}var h=function(t){(0,n.default)(a,t);var i=s(a);function a(t,r){var n;(0,e.default)(this,a),(n=i.call(this)).center=r.Center(t.extent).clone(),n.extent=t.extent;var o=n.computeBuffers(t,r);return n.setIndex(o.index),n.setAttribute("position",o.position),n.setAttribute("uv",o.uv),n.computeBoundingBox(),n.OBB=r.OBB(n.boundingBox),n}return(0,r.default)(a,[{key:"computeBuffers",value:function(t,e){var r=new l,n=t.segment,i=(n+1)*(n+1);r.position=new o.BufferAttribute(new Float32Array(3*i),3),r.index=new o.BufferAttribute(new Uint32Array(n*n*2*3),1),r.uv=new o.BufferAttribute(new Float32Array(2*i),2);var a=Math.max(2,Math.floor(n)||2),s=Math.max(2,Math.floor(n)||2),h=0,d=[];e.Prepare(t);for(var f=0;f<=s;f++){var p=[],m=f/s;e.vProjecte(m,t);for(var g=0;g<=a;g++){var v=g/a,y=3*h;e.uProjecte(v,t);var x=e.VertexPosition(t,t.projected);x.sub(this.center),x.toArray(r.position.array,y),u(r,h,v,m),p.push(h),h++}d.push(p)}for(var _=0,w=0;w<s;w++)for(var b=0;b<a;b++){var M=d[w][b+1],S=d[w][b],T=d[w+1][b],E=d[w+1][b+1];_=c(r,E,S,M,_),_=c(r,E,T,S,_)}return r}}]),a}(o.BufferGeometry);return BS.default=h,BS}function GS(){if(NS)return bS;NS=1;var t=uf;Object.defineProperty(bS,"__esModule",{value:!0}),bS.Map=void 0,bS.requestNewTile=T;var e=t(pf()),r=t(yf()),n=t(Cf()),i=t(Df()),a=t(Uf()),o=Bf,s=t(Ux()),l=t(DM()),u=t(jb()),c=t(Qb()),h=t(SS()),d=t(oS()),f=t(function(){if(ES)return AS;ES=1;var t=uf;Object.defineProperty(AS,"__esModule",{value:!0}),AS.default=void 0;var e=Bf,r=t(PS()),n=t(Ux()),i=t(DM());function a(){this.tmp={coords:new n.default("EPSG:4326",0,0),position:new e.Vector3},this.type="p"}a.prototype.constructor=a,a.prototype.Prepare=function(t){t.nbRow=Math.pow(2,t.zoom+1),t.projected=new e.Vector3};var o=new e.Vector3;a.prototype.Center=function(t){return t.center(this.tmp.coords),o.set(this.tmp.coords.x(),this.tmp.coords.y(),0),o},a.prototype.VertexPosition=function(t){return this.tmp.position.set(t.projected.x,t.projected.y,0),this.tmp.position},a.prototype.uProjecte=function(t,e){e.projected.x=e.extent.west()+t*(e.extent.east()-e.extent.west())},a.prototype.vProjecte=function(t,e){e.projected.y=e.extent.south()+t*(e.extent.north()-e.extent.south())},a.prototype.OBB=function(t){return new r.default(t.min,t.max)};var s=new e.Quaternion;a.prototype.computeSharableExtent=function(t){var e=t.dimensions();return{sharableExtent:new i.default(t.crs(),.5*-e.x,.5*e.x,.5*-e.y,.5*e.y),quaternion:s,position:this.Center(t).clone()}};var l=a;return AS.default=l,AS}()),p=t(LS()),m=t(WM()),g=t(kS()),v=t(HM()),y=t(NM()),x=t(zS()),_=t(pM());function w(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=(0,a.default)(t);if(e){var o=(0,a.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,i.default)(this,r)}}function b(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return M(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return M(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function M(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function S(t,e,r,n){var i=n*t/r.x,a=n*e/r.y;return{x:1===i?0:Math.floor(i),y:1===a?0:Math.floor(a)}}function T(t,e,r,n){if(r&&!r.material)return null;var i=t.builder;n=void 0===n?r.level+1:n;var a=i.computeSharableExtent(e),s=a.sharableExtent,l=a.quaternion,u=a.position,c=t.segments||8,d="".concat(i.type,"_").concat(c,"_").concat(n,"_").concat(s._values.join(",")),f=_.default.get(d);if(!f){var p={extent:s,level:n,segment:c,disableSkirt:t.disableSkirt};f=new x.default(p,i),_.default.set(d,f),f._count=0,f.dispose=function(){f._count--,0===f._count&&(o.BufferGeometry.prototype.dispose.call(f),_.default.delete(d))}}f._count++;var m=new v.default(t.materialOptions,c,t.atlasInfo),g=new y.default(t,f,m,e,n);if(g.layers.set(t.threejsLayer),void 0!==t.renderOrder&&(g.renderOrder=t.renderOrder),m.opacity=t.opacity,r&&r instanceof y.default){var w=i.computeSharableExtent(r.extent);u.sub(w.position).applyQuaternion(w.quaternion.invert()),l.premultiply(w.quaternion)}if(g.position.copy(u),g.quaternion.copy(l),g.material.transparent=t.opacity<1,g.material.uniforms.opacity.value=t.opacity,g.setVisibility(!1),g.updateMatrix(),t.noTextureColor&&g.material.uniforms.noTextureColor.value.copy(t.noTextureColor),void 0!==t.noTextureOpacity&&(g.material.uniforms.noTextureOpacity.value=t.noTextureOpacity),r)g.setBBoxZ(r.OBB().z.min,r.OBB().z.max);else{var b=t.getLayers((function(t){return t instanceof h.default}));b.length>0&&(b[0].minmax||console.error("fix the provider"),g.setBBoxZ(b[0].minmax.min,b[0].minmax.max))}return g.add(g.OBB()),t.onTileCreated(t,r,g),g}var E=new o.Vector3,A=function(t){(0,n.default)(a,t);var i=w(a);function a(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,e.default)(this,a),r=i.call(this,t,n.object3d||new o.Group);var u=n.extent,c=Array.isArray(u)?u[0].crs():u.crs();if(r.validityExtent=u,"EPSG:3857"===c){var h=function(t){for(var e=new l.default("EPSG:3857",-20037508.342789244,20037508.342789244,-20037508.342789244,20037508.342789244),r=e.dimensions(),n=Math.min(Math.floor(r.x/t.dimensions().x),Math.floor(r.y/t.dimensions().y)),i=Math.floor(Math.max(0,Math.log2(n))),a=new s.default("EPSG:3857",t.west(),t.north()),o=new s.default("EPSG:3857",t.east(),t.south()),u=Math.pow(2,i),c=S(a.x()-e.west(),e.north()-a.y(),r,u),h=S(o.x()-e.west(),e.north()-o.y(),r,u),d=r.x/u,f=r.y/u,p=[],m=c.x;m<=h.x;m++)for(var g=c.y;g<=h.y;g++){var v=e.west()+m*d,y=e.north()-g*f;p.push(new l.default("EPSG:3857",v,v+d,y-f,y))}return p}(u);r.schemeTile=h}else Array.isArray(u)?r.schemeTile=u:r.schemeTile=[u];r.extent=r.schemeTile[0].clone();for(var d=1;d<r.schemeTile.length;d++)r.extent.union(r.schemeTile[d]);return r.sseScale=1.5,r.maxSubdivisionLevel=n.maxSubdivisionLevel||-1,r.disableSkirt=!0,r.builder=new f.default,r.protocol="tile",r.visible=!0,r.lighting={enable:!1,position:{x:-.5,y:0,z:1}},r.currentAddedLayerIds=[],r}return(0,r.default)(a,[{key:"pickObjectsAt",value:function(t,e,r){return m.default.pickTilesAt(t,e,r,this)}},{key:"preUpdate",value:function(t,e){var r,n=this;if(t.colorLayers=t.instance.getLayers((function(t,e){return e&&e.id===n.id&&t instanceof c.default})),t.elevationLayers=t.instance.getLayers((function(t,e){return e&&e.id===n.id&&t instanceof h.default})),e.has(void 0)||0===e.size)return this.level0Nodes;var i,a=b(e.values());try{for(a.s();!(i=a.n()).done;){var o=i.value;if(o.isCamera)return this.level0Nodes;if(o.layer===this.id){if(r){if(!(r=o.findCommonAncestor(r)))return this.level0Nodes}else r=o;null==r.material&&(r=void 0)}}}catch(t){a.e(t)}finally{a.f()}return r?[r]:this.level0Nodes}},{key:"update",value:function(t,e){var r=this;if(!e.parent)return p.default.removeChildrenAndCleanup(this,e);if(t.fastUpdateHint&&!t.fastUpdateHint.isAncestorOf(e))return e.material.visible?(this.updateMinMaxDistance(t,e),null):e.visible?e.children.filter((function(t){return t.layer===r})):null;if(!this.frozen){var n=t.camera.isBox3Visible(e.OBB().box3D,e.OBB().matrixWorld);e.visible=n}if(e.visible){var i=!1;if(this.frozen)i=!0;else{var a=e.OBB().box3D.getSize(E),o=e.OBB(),s=g.default.computeFromBox3(t.camera,o.box3D,o.matrixWorld,Math.max(a.x,a.y),g.default.MODE_2D);e.sse=s,this.testTileSSE(e,s)&&this.hasEnoughTexturesToSubdivide(t,e)?(!function(t,e,r){if(!r.children.some((function(t){return t.layer===e}))){var n,i=b(r.extent.quadtreeSplit());try{for(i.s();!(n=i.n()).done;){var a=n.value,o=T(e,a,r);r.add(o);var s,l=b(e.getElevationLayers());try{for(l.s();!(s=l.n()).done;)s.value.update(t,o,r,!0)}catch(t){l.e(t)}finally{l.f()}if(r.material.uniforms.colorTexture.value.image.width>0){var u,c=b(e.getColorLayers());try{for(c.s();!(u=c.n()).done;)u.value.update(t,o,r,!0)}catch(t){c.e(t)}finally{c.f()}}o.updateMatrixWorld(!0)}}catch(t){i.e(t)}finally{i.f()}t.instance.notifyChange(r)}}(t,this,e),e.setDisplayed(!1),i=!0):e.setDisplayed(!0)}return e.material.visible&&(e.material.update(),this.updateMinMaxDistance(t,e),!i)?p.default.removeChildren(this,e):i?e.children.filter((function(t){return t.layer===r})):void 0}return e.setDisplayed(!1),p.default.removeChildren(this,e)}},{key:"postUpdate",value:function(){var t,e=this,r=b(this.level0Nodes);try{for(r.s();!(t=r.n()).done;){t.value.traverse((function(t){if(t.layer===e&&t.material.visible){t.material.uniforms.neighbourdiffLevel.value.set(0,0,0,1);var r=t.findNeighbours();if(r)for(var n=t.extent.dimensions(),i=t.material.texturesInfo.elevation.neighbours,a=0;a<4;a++)if(r[a]&&r[a][0].material.visible){var o=r[a][0],s=r[a][1],l=Math.log2(a%2?Math.round(o.extent.dimensions().y/n.y):Math.round(o.extent.dimensions().x/n.x));t.material.uniforms.neighbourdiffLevel.value.setComponent(a,-l),i.texture[a]=o.material.texturesInfo.elevation.texture;var u=s.offsetToParent(o.extent);i.offsetScale[a]=o.material.texturesInfo.elevation.offsetScale.clone(),i.offsetScale[a].x+=u.x*i.offsetScale[a].z,i.offsetScale[a].y+=u.y*i.offsetScale[a].w,i.offsetScale[a].z*=u.z,i.offsetScale[a].w*=u.w}else t.material.uniforms.neighbourdiffLevel.value.setComponent(a,1)}}))}}catch(t){r.e(t)}finally{r.f()}}},{key:"addLayer",value:function(t){var e=this;return new Promise((function(r,n){e._instance?t instanceof u.default?e.getLayers((function(e){return e.id===t.id})).length>0||e.currentAddedLayerIds.includes(t.id)?n(new Error("Invalid id '".concat(t.id,"': id already used"))):(e.currentAddedLayerIds.push(t.id),t.extent||(t.extent=e.extent),t.projection||(t.projection=e.projection),(t=t._preprocessLayer(e,e._instance)).whenReady.then((function(t){e.attach(t),e._instance.notifyChange(e,!1),r(t)})).catch((function(t){n(t)})).then((function(){e.currentAddedLayerIds=e.currentAddedLayerIds.filter((function(e){return e!==t.id}))}))):n(new Error("layer is not an instance of Layer")):n(new Error("map is not attached to an instance"))}))}},{key:"removeLayer",value:function(t){t.object3d&&(p.default.removeChildrenAndCleanupRecursively(t,t.object3d),this.scene.remove(t.object3d));var e=this.getLayers((function(e){return e._attachedLayers&&e._attachedLayers.includes(t)}))[0];e&&e.detach(t),this._cleanLayer(t),this.notifyChange(e||this._instance.camera.camera3D,!0)}},{key:"getLayers",value:function(t){var e,r=[],n=b(this._attachedLayers);try{for(n.s();!(e=n.n()).done;){var i=e.value;t&&!t(i)||r.push(i)}}catch(t){n.e(t)}finally{n.f()}return r}},{key:"getColorLayers",value:function(){return this.getLayers((function(t){return t instanceof c.default}))}},{key:"getElevationLayers",value:function(){return this.getLayers((function(t){return t instanceof h.default}))}},{key:"clean",value:function(){var t,e=b(this.getLayers());try{for(e.s();!(t=e.n()).done;){t.value.clean(this)}}catch(t){e.e(t)}finally{e.f()}}},{key:"hasEnoughTexturesToSubdivide",value:function(t,e){var r,n=this,i=b(t.elevationLayers);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(!a.frozen&&a.ready&&a.tileInsideLimit(e,a)&&!e.material.isElevationLayerTextureLoaded(a)){if(e.layerUpdateState[a.id]&&e.layerUpdateState[a.id].inError())continue;return!1}}}catch(t){i.e(t)}finally{i.f()}return e.children.some((function(t){return t.layer===n})),!0}},{key:"testTileSSE",value:function(t,e){if(this.maxSubdivisionLevel>0&&this.maxSubdivisionLevel<=t.level)return!1;if(t.extent.dimensions().x<5)return!1;if(!e)return!0;var r=[e.lengths.x*e.ratio,e.lengths.y*e.ratio];return!(r.filter((function(e){return e<100*t.layer.sseScale})).length>=1)&&r.filter((function(e){return e>=384*t.layer.sseScale})).length>=2}},{key:"updateMinMaxDistance",value:function(t,e){var r=e.OBB().box3D.clone().applyMatrix4(e.OBB().matrixWorld),n=t.distance.plane.distanceToPoint(r.getCenter(E)),i=.5*r.getSize(E).length();this._distance.min=Math.min(this._distance.min,n-i),this._distance.max=Math.max(this._distance.max,n+i)}}]),a}(d.default);return bS.Map=A,bS}function jS(){if(US)return wS;US=1,Object.defineProperty(wS,"__esModule",{value:!0}),wS.default=void 0;var t=GS();function e(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){l=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var n={preprocessDataLayer:function(r){if(!r.schemeTile)throw new Error("Cannot init tiled layer without schemeTile for layer ".concat(r.id));r.level0Nodes=[],r.onTileCreated=r.onTileCreated||function(){};var n,i=[],a=e(r.schemeTile);try{for(a.s();!(n=a.n()).done;){var o=n.value;i.push((0,t.requestNewTile)(r,o,void 0,0))}}catch(t){a.e(t)}finally{a.f()}return Promise.all(i).then((function(t){r.level0Nodes=t;var n,i=e(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;r.object3d.add(a),a.updateMatrixWorld()}}catch(t){i.e(t)}finally{i.f()}}))},executeCommand:function(){}};return wS.default=n,wS}var VS={},HS={};function WS(){let t={};return{get:function(e){return t[e]},add:function(e,r){t[e]=r},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const qS={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class XS{constructor(t){this.parser=t,this.name=qS.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let r=0,n=e.length;r<n;r++){const n=e[r];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&t._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(t){const e=this.parser,r="light:"+t;let n=e.cache.get(r);if(n)return n;const i=e.json,a=((i.extensions&&i.extensions[this.name]||{}).lights||[])[t];let o;const s=new Xn(16777215);void 0!==a.color&&s.fromArray(a.color);const l=void 0!==a.range?a.range:0;switch(a.type){case"directional":o=new bh(s),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new _h(s),o.distance=l;break;case"spot":o=new mh(s),o.distance=l,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,o.angle=a.spot.outerConeAngle,o.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return o.position.set(0,0,0),o.decay=2,void 0!==a.intensity&&(o.intensity=a.intensity),o.name=e.createUniqueName(a.name||"light_"+t),n=Promise.resolve(o),e.cache.add(r,n),n}createNodeAttachment(t){const e=this,r=this.parser,n=r.json.nodes[t],i=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(t){return r._getNodeRef(e.cache,i,t)}))}}class YS{constructor(){this.name=qS.KHR_MATERIALS_UNLIT}getMaterialType(){return Yn}extendParams(t,e,r){const n=[];t.color=new Xn(1,1,1),t.opacity=1;const i=e.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const e=i.baseColorFactor;t.color.fromArray(e),t.opacity=e[3]}void 0!==i.baseColorTexture&&n.push(r.assignTexture(t,"map",i.baseColorTexture))}return Promise.all(n)}}class ZS{constructor(t){this.parser=t,this.name=qS.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Pc:null}extendMaterialParams(t,e){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],a=n.extensions[this.name];if(void 0!==a.clearcoatFactor&&(e.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&i.push(r.assignTexture(e,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(e.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&i.push(r.assignTexture(e,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(i.push(r.assignTexture(e,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){const t=a.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new sr(t,t)}return Promise.all(i)}}class KS{constructor(t){this.parser=t,this.name=qS.KHR_MATERIALS_SHEEN}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Pc:null}extendMaterialParams(t,e){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[];e.sheenColor=new Xn(0,0,0),e.sheenRoughness=0,e.sheen=1;const a=n.extensions[this.name];return void 0!==a.sheenColorFactor&&e.sheenColor.fromArray(a.sheenColorFactor),void 0!==a.sheenRoughnessFactor&&(e.sheenRoughness=a.sheenRoughnessFactor),void 0!==a.sheenColorTexture&&i.push(r.assignTexture(e,"sheenColorMap",a.sheenColorTexture)),void 0!==a.sheenRoughnessTexture&&i.push(r.assignTexture(e,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(i)}}class JS{constructor(t){this.parser=t,this.name=qS.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Pc:null}extendMaterialParams(t,e){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],a=n.extensions[this.name];return void 0!==a.transmissionFactor&&(e.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&i.push(r.assignTexture(e,"transmissionMap",a.transmissionTexture)),Promise.all(i)}}class QS{constructor(t){this.parser=t,this.name=qS.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Pc:null}extendMaterialParams(t,e){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],a=n.extensions[this.name];e.thickness=void 0!==a.thicknessFactor?a.thicknessFactor:0,void 0!==a.thicknessTexture&&i.push(r.assignTexture(e,"thicknessMap",a.thicknessTexture)),e.attenuationDistance=a.attenuationDistance||0;const o=a.attenuationColor||[1,1,1];return e.attenuationColor=new Xn(o[0],o[1],o[2]),Promise.all(i)}}class $S{constructor(t){this.parser=t,this.name=qS.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Pc:null}extendMaterialParams(t,e){const r=this.parser.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=r.extensions[this.name];return e.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class tT{constructor(t){this.parser=t,this.name=qS.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Pc:null}extendMaterialParams(t,e){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],a=n.extensions[this.name];e.specularIntensity=void 0!==a.specularFactor?a.specularFactor:1,void 0!==a.specularTexture&&i.push(r.assignTexture(e,"specularIntensityMap",a.specularTexture));const o=a.specularColorFactor||[1,1,1];return e.specularColor=new Xn(o[0],o[1],o[2]),void 0!==a.specularColorTexture&&i.push(r.assignTexture(e,"specularColorMap",a.specularColorTexture).then((function(t){t.encoding=ke}))),Promise.all(i)}}class eT{constructor(t){this.parser=t,this.name=qS.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,r=e.json,n=r.textures[t];if(!n.extensions||!n.extensions[this.name])return null;const i=n.extensions[this.name],a=r.images[i.source],o=e.options.ktx2Loader;if(!o){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,a,o)}}class rT{constructor(t){this.parser=t,this.name=qS.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,r=this.parser,n=r.json,i=n.textures[t];if(!i.extensions||!i.extensions[e])return null;const a=i.extensions[e],o=n.images[a.source];let s=r.textureLoader;if(o.uri){const t=r.options.manager.getHandler(o.uri);null!==t&&(s=t)}return this.detectSupport().then((function(i){if(i)return r.loadTextureImage(t,o,s);if(n.extensionsRequired&&n.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}}class nT{constructor(t){this.name=qS.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,r=e.bufferViews[t];if(r.extensions&&r.extensions[this.name]){const t=r.extensions[this.name],n=this.parser.getDependency("buffer",t.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([n,i.ready]).then((function(e){const r=t.byteOffset||0,n=t.byteLength||0,a=t.count,o=t.byteStride,s=new ArrayBuffer(a*o),l=new Uint8Array(e[0],r,n);return i.decodeGltfBuffer(new Uint8Array(s),a,o,l,t.mode,t.filter),s}))}return null}}const iT="glTF",aT=1313821514,oT=5130562;class sT{constructor(t){this.name=qS.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,12);if(this.header={magic:Rh.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==iT)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,n=new DataView(t,12);let i=0;for(;i<r;){const e=n.getUint32(i,!0);i+=4;const r=n.getUint32(i,!0);if(i+=4,r===aT){const r=new Uint8Array(t,12+i,e);this.content=Rh.decodeText(r)}else if(r===oT){const r=12+i;this.body=t.slice(r,r+e)}i+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class lT{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=qS.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const r=this.json,n=this.dracoLoader,i=t.extensions[this.name].bufferView,a=t.extensions[this.name].attributes,o={},s={},l={};for(const t in a){const e=AT[t]||t.toLowerCase();o[e]=a[t]}for(const e in t.attributes){const n=AT[e]||e.toLowerCase();if(void 0!==a[e]){const i=r.accessors[t.attributes[e]],a=MT[i.componentType];l[n]=a,s[n]=!0===i.normalized}}return e.getDependency("bufferView",i).then((function(t){return new Promise((function(e){n.decodeDracoFile(t,(function(t){for(const e in t.attributes){const r=t.attributes[e],n=s[e];void 0!==n&&(r.normalized=n)}e(t)}),o,l)}))}))}}class uT{constructor(){this.name=qS.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===e.offset&&void 0===e.rotation&&void 0===e.scale||(t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class cT extends Rc{constructor(t){super(),this.isGLTFSpecularGlossinessMaterial=!0;const e=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),r=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),o={specular:{value:(new Xn).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(t){for(const e in o)t.uniforms[e]=o[e];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",e).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",i).replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(t){o.specular.value=t}},specularMap:{get:function(){return o.specularMap.value},set:function(t){o.specularMap.value=t,t?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return o.glossiness.value},set:function(t){o.glossiness.value=t}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(t){o.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}copy(t){return super.copy(t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class hT{constructor(){this.name=qS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return cT}extendParams(t,e,r){const n=e.extensions[this.name];t.color=new Xn(1,1,1),t.opacity=1;const i=[];if(Array.isArray(n.diffuseFactor)){const e=n.diffuseFactor;t.color.fromArray(e),t.opacity=e[3]}if(void 0!==n.diffuseTexture&&i.push(r.assignTexture(t,"map",n.diffuseTexture)),t.emissive=new Xn(0,0,0),t.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,t.specular=new Xn(1,1,1),Array.isArray(n.specularFactor)&&t.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){const e=n.specularGlossinessTexture;i.push(r.assignTexture(t,"glossinessMap",e)),i.push(r.assignTexture(t,"specularMap",e))}return Promise.all(i)}createMaterial(t){const e=new cT(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=je,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}}class dT{constructor(){this.name=qS.KHR_MESH_QUANTIZATION}}class fT extends Uc{constructor(t,e,r,n){super(t,e,r,n)}copySampleValue_(t){const e=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=t*n*3+n;for(let t=0;t!==n;t++)e[t]=r[i+t];return e}}fT.prototype.beforeStart_=fT.prototype.copySampleValue_,fT.prototype.afterEnd_=fT.prototype.copySampleValue_,fT.prototype.interpolate_=function(t,e,r,n){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,u=n-e,c=(r-e)/u,h=c*c,d=h*c,f=t*l,p=f-l,m=-2*d+3*h,g=d-h,v=1-m,y=g-h+c;for(let t=0;t!==o;t++){const e=a[p+t+o],r=a[p+t+s]*u,n=a[f+t+o],l=a[f+t]*u;i[t]=v*e+y*r+m*n+g*l}return i};const pT=new Mr;class mT extends fT{interpolate_(t,e,r,n){const i=super.interpolate_(t,e,r,n);return pT.fromArray(i).normalize().toArray(i),i}}const gT=0,vT=1,yT=2,xT=3,_T=4,wT=5,bT=6,MT={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ST={9728:st,9729:ct,9984:lt,9985:ht,9986:ut,9987:dt},TT={33071:at,33648:ot,10497:it},ET={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},AT={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},RT={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},PT={CUBICSPLINE:void 0,LINEAR:Ee,STEP:Te},CT="OPAQUE",IT="MASK",LT="BLEND";function OT(t,e,r){for(const n in r.extensions)void 0===t[n]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=r.extensions[n])}function DT(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function kT(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let r=0,n=e.weights.length;r<n;r++)t.morphTargetInfluences[r]=e.weights[r];if(e.extras&&Array.isArray(e.extras.targetNames)){const r=e.extras.targetNames;if(t.morphTargetInfluences.length===r.length){t.morphTargetDictionary={};for(let e=0,n=r.length;e<n;e++)t.morphTargetDictionary[r[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function FT(t){const e=t.extensions&&t.extensions[qS.KHR_DRACO_MESH_COMPRESSION];let r;return r=e?"draco:"+e.bufferView+":"+e.indices+":"+NT(e.attributes):t.indices+":"+NT(t.attributes)+":"+t.mode,r}function NT(t){let e="";const r=Object.keys(t).sort();for(let n=0,i=r.length;n<i;n++)e+=r[n]+":"+t[r[n]]+";";return e}function UT(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class BT{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new WS,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new Dh(this.options.manager):this.textureLoader=new sh(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new nh(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const r=this,n=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all(this._invokeAll((function(t){return t.beforeRoot&&t.beforeRoot()}))).then((function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])})).then((function(e){const a={scene:e[0][n.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:n.asset,parser:r,userData:{}};OT(i,a,n),DT(a,n),Promise.all(r._invokeAll((function(t){return t.afterRoot&&t.afterRoot(a)}))).then((function(){t(a)}))})).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],r=this.json.meshes||[];for(let r=0,n=e.length;r<n;r++){const n=e[r].joints;for(let e=0,r=n.length;e<r;e++)t[n[e]].isBone=!0}for(let e=0,n=t.length;e<n;e++){const n=t[e];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(r[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,r){if(t.refs[e]<=1)return r;const n=r.clone(),i=(t,e)=>{const r=this.associations.get(t);null!=r&&this.associations.set(e,r);for(const[r,n]of t.children.entries())i(n,e.children[r])};return i(r,n),n.name+="_instance_"+t.uses[e]++,n}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let r=0;r<e.length;r++){const n=t(e[r]);if(n)return n}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const r=[];for(let n=0;n<e.length;n++){const i=t(e[n]);i&&r.push(i)}return r}getDependency(t,e){const r=t+":"+e;let n=this.cache.get(r);if(!n){switch(t){case"scene":n=this.loadScene(e);break;case"node":n=this.loadNode(e);break;case"mesh":n=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":n=this.loadAccessor(e);break;case"bufferView":n=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":n=this.loadBuffer(e);break;case"material":n=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":n=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":n=this.loadSkin(e);break;case"animation":n=this.loadAnimation(e);break;case"camera":n=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(r,n)}return n}getDependencies(t){let e=this.cache.get(t);if(!e){const r=this,n=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(n.map((function(e,n){return r.getDependency(t,n)}))),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],r=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[qS.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(t,i){r.load(Rh.resolveURL(e.uri,n.path),t,void 0,(function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){const r=e.byteLength||0,n=e.byteOffset||0;return t.slice(n,n+r)}))}loadAccessor(t){const e=this,r=this.json,n=this.json.accessors[t];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);const i=[];return void 0!==n.bufferView?i.push(this.getDependency("bufferView",n.bufferView)):i.push(null),void 0!==n.sparse&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then((function(t){const i=t[0],a=ET[n.type],o=MT[n.componentType],s=o.BYTES_PER_ELEMENT,l=s*a,u=n.byteOffset||0,c=void 0!==n.bufferView?r.bufferViews[n.bufferView].byteStride:void 0,h=!0===n.normalized;let d,f;if(c&&c!==l){const t=Math.floor(u/c),r="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+t+":"+n.count;let l=e.cache.get(r);l||(d=new o(i,t*c,n.count*c/s),l=new $s(d,c/s),e.cache.add(r,l)),f=new el(l,a,u%c/s,h)}else d=null===i?new o(n.count*a):new o(i,u,n.count*a),f=new Jn(d,a,h);if(void 0!==n.sparse){const e=ET.SCALAR,r=MT[n.sparse.indices.componentType],s=n.sparse.indices.byteOffset||0,l=n.sparse.values.byteOffset||0,u=new r(t[1],s,n.sparse.count*e),c=new o(t[2],l,n.sparse.count*a);null!==i&&(f=new Jn(f.array.slice(),f.itemSize,f.normalized));for(let t=0,e=u.length;t<e;t++){const e=u[t];if(f.setX(e,c[t*a]),a>=2&&f.setY(e,c[t*a+1]),a>=3&&f.setZ(e,c[t*a+2]),a>=4&&f.setW(e,c[t*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return f}))}loadTexture(t){const e=this.json,r=this.options,n=e.textures[t],i=e.images[n.source];let a=this.textureLoader;if(i.uri){const t=r.manager.getHandler(i.uri);null!==t&&(a=t)}return this.loadTextureImage(t,i,a)}loadTextureImage(t,e,r){const n=this,i=this.json,a=this.options,o=i.textures[t],s=(e.uri||e.bufferView)+":"+o.sampler;if(this.textureCache[s])return this.textureCache[s];const l=self.URL||self.webkitURL;let u=e.uri||"",c=!1;if(void 0!==e.bufferView)u=n.getDependency("bufferView",e.bufferView).then((function(t){c=!0;const r=new Blob([t],{type:e.mimeType});return u=l.createObjectURL(r),u}));else if(void 0===e.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const h=Promise.resolve(u).then((function(t){return new Promise((function(e,n){let i=e;!0===r.isImageBitmapLoader&&(i=function(t){const r=new vr(t);r.needsUpdate=!0,e(r)}),r.load(Rh.resolveURL(t,a.path),i,void 0,n)}))})).then((function(e){!0===c&&l.revokeObjectURL(u),e.flipY=!1,o.name&&(e.name=o.name);const r=(i.samplers||{})[o.sampler]||{};return e.magFilter=ST[r.magFilter]||ct,e.minFilter=ST[r.minFilter]||dt,e.wrapS=TT[r.wrapS]||it,e.wrapT=TT[r.wrapT]||it,n.associations.set(e,{textures:t}),e})).catch((function(){return console.error("THREE.GLTFLoader: Couldn't load texture",u),null}));return this.textureCache[s]=h,h}assignTexture(t,e,r){const n=this;return this.getDependency("texture",r.index).then((function(i){if(void 0===r.texCoord||0==r.texCoord||"aoMap"===e&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+e+" not yet supported."),n.extensions[qS.KHR_TEXTURE_TRANSFORM]){const t=void 0!==r.extensions?r.extensions[qS.KHR_TEXTURE_TRANSFORM]:void 0;if(t){const e=n.associations.get(i);i=n.extensions[qS.KHR_TEXTURE_TRANSFORM].extendTexture(i,t),n.associations.set(i,e)}}return t[e]=i,i}))}assignFinalMaterial(t){const e=t.geometry;let r=t.material;const n=void 0===e.attributes.tangent,i=void 0!==e.attributes.color,a=void 0===e.attributes.normal;if(t.isPoints){const t="PointsMaterial:"+r.uuid;let e=this.cache.get(t);e||(e=new Zl,zn.prototype.copy.call(e,r),e.color.copy(r.color),e.map=r.map,e.sizeAttenuation=!1,this.cache.add(t,e)),r=e}else if(t.isLine){const t="LineBasicMaterial:"+r.uuid;let e=this.cache.get(t);e||(e=new Ul,zn.prototype.copy.call(e,r),e.color.copy(r.color),this.cache.add(t,e)),r=e}if(n||i||a){let t="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(t+="specular-glossiness:"),n&&(t+="derivative-tangents:"),i&&(t+="vertex-colors:"),a&&(t+="flat-shading:");let e=this.cache.get(t);e||(e=r.clone(),i&&(e.vertexColors=!0),a&&(e.flatShading=!0),n&&(e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(r))),r=e}r.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),t.material=r}getMaterialType(){return Rc}loadMaterial(t){const e=this,r=this.json,n=this.extensions,i=r.materials[t];let a;const o={},s=i.extensions||{},l=[];if(s[qS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const t=n[qS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];a=t.getMaterialType(),l.push(t.extendParams(o,i,e))}else if(s[qS.KHR_MATERIALS_UNLIT]){const t=n[qS.KHR_MATERIALS_UNLIT];a=t.getMaterialType(),l.push(t.extendParams(o,i,e))}else{const r=i.pbrMetallicRoughness||{};if(o.color=new Xn(1,1,1),o.opacity=1,Array.isArray(r.baseColorFactor)){const t=r.baseColorFactor;o.color.fromArray(t),o.opacity=t[3]}void 0!==r.baseColorTexture&&l.push(e.assignTexture(o,"map",r.baseColorTexture)),o.metalness=void 0!==r.metallicFactor?r.metallicFactor:1,o.roughness=void 0!==r.roughnessFactor?r.roughnessFactor:1,void 0!==r.metallicRoughnessTexture&&(l.push(e.assignTexture(o,"metalnessMap",r.metallicRoughnessTexture)),l.push(e.assignTexture(o,"roughnessMap",r.metallicRoughnessTexture))),a=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),l.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,o)}))))}!0===i.doubleSided&&(o.side=h);const u=i.alphaMode||CT;if(u===LT?(o.transparent=!0,o.depthWrite=!1):(o.format=Et,o.transparent=!1,u===IT&&(o.alphaTest=void 0!==i.alphaCutoff?i.alphaCutoff:.5)),void 0!==i.normalTexture&&a!==Yn&&(l.push(e.assignTexture(o,"normalMap",i.normalTexture)),o.normalScale=new sr(1,1),void 0!==i.normalTexture.scale)){const t=i.normalTexture.scale;o.normalScale.set(t,t)}return void 0!==i.occlusionTexture&&a!==Yn&&(l.push(e.assignTexture(o,"aoMap",i.occlusionTexture)),void 0!==i.occlusionTexture.strength&&(o.aoMapIntensity=i.occlusionTexture.strength)),void 0!==i.emissiveFactor&&a!==Yn&&(o.emissive=(new Xn).fromArray(i.emissiveFactor)),void 0!==i.emissiveTexture&&a!==Yn&&l.push(e.assignTexture(o,"emissiveMap",i.emissiveTexture)),Promise.all(l).then((function(){let r;return r=a===cT?n[qS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new a(o),i.name&&(r.name=i.name),r.map&&(r.map.encoding=ke),r.emissiveMap&&(r.emissiveMap.encoding=ke),DT(r,i),e.associations.set(r,{materials:t}),i.extensions&&OT(n,r,i),r}))}createUniqueName(t){const e=dd.sanitizeNodeName(t||"");let r=e;for(let t=1;this.nodeNamesUsed[r];++t)r=e+"_"+t;return this.nodeNamesUsed[r]=!0,r}loadGeometries(t){const e=this,r=this.extensions,n=this.primitiveCache;function i(t){return r[qS.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(r){return GT(r,t,e)}))}const a=[];for(let r=0,o=t.length;r<o;r++){const o=t[r],s=FT(o),l=n[s];if(l)a.push(l.promise);else{let t;t=o.extensions&&o.extensions[qS.KHR_DRACO_MESH_COMPRESSION]?i(o):GT(new mi,o,e),n[s]={primitive:o,promise:t},a.push(t)}}return Promise.all(a)}loadMesh(t){const e=this,r=this.json,n=this.extensions,i=r.meshes[t],a=i.primitives,o=[];for(let t=0,e=a.length;t<e;t++){const e=void 0===a[t].material?(void 0===(s=this.cache).DefaultMaterial&&(s.DefaultMaterial=new Rc({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:u})),s.DefaultMaterial):this.getDependency("material",a[t].material);o.push(e)}var s;return o.push(e.loadGeometries(a)),Promise.all(o).then((function(r){const o=r.slice(0,r.length-1),s=r[r.length-1],l=[];for(let r=0,u=s.length;r<u;r++){const u=s[r],c=a[r];let h;const d=o[r];if(c.mode===_T||c.mode===wT||c.mode===bT||void 0===c.mode)h=!0===i.isSkinnedMesh?new El(u,d):new Oi(u,d),!0!==h.isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),c.mode===wT?h.geometry=jT(h.geometry,1):c.mode===bT&&(h.geometry=jT(h.geometry,Oe));else if(c.mode===vT)h=new Xl(u,d);else if(c.mode===xT)h=new Hl(u,d);else if(c.mode===yT)h=new Yl(u,d);else{if(c.mode!==gT)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);h=new tu(u,d)}Object.keys(h.geometry.morphAttributes).length>0&&kT(h,i),h.name=e.createUniqueName(i.name||"mesh_"+t),DT(h,i),c.extensions&&OT(n,h,c),e.assignFinalMaterial(h),l.push(h)}for(let r=0,n=l.length;r<n;r++)e.associations.set(l[r],{meshes:t,primitives:r});if(1===l.length)return l[0];const u=new js;e.associations.set(u,{meshes:t});for(let t=0,e=l.length;t<e;t++)u.add(l[t]);return u}))}loadCamera(t){let e;const r=this.json.cameras[t],n=r[r.type];if(n)return"perspective"===r.type?e=new Gi(or.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===r.type&&(e=new ha(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),r.name&&(e.name=this.createUniqueName(r.name)),DT(e,r),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(t){const e=this.json.skins[t],r={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",e.inverseBindMatrices).then((function(t){return r.inverseBindMatrices=t,r}))}loadAnimation(t){const e=this.json.animations[t],r=[],n=[],i=[],a=[],o=[];for(let t=0,s=e.channels.length;t<s;t++){const s=e.channels[t],l=e.samplers[s.sampler],u=s.target,c=void 0!==u.node?u.node:u.id,h=void 0!==e.parameters?e.parameters[l.input]:l.input,d=void 0!==e.parameters?e.parameters[l.output]:l.output;r.push(this.getDependency("node",c)),n.push(this.getDependency("accessor",h)),i.push(this.getDependency("accessor",d)),a.push(l),o.push(u)}return Promise.all([Promise.all(r),Promise.all(n),Promise.all(i),Promise.all(a),Promise.all(o)]).then((function(r){const n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],l=[];for(let t=0,e=n.length;t<e;t++){const e=n[t],r=i[t],u=a[t],c=o[t],h=s[t];if(void 0===e)continue;let d;switch(e.updateMatrix(),e.matrixAutoUpdate=!0,RT[h.path]){case RT.weights:d=Wc;break;case RT.rotation:d=Xc;break;default:d=Zc}const f=e.name?e.name:e.uuid,p=void 0!==c.interpolation?PT[c.interpolation]:Ee,m=[];RT[h.path]===RT.weights?e.traverse((function(t){t.morphTargetInfluences&&m.push(t.name?t.name:t.uuid)})):m.push(f);let g=u.array;if(u.normalized){const t=UT(g.constructor),e=new Float32Array(g.length);for(let r=0,n=g.length;r<n;r++)e[r]=g[r]*t;g=e}for(let t=0,e=m.length;t<e;t++){const e=new d(m[t]+"."+RT[h.path],r.array,g,p);"CUBICSPLINE"===c.interpolation&&(e.createInterpolant=function(t){return new(this instanceof Xc?mT:fT)(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(e)}}const u=e.name?e.name:"animation_"+t;return new Kc(u,void 0,l)}))}createNodeMesh(t){const e=this.json,r=this,n=e.nodes[t];return void 0===n.mesh?null:r.getDependency("mesh",n.mesh).then((function(t){const e=r._getNodeRef(r.meshCache,n.mesh,t);return void 0!==n.weights&&e.traverse((function(t){if(t.isMesh)for(let e=0,r=n.weights.length;e<r;e++)t.morphTargetInfluences[e]=n.weights[e]})),e}))}loadNode(t){const e=this.json,r=this.extensions,n=this,i=e.nodes[t],a=i.name?n.createUniqueName(i.name):"";return function(){const e=[],r=n._invokeOne((function(e){return e.createNodeMesh&&e.createNodeMesh(t)}));return r&&e.push(r),void 0!==i.camera&&e.push(n.getDependency("camera",i.camera).then((function(t){return n._getNodeRef(n.cameraCache,i.camera,t)}))),n._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){e.push(t)})),Promise.all(e)}().then((function(e){let o;if(o=!0===i.isBone?new Al:e.length>1?new js:1===e.length?e[0]:new An,o!==e[0])for(let t=0,r=e.length;t<r;t++)o.add(e[t]);if(i.name&&(o.userData.name=i.name,o.name=a),DT(o,i),i.extensions&&OT(r,o,i),void 0!==i.matrix){const t=new en;t.fromArray(i.matrix),o.applyMatrix4(t)}else void 0!==i.translation&&o.position.fromArray(i.translation),void 0!==i.rotation&&o.quaternion.fromArray(i.rotation),void 0!==i.scale&&o.scale.fromArray(i.scale);return n.associations.has(o)||n.associations.set(o,{}),n.associations.get(o).nodes=t,o}))}loadScene(t){const e=this.json,r=this.extensions,n=this.json.scenes[t],i=this,a=new js;n.name&&(a.name=i.createUniqueName(n.name)),DT(a,n),n.extensions&&OT(r,a,n);const o=n.nodes||[],s=[];for(let t=0,r=o.length;t<r;t++)s.push(zT(o[t],a,e,i));return Promise.all(s).then((function(){return i.associations=(t=>{const e=new Map;for(const[t,r]of i.associations)(t instanceof zn||t instanceof vr)&&e.set(t,r);return t.traverse((t=>{const r=i.associations.get(t);null!=r&&e.set(t,r)})),e})(a),a}))}}function zT(t,e,r,n){const i=r.nodes[t];return n.getDependency("node",t).then((function(t){if(void 0===i.skin)return t;let e;return n.getDependency("skin",i.skin).then((function(t){e=t;const r=[];for(let t=0,i=e.joints.length;t<i;t++)r.push(n.getDependency("node",e.joints[t]));return Promise.all(r)})).then((function(r){return t.traverse((function(t){if(!t.isMesh)return;const n=[],i=[];for(let t=0,a=r.length;t<a;t++){const a=r[t];if(a){n.push(a);const r=new en;void 0!==e.inverseBindMatrices&&r.fromArray(e.inverseBindMatrices.array,16*t),i.push(r)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[t])}t.bind(new Il(n,i),t.matrixWorld)})),t}))})).then((function(t){e.add(t);const a=[];if(i.children){const e=i.children;for(let i=0,o=e.length;i<o;i++){const o=e[i];a.push(zT(o,t,r,n))}}return Promise.all(a)}))}function GT(t,e,r){const n=e.attributes,i=[];function a(e,n){return r.getDependency("accessor",e).then((function(e){t.setAttribute(n,e)}))}for(const e in n){const r=AT[e]||e.toLowerCase();r in t.attributes||i.push(a(n[e],r))}if(void 0!==e.indices&&!t.index){const n=r.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));i.push(n)}return DT(t,e),function(t,e,r){const n=e.attributes,i=new Ar;if(void 0===n.POSITION)return;{const t=r.json.accessors[n.POSITION],e=t.min,a=t.max;if(void 0===e||void 0===a)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(i.set(new Sr(e[0],e[1],e[2]),new Sr(a[0],a[1],a[2])),t.normalized){const e=UT(MT[t.componentType]);i.min.multiplyScalar(e),i.max.multiplyScalar(e)}}const a=e.targets;if(void 0!==a){const t=new Sr,e=new Sr;for(let n=0,i=a.length;n<i;n++){const i=a[n];if(void 0!==i.POSITION){const n=r.json.accessors[i.POSITION],a=n.min,o=n.max;if(void 0!==a&&void 0!==o){if(e.setX(Math.max(Math.abs(a[0]),Math.abs(o[0]))),e.setY(Math.max(Math.abs(a[1]),Math.abs(o[1]))),e.setZ(Math.max(Math.abs(a[2]),Math.abs(o[2]))),n.normalized){const t=UT(MT[n.componentType]);e.multiplyScalar(t)}t.max(e)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(t)}t.boundingBox=i;const o=new qr;i.getCenter(o.center),o.radius=i.min.distanceTo(i.max)/2,t.boundingSphere=o}(t,e,r),Promise.all(i).then((function(){return void 0!==e.targets?function(t,e,r){let n=!1,i=!1;for(let t=0,r=e.length;t<r;t++){const r=e[t];if(void 0!==r.POSITION&&(n=!0),void 0!==r.NORMAL&&(i=!0),n&&i)break}if(!n&&!i)return Promise.resolve(t);const a=[],o=[];for(let s=0,l=e.length;s<l;s++){const l=e[s];if(n){const e=void 0!==l.POSITION?r.getDependency("accessor",l.POSITION):t.attributes.position;a.push(e)}if(i){const e=void 0!==l.NORMAL?r.getDependency("accessor",l.NORMAL):t.attributes.normal;o.push(e)}}return Promise.all([Promise.all(a),Promise.all(o)]).then((function(e){const r=e[0],a=e[1];return n&&(t.morphAttributes.position=r),i&&(t.morphAttributes.normal=a),t.morphTargetsRelative=!0,t}))}(t,e.targets,r):t}))}function jT(t,e){let r=t.getIndex();if(null===r){const e=[],n=t.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<n.count;t++)e.push(t);t.setIndex(e),r=t.getIndex()}const n=r.count-2,i=[];if(e===Oe)for(let t=1;t<=n;t++)i.push(r.getX(0)),i.push(r.getX(t)),i.push(r.getX(t+1));else for(let t=0;t<n;t++)t%2==0?(i.push(r.getX(t)),i.push(r.getX(t+1)),i.push(r.getX(t+2))):(i.push(r.getX(t+2)),i.push(r.getX(t+1)),i.push(r.getX(t)));i.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=t.clone();return a.setIndex(i),a}const VT=of(Object.freeze(Object.defineProperty({__proto__:null,GLTFLoader:class extends eh{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(t){return new ZS(t)})),this.register((function(t){return new eT(t)})),this.register((function(t){return new rT(t)})),this.register((function(t){return new KS(t)})),this.register((function(t){return new JS(t)})),this.register((function(t){return new QS(t)})),this.register((function(t){return new $S(t)})),this.register((function(t){return new tT(t)})),this.register((function(t){return new XS(t)})),this.register((function(t){return new nT(t)}))}load(t,e,r,n){const i=this;let a;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:Rh.extractUrlBase(t),this.manager.itemStart(t);const o=function(e){n?n(e):console.error(e),i.manager.itemError(t),i.manager.itemEnd(t)},s=new nh(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(r){try{i.parse(r,a,(function(r){e(r),i.manager.itemEnd(t)}),o)}catch(t){o(t)}}),r,o)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,r,n){let i;const a={},o={};if("string"==typeof t)i=t;else{if(Rh.decodeText(new Uint8Array(t,0,4))===iT){try{a[qS.KHR_BINARY_GLTF]=new sT(t)}catch(t){return void(n&&n(t))}i=a[qS.KHR_BINARY_GLTF].content}else i=Rh.decodeText(new Uint8Array(t))}const s=JSON.parse(i);if(void 0===s.asset||s.asset.version[0]<2)return void(n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new BT(s,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let t=0;t<this.pluginCallbacks.length;t++){const e=this.pluginCallbacks[t](l);o[e.name]=e,a[e.name]=!0}if(s.extensionsUsed)for(let t=0;t<s.extensionsUsed.length;++t){const e=s.extensionsUsed[t],r=s.extensionsRequired||[];switch(e){case qS.KHR_MATERIALS_UNLIT:a[e]=new YS;break;case qS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[e]=new hT;break;case qS.KHR_DRACO_MESH_COMPRESSION:a[e]=new lT(s,this.dracoLoader);break;case qS.KHR_TEXTURE_TRANSFORM:a[e]=new uT;break;case qS.KHR_MESH_QUANTIZATION:a[e]=new dT;break;default:r.indexOf(e)>=0&&void 0===o[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}l.setExtensions(a),l.setPlugins(o),l.parse(r,n)}parseAsync(t,e){const r=this;return new Promise((function(n,i){r.parse(t,e,n,i)}))}}},Symbol.toStringTag,{value:"Module"})));var HT,WT={};function qT(){if(HT)return WT;HT=1,Object.defineProperty(WT,"__esModule",{value:!0}),WT.default=void 0;var t=Bf,e=function(){function e(e){this.manager=void 0!==e?e:t.DefaultLoadingManager}function r(){var t={};return{get:function(e){return t[e]},add:function(e,r){t[e]=r},remove:function(e){delete t[e]},removeAll:function(){t={}},update:function(e,r){for(var n in t){var i=t[n];i.update&&i.update(e,r)}}}}function n(e,r){var n={},i=e.material.uniforms;for(var a in i){var o=i[a];if(o.semantic){var s=o.node,l=e;s&&(l=r[s]),n[a]={semantic:o.semantic,sourceNode:l,targetNode:e,uniform:o}}}this.boundUniforms=n,this._m4=new t.Matrix4}e.prototype={constructor:e,crossOrigin:"Anonymous",load:function(e,r,n,i){var a=this,o=this.path&&"string"==typeof this.path?this.path:t.LoaderUtils.extractUrlBase(e),s=new t.FileLoader(a.manager);s.setResponseType("arraybuffer"),s.load(e,(function(t){a.parse(t,r,o)}),n,i)},setCrossOrigin:function(t){this.crossOrigin=t},setPath:function(t){this.path=t},parse:function(e,r,n){var s,u={};t.LoaderUtils.decodeText(new Uint8Array(e,0,4))===o.magic?(u[i.KHR_BINARY_GLTF]=new l(e),s=u[i.KHR_BINARY_GLTF].content):s=t.LoaderUtils.decodeText(new Uint8Array(e));var c=JSON.parse(s);c.extensionsUsed&&c.extensionsUsed.indexOf(i.KHR_MATERIALS_COMMON)>=0&&(u[i.KHR_MATERIALS_COMMON]=new a(c)),new A(c,u,{path:n||this.path,crossOrigin:this.crossOrigin}).parse((function(t,e,n,i){r({scene:t,scenes:e,cameras:n,animations:i})}))}},e.Shaders={update:function(){console.warn("LegacyGLTFLoader.Shaders has been deprecated, and now updates automatically.")}},n.prototype.update=function(t,e){var r=this.boundUniforms;for(var n in r){var i=r[n];switch(i.semantic){case"MODELVIEW":i.uniform.value.multiplyMatrices(e.matrixWorldInverse,i.sourceNode.matrixWorld);break;case"MODELVIEWINVERSETRANSPOSE":var a=i.uniform.value;this._m4.multiplyMatrices(e.matrixWorldInverse,i.sourceNode.matrixWorld),a.getNormalMatrix(this._m4);break;case"PROJECTION":i.uniform.value.copy(e.projectionMatrix);break;case"JOINTMATRIX":for(var o=i.uniform.value,s=0;s<o.length;s++)o[s].copy(i.sourceNode.matrixWorld).invert().multiply(i.targetNode.skeleton.bones[s].matrixWorld).multiply(i.targetNode.skeleton.boneInverses[s]).multiply(i.targetNode.bindMatrix);break;default:console.warn("Unhandled shader semantic: "+i.semantic)}}},e.Animations={update:function(){console.warn("LegacyGLTFLoader.Animation has been deprecated. Use AnimationMixer instead.")}};var i={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_MATERIALS_COMMON:"KHR_materials_common"};function a(e){this.name=i.KHR_MATERIALS_COMMON,this.lights={};var r=(e.extensions&&e.extensions[i.KHR_MATERIALS_COMMON]||{}).lights||{};for(var n in r){var a,o=r[n],s=o[o.type],l=(new t.Color).fromArray(s.color);switch(o.type){case"directional":(a=new t.DirectionalLight(l)).position.set(0,0,1);break;case"point":a=new t.PointLight(l);break;case"spot":(a=new t.SpotLight(l)).position.set(0,0,1);break;case"ambient":a=new t.AmbientLight(l)}a&&(this.lights[n]=a)}}var o={magic:"glTF",version:1,contentFormat:0},s=20;function l(e){this.name=i.KHR_BINARY_GLTF;var r=new DataView(e,0,s),n={magic:t.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:r.getUint32(4,!0),length:r.getUint32(8,!0),contentLength:r.getUint32(12,!0),contentFormat:r.getUint32(16,!0)};for(var a in o){var l=o[a];if(n[a]!==l)throw new Error('Unsupported glTF-Binary header: Expected "%s" to be "%s".',a,l)}var u=new Uint8Array(e,s,n.contentLength);this.header=n,this.content=t.LoaderUtils.decodeText(u),this.body=e.slice(s+n.contentLength,n.length)}l.prototype.loadShader=function(e,r){var n=r[e.extensions[i.KHR_BINARY_GLTF].bufferView],a=new Uint8Array(n);return t.LoaderUtils.decodeText(a)},l.prototype.loadTextureSourceUri=function(e,r){var n=e.extensions[i.KHR_BINARY_GLTF],a=r[n.bufferView],o=t.LoaderUtils.decodeText(new Uint8Array(a));return"data:"+n.mimeType+";base64,"+btoa(o)};var u={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,TRIANGLES:4,LINES:1,LINE_LOOP:2,LINE_STRIP:3,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,VERTEX_SHADER:35633,FRAGMENT_SHADER:35632},c={5126:Number,35675:t.Matrix3,35676:t.Matrix4,35664:t.Vector2,35665:t.Vector3,35666:t.Vector4,35678:t.Texture},h={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},d={9728:t.NearestFilter,9729:t.LinearFilter,9984:t.NearestMipmapNearestFilter,9985:t.LinearMipmapNearestFilter,9986:t.NearestMipmapLinearFilter,9987:t.LinearMipmapLinearFilter},f={33071:t.ClampToEdgeWrapping,33648:t.MirroredRepeatWrapping,10497:t.RepeatWrapping},p={6406:t.AlphaFormat,6407:t.RGBFormat,6408:t.RGBAFormat,6409:t.LuminanceFormat,6410:t.LuminanceAlphaFormat},m={5121:t.UnsignedByteType,32819:t.UnsignedShort4444Type,32820:t.UnsignedShort5551Type,33635:t.UnsignedShort565Type},g={1028:t.BackSide,1029:t.FrontSide},v={512:t.NeverDepth,513:t.LessDepth,514:t.EqualDepth,515:t.LessEqualDepth,516:t.GreaterEqualDepth,517:t.NotEqualDepth,518:t.GreaterEqualDepth,519:t.AlwaysDepth},y={32774:t.AddEquation,32778:t.SubtractEquation,32779:t.ReverseSubtractEquation},x={0:t.ZeroFactor,1:t.OneFactor,768:t.SrcColorFactor,769:t.OneMinusSrcColorFactor,770:t.SrcAlphaFactor,771:t.OneMinusSrcAlphaFactor,772:t.DstAlphaFactor,773:t.OneMinusDstAlphaFactor,774:t.DstColorFactor,775:t.OneMinusDstColorFactor,776:t.SrcAlphaSaturateFactor},_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},w={scale:"scale",translation:"position",rotation:"quaternion"},b={LINEAR:t.InterpolateLinear,STEP:t.InterpolateDiscrete},M={2884:"CULL_FACE",2929:"DEPTH_TEST",3042:"BLEND",3089:"SCISSOR_TEST",32823:"POLYGON_OFFSET_FILL",32926:"SAMPLE_ALPHA_TO_COVERAGE"};function S(t,e,r){if(!t)return Promise.resolve();var n,i=[];if("[object Array]"===Object.prototype.toString.call(t)){n=[];for(var a=t.length,o=0;o<a;o++){(l=e.call(r||this,t[o],o))&&(i.push(l),l instanceof Promise?l.then(function(t,e){n[t]=e}.bind(this,o)):n[o]=l)}}else for(var s in n={},t){var l;if(t.hasOwnProperty(s))(l=e.call(r||this,t[s],s))&&(i.push(l),l instanceof Promise?l.then(function(t,e){n[t]=e}.bind(this,s)):n[s]=l)}return Promise.all(i).then((function(){return n}))}function T(t,e){return"string"!=typeof t||""===t?"":/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)?t:(e||"")+t}function E(t){this.isDeferredShaderMaterial=!0,this.params=t}function A(t,e,n){this.json=t||{},this.extensions=e||{},this.options=n||{},this.cache=new r}return E.prototype.create=function(){var e=t.UniformsUtils.clone(this.params.uniforms);for(var r in this.params.uniforms){var n=this.params.uniforms[r];n.value instanceof t.Texture&&(e[r].value=n.value,e[r].value.needsUpdate=!0),e[r].semantic=n.semantic,e[r].node=n.node}return this.params.uniforms=e,new t.RawShaderMaterial(this.params)},A.prototype._withDependencies=function(t){for(var e={},r=0;r<t.length;r++){var n=t[r],i="load"+n.charAt(0).toUpperCase()+n.slice(1),a=this.cache.get(n);if(void 0!==a)e[n]=a;else if(this[i]){var o=this[i]();this.cache.add(n,o),e[n]=o}}return S(e,(function(t){return t}))},A.prototype.parse=function(t){var e=this.json;this.cache.removeAll(),this._withDependencies(["scenes","cameras","animations"]).then((function(r){var n=[];for(var i in r.scenes)n.push(r.scenes[i]);var a=void 0!==e.scene?r.scenes[e.scene]:n[0],o=[];for(var i in r.cameras){var s=r.cameras[i];o.push(s)}var l=[];for(var i in r.animations)l.push(r.animations[i]);t(a,n,o,l)}))},A.prototype.loadShaders=function(){var e=this.json,r=this.extensions,n=this.options;return this._withDependencies(["bufferViews"]).then((function(a){return S(e.shaders,(function(e){return e.extensions&&e.extensions[i.KHR_BINARY_GLTF]?r[i.KHR_BINARY_GLTF].loadShader(e,a.bufferViews):new Promise((function(r){var i=new t.FileLoader;i.setResponseType("text"),i.load(T(e.uri,n.path),(function(t){r(t)}))}))}))}))},A.prototype.loadBuffers=function(){var e=this.json,r=this.extensions,n=this.options;return S(e.buffers,(function(e,a){return"binary_glTF"===a?r[i.KHR_BINARY_GLTF].body:"arraybuffer"===e.type||void 0===e.type?new Promise((function(r){var i=new t.FileLoader;i.setResponseType("arraybuffer"),i.load(T(e.uri,n.path),(function(t){r(t)}))})):void console.warn("LegacyGLTFLoader: "+e.type+" buffer type is not supported")}))},A.prototype.loadBufferViews=function(){var t=this.json;return this._withDependencies(["buffers"]).then((function(e){return S(t.bufferViews,(function(t){var r=e.buffers[t.buffer],n=void 0!==t.byteLength?t.byteLength:0;return r.slice(t.byteOffset,t.byteOffset+n)}))}))},A.prototype.loadAccessors=function(){var e=this.json;return this._withDependencies(["bufferViews"]).then((function(r){return S(e.accessors,(function(e){var n=r.bufferViews[e.bufferView],i=_[e.type],a=h[e.componentType],o=a.BYTES_PER_ELEMENT;if(e.byteStride&&e.byteStride!==o*i){var s=new a(n),l=new t.InterleavedBuffer(s,e.byteStride/o);return new t.InterleavedBufferAttribute(l,i,e.byteOffset/o)}return s=new a(n,e.byteOffset,e.count*i),new t.BufferAttribute(s,i)}))}))},A.prototype.loadTextures=function(){var e=this.json,r=this.extensions,n=this.options;return this._withDependencies(["bufferViews"]).then((function(a){return S(e.textures,(function(o){if(o.source)return new Promise((function(s){var l=e.images[o.source],u=l.uri;l.extensions&&l.extensions[i.KHR_BINARY_GLTF]&&(u=r[i.KHR_BINARY_GLTF].loadTextureSourceUri(l,a.bufferViews));var c=t.Loader.Handlers.get(u);null===c&&(c=new t.TextureLoader),c.setCrossOrigin(n.crossOrigin),c.load(T(u,n.path),(function(r){if(r.flipY=!1,void 0!==o.name&&(r.name=o.name),r.format=void 0!==o.format?p[o.format]:t.RGBAFormat,void 0!==o.internalFormat&&r.format!==p[o.internalFormat]&&console.warn("LegacyGLTFLoader: Three.js doesn't support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),r.type=void 0!==o.type?m[o.type]:t.UnsignedByteType,o.sampler){var n=e.samplers[o.sampler];r.magFilter=d[n.magFilter]||t.LinearFilter,r.minFilter=d[n.minFilter]||t.NearestMipmapLinearFilter,r.wrapS=f[n.wrapS]||t.RepeatWrapping,r.wrapT=f[n.wrapT]||t.RepeatWrapping}s(r)}),void 0,(function(){s()}))}))}))}))},A.prototype.loadMaterials=function(){var e=this.json;return this._withDependencies(["shaders","textures"]).then((function(r){return S(e.materials,(function(n){var a,o,s={},l={};if(n.extensions&&n.extensions[i.KHR_MATERIALS_COMMON]&&(o=n.extensions[i.KHR_MATERIALS_COMMON]),o){var h=["ambient","emission","transparent","transmission","doubleSided"];switch(o.technique){case"BLINN":case"PHONG":a=t.MeshPhongMaterial,h.push("diffuse","specular","shininess");break;case"LAMBERT":a=t.MeshLambertMaterial,h.push("diffuse");break;default:a=t.MeshBasicMaterial}h.forEach((function(t){void 0!==o.values[t]&&(s[t]=o.values[t])})),(o.doubleSided||s.doubleSided)&&(l.side=t.DoubleSide),(o.transparent||s.transparent)&&(l.transparent=!0,l.opacity=void 0!==s.transmission?s.transmission:1)}else if(void 0===n.technique)a=t.MeshPhongMaterial,Object.assign(s,n.values);else{a=E;var d=e.techniques[n.technique];l.uniforms={};var f=e.programs[d.program];if(f){l.fragmentShader=r.shaders[f.fragmentShader],l.fragmentShader||(console.warn("ERROR: Missing fragment shader definition:",f.fragmentShader),a=t.MeshPhongMaterial);var p=r.shaders[f.vertexShader];p||(console.warn("ERROR: Missing vertex shader definition:",f.vertexShader),a=t.MeshPhongMaterial),l.vertexShader=function(t,e){var r={};for(var n in e.attributes){var i=e.attributes[n],a=(h=e.parameters[i]).type,o=h.semantic;r[n]={type:a,semantic:o}}var s=e.parameters,l=e.attributes,u={};for(var n in r){var c=s[i=l[n]];(o=c.semantic)&&(u[n]=c)}for(var i in u){o=(h=u[i]).semantic;var h,d=new RegExp("\\b"+i+"\\b","g");switch(o){case"POSITION":t=t.replace(d,"position");break;case"NORMAL":t=t.replace(d,"normal");break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":t=t.replace(d,"uv");break;case"TEXCOORD_1":t=t.replace(d,"uv2");break;case"COLOR_0":case"COLOR0":case"COLOR":t=t.replace(d,"color");break;case"WEIGHT":t=t.replace(d,"skinWeight");break;case"JOINT":t=t.replace(d,"skinIndex")}}return t}(p,d);var m=d.uniforms;for(var _ in m){var w=m[_],b=d.parameters[w],S=b.type;if(!c[S])throw new Error("Unknown shader uniform param type: "+S);var T,A=b.count;void 0!==n.values&&(T=n.values[w]);var R=new c[S],P=b.semantic,C=b.node;switch(S){case u.FLOAT:R=b.value,"transmission"===w&&(l.transparent=!0),void 0!==T&&(R=T);break;case u.FLOAT_VEC2:case u.FLOAT_VEC3:case u.FLOAT_VEC4:case u.FLOAT_MAT3:b&&b.value&&R.fromArray(b.value),T&&R.fromArray(T);break;case u.FLOAT_MAT2:console.warn("FLOAT_MAT2 is not a supported uniform type");break;case u.FLOAT_MAT4:if(A){R=new Array(A);for(var I=0;I<A;I++)R[I]=new c[S];if(b&&b.value){var L=b.value;R.fromArray(L)}T&&R.fromArray(T)}else{if(b&&b.value){var O=b.value;R.fromArray(O)}T&&R.fromArray(T)}break;case u.SAMPLER_2D:R=void 0!==T?r.textures[T]:void 0!==b.value?r.textures[b.value]:null}l.uniforms[_]={value:R,semantic:P,node:C}}for(var D=d.states||{},k=D.enable||[],F=D.functions||{},N=!1,U=!1,B=!1,z=0,G=k.length;z<G;z++){var j=k[z];switch(M[j]){case"CULL_FACE":N=!0;break;case"DEPTH_TEST":U=!0;break;case"BLEND":B=!0;break;case"SCISSOR_TEST":case"POLYGON_OFFSET_FILL":case"SAMPLE_ALPHA_TO_COVERAGE":break;default:throw new Error("Unknown technique.states.enable: "+j)}}l.side=N?void 0!==F.cullFace?g[F.cullFace]:t.FrontSide:t.DoubleSide,l.depthTest=U,l.depthFunc=void 0!==F.depthFunc?v[F.depthFunc]:t.LessDepth,l.depthWrite=void 0===F.depthMask||F.depthMask[0],l.blending=B?t.CustomBlending:t.NoBlending,l.transparent=B;var V=F.blendEquationSeparate;void 0!==V?(l.blendEquation=y[V[0]],l.blendEquationAlpha=y[V[1]]):(l.blendEquation=t.AddEquation,l.blendEquationAlpha=t.AddEquation);var H=F.blendFuncSeparate;void 0!==H?(l.blendSrc=x[H[0]],l.blendDst=x[H[1]],l.blendSrcAlpha=x[H[2]],l.blendDstAlpha=x[H[3]]):(l.blendSrc=t.OneFactor,l.blendDst=t.ZeroFactor,l.blendSrcAlpha=t.OneFactor,l.blendDstAlpha=t.ZeroFactor)}}Array.isArray(s.diffuse)?l.color=(new t.Color).fromArray(s.diffuse):"string"==typeof s.diffuse&&(l.map=r.textures[s.diffuse]),delete l.diffuse,"string"==typeof s.reflective&&(l.envMap=r.textures[s.reflective]),"string"==typeof s.bump&&(l.bumpMap=r.textures[s.bump]),Array.isArray(s.emission)?a===t.MeshBasicMaterial?l.color=(new t.Color).fromArray(s.emission):l.emissive=(new t.Color).fromArray(s.emission):"string"==typeof s.emission&&(a===t.MeshBasicMaterial?l.map=r.textures[s.emission]:l.emissiveMap=r.textures[s.emission]),Array.isArray(s.specular)?l.specular=(new t.Color).fromArray(s.specular):"string"==typeof s.specular&&(l.specularMap=r.textures[s.specular]),void 0!==s.shininess&&(l.shininess=s.shininess);var W=new a(l);return void 0!==n.name&&(W.name=n.name),W}))}))},A.prototype.loadMeshes=function(){var e=this.json;return this._withDependencies(["accessors","materials"]).then((function(r){return S(e.meshes,(function(e){var n=new t.Group;void 0!==e.name&&(n.name=e.name),e.extras&&(n.userData=e.extras);var i=e.primitives||[];for(var a in i){var o=i[a];if(o.mode===u.TRIANGLES||void 0===o.mode){var s=new t.BufferGeometry,l=o.attributes;for(var c in l){if(!(f=l[c]))return;var h=r.accessors[f];switch(c){case"POSITION":s.setAttribute("position",h);break;case"NORMAL":s.setAttribute("normal",h);break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":s.setAttribute("uv",h);break;case"TEXCOORD_1":s.setAttribute("uv2",h);break;case"COLOR_0":case"COLOR0":case"COLOR":s.setAttribute("color",h);break;case"WEIGHT":s.setAttribute("skinWeight",h);break;case"JOINT":s.setAttribute("skinIndex",h);break;case"_BATCHID":s.setAttribute("_BATCHID",h)}}o.indices&&s.setIndex(r.accessors[o.indices]);var d=void 0!==r.materials?r.materials[o.material]:new t.MeshPhongMaterial({color:0,emissive:8947848,specular:0,shininess:0,transparent:!1,depthTest:!0,side:t.FrontSide});(p=new t.Mesh(s,d)).castShadow=!0,p.name="0"===a?n.name:n.name+a,o.extras&&(p.userData=o.extras),n.add(p)}else if(o.mode===u.LINES||o.mode===u.LINE_STRIP||o.mode===u.LINE_LOOP){s=new t.BufferGeometry,l=o.attributes;for(var c in l){var f;if(!(f=l[c]))return;h=r.accessors[f];switch(c){case"POSITION":s.setAttribute("position",h);break;case"COLOR_0":case"COLOR0":case"COLOR":s.setAttribute("color",h)}}var p;d=r.materials[o.material];o.indices?(s.setIndex(r.accessors[o.indices]),p=new t.LineSegments(s,d)):p=o.mode===u.LINES?new t.LineSegments(s,d):o.mode===u.LINE_LOOP?new t.LineLoop(s,d):new t.Line(s,d),p.name="0"===a?n.name:n.name+a,o.extras&&(p.userData=o.extras),n.add(p)}else console.warn("Only triangular and line primitives are supported")}return n}))}))},A.prototype.loadCameras=function(){return S(this.json.cameras,(function(e){if("perspective"===e.type&&e.perspective){var r=e.perspective.yfov,n=void 0!==e.perspective.aspectRatio?e.perspective.aspectRatio:1,i=new t.PerspectiveCamera(t.MathUtils.radToDeg(r*n),n,e.perspective.znear||1,e.perspective.zfar||2e6);return void 0!==e.name&&(i.name=e.name),e.extras&&(i.userData=e.extras),i}if("orthographic"===e.type&&e.orthographic){i=new t.OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,e.orthographic.znear,e.orthographic.zfar);return void 0!==e.name&&(i.name=e.name),e.extras&&(i.userData=e.extras),i}}))},A.prototype.loadSkins=function(){var e=this.json;return this._withDependencies(["accessors"]).then((function(r){return S(e.skins,(function(e){var n=new t.Matrix4;return void 0!==e.bindShapeMatrix&&n.fromArray(e.bindShapeMatrix),{bindShapeMatrix:n,jointNames:e.jointNames,inverseBindMatrices:r.accessors[e.inverseBindMatrices]}}))}))},A.prototype.loadAnimations=function(){var e=this.json;return this._withDependencies(["accessors","nodes"]).then((function(r){return S(e.animations,(function(e,n){var i=[];for(var a in e.channels){var o=e.channels[a],s=e.samplers[o.sampler];if(s){var l=o.target,u=l.id,c=void 0!==e.parameters?e.parameters[s.input]:s.input,h=void 0!==e.parameters?e.parameters[s.output]:s.output,d=r.accessors[c],f=r.accessors[h],p=r.nodes[u];if(p){p.updateMatrix(),p.matrixAutoUpdate=!0;var m=w[l.path]===w.rotation?t.QuaternionKeyframeTrack:t.VectorKeyframeTrack,g=p.name?p.name:p.uuid,v=void 0!==s.interpolation?b[s.interpolation]:t.InterpolateLinear;i.push(new m(g+"."+w[l.path],t.AnimationUtils.arraySlice(d.array,0),t.AnimationUtils.arraySlice(f.array,0),v))}}}u=void 0!==e.name?e.name:"animation_"+n;return new t.AnimationClip(u,void 0,i)}))}))},A.prototype.loadNodes=function(){var e=this.json,r=this.extensions,n=this;return S(e.nodes,(function(e){var r,n=new t.Matrix4;return e.jointName?((r=new t.Bone).name=void 0!==e.name?e.name:e.jointName,r.jointName=e.jointName):(r=new t.Object3D,void 0!==e.name&&(r.name=e.name)),e.extras&&(r.userData=e.extras),void 0!==e.matrix?(n.fromArray(e.matrix),r.applyMatrix4(n)):(void 0!==e.translation&&r.position.fromArray(e.translation),void 0!==e.rotation&&r.quaternion.fromArray(e.rotation),void 0!==e.scale&&r.scale.fromArray(e.scale)),r})).then((function(a){return n._withDependencies(["meshes","skins","cameras"]).then((function(n){return S(a,(function(o,s){var l=e.nodes[s];if(void 0!==l.meshes)for(var u in l.meshes){var c=l.meshes[u],h=n.meshes[c];if(void 0!==h)for(var d in h.children){var f,p=h.children[d],m=p.material,g=p.geometry,v=p.userData,y=p.name;switch(m.isDeferredShaderMaterial?m=_=m.create():_=m,p.type){case"LineSegments":p=new t.LineSegments(g,_);break;case"LineLoop":p=new t.LineLoop(g,_);break;case"Line":p=new t.Line(g,_);break;default:p=new t.Mesh(g,_)}if(p.castShadow=!0,p.userData=v,p.name=y,l.skin&&(f=n.skins[l.skin]),f){var x=function(t){for(var e=Object.keys(a),r=0,n=e.length;r<n;r++){var i=a[e[r]];if(i.jointName===t)return i}return null},_=m;(p=new t.SkinnedMesh(g,_)).castShadow=!0,p.userData=v,p.name=y;for(var w=[],b=[],M=0,S=f.jointNames.length;M<S;M++){var T=f.jointNames[M],E=x(T);if(E){w.push(E);var A=f.inverseBindMatrices.array,R=(new t.Matrix4).fromArray(A,16*M);b.push(R)}else console.warn("WARNING: joint: '"+T+"' could not be found")}p.bind(new t.Skeleton(w,b),f.bindShapeMatrix);!function t(r,n,i){var o=r[i];if(void 0!==o)for(var s=0,l=o.length;s<l;s++){var u=o[s],c=a[u],h=e.nodes[u];void 0!==c&&!0===c.isBone&&void 0!==h&&(n.add(c),t(h,c,"children"))}}(l,p,"skeletons")}o.add(p)}else console.warn("LegacyGLTFLoader: Couldn't find node \""+c+'".')}if(void 0!==l.camera){var P=n.cameras[l.camera];o.add(P)}if(l.extensions&&l.extensions[i.KHR_MATERIALS_COMMON]&&l.extensions[i.KHR_MATERIALS_COMMON].light){var C=r[i.KHR_MATERIALS_COMMON].lights[l.extensions[i.KHR_MATERIALS_COMMON].light];o.add(C)}return o}))}))}))},A.prototype.loadScenes=function(){var e=this.json;function r(t,n,i){var a=i[t];n.add(a);var o=e.nodes[t];if(o.children)for(var s=o.children,l=0,u=s.length;l<u;l++){r(s[l],a,i)}}return this._withDependencies(["nodes"]).then((function(i){return S(e.scenes,(function(e){var a=new t.Scene;void 0!==e.name&&(a.name=e.name),e.extras&&(a.userData=e.extras);for(var o=e.nodes||[],s=0,l=o.length;s<l;s++){r(o[s],a,i.nodes)}return a.traverse((function(t){t.material&&t.material.isRawShaderMaterial&&(t.gltfShader=new n(t,i.nodes),t.onBeforeRender=function(t,e,r){this.gltfShader.update(e,r)})})),a}))}))},e}();return WT.default=e,WT}var XT={},YT={};function ZT(t,e,r){return e<=t&&t<=r}function KT(t){if(void 0===t)return{};if(t===Object(t))return t;throw TypeError("Could not convert argument to dictionary")}var JT=-1;function QT(t){this.tokens=[].slice.call(t)}QT.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.shift():JT},prepend:function(t){if(Array.isArray(t))for(var e=t;e.length;)this.tokens.unshift(e.pop());else this.tokens.unshift(t)},push:function(t){if(Array.isArray(t))for(var e=t;e.length;)this.tokens.push(e.shift());else this.tokens.push(t)}};var $T=-1;function tE(t,e){if(t)throw TypeError("Decoder error");return e||65533}var eE="utf-8";function rE(t,e){if(!(this instanceof rE))return new rE(t,e);if((t=void 0!==t?String(t).toLowerCase():eE)!==eE)throw new Error("Encoding not supported. Only utf-8 is supported");e=KT(e),this._streaming=!1,this._BOMseen=!1,this._decoder=null,this._fatal=Boolean(e.fatal),this._ignoreBOM=Boolean(e.ignoreBOM),Object.defineProperty(this,"encoding",{value:"utf-8"}),Object.defineProperty(this,"fatal",{value:this._fatal}),Object.defineProperty(this,"ignoreBOM",{value:this._ignoreBOM})}function nE(t,e){if(!(this instanceof nE))return new nE(t,e);if((t=void 0!==t?String(t).toLowerCase():eE)!==eE)throw new Error("Encoding not supported. Only utf-8 is supported");e=KT(e),this._streaming=!1,this._encoder=null,this._options={fatal:Boolean(e.fatal)},Object.defineProperty(this,"encoding",{value:"utf-8"})}function iE(t){var e=t.fatal,r=0,n=0,i=0,a=128,o=191;this.handler=function(t,s){if(s===JT&&0!==i)return i=0,tE(e);if(s===JT)return $T;if(0===i){if(ZT(s,0,127))return s;if(ZT(s,194,223))i=1,r=s-192;else if(ZT(s,224,239))224===s&&(a=160),237===s&&(o=159),i=2,r=s-224;else{if(!ZT(s,240,244))return tE(e);240===s&&(a=144),244===s&&(o=143),i=3,r=s-240}return r<<=6*i,null}if(!ZT(s,a,o))return r=i=n=0,a=128,o=191,t.prepend(s),tE(e);if(a=128,o=191,r+=s-128<<6*(i-(n+=1)),n!==i)return null;var l=r;return r=i=n=0,l}}function aE(t){t.fatal,this.handler=function(t,e){if(e===JT)return $T;if(ZT(e,0,127))return e;var r,n;ZT(e,128,2047)?(r=1,n=192):ZT(e,2048,65535)?(r=2,n=224):ZT(e,65536,1114111)&&(r=3,n=240);for(var i=[(e>>6*r)+n];r>0;){var a=e>>6*(r-1);i.push(128|63&a),r-=1}return i}}rE.prototype={decode:function(t,e){var r;r="object"==typeof t&&t instanceof ArrayBuffer?new Uint8Array(t):"object"==typeof t&&"buffer"in t&&t.buffer instanceof ArrayBuffer?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(0),e=KT(e),this._streaming||(this._decoder=new iE({fatal:this._fatal}),this._BOMseen=!1),this._streaming=Boolean(e.stream);for(var n,i=new QT(r),a=[];!i.endOfStream()&&(n=this._decoder.handler(i,i.read()))!==$T;)null!==n&&(Array.isArray(n)?a.push.apply(a,n):a.push(n));if(!this._streaming){do{if((n=this._decoder.handler(i,i.read()))===$T)break;null!==n&&(Array.isArray(n)?a.push.apply(a,n):a.push(n))}while(!i.endOfStream());this._decoder=null}return a.length&&(-1===["utf-8"].indexOf(this.encoding)||this._ignoreBOM||this._BOMseen||(65279===a[0]?(this._BOMseen=!0,a.shift()):this._BOMseen=!0)),function(t){for(var e="",r=0;r<t.length;++r){var n=t[r];n<=65535?e+=String.fromCharCode(n):(n-=65536,e+=String.fromCharCode(55296+(n>>10),56320+(1023&n)))}return e}(a)}},nE.prototype={encode:function(t,e){t=t?String(t):"",e=KT(e),this._streaming||(this._encoder=new aE(this._options)),this._streaming=Boolean(e.stream);for(var r,n=[],i=new QT(function(t){for(var e=String(t),r=e.length,n=0,i=[];n<r;){var a=e.charCodeAt(n);if(a<55296||a>57343)i.push(a);else if(56320<=a&&a<=57343)i.push(65533);else if(55296<=a&&a<=56319)if(n===r-1)i.push(65533);else{var o=t.charCodeAt(n+1);if(56320<=o&&o<=57343){var s=1023&a,l=1023&o;i.push(65536+(s<<10)+l),n+=1}else i.push(65533)}n+=1}return i}(t));!i.endOfStream()&&(r=this._encoder.handler(i,i.read()))!==$T;)Array.isArray(r)?n.push.apply(n,r):n.push(r);if(!this._streaming){for(;(r=this._encoder.handler(i,i.read()))!==$T;)Array.isArray(r)?n.push.apply(n,r):n.push(r);this._encoder=null}return new Uint8Array(n)}};const oE=of(Object.freeze(Object.defineProperty({__proto__:null,TextDecoder:rE,TextEncoder:nE},Symbol.toStringTag,{value:"Module"})));var sE,lE;function uE(){if(sE)return YT;sE=1,Object.defineProperty(YT,"__esModule",{value:!0}),YT.default=YT.TextDecoder=void 0;var t=oE,e="function"==typeof af.TextDecoder?af.TextDecoder:t.TextDecoder;YT.TextDecoder=e;var r=new e("utf-8");return YT.default=r,YT}function cE(){if(lE)return XT;lE=1;var t=uf;Object.defineProperty(XT,"__esModule",{value:!0}),XT.default=void 0;var e=t(uE()),r={parse:function(t){var r=e.default.decode(new Uint8Array(t)),n=JSON.parse(r);return Promise.resolve(n)}};return XT.default=r,XT}var hE,dE,fE={};function pE(){if(dE)return HS;dE=1;var t=uf;Object.defineProperty(HS,"__esModule",{value:!0}),HS.default=void 0;var e=t(cf),r=Bf,n=VT,i=t(qT()),a=t(cE()),o=t($M()),s=t(function(){if(hE)return fE;hE=1,Object.defineProperty(fE,"__esModule",{value:!0}),fE.default=void 0;var t=new RegExp("gl_Position.*(?![^]*gl_Position)"),e=new RegExp("[^\\w]*main[^\\w]*(void)?[^\\w]*{"),r={patchMaterialForLogDepthSupport:function(r){if(-1===r.vertexShader.indexOf("USE_LOGDEPTHBUF")&&-1===r.vertexShader.indexOf("logdepthbuf_pars_vertex")){r.vertexShader="#include <logdepthbuf_pars_vertex>\n#define EPSILON 1e-6\n".concat(r.vertexShader);var n=t.exec(r.vertexShader),i=n[0].length+n.index;r.vertexShader="".concat(r.vertexShader.slice(0,i),"\n#include <logdepthbuf_vertex>\n").concat(r.vertexShader.slice(i)),r.fragmentShader="".concat("precision highp float;\nprecision highp int;\n","\n#include <logdepthbuf_pars_fragment>\n").concat(r.fragmentShader),i=(n=e.exec(r.fragmentShader))[0].length+n.index,r.fragmentShader="".concat(r.fragmentShader.slice(0,i),"\n#include <logdepthbuf_fragment>\n").concat(r.fragmentShader.slice(i)),r.defines={USE_LOGDEPTHBUF:1,USE_LOGDEPTHBUF_EXT:1}}}};return fE.default=r,fE}()),l=t(uE());function u(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var h=(new r.Matrix4).makeRotationX(Math.PI/2),d=(new r.Matrix4).makeRotationZ(-Math.PI/2),f=new n.GLTFLoader,p=new i.default;function m(t){var e=["MODELVIEW","MODELVIEWINVERSETRANSPOSE","PROJECTION","JOINTMATRIX"];if(t.gltfShader){for(var r=[],n=0,i=Object.keys(t.gltfShader.boundUniforms);n<i.length;n++){var a=i[n];r.push(a)}for(var o=0,s=r;o<s.length;o++){var l=s[o],u=t.gltfShader.boundUniforms[l].semantic;e.indexOf(u)<0&&delete t.gltfShader.boundUniforms[l]}}}var g={parse:function(t,n){var i=n.gltfUpAxis,c=n.urlBase;if(!t)throw new Error("No array buffer provided.");var g=new DataView(t,4),v=0,y={};if(y.magic=l.default.decode(new Uint8Array(t,0,4)),y.magic){y.version=g.getUint32(v,!0),v+=Uint32Array.BYTES_PER_ELEMENT,y.byteLength=g.getUint32(v,!0),v+=Uint32Array.BYTES_PER_ELEMENT,y.FTJSONLength=g.getUint32(v,!0),v+=Uint32Array.BYTES_PER_ELEMENT,y.FTBinaryLength=g.getUint32(v,!0),v+=Uint32Array.BYTES_PER_ELEMENT,y.BTJSONLength=g.getUint32(v,!0),v+=Uint32Array.BYTES_PER_ELEMENT,y.BTBinaryLength=g.getUint32(v,!0),v+=Uint32Array.BYTES_PER_ELEMENT;var x=[];if(y.BTJSONLength>0){var _=28+y.FTJSONLength+y.FTBinaryLength;x.push(a.default.parse(t.slice(_,y.BTJSONLength+_)))}else x.push(Promise.resolve({}));return x.push(new Promise((function(a){var g=function(c){var f,p=u(c.scenes);try{for(p.s();!(f=p.n()).done;){f.value.traverse(m)}}catch(t){p.e(t)}finally{p.f()}void 0===i||"Y"===i?c.scene.applyMatrix4(h):"X"===i&&c.scene.applyMatrix4(d),function(t,e){var r=new DataView(t,0,20),n=new Uint8Array(t,20,r.getUint32(12,!0)),i=l.default.decode(new Uint8Array(n)),a=JSON.parse(i);a.extensions&&a.extensions.CESIUM_RTC&&(e.position.fromArray(a.extensions.CESIUM_RTC.center),e.updateMatrixWorld(!0))}(t.slice(28+y.FTJSONLength+y.FTBinaryLength+y.BTJSONLength+y.BTBinaryLength),c.scene),c.scene.traverse((function(t){t.frustumCulled=!1,t.material&&(n.overrideMaterials?(t.material.dispose(),"object"===(0,e.default)(n.overrideMaterials)&&n.overrideMaterials.isMaterial?t.material=n.overrideMaterials.clone():t.material=new r.MeshLambertMaterial({color:16777215})):o.default.isLogDepthBufferSupported()&&t.material.isRawShaderMaterial&&!n.doNotPatchMaterial&&(s.default.patchMaterialForLogDepthSupport(t.material),console.warn("b3dm shader has been patched to add log depth buffer support")),t.material.transparent=n.opacity<1,t.material.opacity=n.opacity)})),a(c)},v=t.slice(28+y.FTJSONLength+y.FTBinaryLength+y.BTJSONLength+y.BTBinaryLength);1===new DataView(v,0,20).getUint32(4,!0)?p.parse(v,g,c):f.parse(v,c,g,(function(t){return console.error(t)}))}))),Promise.all(x).then((function(t){return{gltf:t[1],batchTable:t[0]}}))}throw new Error("Invalid b3dm file.")}};return HS.default=g,HS}var mE,gE={};function vE(){if(mE)return gE;mE=1;var t=uf;Object.defineProperty(gE,"__esModule",{value:!0}),gE.default=void 0;var e=Bf,r=t(cE()),n=t(uE()),i={parse:function(t){if(!t)throw new Error("No array buffer provided.");var i=new DataView(t),a=0,o={},s={},l={};if(o.magic=n.default.decode(new Uint8Array(t,a,4)),a+=4,o.magic){if(o.version=i.getUint32(a,!0),a+=Uint32Array.BYTES_PER_ELEMENT,o.byteLength=i.getUint32(a,!0),a+=Uint32Array.BYTES_PER_ELEMENT,o.FTJSONLength=i.getUint32(a,!0),a+=Uint32Array.BYTES_PER_ELEMENT,o.FTBinaryLength=i.getUint32(a,!0),a+=Uint32Array.BYTES_PER_ELEMENT,o.BTJSONLength=i.getUint32(a,!0),a+=Uint32Array.BYTES_PER_ELEMENT,o.BTBinaryLength=i.getUint32(a,!0),a+=Uint32Array.BYTES_PER_ELEMENT,o.FTBinaryLength>0&&(l=function(t,r,i){var a,o=new e.BufferGeometry,s=n.default.decode(new Uint8Array(t,r,i)),l=JSON.parse(s);l.POINTS_LENGTH&&(a=l.POINTS_LENGTH);if(l.POSITION){var u=l.POSITION.byteOffset+s.length+r,c=new Float32Array(t,u,3*a);o.setAttribute("position",new e.BufferAttribute(c,3))}if(l.RGB){var h=l.RGB.byteOffset+s.length+r,d=new Uint8Array(t,h,3*a);o.setAttribute("color",new e.BufferAttribute(d,3,!0))}if(l.POSITION_QUANTIZED)throw new Error("For pnts loader, POSITION_QUANTIZED: not yet managed");if(l.RGBA)throw new Error("For pnts loader, RGBA: not yet managed");if(l.RGB565)throw new Error("For pnts loader, RGB565: not yet managed");if(l.NORMAL)throw new Error("For pnts loader, NORMAL: not yet managed");if(l.NORMAL_OCT16P)throw new Error("For pnts loader, NORMAL_OCT16P: not yet managed");if(l.BATCH_ID)throw new Error("For pnts loader, BATCH_ID: not yet managed");var f=l.RTC_CENTER?(new e.Vector3).fromArray(l.RTC_CENTER):void 0;return{geometry:o,offset:f}}(t,a,o.FTJSONLength)),o.BTJSONLength>0){var u=28+o.FTJSONLength+o.FTBinaryLength;s=r.default.parse(t.slice(u,o.BTJSONLength+u))}var c={point:l,batchTable:s};return Promise.resolve(c)}throw new Error("Invalid pnts file.")}};return gE.default=i,gE}var yE,xE,_E={},wE={};function bE(){if(yE)return wE;yE=1;var t=uf;Object.defineProperty(wE,"__esModule",{value:!0}),wE.default=wE.MODE=void 0;var e=t(pf()),r=t(yf()),n=t(sM()),i=t(Cf()),a=t(Df()),o=t(Uf()),s=Bf,l=t($M());function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=(0,o.default)(t);if(e){var i=(0,o.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var c={COLOR:0,INTENSITY:1,CLASSIFICATION:2,NORMAL:3,TEXTURE:4,ELEVATION:5};wE.MODE=c;var h=16,d=function(t){(0,i.default)(d,t);var a=u(d);function d(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,e.default)(this,d),(t=a.call(this)).vertexShader="precision highp float;\nprecision highp int;\n\n#include <logdepthbuf_pars_vertex>\n#define EPSILON 1e-6\n\nattribute vec3 position;\nuniform mat4 modelMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float size;\n\nuniform int pickingId;\nuniform int mode;\nuniform float opacity;\nuniform vec4 overlayColor;\nattribute vec3 color;\nattribute vec4 unique_id;\nattribute float intensity;\n\n#if defined(NORMAL_OCT16)\nattribute vec2 oct16Normal;\n#elif defined(NORMAL_SPHEREMAPPED)\nattribute vec2 sphereMappedNormal;\n#else\nattribute vec3 normal;\n#endif\n\nuniform sampler2D overlayTexture;\nuniform vec4 offsetScale;\nuniform vec2 extentTopLeft;\nuniform vec2 extentSize;\n\nvarying vec4 vColor;\n\n// see https://web.archive.org/web/20150303053317/http://lgdv.cs.fau.de/get/1602\n// and implementation in PotreeConverter (BINPointReader.cpp) and potree (BinaryDecoderWorker.js)\n#if defined(NORMAL_OCT16)\nvec3 decodeOct16Normal(vec2 encodedNormal) {\n    vec2 nNorm = 2. * (encodedNormal / 255.) - 1.;\n    vec3 n;\n    n.z = 1. - abs(nNorm.x) - abs(nNorm.y);\n    if (n.z >= 0.) {\n        n.x = nNorm.x;\n        n.y = nNorm.y;\n    } else {\n        n.x = sign(nNorm.x) - sign(nNorm.x) * sign(nNorm.y) * nNorm.y;\n        n.y = sign(nNorm.y) - sign(nNorm.y) * sign(nNorm.x) * nNorm.x;\n    }\n    return normalize(n);\n}\n#elif defined(NORMAL_SPHEREMAPPED)\n// see http://aras-p.info/texts/CompactNormalStorage.html method #4\n// or see potree's implementation in BINPointReader.cpp\nvec3 decodeSphereMappedNormal(vec2 encodedNormal) {\n    vec2 fenc = 2. * encodedNormal / 255. - 1.;\n    float f = dot(fenc,fenc);\n    float g = 2. * sqrt(1. - f);\n    vec3 n;\n    n.xy = fenc * g;\n    n.z = 1. - 2. * f;\n    return n;\n}\n#endif\n\n#ifdef DEFORMATION_SUPPORT\nuniform int enableTransfo;\nuniform mat4 transformations[NUM_TRANSFO];\nuniform vec3 vec[NUM_TRANSFO];\nuniform vec2 origin[NUM_TRANSFO];\nuniform vec2 influence[NUM_TRANSFO];\nuniform vec4 tColors[NUM_TRANSFO];\n#endif\n\nvoid main() {\n\n#if defined(NORMAL_OCT16)\n    vec3  normal = decodeOct16Normal(oct16Normal);\n#elif defined(NORMAL_SPHEREMAPPED)\n    vec3 normal = decodeSphereMappedNormal(sphereMappedNormal);\n#elif defined(NORMAL)\n    // nothing to do\n#else\n    // default to color\n    vec3 normal = color;\n#endif\n\n    if (pickingId > 0) {\n        vColor = unique_id;\n\n        int left4bitsShift = 16; // << 4 <=> * 2^4\n        int left8bitsShift = left4bitsShift * left4bitsShift;\n        // 20 bits for 'unique_id' (= the point index in the buffer)\n        // 12 bits for 'pickingId' (= the point instance id)\n        // (see Picking.js)\n        //     = |4bits||     8 bits     |\n        //          ^ left-most 4 bits of the green channel\n        //                     ^ red channel\n        int upperPart = pickingId / left8bitsShift;\n        int lowerPart = pickingId - upperPart * left8bitsShift; // 8 bits\n        vColor.r = float(lowerPart) / 255.0;\n        vColor.g += float(upperPart * 8) / 255.0; // << 4\n        // vColor.g += float(upperPart * left4bitsShift) / 255.0;\n    } else if (mode == MODE_INTENSITY) {\n        vColor = vec4(intensity, intensity, intensity, opacity);\n    } else if (mode == MODE_NORMAL) {\n        vColor = vec4(abs(normal), opacity);\n    } else if (mode == MODE_TEXTURE) {\n        vec2 pp = (modelMatrix * vec4(position, 1.0)).xy;\n        // offsetScale is from topleft\n        pp.x -= extentTopLeft.x;\n        pp.y = extentTopLeft.y - pp.y;\n        pp *= offsetScale.zw / extentSize;\n        pp += offsetScale.xy;\n        pp.y = 1.0 - pp.y;\n        vec3 textureColor = texture2D(overlayTexture, pp).rgb;\n        vColor = vec4(mix(textureColor, overlayColor.rgb, overlayColor.a), opacity);\n    } else if (mode == MODE_ELEVATION) {\n        float z = (modelMatrix * vec4(position, 1.0)).z;\n        // colors from OGC EL.GridCoverage.Default style\n        if (z < -100.0) {\n            vColor = vec4(float(0x00) / 255.0, float(0x5C) / 255.0, float(0xE6) / 255.0, 1.0);\n        } else if (z <= 0.0) {\n            vColor = mix(\n                vec4(float(0x00) / 255.0, float(0x5C) / 255.0, float(0xE6) / 255.0, 1.0),\n                vec4(float(0x28) / 255.0, float(0xED) / 255.0, float(0xD6) / 255.0, 1.0),\n                -z / 100.0);\n        } else if (z <= 50.0) {\n            vColor = mix(\n                vec4(float(0x00) / 255.0, float(0x5C) / 255.0, float(0xE6) / 255.0, 1.0),\n                vec4(float(0x28) / 255.0, float(0xED) / 255.0, float(0xD6) / 255.0, 1.0),\n                -z / 100.0);\n        } else if (z <= 50.0) {\n            vColor = mix(\n                vec4(float(0x28) / 255.0, float(0xED) / 255.0, float(0xD6) / 255.0, 1.0),\n                vec4(float(0x54) / 255.0, float(0xF7) / 255.0, float(0x6D) / 255.0, 1.0),\n                z / 50.0);\n        } else if (z <= 100.0) {\n            vColor = mix(\n                vec4(float(0x54) / 255.0, float(0xF7) / 255.0, float(0x6D) / 255.0, 1.0),\n                vec4(float(0x9A) / 255.0, float(0xFA) / 255.0, float(0x66) / 255.0, 1.0),\n                (z - 50.0)/ 50.0);\n        } else {\n            vColor = mix(\n                vec4(float(0x9A) / 255.0, float(0xFA) / 255.0, float(0x66) / 255.0, 1.0),\n                vec4(float(0x7B) / 255.0, float(0xF2) / 255.0, float(0x3A) / 255.0, 1.0),\n                (z - 100.0)/ 50.0);\n        }\n        vColor.a = opacity;\n    } else {\n        // default to color mode\n        vColor = vec4(mix(color, overlayColor.rgb, overlayColor.a), opacity);\n    }\n\n    mat4 mvMatrix = modelViewMatrix;\n\n    #ifdef DEFORMATION_SUPPORT\n    if (!pickingMode) {\n        vColor = enableTransfo > 0 ?\n            vec4(0.0, 1.0, 1.0, 1.0):\n            vec4(1.0, 0.0, 1.0, 1.0);\n    }\n    if (enableTransfo > 0) {\n        vec4 mPosition = modelMatrix * vec4(position, 1.0);\n        float minDistance = 1000.0;\n        int bestChoice = -1;\n        for (int i = 0; i < NUM_TRANSFO; i++) {\n            if (i >= enableTransfo) {\n                break;\n            }\n            vec2 v = vec[i].xy;\n            float length = vec[i].z;\n            float depassement_x =\n                length * (influence[i].x - 1.0);\n\n            vec2 diff = mPosition.xy - origin[i];\n            float distance_x = dot(diff, v);\n\n            if (-depassement_x <= distance_x &&\n                    distance_x <= (length + depassement_x)) {\n                vec2 normal = vec2(-v.y, v.x);\n                float d = abs(dot(diff, normal));\n                if (d < minDistance && d <= influence[i].y) {\n                    minDistance = d;\n                    bestChoice = i;\n                }\n            }\n        }\n\n        if (bestChoice >= 0) {\n            // override modelViewMatrix\n            mvMatrix = transformations[bestChoice];\n            vColor = mix(\n                tColors[bestChoice],\n                vec4(color, 1.0),\n                0.5);\n        }\n    }\n    #endif\n\n    vec4 mvPosition = mvMatrix * vec4( position, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n\n    if (size > 0.) {\n        gl_PointSize = size;\n    } else {\n        gl_PointSize = clamp(-size / gl_Position.w, 3.0, 10.0);\n    }\n\n    #include <logdepthbuf_vertex>\n}\n",t.fragmentShader="precision highp float;\nprecision highp int;\n\n#include <logdepthbuf_pars_fragment>\n\nvarying vec4 vColor;\n\nvoid main() {\n    // circular point rendering\n    if(length(gl_PointCoord - 0.5) > 0.5){\n        discard;\n    }\n\n    gl_FragColor = vColor;\n\n    #include <logdepthbuf_fragment>\n}\n",t.size=r.size||0,t.scale=r.scale||.025/Math.tan(.5),t.overlayColor=r.overlayColor||new s.Vector4(0,0,0,0),t.mode=r.mode||c.COLOR,t.pickingId=0;for(var n=0,i=Object.keys(c);n<i.length;n++){var o=i[n];Object.prototype.hasOwnProperty.call(c,o)&&(t.defines["MODE_".concat(o)]=c[o])}t.uniforms.size=new s.Uniform(t.size),t.uniforms.mode=new s.Uniform(t.mode),t.uniforms.pickingId=new s.Uniform(t.pickingId),t.uniforms.opacity=new s.Uniform(t.opacity),t.uniforms.overlayColor=new s.Uniform(t.overlayColor),l.default.isLogDepthBufferSupported()&&(t.defines.USE_LOGDEPTHBUF=1,t.defines.USE_LOGDEPTHBUF_EXT=1),t.extensions.fragDepth=!0,t.uniforms.enableTransfo=new s.Uniform(0),t.transformations=[];for(var u=0;u<h;u++)t.transformations.push(new s.Matrix4);t.uniforms.transformations=new s.Uniform(t.transformations),t.vec=[];for(var f=0;f<h;f++)t.vec.push(new s.Vector3);t.uniforms.vec=new s.Uniform(t.vec),t.origin=[];for(var p=0;p<h;p++)t.origin.push(new s.Vector2);t.uniforms.origin=new s.Uniform(t.origin),t.influence=[];for(var m=0;m<h;m++)t.influence.push(new s.Vector2);t.uniforms.influence=new s.Uniform(t.influence),t.tColors=[];for(var g=0;g<h;g++)t.tColors.push(new s.Color);return t.colorLayer=null,t.uniforms.tColors=new s.Uniform(t.tColors),t.updateUniforms(),t}return(0,r.default)(d,[{key:"clone",value:function(){var t=(0,n.default)((0,o.default)(d.prototype),"clone",this).call(this,this);return t.update(this),t}},{key:"enablePicking",value:function(t){this.pickingId=t,this.blending=t?s.NoBlending:s.NormalBlending,this.updateUniforms()}},{key:"updateUniforms",value:function(){this.uniforms.size.value=this.size>0?this.size:-this.scale*window.innerHeight,this.uniforms.mode.value=this.mode,this.uniforms.pickingId.value=this.pickingId,this.uniforms.opacity.value=this.opacity,this.uniforms.overlayColor.value=this.overlayColor}},{key:"update",value:function(t){return t&&(this.visible=t.visible,this.opacity=t.opacity,this.transparent=t.transparent,this.size=t.size,this.mode=t.mode,this.pickingId=t.pickingId,this.scale=t.scale,this.overlayColor.copy(t.overlayColor)),this.updateUniforms(),t&&Object.assign(this.defines,t.defines),this}},{key:"pushLayer",value:function(t,e){this.mode=c.TEXTURE,this.updateUniforms(),this.colorLayer=t,this.uniforms.overlayTexture=new s.Uniform,this.uniforms.offsetScale=new s.Uniform(new s.Vector4(0,0,1,1)),this.uniforms.extentTopLeft=new s.Uniform(new s.Vector2(e.west(),e.north()));var r=e.dimensions();this.uniforms.extentSize=new s.Uniform(new s.Vector2(r.x,r.y))}},{key:"getColorTexture",value:function(t){return t!==this.colorLayer?null:this.uniforms.overlayTexture.value}},{key:"setColorTextures",value:function(t,e){return Array.isArray(e)&&(e=e[0]),t===this.colorLayer&&(this.uniforms.overlayTexture.value=e.texture,this.uniforms.offsetScale.value.copy(e.pitch)),Promise.resolve()}},{key:"setSequence",value:function(){}},{key:"setLayerVisibility",value:function(){}},{key:"setLayerOpacity",value:function(){}},{key:"enableTransfo",value:function(t){t?(this.defines.DEFORMATION_SUPPORT=1,this.defines.NUM_TRANSFO=h):(delete this.defines.DEFORMATION_SUPPORT,delete this.defines.NUM_TRANSFO),this.needsUpdate=!0}}]),d}(s.RawShaderMaterial),f=d;return wE.default=f,wE}function ME(){if(xE)return _E;xE=1;var t=uf;Object.defineProperty(_E,"__esModule",{value:!0}),_E.default=void 0;var e=t(pf()),r=t(yf()),n=t(Cf()),i=t(Df()),a=t(Uf()),o=Bf,s=t(bE());function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=(0,a.default)(t);if(e){var o=(0,a.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,i.default)(this,r)}}var u=function(t){(0,n.default)(a,t);var i=l(a);function a(t,r){var n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.default;return(0,e.default)(this,a),(n=i.call(this,r,o))._layer=t,n.extent=void 0,n.layerUpdateState={},n.wmtsCoords={},n}return(0,r.default)(a,[{key:"getExtentForLayer",value:function(t){if(t.extent.crs()!==this._layer.extent.crs())throw new Error("Unsupported reprojection");return this.extent}}]),a}(o.Points),c=u;return _E.default=c,_E}var SE={},TE=uf;Object.defineProperty(SE,"__esModule",{value:!0}),SE.calculateCameraDistance=JE;var EE=SE.default=void 0;SE.init3dTilesEntity=function(t,e,r){return GE(t,e,r,r.tileset.root,void 0,!0).then((function(e){delete r.tileset,r.object3d.add(e),e.updateMatrixWorld(),r.tileIndex.index[e.tileId].obj=e,r.root=e,r.extent=VE(r.projection||t.referenceCrs,e.boundingVolume,e.matrixWorld)}))};var AE=TE(Nx()),RE=TE(pf()),PE=TE(yf()),CE=TE(Cf()),IE=TE(Df()),LE=TE(Uf()),OE=Bf,DE=TE(DM()),kE=TE(kS());function FE(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return NE(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return NE(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function NE(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function UE(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=(0,LE.default)(t);if(e){var i=(0,LE.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,IE.default)(this,r)}}var BE=function(t){(0,CE.default)(r,t);var e=UE(r);function r(t,n){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if((0,RE.default)(this,r),i=e.call(this,t,a.object3d||new OE.Group),!n)throw new Error("missing source");if(!n.url)throw new Error("missing source.url");return i.protocol="3d-tiles",i.url=n.url,i.networkOptions=n.networkOptions,i.sseThreshold=a.sseThreshold||16,i.cleanupDelay=a.cleanupDelay||1e3,i.material=a.material||void 0,i._cleanableTiles=[],i}return(0,PE.default)(r,[{key:"preUpdate",value:function(){if(!this.visible)return[];var t=Date.now();if(this._cleanableTiles.length&&t-this._cleanableTiles[0].cleanableSince>this.cleanupDelay)for(;this._cleanableTiles.length;){var e=this._cleanableTiles[0];if(!(t-e.cleanableSince>this.cleanupDelay))break;qE(this,e)}return[this.root]}},{key:"update",value:function(t,e){var r=this;if(e.remove.apply(e,(0,AE.default)(e.children.filter((function(t){return t.deleted})))),!e.parent.pendingSubdivision||e.parent.additiveRefinement){var n,i=!WE(t.camera,e,e.matrixWorld);if(e.visible=i,i){if(KE(this,e),JE(t.camera.camera3D,e),e.pendingSubdivision||function(t,e,r){if(void 0===e.tileIndex.index[r.tileId].children)return!1;if(e.tileIndex.index[r.tileId].isTileset)return!0;var n=function(t,e){if(e.boundingVolume.region)throw new Error("boundingVolume.region is unsupported");if(e.boundingVolume.box){var r=kE.default.computeFromBox3(t.camera,e.boundingVolume.box,e.matrixWorld,e.geometricError,kE.default.MODE_3D);return r?Math.max(r.lengths.x,r.lengths.y):1/0}return e.boundingVolume.sphere?0===e.distance?1/0:t.camera._preSSE*(e.geometricError/e.distance):1/0}(t,r);return r.sse=n,n>e.sseThreshold}(t,this,e)){if(function(t,e,r,n){r.additiveRefinement?function(t,e,r,n){var i,a=FE(e.tileIndex.index[r.tileId].children);try{var o=function(){var a=i.value;if(a.promise||r.children.filter((function(t){return t.tileId===a.tileId})).length>0)return"continue";var o=r.matrixWorld;if(a.transform&&(o=HE.multiplyMatrices(r.matrixWorld,a.transform)),!(!n||!n(t.camera,a,o)))return"continue";a.promise=GE(t.instance,t.scheduler,e,a,r,!0).then((function(n){if(n&&r.parent){r.add(n),n.updateMatrixWorld();var i=VE(e.extent.crs(),n.boundingVolume,n.matrixWorld);n.traverse((function(t){t.extent=i})),t.instance.notifyChange(a)}delete a.promise}),(function(){delete a.promise}))};for(a.s();!(i=a.n()).done;)o()}catch(t){a.e(t)}finally{a.f()}}(t,e,r,n):function(t,e,r){if(r.pendingSubdivision)return;if(jE(r).length>0)return;var n=e.tileIndex.index[r.tileId].children;if(void 0===n||0===n.length)return;r.pendingSubdivision=!0;var i,a=[],o=FE(e.tileIndex.index[r.tileId].children);try{for(o.s();!(i=o.n()).done;){var s=i.value,l=GE(t.instance,t.scheduler,e,s,r,!1).then((function(t){r.add(t),t.updateMatrixWorld();var n=VE(e.extent.crs(),t.boundingVolume,t.matrixWorld);t.traverse((function(t){t.extent=n}))}));a.push(l)}}catch(t){o.e(t)}finally{o.f()}Promise.all(a).then((function(){r.pendingSubdivision=!1,t.instance.notifyChange(r)}),(function(){r.pendingSubdivision=!1;var t,n=FE(jE(r));try{for(n.s();!(t=n.n()).done;){var i=t.value;i.visible=!1,ZE(e,i)}}catch(t){n.e(t)}finally{n.f()}}))}(t,e,r)}(t,this,e,WE),e.additiveRefinement||e.pendingSubdivision)YE(e,!0);else{var a=this.tileIndex.index[e.tileId].children.filter((function(t){return t.isTileset}));if(a.length){var o,s=!0,l=FE(a);try{var u=function(){var t=o.value,r=e.children.filter((function(e){return e.tileId===t.tileId}))[0];if(!function(t,e){return t&&e&&1===e.children.length&&e.children[0].children.length>0}(t,r))return s=!1,"break"};for(l.s();!(o=l.n()).done;){if("break"===u())break}}catch(t){l.e(t)}finally{l.f()}YE(e,s)}else YE(e,!0)}n=jE(e)}else{YE(e,!0);var c,h=FE(jE(e));try{for(h.s();!(c=h.n()).done;){var d=c.value;d.visible=!1,ZE(this,d)}}catch(t){h.e(t)}finally{h.f()}}if(e.content&&e.content.visible){if(e.boundingVolume.region)throw new Error("boundingVolume.region is not yet supported");(e.boundingVolume.box||e.boundingVolume.sphere)&&(this._distance.min=Math.min(this._distance.min,e.distance.min),this._distance.max=Math.max(this._distance.max,e.distance.max)),e.content.traverse((function(t){t.layer===r&&t.material&&(t.material.wireframe=r.wireframe,t.isPoints&&(t.material.update?t.material.update(r.material):t.material.copy(r.material)))}))}}else e!==this.root&&e.parent&&e.parent.additiveRefinement&&ZE(this,e);return n}e.visible=!1}}]),r}(TE(oS()).default),zE={v:new OE.Vector3,b:new OE.Box3,s:new OE.Sphere};function GE(t,e,r,n,i,a){if(n.obj)return KE(r,n.obj),t.notifyChange(i),Promise.resolve(n.obj);var o;if(!i||i.additiveRefinement){var s=n.boundingVolume.box.clone().applyMatrix4(n._worldFromLocalTransform).getSize(zE.v);o=s.x*s.y}else{var l=i.boundingVolume.box.clone().applyMatrix4(i.matrixWorld).getSize(zE.v);o=l.x*l.y}var u={view:t,requester:i,layer:r,priority:o,metadata:n,redraw:a,earlyDropFunction:function(t){return t.requester&&(!t.requester.parent||!t.requester.visible||t.requester.sse<t.layer.sseThreshold)}};if(n.content){var c=n.content.url||n.content.uri,h=c.startsWith("http")?c:n.baseURL+c;u.toDownload={url:h}}return e.execute(u).then((function(t){return n.obj=t,t}))}function jE(t){return t.children.filter((function(e){return e.layer===t.layer&&e.tileId}))}function VE(t,e,r){if(e.region)return new DE.default("EPSG:4326",OE.MathUtils.radToDeg(e.region[0]),OE.MathUtils.radToDeg(e.region[2]),OE.MathUtils.radToDeg(e.region[1]),OE.MathUtils.radToDeg(e.region[3]));if(e.box){var n=zE.b.copy(e.box).applyMatrix4(r);return DE.default.fromBox3(t,n)}var i=zE.s.copy(e.sphere).applyMatrix4(r);return new DE.default(t,{west:i.center.x-i.radius,east:i.center.x+i.radius,south:i.center.y-i.radius,north:i.center.y+i.radius})}var HE=new OE.Matrix4;function WE(t,e,r){if(e.viewerRequestVolume){var n=e.viewerRequestVolume;if(n.region)return!0;if(n.box)return!0;if(n.sphere&&(zE.s.copy(n.sphere),zE.s.applyMatrix4(e.matrixWorld),!(t.camera3D.position.distanceTo(zE.s.center)<=zE.s.radius)))return!0}if(e.boundingVolume){var i=e.boundingVolume;if(i.region)return!t.isBox3Visible(i.region.box3D,r.clone().multiply(i.region.matrix));if(i.box)return!t.isBox3Visible(i.box,r);if(i.sphere)return!t.isSphereVisible(i.sphere,r)}return!1}function qE(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;KE(t,e),t.tileIndex.index[e.tileId].obj&&(t.tileIndex.index[e.tileId].obj.deleted=Date.now(),t.tileIndex.index[e.tileId].obj=void 0);var n,i=FE(jE(e));try{for(i.s();!(n=i.n()).done;){var a=n.value;qE(t,a,r+1),e.remove(a)}}catch(t){i.e(t)}finally{i.f()}e.content&&(e.content.traverse(XE),e.remove(e.content),delete e.content),e.dispose&&e.dispose()}function XE(t){var e,r=FE(t.children);try{for(r.s();!(e=r.n()).done;){XE(e.value)}}catch(t){r.e(t)}finally{r.f()}t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose(),t.remove.apply(t,(0,AE.default)(t.children))}function YE(t,e){t.content&&(t.content.visible=e)}function ZE(t,e){e.cleanableSince||(e.cleanableSince=Date.now(),t._cleanableTiles.push(e))}function KE(t,e){e.cleanableSince&&(t._cleanableTiles.splice(t._cleanableTiles.indexOf(e),1),e.cleanableSince=void 0)}function JE(t,e){if(e.distance.min=0,e.distance.max=0,e.boundingVolume.region)throw new Error("boundingVolume.region is unsupported");e.boundingVolume.box?(zE.b.copy(e.boundingVolume.box),zE.b.applyMatrix4(e.matrixWorld),e.distance.min=zE.b.distanceToPoint(t.position),e.distance.max=e.distance.min+zE.b.getSize(zE.v).length()):e.boundingVolume.sphere&&(zE.s.copy(e.boundingVolume.sphere),zE.s.applyMatrix4(e.matrixWorld),e.distance.min=Math.max(0,zE.s.distanceToPoint(t.position)),e.distance.max=e.distance.min+2*zE.s.radius)}var QE,$E=BE;function tA(){if(QE)return VS;QE=1;var t=uf;Object.defineProperty(VS,"__esModule",{value:!0}),VS.$3dTilesIndex=void 0,VS.configureTile=w,VS.default=void 0,VS.getObjectToUpdateForAttachedLayers=v;var e=t(pf()),r=t(yf()),n=Bf,i=t(pE()),a=t(vE()),o=t(Gb()),s=t(uE()),l=t(WM()),u=t(ME()),c=t(bE()),h=t(pM()),d=SE;function f(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var m=new n.Matrix4,g=function(){function t(r,i){(0,e.default)(this,t),this._counter=1,this.index={},this._inverseTileTransform=new n.Matrix4,this._recurse(r.root,i)}return(0,r.default)(t,[{key:"_recurse",value:function(t,e,r){if(t.transform=t.transform?(new n.Matrix4).fromArray(t.transform):m,t._worldFromLocalTransform=t.transform,r&&r._worldFromLocalTransform&&(t.transform?t._worldFromLocalTransform=(new n.Matrix4).multiplyMatrices(r._worldFromLocalTransform,t.transform):t._worldFromLocalTransform=r._worldFromLocalTransform),t._worldFromLocalTransform?this._inverseTileTransform.copy(t._worldFromLocalTransform).invert():this._inverseTileTransform.identity(),t.viewerRequestVolume=t.viewerRequestVolume?y(t.viewerRequestVolume,this._inverseTileTransform):void 0,t.boundingVolume=y(t.boundingVolume,this._inverseTileTransform),t.refine=t.refine||(r?r.refine:"ADD"),this.index[this._counter]=t,t.tileId=this._counter,t.baseURL=e,this._counter++,t.children){var i,a=f(t.children);try{for(a.s();!(i=a.n()).done;){var o=i.value;try{this._recurse(o,e,t)}catch(e){t.children[t.children.indexOf(o)]=void 0}}}catch(t){a.e(t)}finally{a.f()}t.children.length;t.children=t.children.filter((function(t){return void 0!==t})),t.children.length}}},{key:"extendTileset",value:function(t,e,r){this._recurse(t.root,r,this.index[e]),this.index[e].children=[t.root],this.index[e].isTileset=!0}}]),t}();function v(t){if(!t.content)return null;var e=[];t.content.traverse((function(r){r.isObject3D&&r.material&&r.layer===t.layer&&e.push(r)}));var r=t.parent;return r&&r.content?{elements:e,parent:r.content}:{elements:e}}function y(t){if(t.region)throw new Error("volume.region is unsupported");if(t.box){var e=t.box,r=new n.Vector3(e[0],e[1],e[2]),i=new n.Vector3(e[3],e[4],e[5]),a=new n.Vector3(e[6],e[7],e[8]),o=new n.Vector3(e[9],e[10],e[11]),s=r.clone().sub(i).sub(a).sub(o),l=r.clone().add(i).add(a).add(o),u=Math.min(s.x,l.x),c=Math.max(s.x,l.x),h=Math.min(s.y,l.y),d=Math.max(s.y,l.y),f=Math.min(s.z,l.z),p=Math.max(s.z,l.z),m=new n.Box3(new n.Vector3(u,h,f),new n.Vector3(c,d,p));if(0===m.getSize(new n.Vector3).length())throw new Error("Invalid boundingVolume (0 sized box)");return{box:m}}return t.sphere?{sphere:new n.Sphere(new n.Vector3(t.sphere[0],t.sphere[1],t.sphere[2]),t.sphere[3])}:null}function x(t,e,r){var a=n.LoaderUtils.extractUrlBase(r),o={gltfUpAxis:e.asset.gltfUpAxis,urlBase:a,overrideMaterials:e.overrideMaterials,doNotPatchMaterial:e.doNotPatchMaterial,opacity:e.opacity};return i.default.parse(t,o).then((function(t){return{batchTable:t.batchTable,object3d:t.gltf.scene}}))}function _(t,e){return a.default.parse(t).then((function(t){var r=e.material?e.material.clone():new c.default;r.enablePicking&&l.default.preparePointGeometryForPicking(t.point.geometry);var n=new u.default(e,t.point.geometry,r);return t.point.offset&&n.position.copy(t.point.offset),{object3d:n}}))}function w(t,e,r,n){t.frustumCulled=!1,t.layer=e,r.transform&&t.applyMatrix4(r.transform),t.geometricError=r.geometricError,t.tileId=r.tileId,r.refine?t.additiveRefinement="ADD"===r.refine.toUpperCase():t.additiveRefinement=!!n&&n.additiveRefinement,t.viewerRequestVolume=r.viewerRequestVolume,t.boundingVolume=r.boundingVolume,t.boundingVolume.region&&t.add(t.boundingVolume.region),t.distance={},t.updateMatrixWorld()}VS.$3dTilesIndex=g;var b={preprocessDataLayer:function(t,e,r){t.getObjectToUpdateForAttachedLayers=v,t.material&&t.material.enablePicking&&(t.pickObjectsAt=function(e,r,n){return l.default.pickPointsAt(e,r,n,t)});var n=t.url;return o.default.json(n,t.networkOptions).then((function(i){i.root.refine||(i.root.refine=i.refine);var a={boundingVolume:i.root.boundingVolume,geometricError:10*i.geometricError,refine:i.root.refine,transform:i.root.transform,children:[i.root]};i.root.transform=void 0,i.root=a,t.tileset=i;var o=n.slice(0,n.lastIndexOf("/")+1);return t.tileIndex=new g(i,o),t.asset=i.asset,(0,d.init3dTilesEntity)(e,r,t,i.root)}))},executeCommand:function(t){var e,r=t.layer,i=t.metadata,a=new n.Object3D;w(a,r,i,t.requester),i.content&&(e=i.content.url?i.content.url:i.content.uri);var l=function(t){t.layers.set(r.threejsLayer),t.userData.metadata=i,t.layer=r};if(e){var u=e.startsWith("http")?e:i.baseURL+e,c={b3dm:x,pnts:_};return(h.default.get(u)||h.default.set(u,o.default.arrayBuffer(u,r.networkOptions),h.default.TEXTURE)).then((function(t){if(void 0!==t){var e,n=s.default.decode(new Uint8Array(t,0,4));if(i.magic=n,"{"===n[0]){t=JSON.parse(s.default.decode(new Uint8Array(t)));var o=u.slice(0,u.lastIndexOf("/")+1);r.tileIndex.extendTileset(t,i.tileId,o)}else if("b3dm"===n)e=c.b3dm;else{if("pnts"!==n)return Promise.reject(new Error("Unsupported magic code ".concat(n)));e=c.pnts}if(e)return e(t,r,u).then((function(t){return a.content=t.object3d,t.batchTable&&(a.batchTable=t.batchTable),a.add(t.object3d),a.traverse(l),a}))}return a.traverse(l),a}))}return a.traverse(l),Promise.resolve(a)}};return VS.default=b,VS}EE=SE.default=$E;var eA,rA={},nA={};var iA,aA,oA,sA={},lA={},uA={};function cA(){if(oA)return aA;oA=1,aA=e;var t=(iA||(iA=1,uA.read=function(t,e,r,n,i){var a,o,s=8*i-n-1,l=(1<<s)-1,u=l>>1,c=-7,h=r?i-1:0,d=r?-1:1,f=t[e+h];for(h+=d,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+t[e+h],h+=d,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=n;c>0;o=256*o+t[e+h],h+=d,c-=8);if(0===a)a=1-u;else{if(a===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),a-=u}return(f?-1:1)*o*Math.pow(2,a-n)},uA.write=function(t,e,r,n,i,a){var o,s,l,u=8*a-i-1,c=(1<<u)-1,h=c>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:a-1,p=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),(e+=o+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=c?(s=0,o=c):o+h>=1?(s=(e*l-1)*Math.pow(2,i),o+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;t[r+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,u+=i;u>0;t[r+f]=255&o,f+=p,o/=256,u-=8);t[r+f-p]|=128*m}),uA);function e(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var r=4294967296,n=1/r,i="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function a(t){return t.type===e.Bytes?t.readVarint()+t.pos:t.pos+1}function o(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function s(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=t;i--)r.buf[i+n]=r.buf[i]}function l(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function u(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function c(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function h(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function d(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function f(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function p(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function m(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function g(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function v(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function y(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function x(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,a=this.pos;this.type=7&n,t(i,e,this),this.pos===a&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=v(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=x(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=v(this.buf,this.pos)+v(this.buf,this.pos+4)*r;return this.pos+=8,t},readSFixed64:function(){var t=v(this.buf,this.pos)+x(this.buf,this.pos+4)*r;return this.pos+=8,t},readFloat:function(){var e=t.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=t.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(t,e,r){var n,i,a=r.buf;if(i=a[r.pos++],n=(112&i)>>4,i<128)return o(t,n,e);if(i=a[r.pos++],n|=(127&i)<<3,i<128)return o(t,n,e);if(i=a[r.pos++],n|=(127&i)<<10,i<128)return o(t,n,e);if(i=a[r.pos++],n|=(127&i)<<17,i<128)return o(t,n,e);if(i=a[r.pos++],n|=(127&i)<<24,i<128)return o(t,n,e);if(i=a[r.pos++],n|=(1&i)<<31,i<128)return o(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&i?function(t,e,r){return i.decode(t.subarray(e,r))}(this.buf,e,t):function(t,e,r){var n="",i=e;for(;i<r;){var a,o,s,l=t[i],u=null,c=l>239?4:l>223?3:l>191?2:1;if(i+c>r)break;1===c?l<128&&(u=l):2===c?128==(192&(a=t[i+1]))&&(u=(31&l)<<6|63&a)<=127&&(u=null):3===c?(a=t[i+1],o=t[i+2],128==(192&a)&&128==(192&o)&&((u=(15&l)<<12|(63&a)<<6|63&o)<=2047||u>=55296&&u<=57343)&&(u=null)):4===c&&(a=t[i+1],o=t[i+2],s=t[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&((u=(15&l)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,c=1):u>65535&&(u-=65536,n+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),n+=String.fromCharCode(u),i+=c}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,r){if(this.type!==e.Bytes)return t.push(this.readVarint(r));var n=a(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(r));return t},readPackedSVarint:function(t){if(this.type!==e.Bytes)return t.push(this.readSVarint());var r=a(this);for(t=t||[];this.pos<r;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==e.Bytes)return t.push(this.readBoolean());var r=a(this);for(t=t||[];this.pos<r;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==e.Bytes)return t.push(this.readFloat());var r=a(this);for(t=t||[];this.pos<r;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==e.Bytes)return t.push(this.readDouble());var r=a(this);for(t=t||[];this.pos<r;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==e.Bytes)return t.push(this.readFixed32());var r=a(this);for(t=t||[];this.pos<r;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==e.Bytes)return t.push(this.readSFixed32());var r=a(this);for(t=t||[];this.pos<r;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==e.Bytes)return t.push(this.readFixed64());var r=a(this);for(t=t||[];this.pos<r;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==e.Bytes)return t.push(this.readSFixed64());var r=a(this);for(t=t||[];this.pos<r;)t.push(this.readSFixed64());return t},skip:function(t){var r=7&t;if(r===e.Varint)for(;this.buf[this.pos++]>127;);else if(r===e.Bytes)this.pos=this.readVarint()+this.pos;else if(r===e.Fixed32)this.pos+=4;else{if(r!==e.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),y(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),y(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),y(this.buf,-1&t,this.pos),y(this.buf,Math.floor(t*n),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),y(this.buf,-1&t,this.pos),y(this.buf,Math.floor(t*n),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,n;t>=0?(r=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,n=n+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t}(r,0,e),function(t,e){var r=(7&t)<<4;if(e.buf[e.pos++]|=r|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var n,i,a=0;a<e.length;a++){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){n>56319||a+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):i=n;continue}if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(t[r++]=239,t[r++]=191,t[r++]=189,i=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=63&n|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&s(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),t.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),t.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&s(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,r,n){this.writeTag(t,e.Bytes),this.writeRawMessage(r,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,l,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,u,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,d,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,c,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,h,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,f,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,p,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,m,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,g,e)},writeBytesField:function(t,r){this.writeTag(t,e.Bytes),this.writeBytes(r)},writeFixed32Field:function(t,r){this.writeTag(t,e.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(t,r){this.writeTag(t,e.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(t,r){this.writeTag(t,e.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(t,r){this.writeTag(t,e.Fixed64),this.writeSFixed64(r)},writeVarintField:function(t,r){this.writeTag(t,e.Varint),this.writeVarint(r)},writeSVarintField:function(t,r){this.writeTag(t,e.Varint),this.writeSVarint(r)},writeStringField:function(t,r){this.writeTag(t,e.Bytes),this.writeString(r)},writeFloatField:function(t,r){this.writeTag(t,e.Fixed32),this.writeFloat(r)},writeDoubleField:function(t,r){this.writeTag(t,e.Fixed64),this.writeDouble(r)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}},aA}var hA,dA,fA,pA,mA,gA,vA,yA,xA,_A={};function wA(){if(pA)return fA;pA=1;var t=function(){if(dA)return hA;function t(t,e){this.x=t,this.y=e}return dA=1,hA=t,t.prototype={clone:function(){return new t(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=e*this.x-r*this.y,i=r*this.x+e*this.y;return this.x=n,this.y=i,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),i=e.x+r*(this.x-e.x)-n*(this.y-e.y),a=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=i,this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},t.convert=function(e){return e instanceof t?e:Array.isArray(e)?new t(e[0],e[1]):e},hA}();function e(t,e,n,i,a){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=a,t.readFields(r,this,e)}function r(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){var r=t.readVarint()+t.pos;for(;t.pos<r;){var n=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[n]=i}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function n(t){for(var e,r,n=0,i=0,a=t.length,o=a-1;i<a;o=i++)e=t[i],n+=((r=t[o]).x-e.x)*(e.y+r.y);return n}return fA=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var r,n=e.readVarint()+e.pos,i=1,a=0,o=0,s=0,l=[];e.pos<n;){if(a<=0){var u=e.readVarint();i=7&u,a=u>>3}if(a--,1===i||2===i)o+=e.readSVarint(),s+=e.readSVarint(),1===i&&(r&&l.push(r),r=[]),r.push(new t(o,s));else{if(7!==i)throw new Error("unknown command "+i);r&&r.push(r[0].clone())}}return r&&l.push(r),l},e.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,n=0,i=0,a=0,o=1/0,s=-1/0,l=1/0,u=-1/0;t.pos<e;){if(n<=0){var c=t.readVarint();r=7&c,n=c>>3}if(n--,1===r||2===r)(i+=t.readSVarint())<o&&(o=i),i>s&&(s=i),(a+=t.readSVarint())<l&&(l=a),a>u&&(u=a);else if(7!==r)throw new Error("unknown command "+r)}return[o,l,s,u]},e.prototype.toGeoJSON=function(t,r,i){var a,o,s=this.extent*Math.pow(2,i),l=this.extent*t,u=this.extent*r,c=this.loadGeometry(),h=e.types[this.type];function d(t){for(var e=0;e<t.length;e++){var r=t[e],n=180-360*(r.y+u)/s;t[e]=[360*(r.x+l)/s-180,360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90]}}switch(this.type){case 1:var f=[];for(a=0;a<c.length;a++)f[a]=c[a][0];d(c=f);break;case 2:for(a=0;a<c.length;a++)d(c[a]);break;case 3:for(c=function(t){var e=t.length;if(e<=1)return[t];for(var r,i,a=[],o=0;o<e;o++){var s=n(t[o]);0!==s&&(void 0===i&&(i=s<0),i===s<0?(r&&a.push(r),r=[t[o]]):r.push(t[o]))}r&&a.push(r);return a}(c),a=0;a<c.length;a++)for(o=0;o<c[a].length;o++)d(c[a][o])}1===c.length?c=c[0]:h="Multi"+h;var p={type:"Feature",geometry:{type:h,coordinates:c},properties:this.properties};return"id"in this&&(p.id=this.id),p},fA}function bA(){if(gA)return mA;gA=1;var t=wA();function e(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(r,this,e),this.length=this._features.length}function r(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){var e=null,r=t.readVarint()+t.pos;for(;t.pos<r;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(r))}return mA=e,e.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var r=this._pbf.readVarint()+this._pbf.pos;return new t(this._pbf,r,this.extent,this._keys,this._values)},mA}function MA(){return xA||(xA=1,_A.VectorTile=function(){if(yA)return vA;yA=1;var t=bA();function e(e,r,n){if(3===e){var i=new t(n,n.readVarint()+n.pos);i.length&&(r[i.name]=i)}}return vA=function(t,r){this.layers=t.readFields(e,{},r)}}(),_A.VectorTileFeature=wA(),_A.VectorTileLayer=bA()),_A}var SA,TA,EA={};function AA(){if(SA)return EA;SA=1;var t=uf;Object.defineProperty(EA,"__esModule",{value:!0}),EA.default=void 0;var e=t(Ux()),r=t(DM());function n(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){l=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function a(t,e){var r,i=n(t);try{for(i.s();!(r=i.n()).done;){r.value.offset+=e}}catch(t){i.e(t)}finally{i.f()}return t}var o=new e.default("EPSG:4978",0,0,0);function s(t,r,i,a,s){var l=0;s&&(l=s.length,s.length+=i.length);var u,c=s||new Array(i.length),h=0,d=1,f=n(i);try{for(f.s();!(u=f.n()).done;){var p=u.value;"number"==typeof p[2]&&(d=p[2]),t===r?c[l+h]=new e.default(t,p[0],p[1],d):(o.set(t,p[0],p[1],d),c[l+h]=o.as(r)),a&&a.expandByPoint(c[l+h]),++h}}catch(t){f.e(t)}finally{f.f()}return c}var l={point:function(t,e,n,i,a,o){var l=o.buildExtent?new r.default(n,1/0,-1/0,1/0,-1/0):void 0,u=s(e,n,i,l);return a&&(u=u.filter((function(t){return a.isPointInside(t)}))),t.vertices=t.vertices.concat(u),t.geometry.push({extent:l}),t},polygon:function(t,e,n,i,a,o){var l=o.buildExtent?new r.default(n,1/0,-1/0,1/0,-1/0):void 0,u=s(e,n,i[0],l);if(a&&!a.isPointInside(u[0]))return null;for(var c=[{offset:0,count:u.length}],h=u.length,d=1;d<i.length;d++){s(e,n,i[d],l,u);var f=u.length-h;c.push({offset:h,count:f}),h+=f}return t.vertices=t.vertices.concat(u),t.geometry.push({extent:l,indices:c}),t},lineString:function(t,e,n,i,a,o){var l=o.buildExtent?new r.default(n,1/0,-1/0,1/0,-1/0):void 0,u=s(e,n,i,l);if(a&&!a.isPointInside(u[0]))return null;var c=[{offset:0,count:u.length}];return t.vertices=t.vertices.concat(u),t.geometry.push({extent:l,indices:c}),t},multi:function(t,e,r,i,o,s,l){if(1===o.length)return this[t](e,r,i,o[0],s,l);var u,c,h=0,d=n(o);try{for(d.s();!(c=d.n()).done;){var f=c.value;if(this[t](e,r,i,f,s,l)){a(u=e.geometry[e.geometry.length-1].indices,h);var p=u[u.length-1];h=p.offset+p.count}}}catch(t){d.e(t)}finally{d.f()}return e}};function u(t,e,r,i,a){if(a.filter&&!a.filter(r.properties,r.geometry))return null;var o={type:r.geometry.type.toLowerCase(),geometry:[],vertices:[]};if(function(t,e,r,n,i,a){if(0===n.length)return null;switch(t.type){case"point":return l.point(t,e,r,[n],i,a);case"multipoint":return l.multi("point",t,e,r,n,i,a);case"linestring":return l.lineString(t,e,r,n,i,a);case"multilinestring":return l.multi("lineString",t,e,r,n,i,a);case"polygon":return l.polygon(t,e,r,n,i,a);case"multipolygon":return l.multi("polygon",t,e,r,n,i,a);default:throw new Error("Unhandled geometry type ".concat(t.type))}}(o,t,e,r.geometry.coordinates,i,a),0===o.geometry.length)return null;if(a.buildExtent){var s,u=n(o.geometry);try{for(u.s();!(s=u.n()).done;){var c=s.value;o.extent=o.extent||c.extent,o.extent.union(c.extent)}}catch(t){u.e(t)}finally{u.f()}}o.properties=r.properties||{};for(var h=0,d=Object.keys(r);h<d.length;h++){var f=d[h];["type","geometry","properties"].indexOf(f.toLowerCase())<0&&(o.properties[f]=r[f])}return a.featureCb instanceof Function&&a.featureCb(o),o}function c(t,e,r,i,a){var o,s={features:[]},l=n(r);try{for(l.s();!(o=l.n()).done;){var c=u(t,e,o.value,i,a);c&&(a.buildExtent&&(s.extent?s.extent.union(c.extent):s.extent=c.extent.clone()),s.features.push(c))}}catch(t){l.e(t)}finally{l.f()}return s}var h={parse:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.crsOut,n=e.filteringExtent;switch("string"==typeof t&&(t=JSON.parse(t)),e.crsIn=e.crsIn||function(t){if(t.crs){if("epsg"===t.crs.type.toLowerCase())return"EPSG:".concat(t.crs.properties.code);if("name"===t.crs.type.toLowerCase()){var e=t.crs.properties.name.toLowerCase().indexOf("epsg:");if(e>=0){var r=t.crs.properties.name.indexOf(":",e+5);if(r>0)return"EPSG:".concat(t.crs.properties.name.substr(r+1))}}throw new Error("Unsupported CRS type '".concat(t.crs,"'"))}return"EPSG:4326"}(t),t.type.toLowerCase()){case"featurecollection":return Promise.resolve(c(e.crsIn,r,t.features,n,e));case"feature":return Promise.resolve(c(e.crsIn,r,[t],n,e));default:throw new Error("Unsupported GeoJSON type: '".concat(t.type))}}};return EA.default=h,EA}function RA(){if(TA)return lA;TA=1;var t=uf;Object.defineProperty(lA,"__esModule",{value:!0}),lA.default=void 0;var e=t(cA()),r=MA(),n=t(AA());t(DM());var i={parse:function(t,i){return Promise.resolve(function(t,i){var a=new r.VectorTile(new e.default(t)),o=Object.keys(a.layers);if(o.length<1)return null;var s,l={type:"FeatureCollection",features:[],crs:{type:"EPSG",properties:{code:4326}},extent:i.extent};o.forEach((function(t){for(var e=a.layers[t],r=0;r<e.length;r++){var n=void 0;if("top"===i.origin)n=e.feature(r).toGeoJSON(i.coords.col,i.coords.row,i.coords.zoom);else{var s=1<<i.coords.zoom;n=e.feature(r).toGeoJSON(i.coords.col,s-i.coords.row-1,i.coords.zoom)}o.length>1&&(n.properties.vt_layer=t),l.features.push(n)}})),s="WMTS:PM"===i.coords.crs()?"EPSG:3857":i.extent.crs();return n.default.parse(l,{crsOut:s,filteringExtent:i.filteringExtent,filter:i.filter,buildExtent:!0})}(t,i))}};return lA.default=i,lA}var PA,CA,IA,LA={};function OA(){if(PA)return LA;PA=1,Object.defineProperty(LA,"__esModule",{value:!0}),LA.default=void 0;var t=Bf;function e(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){l=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var n=new t.Vector2;function i(t,e,r,i){n.x=e._values[0]-i.x,n.y=i.y-e._values[1],n.multiply(r),t.moveTo(n.x,n.y)}function a(t,e,r,i){n.x=e._values[0]-i.x,n.y=i.y-e._values[1],n.multiply(r),t.lineTo(n.x,n.y)}function o(t,r,n,i,a,o){var l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};if(0!==r.length)if(l.length){var u,c=e(l);try{for(c.s();!(u=c.n()).done;){s(t,r,n,i,a,o,u.value)}}catch(t){c.e(t)}finally{c.f()}}else s(t,r,n,i,a,o,l)}function s(t,r,n,o,s,l,u){t.beginPath();var c,h=e(n);try{for(h.s();!(c=h.n()).done;){var d=c.value;i(t,r[d.offset],s,o);for(var f=1;f<d.count;f++)a(t,r[d.offset+f],s,o)}}catch(t){h.e(t)}finally{h.f()}(u.stroke||l.stroke)&&(t.strokeStyle=u.stroke||l.stroke,t.lineWidth=u.strokeWidth||l["stroke-width"]||2,t.globalAlpha=u.strokeOpacity||l["stroke-opacity"]||1,t.lineCap=u.strokeCap||l["stroke-cap"]||"butt",t.stroke()),n&&(u.fill||l.fill)&&(t.fillStyle=u.fill||l.fill,t.globalAlpha=u.fillOpacity||l["fill-opacity"]||1,t.fill())}function l(t,e,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};n.x=e._values[0]-r.x,n.y=r.y-e._values[1],n.multiply(i),t.beginPath(),t.arc(n.x,n.y,a.radius||3,0,2*Math.PI,!1),t.fillStyle=a.fill||"white",t.fill(),t.lineWidth=a.lineWidth||1,t.strokeStyle=a.stroke||"red",t.stroke()}function u(t,r,n,i,a){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},u=r.properties;"function"==typeof s&&(s=s(u,r));var c,h=e(r.geometry);try{for(h.s();!(c=h.n()).done;){var d=c.value;"point"===r.type?l(t,r.vertices[0],n,i,s):d.extent.intersectsExtent(a)&&o(t,r.vertices,d.indices,n,i,u,s)}}catch(t){h.e(t)}finally{h.f()}}var c={createTextureFromFeature:function(r,n,i,a,o){var s;if(r){var l=new t.Vector2(n.west(),n.north()),c=n.dimensions(),h=document.createElement("canvas");h.width=i,h.height=i;var d=h.getContext("2d");o&&(d.fillStyle=o.getStyle(),d.fillRect(0,0,i,i)),d.globalCompositeOperation=a.globalCompositeOperation||"source-over";var f,p=new t.Vector2(d.canvas.width/c.x,d.canvas.width/c.y),m=e(r.features);try{for(m.s();!(f=m.n()).done;){u(d,f.value,l,p,n,a)}}catch(t){m.e(t)}finally{m.f()}(s=new t.Texture(h)).flipY=!1,s.generateMipmaps=!1,s.magFilter=t.LinearFilter,s.minFilter=t.LinearFilter,s.needsUpdate=!0}else if(o){var g=new Uint8Array(3);g[0]=255*o.r,g[1]=255*o.g,g[2]=255*o.b,(s=new t.DataTexture(g,1,1,t.RGBFormat)).needsUpdate=!0}else s=new t.Texture;return s},featuresAtPoint:function(r,n,i,a,o,s){if(!r)return[];var l=[],c=n.dimensions(),h=new t.Vector2(i/c.x,i/c.y),d=new t.Vector2(o.x-s/h.x,o.y+s/h.y),f=document.createElement("canvas");f.width=1+2*s,f.height=1+2*s;var p=f.getContext("2d");p.globalCompositeOperation="source-over";var m,g=e(r.features);try{for(g.s();!(m=g.n()).done;){var v=m.value;p.clearRect(0,0,f.width,f.height),u(p,v,d,h,n,a);for(var y=p.getImageData(0,0,f.width,f.height),x=y.data,_=!1,w=0;w<y.data.length&&!(_=_||x[w+3]>0);w+=4);_&&l.push(v)}}catch(t){g.e(t)}finally{g.f()}return l}};return LA.default=c,LA}function DA(){if(IA)return rA;IA=1;var t=uf;Object.defineProperty(rA,"__esModule",{value:!0}),rA.default=void 0;var e=t(px()),r=t(Nx()),n=Bf,i=t(FM()),a=t(function(){if(eA)return nA;eA=1;var t=uf;return Object.defineProperty(nA,"__esModule",{value:!0}),nA.default=void 0,t(DM()),t(jb()),nA.default={xyz:function(t,e){return e.url.replace(/(\$\{z\}|%TILEMATRIX)/,t.zoom).replace(/(\$\{y\}|%ROW)/,t.row).replace(/(\$\{x\}|%COL)/,t.col)},bbox:function(t,e){var r="EPSG:4326"===e.projection?9:2,n=t.crs()===e.projection?t:t.as(e.projection),i=n.west().toFixed(r),a=n.south().toFixed(r),o=n.east().toFixed(r),s=n.north().toFixed(r),l=e.axisOrder||"wsen";return l=l.replace("w","".concat(i,",")).replace("s","".concat(a,",")).replace("e","".concat(o,",")).replace("n","".concat(s,",")).slice(0,-1),e.url.replace("%bbox",l)}},nA}()),o=t(DM()),s=t(function(){if(CA)return sA;CA=1;var t=uf;Object.defineProperty(sA,"__esModule",{value:!0}),sA.default=void 0;var e=Bf,r=t(Gb()),n=t(pM()),i=t(RA()),a=t(OA());t(DM()),t(NM()),t(jb());var o=t(Qb()),s=function(t,e,n,a){return r.default.arrayBuffer(t,n.networkOptions).then((function(t){return i.default.parse(t,{extent:e.extent,filteringExtent:n.extent,filter:n.filter,origin:n.origin,coords:a})}))},l={getVectorTileByUrl:s,getVectorTileTextureByUrl:function(t,r,i,l){return i instanceof o.default?null:n.default.get(t)||n.default.set(t,s(t,r,i,l).then((function(t){var n,o=i.backgroundLayer&&i.backgroundLayer.paint?new e.Color(i.backgroundLayer.paint["background-color"]):void 0;switch(l.crs()){case"TMS":n=r.extent;break;case"WMTS:PM":n=l.as("EPSG:3857");break;default:n=l.as(r.extent.crs())}var s=a.default.createTextureFromFeature(t,n,256,i.style,o);return s.extent=r.extent,s.coords=l,s})))}};return sA.default=l,sA}()),l=Ob();function u(t,e,r,o){var s=new n.Vector4(0,0,1,1),u=function(t,e,r,n,a){if(r.updateStrategy.type===l.STRATEGY_MIN_NETWORK_TRAFFIC)return t;var o,s,u,c=0;if(e){if(t.zoom<=e.zoom+1)return t;switch(r.updateStrategy.type){case l.STRATEGY_PROGRESSIVE:c+=1;break;case l.STRATEGY_GROUP:o=t.zoom,e.zoom,c=(u=(s=r.updateStrategy.options).groups.filter((function(t){return t<=o}))).length?u[u.length-1]:s.groups[0];break;default:case l.STRATEGY_DICHOTOMY:c=Math.ceil((e.zoom+t.zoom)/2)}}return a&&a.extent&&a.extent.zoom===c&&(c=Math.ceil((e.zoom+c)/2)),c=Math.min(Math.max(c,r.options.zoom.min),r.options.zoom.max),t.zoom<=c?t:i.default.WMTS_WGS84Parent(t,c,n)}(e,r&&r.extent?r.extent:null,t,s,o);return r&&r.extent&&r.extent.zoom===u.zoom?null:{extent:u,pitch:s,url:a.default.xyz(u,t)}}function c(t,e){return h(t.getExtentForLayer(e),e)}function h(t,e){return e.options.zoom.min<=t.zoom&&t.zoom<=e.options.zoom.max}var d={preprocessDataLayer:function(t){if(t.extent||(t.extent=new o.default("EPSG:3857",-20037508.342789244,20037508.342789244,-20037508.342789244,20037508.342789244)),!(t.extent instanceof o.default)){if(!t.projection)throw new Error("Missing projection property for layer '".concat(t.id,"'"));t.extent=(0,e.default)(o.default,[t.projection].concat((0,r.default)(t.extent)))}t.origin=t.origin||("xyz"===t.protocol?"top":"bottom"),t.options.zoom||(t.options.zoom={min:0,max:18}),t.fx=t.fx||0},executeCommand:function(t){var e=t.layer;return("application/x-protobuf;type=mapbox-vector"===e.format?s.default.getVectorTileTextureByUrl(t.toDownload,t.requester,e):i.default.getColorTextureByUrl(t.toDownload,e.networkOptions)).then((function(t){var r={};return r.texture=t,e.transparent&&(t.premultiplyAlpha=!0),r}))},tileTextureCount:function(t,e){return c(t,e)?1:0},tileInsideLimit:c,getPossibleTextureImprovements:function(t,e,r,n){return h(e,t)?e.zoom>t.options.zoom.max?null:r?(!r.extent||r.extent.zoom<e.zoom)&&u(t,e,r,n):u(t,e,r,n):null}};return rA.default=d,rA}var kA,FA={},NA={};function UA(){if(kA)return NA;kA=1;var t=uf;Object.defineProperty(NA,"__esModule",{value:!0}),NA.default=void 0;var e=Bf,r=t(Jb());function n(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){l=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var a={v:new e.Vector3};function o(t,e,r,n){if(n<=0)return 1/0;var i=e.metadata.spacing/Math.pow(2,r.name.length),a=t.camera.preSSE*i/n;return Math.max(0,a-e.pointSize)}function s(t){t.obj&&(t.obj.material.visible=!1),t.notVisibleSince||(t.notVisibleSince=Date.now(),t.sse=-1);var e,r=n(t.children);try{for(r.s();!(e=r.n()).done;){s(e.value)}}catch(t){r.e(t)}finally{r.f()}}function l(t,e,r){var n=t.distance.plane.distanceToPoint(r.getCenter()),i=.5*r.getSize(a.v).length();return e._distance.min=Math.min(e._distance.min,n-i),e._distance.max=Math.max(e._distance.max,n+i),n}var u={preUpdate:function(t){return function(r,i){if(!t.root)return[];var a;r.camera.preSSE=r.camera.height/(2*Math.tan(.5*e.MathUtils.degToRad(r.camera.camera3D.fov))),t.material&&(t.material.visible=t.visible,t.material.opacity=t.opacity,t.material.transparent=t.opacity<1,t.material.size=t.pointSize);var o,s=n(i.values());try{for(s.s();!(o=s.n()).done;){var l=o.value;if(l.isCamera||l===t)return[t.root];if(void 0!==l.obj&&(l.obj.isPoints&&l.obj.layer===t))if(a){var u=Math.min(l.name.length,a.length),c=void 0;for(c=0;c<u&&l.name[c]===a[c];c++);if(0===(a=a.substr(0,c)).length)break}else a=l.name}}catch(t){s.e(t)}finally{s.f()}return a&&(r.fastUpdateHint=a),[t.root]}},update:function(t){return function(e,i){if(t.octreeDepthLimit>=0&&t.octreeDepthLimit<i.name.length)return s(i),null;var a=i.tightbbox?i.tightbbox:i.bbox;if(e.fastUpdateHint&&!i.name.startsWith(e.fastUpdateHint)){if(!i.visible)return null;l(e,t,a)}else{if(i.visible=e.camera.isBox3Visible(a,t.object3d.matrixWorld),!i.visible)return s(i),null;var u=l(e,t,a);if(i.notVisibleSince=void 0,i.numPoints>0)if(i.obj)i.obj.material.update?i.obj.material.update(t.material):i.obj.material.copy(t.material);else if(!i.promise){var c=o(e,t,i,u)/Math.max(.001,u);i.promise=e.scheduler.execute({layer:t,requester:i,view:e.instance,priority:c,redraw:!0,isLeaf:0===i.childrenBitField,earlyDropFunction:function(e){return!e.requester.visible||!t.visible}}).then((function(e){t.onPointsCreated&&t.onPointsCreated(t,e),i.obj=e,i.tightbbox=e.tightbbox,t.group.add(i.obj),i.obj.updateMatrixWorld(!0),i.promise=null}),(function(t){t instanceof r.default&&(i.promise=null)}))}i.children&&i.children.length&&(i.sse=o(e,t,i,u)/t.sseThreshold)}if(i.children&&i.children.length){if(i.sse>=1)return i.children;var h,d=n(i.children);try{for(d.s();!(h=d.n()).done;){s(h.value)}}catch(t){d.e(t)}finally{d.f()}}return null}},postUpdate:function(t){return function(){if(t.group){t.displayedCount=0;var e,r=n(t.group.children);try{for(r.s();!(e=r.n()).done;){var i=e.value;if(i.material.visible){var a=i.geometry.attributes.position.count;i.geometry.setDrawRange(0,a),t.displayedCount+=a}}}catch(t){r.e(t)}finally{r.f()}if(t.displayedCount>t.pointBudget)if(t.supportsProgressiveDisplay){var o,s=t.pointBudget/t.displayedCount,l=n(t.group.children);try{for(l.s();!(o=l.n()).done;){var u=o.value;if(u.material.visible){var c=Math.floor(u.geometry.drawRange.count*s);c>0?u.geometry.setDrawRange(0,c):u.material.visible=!1}}}catch(t){l.e(t)}finally{l.f()}t.displayedCount*=s}else{t.group.children.sort((function(t,e){return e.userData.metadata.sse-t.userData.metadata.sse}));var h=!1;t.displayedCount=0;var d,f=n(t.group.children);try{for(f.s();!(d=f.n()).done;){var p=d.value,m=p.geometry.attributes.position.count;h||t.displayedCount+m>t.pointBudget?(p.material.visible=!1,h=!0):t.displayedCount+=m}}catch(t){f.e(t)}finally{f.f()}}for(var g=Date.now(),v=t.group.children.length-1;v>=0;v--){var y=t.group.children[v],x=y.userData.metadata.notVisibleSince;!y.material.visible&&g-x>1e4&&(t.group.children.splice(v,1),y.material.dispose(),y.geometry.dispose(),y.material=null,y.geometry=null,y.userData.metadata.obj=null)}}}}};return NA.default=u,NA}var BA,zA={};function GA(){if(BA)return zA;BA=1,Object.defineProperty(zA,"__esModule",{value:!0}),zA.default=void 0;var t=Bf;function e(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){l=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}for(var n={POSITION_CARTESIAN:{numElements:3,ArrayType:Float32Array,attributeName:"position"},COLOR_PACKED:{numElements:4,ArrayType:Uint8Array,attributeName:"color",normalized:!0},INTENSITY:{numElements:1,numByte:2,ArrayType:Float32Array,attributeName:"intensity",normalized:!0},CLASSIFICATION:{numElements:1,ArrayType:Uint8Array,attributeName:"classification"},NORMAL_SPHEREMAPPED:{numElements:2,ArrayType:Uint8Array,attributeName:"sphereMappedNormal"},NORMAL_OCT16:{numElements:2,ArrayType:Uint8Array,attributeName:"oct16Normal"},NORMAL:{numElements:3,ArrayType:Float32Array,attributeName:"normal"}},i=function(){var t=o[a],e=n[t];e.potreeName=t,e.numByte=e.numByte||e.ArrayType.BYTES_PER_ELEMENT,e.byteSize=e.numElements*e.numByte,e.normalized=e.normalized||!1;var r="getUint".concat(8*e.numByte);e.getValue=1===e.numByte?function(t,e){return t[r](e)}:function(t,e){return t[r](e,!0)}},a=0,o=Object.keys(n);a<o.length;a++)i();var s={parse:function(r,i){if(!r)throw new Error("No array buffer provided.");var a,o=new DataView(r),s=0,l=e(i);try{for(l.s();!(a=l.n()).done;){var u=a.value;s+=n[u].byteSize}}catch(t){l.e(t)}finally{l.f()}var c,h=Math.floor(r.byteLength/s),d=new t.BufferGeometry,f=0,p=0,m=e(i);try{for(m.s();!(c=m.n()).done;){for(var g=c.value,v=n[g],y=v.numElements*h,x=new v.ArrayType(y),_=0;_<y;_+=v.numElements){for(var w=0;w<v.numElements;w++)x[_+w]=v.getValue(o,p+w*v.numByte);p+=s}p=f+=v.byteSize,d.setAttribute(v.attributeName,new t.BufferAttribute(x,v.numElements,v.normalized))}}catch(t){m.e(t)}finally{m.f()}return d.computeBoundingBox(),Promise.resolve(d)}};return zA.default=s,zA}var jA,VA,HA={};function WA(){if(VA)return FA;VA=1;var t=uf,e=cf;Object.defineProperty(FA,"__esModule",{value:!0}),FA.default=FA._testing=void 0,FA.getObjectToUpdateForAttachedLayers=v;var r=Bf,n=t(Gb()),i=t(UA()),a=t(GA()),o=t(function(){if(jA)return HA;jA=1,Object.defineProperty(HA,"__esModule",{value:!0}),HA.default=void 0;var t=Bf,e={parse:function(e){if(!e)throw new Error("No array buffer provided.");var r=new DataView(e,0,24),n=new t.Vector3(r.getFloat32(0,!0),r.getFloat32(4,!0),r.getFloat32(8,!0)),i=new t.Vector3(r.getFloat32(12,!0),r.getFloat32(16,!0),r.getFloat32(20,!0)),a=new t.Box3(n,i),o=Math.floor((e.byteLength-24)/16),s=new Float32Array(e,24,3*o),l=new Uint8Array(e,24+12*o,4*o),u=new t.BufferGeometry;return u.setAttribute("position",new t.BufferAttribute(s,3)),u.setAttribute("color",new t.BufferAttribute(l,4,!0)),u.boundingBox=a,Promise.resolve(u)}};return HA.default=e,HA}()),s=function(t,r){if(!r&&t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var n=h(r);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=a?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=t[o]}i.default=t,n&&n.set(t,i);return i}(bE()),l=t(WM()),u=t(DM()),c=t(ME());function h(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(h=function(t){return t?r:e})(t)}function d(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return f(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function p(t,e,i){return n.default.arrayBuffer("".concat(i.baseurl,"/r").concat(i.name,".hrc"),t.networkOptions).then((function(n){var a,o,s,l,u,c,h,d,f,p,m=new DataView(n),g=[],v=0;for(i.childrenBitField=m.getUint8(0),v+=1,i.numPoints=m.getUint32(1,!0),v+=4,i.children=[],g.push(i);g.length&&v<n.byteLength;)for(var y=g.shift(),x=0;x<8;x++)if(y.childrenBitField&1<<x&&v+5<=n.byteLength){var _=m.getUint8(v);v+=1;var w=m.getUint32(v,!0);v+=4,0===w&&(w=i.numPoints);var b=y.name+x,M=(a=y.bbox,o=x,s=void 0,l=void 0,u=void 0,c=void 0,h=void 0,d=void 0,f=void 0,p=void 0,s=a.min,l=a.max,u=(new r.Vector3).copy(l).sub(s).multiplyScalar(.5),c=new r.Vector3(u.x,0,0),h=new r.Vector3(0,u.y,0),d=new r.Vector3(0,0,u.z),f=s,p=(new r.Vector3).add(s).add(u),1===o?(s=(new r.Vector3).copy(f).add(d),l=(new r.Vector3).copy(p).add(d)):3===o?(s=(new r.Vector3).copy(f).add(d).add(h),l=(new r.Vector3).copy(p).add(d).add(h)):0===o?(s=f,l=p):2===o?(s=(new r.Vector3).copy(f).add(h),l=(new r.Vector3).copy(p).add(h)):5===o?(s=(new r.Vector3).copy(f).add(d).add(c),l=(new r.Vector3).copy(p).add(d).add(c)):7===o?(s=(new r.Vector3).copy(f).add(u),l=(new r.Vector3).copy(p).add(u)):4===o?(s=(new r.Vector3).copy(f).add(c),l=(new r.Vector3).copy(p).add(c)):6===o&&(s=(new r.Vector3).copy(f).add(c).add(h),l=(new r.Vector3).copy(p).add(c).add(h)),new r.Box3(s,l)),S=i.baseurl;if(b.length%e==0){var T=b.substr(i.name.length);S="".concat(i.baseurl,"/").concat(T)}var E={numPoints:w,childrenBitField:_,children:[],name:b,baseurl:S,bbox:M,layer:t,parent:y};y.children.push(E),g.push(E)}return i}))}function m(t,e){if(t.name===e)return t;for(var r=t.name.length,n=0;n<t.children.length;n++)if(t.children[n].name[r]===e[r])return m(t.children[n],e);throw new Error("Cannot find node with name '".concat(e,"'"))}function g(t,e){e.metadata=t;var r=!0;if(void 0!==e.metadata.scale){e.isFromPotreeConverter=!0,r="CIN"===e.metadata.pointAttributes;var n=Array.isArray(e.metadata.pointAttributes)&&e.metadata.pointAttributes.find((function(t){return t.startsWith("NORMAL")}));n&&(e.material.defines[n]=1)}else e.metadata.scale=1,e.metadata.octreeDir="giro3d/".concat(e.table,".points"),e.metadata.hierarchyStepSize=1e6,r=!0;e.parse=r?o.default.parse:a.default.parse,e.extension=r?"cin":"bin",e.supportsProgressiveDisplay=r}function v(t){if(!t.obj)return null;var e=t.parent;return e&&e.obj?{element:t.obj,parent:e.obj}:{element:t.obj}}var y={preprocessDataLayer:function(t,e){return t.file||(t.file="cloud.js"),t.group||(t.group=new r.Group,t.object3d.add(t.group),t.group.updateMatrixWorld()),t.bboxes||(t.bboxes=new r.Group,t.object3d.add(t.bboxes),t.bboxes.updateMatrixWorld(),t.bboxes.visible=!1),t.networkOptions=t.networkOptions||{},t.octreeDepthLimit=t.octreeDepthLimit||-1,t.pointBudget=t.pointBudget||2e6,t.pointSize=0!==t.pointSize&&Number.isNaN(t.pointSize)?4:t.pointSize,t.sseThreshold=t.sseThreshold||2,t.material=t.material||{},t.material=t.material.isMaterial?t.material:new s.default(t.material),t.material.defines=t.material.defines||{},t.mode=s.MODE.COLOR,t.preUpdate=i.default.preUpdate,t.update=i.default.update,t.postUpdate=i.default.postUpdate,t.getObjectToUpdateForAttachedLayers=v,t.pickObjectsAt=function(e,r,n,i){return l.default.pickPointsAt(e,r,n,t,i)},n.default.json("".concat(t.url,"/").concat(t.file),t.networkOptions).then((function(e){g(e,t);var n=function(t){var e;if(t.isFromPotreeConverter){var n=t.metadata.boundingBox;e=new r.Box3(new r.Vector3(n.lx,n.ly,n.lz),new r.Vector3(n.ux,n.uy,n.uz))}else{var i,a=0,o=d(t.metadata);try{for(o.s();!(i=o.n()).done&&i.value.table!==t.table;)a++}catch(t){o.e(t)}finally{o.f()}var s=t.metadata[a].bbox;e=new r.Box3(new r.Vector3(s.xmin,s.ymin,s.zmin),new r.Vector3(s.xmax,s.ymax,s.zmax))}return e}(t);return p(t,t.metadata.hierarchyStepSize,{baseurl:"".concat(t.url,"/").concat(t.metadata.octreeDir,"/r"),name:"",bbox:n})})).then((function(r){return console.log("LAYER metadata:",r),t.root=r,r.findChildrenByName=m.bind(r,r),t.extent=u.default.fromBox3(e.referenceCrs,r.bbox),t}))},executeCommand:function(t){var e=t.layer,r=t.requester;r.childrenBitField&&0===r.children.length&&p(e,e.metadata.hierarchyStepSize,r).then((function(){return t.view.notifyChange(e,!1)}));var i="".concat(r.baseurl,"/r").concat(r.name,".").concat(e.extension,"?isleaf=").concat(t.isLeaf?1:0);return n.default.arrayBuffer(i,e.networkOptions).then((function(t){return e.parse(t,e.metadata.pointAttributes)})).then((function(n){var i=new c.default(e,n,e.material.clone());return i.material.enablePicking&&l.default.preparePointGeometryForPicking(i.geometry),i.frustumCulled=!1,i.matrixAutoUpdate=!1,i.position.copy(r.bbox.min),i.scale.set(e.metadata.scale,e.metadata.scale,e.metadata.scale),i.updateMatrix(),i.tightbbox=n.boundingBox.applyMatrix4(i.matrix),i.layers.set(e.threejsLayer),i.layer=e,i.extent=u.default.fromBox3(t.view.referenceCrs,r.bbox),i.userData.metadata=r,i}))}};FA.default=y;var x={parseMetadata:g};return FA._testing=x,FA}var qA={};class XA{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,e){let r=this.length++;for(this.ids[r]=t,this.values[r]=e;r>0;){const t=r-1>>1,n=this.values[t];if(e>=n)break;this.ids[r]=this.ids[t],this.values[r]=n,r=t}this.ids[r]=t,this.values[r]=e}pop(){if(0===this.length)return;const t=this.ids[0];if(this.length--,this.length>0){const t=this.ids[0]=this.ids[this.length],e=this.values[0]=this.values[this.length],r=this.length>>1;let n=0;for(;n<r;){let t=1+(n<<1);const r=t+1;let i=this.ids[t],a=this.values[t];const o=this.values[r];if(r<this.length&&o<a&&(t=r,i=this.ids[r],a=o),a>=e)break;this.ids[n]=i,this.values[n]=a,n=t}this.ids[n]=t,this.values[n]=e}return t}peek(){if(0!==this.length)return this.ids[0]}peekValue(){if(0!==this.length)return this.values[0]}}const YA=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ZA{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[e,r]=new Uint8Array(t,0,2);if(251!==e)throw new Error("Data does not appear to be in a Flatbush format.");if(r>>4!=3)throw new Error(`Got v${r>>4} data when expected v3.`);const[n]=new Uint16Array(t,2,1),[i]=new Uint32Array(t,4,1);return new ZA(i,n,YA[15&r],t)}constructor(t,e=16,r=Float64Array,n){if(void 0===t)throw new Error("Missing required argument: numItems.");if(isNaN(t)||t<=0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535);let i=t,a=i;this._levelBounds=[4*i];do{i=Math.ceil(i/this.nodeSize),a+=i,this._levelBounds.push(4*a)}while(1!==i);this.ArrayType=r||Float64Array,this.IndexArrayType=a<16384?Uint16Array:Uint32Array;const o=YA.indexOf(this.ArrayType),s=4*a*this.ArrayType.BYTES_PER_ELEMENT;if(o<0)throw new Error(`Unexpected typed array class: ${r}.`);n&&n instanceof ArrayBuffer?(this.data=n,this._boxes=new this.ArrayType(this.data,8,4*a),this._indices=new this.IndexArrayType(this.data,8+s,a),this._pos=4*a,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+s+a*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,4*a),this._indices=new this.IndexArrayType(this.data,8+s,a),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,48+o]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t),this._queue=new XA}add(t,e,r,n){const i=this._pos>>2;return this._indices[i]=i,this._boxes[this._pos++]=t,this._boxes[this._pos++]=e,this._boxes[this._pos++]=r,this._boxes[this._pos++]=n,t<this.minX&&(this.minX=t),e<this.minY&&(this.minY=e),r>this.maxX&&(this.maxX=r),n>this.maxY&&(this.maxY=n),i}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize)return this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,void(this._boxes[this._pos++]=this.maxY);const t=this.maxX-this.minX||1,e=this.maxY-this.minY||1,r=new Uint32Array(this.numItems);for(let n=0;n<this.numItems;n++){let i=4*n;const a=this._boxes[i++],o=this._boxes[i++],s=this._boxes[i++],l=this._boxes[i++],u=Math.floor(65535*((a+s)/2-this.minX)/t),c=Math.floor(65535*((o+l)/2-this.minY)/e);r[n]=tR(u,c)}QA(r,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let t=0,e=0;t<this._levelBounds.length-1;t++){const r=this._levelBounds[t];for(;e<r;){const t=e;let n=1/0,i=1/0,a=-1/0,o=-1/0;for(let t=0;t<this.nodeSize&&e<r;t++)n=Math.min(n,this._boxes[e++]),i=Math.min(i,this._boxes[e++]),a=Math.max(a,this._boxes[e++]),o=Math.max(o,this._boxes[e++]);this._indices[this._pos>>2]=t,this._boxes[this._pos++]=n,this._boxes[this._pos++]=i,this._boxes[this._pos++]=a,this._boxes[this._pos++]=o}}}search(t,e,r,n,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let a=this._boxes.length-4;const o=[],s=[];for(;void 0!==a;){const l=Math.min(a+4*this.nodeSize,JA(a,this._levelBounds));for(let u=a;u<l;u+=4){const l=0|this._indices[u>>2];r<this._boxes[u]||(n<this._boxes[u+1]||t>this._boxes[u+2]||e>this._boxes[u+3]||(a<4*this.numItems?(void 0===i||i(l))&&s.push(l):o.push(l)))}a=o.pop()}return s}neighbors(t,e,r=1/0,n=1/0,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let a=this._boxes.length-4;const o=this._queue,s=[],l=n*n;for(;void 0!==a;){const n=Math.min(a+4*this.nodeSize,JA(a,this._levelBounds));for(let r=a;r<n;r+=4){const n=0|this._indices[r>>2],s=KA(t,this._boxes[r],this._boxes[r+2]),l=KA(e,this._boxes[r+1],this._boxes[r+3]),u=s*s+l*l;a<4*this.numItems?(void 0===i||i(n))&&o.push(1+(n<<1),u):o.push(n<<1,u)}for(;o.length&&1&o.peek();){if(o.peekValue()>l)return o.clear(),s;if(s.push(o.pop()>>1),s.length===r)return o.clear(),s}a=o.pop()>>1}return o.clear(),s}}function KA(t,e,r){return t<e?e-t:t<=r?0:t-r}function JA(t,e){let r=0,n=e.length-1;for(;r<n;){const i=r+n>>1;e[i]>t?n=i:r=i+1}return e[r]}function QA(t,e,r,n,i,a){if(Math.floor(n/a)>=Math.floor(i/a))return;const o=t[n+i>>1];let s=n-1,l=i+1;for(;;){do{s++}while(t[s]<o);do{l--}while(t[l]>o);if(s>=l)break;$A(t,e,r,s,l)}QA(t,e,r,n,l,a),QA(t,e,r,l+1,i,a)}function $A(t,e,r,n,i){const a=t[n];t[n]=t[i],t[i]=a;const o=4*n,s=4*i,l=e[o],u=e[o+1],c=e[o+2],h=e[o+3];e[o]=e[s],e[o+1]=e[s+1],e[o+2]=e[s+2],e[o+3]=e[s+3],e[s]=l,e[s+1]=u,e[s+2]=c,e[s+3]=h;const d=r[n];r[n]=r[i],r[i]=d}function tR(t,e){let r=t^e,n=65535^r,i=65535^(t|e),a=t&(65535^e),o=r|n>>1,s=r>>1^r,l=i>>1^n&a>>1^i,u=r&i>>1^a>>1^a;r=o,n=s,i=l,a=u,o=r&r>>2^n&n>>2,s=r&n>>2^n&(r^n)>>2,l^=r&i>>2^n&a>>2,u^=n&i>>2^(r^n)&a>>2,r=o,n=s,i=l,a=u,o=r&r>>4^n&n>>4,s=r&n>>4^n&(r^n)>>4,l^=r&i>>4^n&a>>4,u^=n&i>>4^(r^n)&a>>4,r=o,n=s,i=l,a=u,l^=r&i>>8^n&a>>8,u^=n&i>>8^(r^n)&a>>8,r=l^l>>1,n=u^u>>1;let c=t^e,h=n|65535^(c|r);return c=16711935&(c|c<<8),c=252645135&(c|c<<4),c=858993459&(c|c<<2),c=1431655765&(c|c<<1),h=16711935&(h|h<<8),h=252645135&(h|h<<4),h=858993459&(h|h<<2),h=1431655765&(h|h<<1),(h<<1|c)>>>0}const eR=of(Object.freeze(Object.defineProperty({__proto__:null,default:ZA},Symbol.toStringTag,{value:"Module"})));var rR;function nR(){if(rR)return qA;rR=1;var t=uf;Object.defineProperty(qA,"__esModule",{value:!0}),qA.default=void 0;var e=t(px()),r=t(Nx()),n=t(eR),i=Bf,a=t(DM()),o=t(FM()),s=VM();function l(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var c=new a.default("dummy",0,0,0,0);function h(t,e){var r,n,i=function(t,e,r){return t.search(r.west(),r.south(),r.east(),r.north()).map((function(t){return e[t]}))}(t._spatialIndex,t.images,e),a=l(i);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(e.isInside(o.extent))if(r){var s=r.extent.dimensions(),u=o.extent.dimensions();u.x<=s.x&&u.y<=s.y&&(r=o)}else r=o}}catch(t){a.e(t)}finally{a.f()}if(r)return r;if(0===i.length)return null;var h,d=0,f=l(i);try{for(f.s();!(h=f.n()).done;){var p=h.value;c.copy(p.extent);var m=(c=c.intersect(e)).dimensions(),g=Math.floor(m.x*m.y);if(g>=d)if(r)if(g===d){var v=p.extent.dimensions(),y=r.extent.dimensions();v.x<y.x&&v.y<y.y&&(r=p,d=g)}else r=p,d=g;else r=p,d=g}}catch(t){f.e(t)}finally{f.f()}return t.discardOutsideUV=!0,r}function d(t,e){return(e.elevationFormat===s.ELEVATION_FORMAT.XBIL?o.default.getXBilTextureByUrl(t.url,e.source.networkOptions):o.default.getColorTextureByUrl(t.url,e.source.networkOptions)).then((function(r){var n={texture:r,pitch:t.pitch||new i.Vector4(0,0,1,1)};return n.texture.extent=t.selection.extent,n.texture.file=t.selection.image,e.transparent&&(r.premultiplyAlpha=!0),n}))}var f={preprocessDataLayer:function(t){return t.extent&&console.warn("Ignoring given layer.extent, and rebuilding it from sources images instead"),t.canTileTextureBeImproved=this.canTileTextureBeImproved,t.source.fetchMetadata().then((function(i){t.images=[];for(var o=0,s=Object.keys(i);o<s.length;o++){var u=s[o],c=(0,e.default)(a.default,[t.projection].concat((0,r.default)(i[u])));t.images.push({image:u,extent:c}),t.extent?t.extent.union(c):t.extent=c.clone()}t._spatialIndex=new n.default(t.images.length);var f,p=l(t.images);try{for(p.s();!(f=p.n()).done;){var m=f.value;t._spatialIndex.add(m.extent.west(),m.extent.south(),m.extent.east(),m.extent.north())}}catch(t){p.e(t)}finally{p.f()}t._spatialIndex.finish();var g=h(t,t.extent);return d({url:t.source.buildUrl(g.image),selection:g},t).then((function(e){t.imageSize={w:e.texture.image.width,h:e.texture.image.height}}))}))},tileInsideLimit:function(t,e){return!!e.images&&h(e,t.extent)},getPossibleTextureImprovements:function(t,e,r){if(!t.images)return null;var n=h(t,e);return n?r&&r.file===n.image?null:{selection:n,pitch:e.offsetToParent(n.extent),url:t.source.buildUrl(n.image)}:null},executeCommand:function(t){var e=t.layer;return d(t.toDownload,e)}};return qA.default=f,qA}var iR={};const aR=of(d_);var oR;function sR(){if(oR)return iR;oR=1;var t=uf;Object.defineProperty(iR,"__esModule",{value:!0}),iR.default=void 0;var e=Bf,r=t(xS),n=aR,i=t(DM());function a(t,e){return new i.default(e,t[0],t[2],t[1],t[3])}function o(t,r){var n=new e.Texture(t.tile.getImage());return n.needsUpdate=!0,n.premultiplyAlpha=r.transparent,n.extent=t.tileExtent,{texture:n,pitch:t.pitch}}var s={preprocessDataLayer:function(t){var e=t.source,r=e.getProjection(),n=e.getTileGridForProjection(r),i=e.getTilePixelSize(0,1,r);t.imageSize={w:i[0],h:i[1]};var o=n.getExtent();t.extent=a(o,r.getCode()),t.fx=0},executeCommand:function(t){return function(t,e){var i,a=t.tile;i=a.getState()===r.default.LOADED?Promise.resolve(o(t,e)):new Promise((function(i,s){a.load(),(0,n.listenOnce)(a,"change",(function(n){var a=n.target.getState();a===r.default.ERROR?s():a===r.default.LOADED&&i(o(t,e))}))}));return i}(t.toDownload,t.layer)},tileTextureCount:function(){return 1},tileInsideLimit:function(t,e){return t.getExtentForLayer(e).isInside(e.extent)},getPossibleTextureImprovements:function(t,e,r){var n=e.as(t.extent.crs()),i=function(t,e){var r=t.source,n=r.getProjection(),i=r.getTileGridForProjection(n),o=function(t,e){e=function(t){return[Math.ceil(t.west()),Math.ceil(t.south()),Math.floor(t.east()),Math.floor(t.north())]}(e);for(var r,n=t.getMinZoom(),i=t.getMaxZoom();i>=n;i--)if(1===(r=t.getTileRangeForExtentAndZ(e,i,r)).getWidth()&&1===r.getHeight())return[i,r.minX,r.minY];return null}(i,e);if(!o)return null;var s=r.getTile(o[0],o[1],o[2],1,n),l=a(i.getTileCoordExtent(o),n.getCode()),u=e.offsetToParent(l);return{extent:e,pitch:u,tile:s,tileExtent:l}}(t,n);return r&&r.extent&&r.extent.isInside(i.tileExtent)?null:i}};return iR.default=s,iR}var lR={};const uR=of(zy);var cR={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},hR=[cR.FILL],dR=[cR.STROKE],fR=[cR.BEGIN_PATH],pR=[cR.CLOSE_PATH];const mR=cR;const gR=function(){function t(){}return t.prototype.drawCustom=function(t,e,r,n){},t.prototype.drawGeometry=function(t){},t.prototype.setStyle=function(t){},t.prototype.drawCircle=function(t,e){},t.prototype.drawFeature=function(t,e){},t.prototype.drawGeometryCollection=function(t,e){},t.prototype.drawLineString=function(t,e){},t.prototype.drawMultiLineString=function(t,e){},t.prototype.drawMultiPoint=function(t,e){},t.prototype.drawMultiPolygon=function(t,e){},t.prototype.drawPoint=function(t,e){},t.prototype.drawPolygon=function(t,e){},t.prototype.drawText=function(t,e){},t.prototype.setFillStrokeStyle=function(t,e){},t.prototype.setImageStyle=function(t,e){},t.prototype.setTextStyle=function(t,e){},t}();var vR=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,yR=/^([a-z]*)$|^hsla?\(.*\)$/i;function xR(t){return"string"==typeof t?t:TR(t)}var _R,wR,bR=(_R={},wR=0,function(t){var e;if(_R.hasOwnProperty(t))e=_R[t];else{if(wR>=1024){var r=0;for(var n in _R)0==(3&r++)&&(delete _R[n],--wR)}e=function(t){var e,r,n,i,a;if(yR.exec(t)&&(t=function(t){var e=document.createElement("div");if(e.style.color=t,""!==e.style.color){document.body.appendChild(e);var r=getComputedStyle(e).color;return document.body.removeChild(e),r}return""}(t)),vR.exec(t)){var o=t.length-1,s=void 0;s=o<=4?1:2;var l=4===o||8===o;e=parseInt(t.substr(1+0*s,s),16),r=parseInt(t.substr(1+1*s,s),16),n=parseInt(t.substr(1+2*s,s),16),i=l?parseInt(t.substr(1+3*s,s),16):255,1==s&&(e=(e<<4)+e,r=(r<<4)+r,n=(n<<4)+n,l&&(i=(i<<4)+i)),a=[e,r,n,i/255]}else 0==t.indexOf("rgba(")?SR(a=t.slice(5,-1).split(",").map(Number)):0==t.indexOf("rgb(")?((a=t.slice(4,-1).split(",").map(Number)).push(1),SR(a)):iy(!1,14);return a}(t),_R[t]=e,++wR}return e});function MR(t){return Array.isArray(t)?t:bR(t)}function SR(t){return t[0]=xv(t[0]+.5|0,0,255),t[1]=xv(t[1]+.5|0,0,255),t[2]=xv(t[2]+.5|0,0,255),t[3]=xv(t[3],0,1),t}function TR(t){var e=t[0];e!=(0|e)&&(e=e+.5|0);var r=t[1];r!=(0|r)&&(r=r+.5|0);var n=t[2];return n!=(0|n)&&(n=n+.5|0),"rgba("+e+","+r+","+n+","+(void 0===t[3]?1:Math.round(100*t[3])/100)+")"}function ER(t){return Array.isArray(t)?TR(t):t}var AR=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),RR=["style","variant","weight","size","lineHeight","family"],PR=function(t){var e=t.match(AR);if(!e)return null;for(var r={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"},n=0,i=RR.length;n<i;++n){var a=e[n+1];void 0!==a&&(r[RR[n]]=a)}return r.families=r.family.split(/,\s?/),r},CR="#000",IR="round",LR=[],OR="round",DR="#000",kR="center",FR="middle",NR=[0,0,0,0],UR=new H_;(new Kx).setSize=function(){console.warn("labelCache is deprecated.")};var BR,zR,GR=null,jR={},VR=function(){var t,e,r="32px ",n=["monospace","serif"],i=n.length,a="wmytzilWMYTZIL@#/&?$%10";function o(t,o,s){for(var l=!0,u=0;u<i;++u){var c=n[u];if(e=qR(t+" "+o+" "+r+c,a),s!=c){var h=qR(t+" "+o+" "+r+s+","+c,a);l=l&&h!=e}}return!!l}function s(){for(var e=!0,r=UR.getKeys(),n=0,i=r.length;n<i;++n){var a=r[n];UR.get(a)<100&&(o.apply(this,a.split("\n"))?(qv(jR),GR=null,BR=void 0,UR.set(a,100)):(UR.set(a,UR.get(a)+1,!0),e=!1))}e&&(clearInterval(t),t=void 0)}return function(e){var r=PR(e);if(r)for(var n=r.families,i=0,a=n.length;i<a;++i){var l=n[i],u=r.style+"\n"+r.weight+"\n"+l;void 0===UR.get(u)&&(UR.set(u,100,!0),o(r.style,r.weight,l)||(UR.set(u,0,!0),void 0===t&&(t=setInterval(s,32))))}}}(),HR=function(t){var e=jR[t];if(null==e){if(r_){var r=PR(t),n=WR(t,"Žg");e=(isNaN(Number(r.lineHeight))?1.2:Number(r.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else zR||((zR=document.createElement("div")).innerHTML="M",zR.style.minHeight="0",zR.style.maxHeight="none",zR.style.height="auto",zR.style.padding="0",zR.style.border="none",zR.style.position="absolute",zR.style.display="block",zR.style.left="-99999px"),zR.style.font=t,document.body.appendChild(zR),e=zR.offsetHeight,document.body.removeChild(zR);jR[t]=e}return e};function WR(t,e){return GR||(GR=i_(1,1)),t!=BR&&(GR.font=t,BR=GR.font),GR.measureText(e)}function qR(t,e){return WR(t,e).width}function XR(t,e,r){if(e in r)return r[e];var n=e.split("\n").reduce((function(e,r){return Math.max(e,qR(t,r))}),0);return r[e]=n,n}function YR(t,e,r,n,i,a,o,s,l,u,c){t.save(),1!==r&&(t.globalAlpha*=r),e&&t.setTransform.apply(t,e),n.contextInstructions?(t.translate(l,u),t.scale(c[0],c[1]),function(t,e){for(var r=t.contextInstructions,n=0,i=r.length;n<i;n+=2)Array.isArray(r[n+1])?e[r[n]].apply(e,r[n+1]):e[r[n]]=r[n+1]}(n,t)):c[0]<0||c[1]<0?(t.translate(l,u),t.scale(c[0],c[1]),t.drawImage(n,i,a,o,s,0,0,o,s)):t.drawImage(n,i,a,o,s,l,u,o*c[0],s*c[1]),t.restore()}function ZR(t,e,r,n,i){for(var a=void 0!==i?i:[],o=0,s=e;s<r;s+=n)a[o++]=t.slice(s,s+n);return a.length=o,a}function KR(t,e,r,n,i){for(var a=void 0!==i?i:[],o=0,s=0,l=r.length;s<l;++s){var u=r[s];a[o++]=ZR(t,e,u,n,a[o]),e=u}return a.length=o,a}function JR(t,e,r,n,i){for(var a=void 0!==i?i:[],o=0,s=0,l=r.length;s<l;++s){var u=r[s];a[o++]=KR(t,e,u,n,a[o]),e=u[u.length-1]}return a.length=o,a}var QR=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const $R=function(t){function e(e,r,n,i){var a=t.call(this)||this;return a.tolerance=e,a.maxExtent=r,a.pixelRatio=i,a.maxLineWidth=0,a.resolution=n,a.beginGeometryInstruction1_=null,a.beginGeometryInstruction2_=null,a.bufferedMaxExtent_=null,a.instructions=[],a.coordinates=[],a.tmpCoordinate_=[],a.hitDetectionInstructions=[],a.state={},a}return QR(e,t),e.prototype.applyPixelRatio=function(t){var e=this.pixelRatio;return 1==e?t:t.map((function(t){return t*e}))},e.prototype.appendFlatPointCoordinates=function(t,e){for(var r=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,i=this.coordinates,a=i.length,o=0,s=t.length;o<s;o+=e)n[0]=t[o],n[1]=t[o+1],ly(r,n)&&(i[a++]=n[0],i[a++]=n[1]);return a},e.prototype.appendFlatLineCoordinates=function(t,e,r,n,i,a){var o=this.coordinates,s=o.length,l=this.getBufferedMaxExtent();a&&(e+=n);var u,c,h,d=t[e],f=t[e+1],p=this.tmpCoordinate_,m=!0;for(u=e+n;u<r;u+=n)p[0]=t[u],p[1]=t[u+1],(h=hy(l,p))!==c?(m&&(o[s++]=d,o[s++]=f,m=!1),o[s++]=p[0],o[s++]=p[1]):h===Qv.INTERSECTING?(o[s++]=p[0],o[s++]=p[1],m=!1):m=!0,d=p[0],f=p[1],c=h;return(i&&m||u===e+n)&&(o[s++]=d,o[s++]=f),s},e.prototype.drawCustomCoordinates_=function(t,e,r,n,i){for(var a=0,o=r.length;a<o;++a){var s=r[a],l=this.appendFlatLineCoordinates(t,e,s,n,!1,!1);i.push(l),e=s}return e},e.prototype.drawCustom=function(t,e,r,n){this.beginGeometry(t,e);var i,a,o,s,l,u=t.getType(),c=t.getStride(),h=this.coordinates.length;switch(u){case"MultiPolygon":i=t.getOrientedFlatCoordinates(),s=[];var d=t.getEndss();l=0;for(var f=0,p=d.length;f<p;++f){var m=[];l=this.drawCustomCoordinates_(i,l,d[f],c,m),s.push(m)}this.instructions.push([mR.CUSTOM,h,s,t,r,JR]),this.hitDetectionInstructions.push([mR.CUSTOM,h,s,t,n||r,JR]);break;case"Polygon":case"MultiLineString":o=[],i="Polygon"==u?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),l=this.drawCustomCoordinates_(i,0,t.getEnds(),c,o),this.instructions.push([mR.CUSTOM,h,o,t,r,KR]),this.hitDetectionInstructions.push([mR.CUSTOM,h,o,t,n||r,KR]);break;case"LineString":case"Circle":i=t.getFlatCoordinates(),a=this.appendFlatLineCoordinates(i,0,i.length,c,!1,!1),this.instructions.push([mR.CUSTOM,h,a,t,r,ZR]),this.hitDetectionInstructions.push([mR.CUSTOM,h,a,t,n||r,ZR]);break;case"MultiPoint":i=t.getFlatCoordinates(),(a=this.appendFlatPointCoordinates(i,c))>h&&(this.instructions.push([mR.CUSTOM,h,a,t,r,ZR]),this.hitDetectionInstructions.push([mR.CUSTOM,h,a,t,n||r,ZR]));break;case"Point":i=t.getFlatCoordinates(),this.coordinates.push(i[0],i[1]),a=this.coordinates.length,this.instructions.push([mR.CUSTOM,h,a,t,r]),this.hitDetectionInstructions.push([mR.CUSTOM,h,a,t,n||r])}this.endGeometry(e)},e.prototype.beginGeometry=function(t,e){this.beginGeometryInstruction1_=[mR.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[mR.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},e.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},e.prototype.reverseHitDetectionInstructions=function(){var t,e=this.hitDetectionInstructions;e.reverse();var r,n,i=e.length,a=-1;for(t=0;t<i;++t)(n=(r=e[t])[0])==mR.END_GEOMETRY?a=t:n==mR.BEGIN_GEOMETRY&&(r[2]=t,Wx(this.hitDetectionInstructions,a,t),a=-1)},e.prototype.setFillStrokeStyle=function(t,e){var r=this.state;if(t){var n=t.getColor();r.fillStyle=ER(n||CR)}else r.fillStyle=void 0;if(e){var i=e.getColor();r.strokeStyle=ER(i||DR);var a=e.getLineCap();r.lineCap=void 0!==a?a:IR;var o=e.getLineDash();r.lineDash=o?o.slice():LR;var s=e.getLineDashOffset();r.lineDashOffset=s||0;var l=e.getLineJoin();r.lineJoin=void 0!==l?l:OR;var u=e.getWidth();r.lineWidth=void 0!==u?u:1;var c=e.getMiterLimit();r.miterLimit=void 0!==c?c:10,r.lineWidth>this.maxLineWidth&&(this.maxLineWidth=r.lineWidth,this.bufferedMaxExtent_=null)}else r.strokeStyle=void 0,r.lineCap=void 0,r.lineDash=null,r.lineDashOffset=void 0,r.lineJoin=void 0,r.lineWidth=void 0,r.miterLimit=void 0},e.prototype.createFill=function(t){var e=t.fillStyle,r=[mR.SET_FILL_STYLE,e];return"string"!=typeof e&&r.push(!0),r},e.prototype.applyStroke=function(t){this.instructions.push(this.createStroke(t))},e.prototype.createStroke=function(t){return[mR.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]},e.prototype.updateFillStyle=function(t,e){var r=t.fillStyle;"string"==typeof r&&t.currentFillStyle==r||(void 0!==r&&this.instructions.push(e.call(this,t)),t.currentFillStyle=r)},e.prototype.updateStrokeStyle=function(t,e){var r=t.strokeStyle,n=t.lineCap,i=t.lineDash,a=t.lineDashOffset,o=t.lineJoin,s=t.lineWidth,l=t.miterLimit;(t.currentStrokeStyle!=r||t.currentLineCap!=n||i!=t.currentLineDash&&!qx(t.currentLineDash,i)||t.currentLineDashOffset!=a||t.currentLineJoin!=o||t.currentLineWidth!=s||t.currentMiterLimit!=l)&&(void 0!==r&&e.call(this,t),t.currentStrokeStyle=r,t.currentLineCap=n,t.currentLineDash=i,t.currentLineDashOffset=a,t.currentLineJoin=o,t.currentLineWidth=s,t.currentMiterLimit=l)},e.prototype.endGeometry=function(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var e=[mR.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)},e.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=sy(this.maxExtent),this.maxLineWidth>0)){var t=this.resolution*(this.maxLineWidth+1)/2;oy(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},e}(gR);var tP=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const eP=function(t){function e(e,r,n,i){var a=t.call(this,e,r,n,i)||this;return a.hitDetectionImage_=null,a.image_=null,a.imagePixelRatio_=void 0,a.anchorX_=void 0,a.anchorY_=void 0,a.height_=void 0,a.opacity_=void 0,a.originX_=void 0,a.originY_=void 0,a.rotateWithView_=void 0,a.rotation_=void 0,a.scale_=void 0,a.width_=void 0,a.declutterMode_=void 0,a.declutterImageWithText_=void 0,a}return tP(e,t),e.prototype.drawPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var r=t.getFlatCoordinates(),n=t.getStride(),i=this.coordinates.length,a=this.appendFlatPointCoordinates(r,n);this.instructions.push([mR.DRAW_IMAGE,i,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([mR.DRAW_IMAGE,i,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}},e.prototype.drawMultiPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var r=t.getFlatCoordinates(),n=t.getStride(),i=this.coordinates.length,a=this.appendFlatPointCoordinates(r,n);this.instructions.push([mR.DRAW_IMAGE,i,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([mR.DRAW_IMAGE,i,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}},e.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,t.prototype.finish.call(this)},e.prototype.setImageStyle=function(t,e){var r=t.getAnchor(),n=t.getSize(),i=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=r[0],this.anchorY_=r[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=i[0],this.originY_=i[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=n[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e},e}($R);var rP=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const nP=function(t){function e(e,r,n,i){return t.call(this,e,r,n,i)||this}return rP(e,t),e.prototype.drawFlatCoordinates_=function(t,e,r,n){var i=this.coordinates.length,a=this.appendFlatLineCoordinates(t,e,r,n,!1,!1),o=[mR.MOVE_TO_LINE_TO,i,a];return this.instructions.push(o),this.hitDetectionInstructions.push(o),r},e.prototype.drawLineString=function(t,e){var r=this.state,n=r.strokeStyle,i=r.lineWidth;if(void 0!==n&&void 0!==i){this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([mR.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,LR,0],fR);var a=t.getFlatCoordinates(),o=t.getStride();this.drawFlatCoordinates_(a,0,a.length,o),this.hitDetectionInstructions.push(dR),this.endGeometry(e)}},e.prototype.drawMultiLineString=function(t,e){var r=this.state,n=r.strokeStyle,i=r.lineWidth;if(void 0!==n&&void 0!==i){this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([mR.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset],fR);for(var a=t.getEnds(),o=t.getFlatCoordinates(),s=t.getStride(),l=0,u=0,c=a.length;u<c;++u)l=this.drawFlatCoordinates_(o,l,a[u],s);this.hitDetectionInstructions.push(dR),this.endGeometry(e)}},e.prototype.finish=function(){var e=this.state;return null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&this.instructions.push(dR),this.reverseHitDetectionInstructions(),this.state=null,t.prototype.finish.call(this)},e.prototype.applyStroke=function(e){null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(dR),e.lastStroke=this.coordinates.length),e.lastStroke=0,t.prototype.applyStroke.call(this,e),this.instructions.push(fR)},e}($R);function iP(t,e){return e*Math.round(t/e)}var aP=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const oP=function(t){function e(e,r,n,i){return t.call(this,e,r,n,i)||this}return aP(e,t),e.prototype.drawFlatCoordinatess_=function(t,e,r,n){var i=this.state,a=void 0!==i.fillStyle,o=void 0!==i.strokeStyle,s=r.length;this.instructions.push(fR),this.hitDetectionInstructions.push(fR);for(var l=0;l<s;++l){var u=r[l],c=this.coordinates.length,h=this.appendFlatLineCoordinates(t,e,u,n,!0,!o),d=[mR.MOVE_TO_LINE_TO,c,h];this.instructions.push(d),this.hitDetectionInstructions.push(d),o&&(this.instructions.push(pR),this.hitDetectionInstructions.push(pR)),e=u}return a&&(this.instructions.push(hR),this.hitDetectionInstructions.push(hR)),o&&(this.instructions.push(dR),this.hitDetectionInstructions.push(dR)),e},e.prototype.drawCircle=function(t,e){var r=this.state,n=r.fillStyle,i=r.strokeStyle;if(void 0!==n||void 0!==i){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([mR.SET_FILL_STYLE,CR]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([mR.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);var a=t.getFlatCoordinates(),o=t.getStride(),s=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,o,!1,!1);var l=[mR.CIRCLE,s];this.instructions.push(fR,l),this.hitDetectionInstructions.push(fR,l),void 0!==r.fillStyle&&(this.instructions.push(hR),this.hitDetectionInstructions.push(hR)),void 0!==r.strokeStyle&&(this.instructions.push(dR),this.hitDetectionInstructions.push(dR)),this.endGeometry(e)}},e.prototype.drawPolygon=function(t,e){var r=this.state,n=r.fillStyle,i=r.strokeStyle;if(void 0!==n||void 0!==i){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([mR.SET_FILL_STYLE,CR]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([mR.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);var a=t.getEnds(),o=t.getOrientedFlatCoordinates(),s=t.getStride();this.drawFlatCoordinatess_(o,0,a,s),this.endGeometry(e)}},e.prototype.drawMultiPolygon=function(t,e){var r=this.state,n=r.fillStyle,i=r.strokeStyle;if(void 0!==n||void 0!==i){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([mR.SET_FILL_STYLE,CR]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([mR.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);for(var a=t.getEndss(),o=t.getOrientedFlatCoordinates(),s=t.getStride(),l=0,u=0,c=a.length;u<c;++u)l=this.drawFlatCoordinatess_(o,l,a[u],s);this.endGeometry(e)}},e.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var e=this.tolerance;if(0!==e)for(var r=this.coordinates,n=0,i=r.length;n<i;++n)r[n]=iP(r[n],e);return t.prototype.finish.call(this)},e.prototype.setFillStrokeStyles_=function(){var t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)},e}($R),sP="point",lP="line";function uP(t,e,r,n,i){var a,o,s,l,u,c,h,d,f,p=r,m=r,g=0,v=0,y=r;for(a=r;a<n;a+=i){var x=e[a],_=e[a+1];void 0!==l&&(d=x-l,f=_-u,s=Math.sqrt(d*d+f*f),void 0!==c&&(v+=o,Math.acos((c*d+h*f)/(o*s))>t&&(v>g&&(g=v,p=y,m=a),v=0,y=a-i)),o=s,c=d,h=f),l=x,u=_}return(v+=s)>g?[y,a]:[p,m]}var cP=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),hP={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};var dP={Circle:oP,Default:$R,Image:eP,LineString:nP,Polygon:oP,Text:function(t){function e(e,r,n,i){var a=t.call(this,e,r,n,i)||this;return a.labels_=null,a.text_="",a.textOffsetX_=0,a.textOffsetY_=0,a.textRotateWithView_=void 0,a.textRotation_=0,a.textFillState_=null,a.fillStates={},a.textStrokeState_=null,a.strokeStates={},a.textState_={},a.textStates={},a.textKey_="",a.fillKey_="",a.strokeKey_="",a.declutterImageWithText_=void 0,a}return cP(e,t),e.prototype.finish=function(){var e=t.prototype.finish.call(this);return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e},e.prototype.drawText=function(t,e){var r=this.textFillState_,n=this.textStrokeState_,i=this.textState_;if(""!==this.text_&&i&&(r||n)){var a=this.coordinates,o=a.length,s=t.getType(),l=null,u=t.getStride();if(i.placement!==lP||"LineString"!=s&&"MultiLineString"!=s&&"Polygon"!=s&&"MultiPolygon"!=s){var c=i.overflow?null:[];switch(s){case"Point":case"MultiPoint":l=t.getFlatCoordinates();break;case"LineString":l=t.getFlatMidpoint();break;case"Circle":l=t.getCenter();break;case"MultiLineString":l=t.getFlatMidpoints(),u=2;break;case"Polygon":l=t.getFlatInteriorPoint(),i.overflow||c.push(l[2]/this.resolution),u=3;break;case"MultiPolygon":var h=t.getFlatInteriorPoints();l=[];for(b=0,M=h.length;b<M;b+=3)i.overflow||c.push(h[b+2]/this.resolution),l.push(h[b],h[b+1]);if(0===l.length)return;u=2}if((C=this.appendFlatPointCoordinates(l,u))===o)return;if(c&&(C-o)/2!=l.length/u){var d=o/2;c=c.filter((function(t,e){var r=a[2*(d+e)]===l[e*u]&&a[2*(d+e)+1]===l[e*u+1];return r||--d,r}))}this.saveTextStates_(),(i.backgroundFill||i.backgroundStroke)&&(this.setFillStrokeStyle(i.backgroundFill,i.backgroundStroke),i.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),i.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);var f=i.padding;if(f!=NR&&(i.scale[0]<0||i.scale[1]<0)){var p=i.padding[0],m=i.padding[1],g=i.padding[2],v=i.padding[3];i.scale[0]<0&&(m=-m,v=-v),i.scale[1]<0&&(p=-p,g=-g),f=[p,m,g,v]}var y=this.pixelRatio;this.instructions.push([mR.DRAW_IMAGE,o,C,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,f==NR?NR:f.map((function(t){return t*y})),!!i.backgroundFill,!!i.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,c]);var x=1/y;this.hitDetectionInstructions.push([mR.DRAW_IMAGE,o,C,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[x,x],NaN,void 0,this.declutterImageWithText_,f,!!i.backgroundFill,!!i.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,c]),this.endGeometry(e)}else{if(!Dy(this.getBufferedMaxExtent(),t.getExtent()))return;var _=void 0;if(l=t.getFlatCoordinates(),"LineString"==s)_=[l.length];else if("MultiLineString"==s)_=t.getEnds();else if("Polygon"==s)_=t.getEnds().slice(0,1);else if("MultiPolygon"==s){var w=t.getEndss();_=[];for(var b=0,M=w.length;b<M;++b)_.push(w[b][0])}this.beginGeometry(t,e);for(var S=i.textAlign,T=0,E=void 0,A=0,R=_.length;A<R;++A){if(null==S){var P=uP(i.maxAngle,l,T,_[A],u);T=P[0],E=P[1]}else E=_[A];for(var b=T;b<E;b+=u)a.push(l[b],l[b+1]);var C=a.length;T=_[A],this.drawChars_(o,C),o=C}this.endGeometry(e)}}},e.prototype.saveTextStates_=function(){var t=this.textStrokeState_,e=this.textState_,r=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));var i=this.textKey_;i in this.textStates||(this.textStates[i]={font:e.font,textAlign:e.textAlign||kR,justify:e.justify,textBaseline:e.textBaseline||FR,scale:e.scale});var a=this.fillKey_;r&&(a in this.fillStates||(this.fillStates[a]={fillStyle:r.fillStyle}))},e.prototype.drawChars_=function(t,e){var r=this.textStrokeState_,n=this.textState_,i=this.strokeKey_,a=this.textKey_,o=this.fillKey_;this.saveTextStates_();var s=this.pixelRatio,l=hP[n.textBaseline],u=this.textOffsetY_*s,c=this.text_,h=r?r.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([mR.DRAW_CHARS,t,e,l,n.overflow,o,n.maxAngle,s,u,i,h*s,c,a,1]),this.hitDetectionInstructions.push([mR.DRAW_CHARS,t,e,l,n.overflow,o,n.maxAngle,1,u,i,h,c,a,1/s])},e.prototype.setTextStyle=function(t,e){var r,n,i;if(t){var a=t.getFill();a?((n=this.textFillState_)||(n={},this.textFillState_=n),n.fillStyle=ER(a.getColor()||CR)):(n=null,this.textFillState_=n);var o=t.getStroke();if(o){(i=this.textStrokeState_)||(i={},this.textStrokeState_=i);var s=o.getLineDash(),l=o.getLineDashOffset(),u=o.getWidth(),c=o.getMiterLimit();i.lineCap=o.getLineCap()||IR,i.lineDash=s?s.slice():LR,i.lineDashOffset=void 0===l?0:l,i.lineJoin=o.getLineJoin()||OR,i.lineWidth=void 0===u?1:u,i.miterLimit=void 0===c?10:c,i.strokeStyle=ER(o.getColor()||DR)}else i=null,this.textStrokeState_=i;r=this.textState_;var h=t.getFont()||"10px sans-serif";VR(h);var d=t.getScaleArray();r.overflow=t.getOverflow(),r.font=h,r.maxAngle=t.getMaxAngle(),r.placement=t.getPlacement(),r.textAlign=t.getTextAlign(),r.justify=t.getJustify(),r.textBaseline=t.getTextBaseline()||FR,r.backgroundFill=t.getBackgroundFill(),r.backgroundStroke=t.getBackgroundStroke(),r.padding=t.getPadding()||NR,r.scale=void 0===d?[1,1]:d;var f=t.getOffsetX(),p=t.getOffsetY(),m=t.getRotateWithView(),g=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===f?0:f,this.textOffsetY_=void 0===p?0:p,this.textRotateWithView_=void 0!==m&&m,this.textRotation_=void 0===g?0:g,this.strokeKey_=i?("string"==typeof i.strokeStyle?i.strokeStyle:ey(i.strokeStyle))+i.lineCap+i.lineDashOffset+"|"+i.lineWidth+i.lineJoin+i.miterLimit+"["+i.lineDash.join()+"]":"",this.textKey_=r.font+r.scale+(r.textAlign||"?")+(r.justify||"?")+(r.textBaseline||"?"),this.fillKey_=n?"string"==typeof n.fillStyle?n.fillStyle:"|"+ey(n.fillStyle):""}else this.text_="";this.declutterImageWithText_=e},e}($R)},fP=function(){function t(t,e,r,n){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=r,this.buildersByZIndex_={}}return t.prototype.finish=function(){var t={};for(var e in this.buildersByZIndex_){t[e]=t[e]||{};var r=this.buildersByZIndex_[e];for(var n in r){var i=r[n].finish();t[e][n]=i}}return t},t.prototype.getBuilder=function(t,e){var r=void 0!==t?t.toString():"0",n=this.buildersByZIndex_[r];void 0===n&&(n={},this.buildersByZIndex_[r]=n);var i=n[e];void 0===i&&(i=new(0,dP[e])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=i);return i},t}();const pP=of(Object.freeze(Object.defineProperty({__proto__:null,default:fP},Symbol.toStringTag,{value:"Module"})));var mP,gP=new Array(6);function vP(){return[1,0,0,1,0,0]}function yP(t,e){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=e[0],u=e[1],c=e[2],h=e[3],d=e[4],f=e[5];return t[0]=r*l+i*u,t[1]=n*l+a*u,t[2]=r*c+i*h,t[3]=n*c+a*h,t[4]=r*d+i*f+o,t[5]=n*d+a*f+s,t}function xP(t,e,r,n,i,a,o){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=a,t[5]=o,t}function _P(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function wP(t,e){var r=e[0],n=e[1];return e[0]=t[0]*r+t[2]*n+t[4],e[1]=t[1]*r+t[3]*n+t[5],e}function bP(t,e,r,n,i,a,o,s){var l=Math.sin(a),u=Math.cos(a);return t[0]=n*u,t[1]=i*l,t[2]=-n*l,t[3]=i*u,t[4]=o*n*u-s*n*l+e,t[5]=o*i*l+s*i*u+r,t}function MP(t,e){var r=SP(e);iy(0!==r,32);var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],l=e[5];return t[0]=o/r,t[1]=-i/r,t[2]=-a/r,t[3]=n/r,t[4]=(a*l-o*s)/r,t[5]=-(n*l-i*s)/r,t}function SP(t){return t[0]*t[3]-t[1]*t[2]}function TP(t){var e="matrix("+t.join(", ")+")";if(r_)return e;var r=mP||(mP=document.createElement("div"));return r.style.transform=e,r.style.transform}const EP=Object.freeze(Object.defineProperty({__proto__:null,apply:wP,compose:bP,composeCssTransform:function(t,e,r,n,i,a,o){return TP(bP([1,0,0,1,0,0],t,e,r,n,i,a,o))},create:vP,determinant:SP,invert:function(t){return MP(t,t)},makeInverse:MP,makeScale:function(t,e,r){return xP(t,e,0,0,r,0,0)},multiply:yP,reset:function(t){return xP(t,1,0,0,1,0,0)},rotate:function(t,e){var r=Math.cos(e),n=Math.sin(e);return yP(t,xP(gP,r,n,-n,r,0,0))},scale:function(t,e,r){return yP(t,xP(gP,e,0,0,r,0,0))},set:xP,setFromArray:_P,toString:TP,translate:function(t,e,r){return yP(t,xP(gP,1,0,0,1,e,r))}},Symbol.toStringTag,{value:"Module"}));function AP(t,e,r,n,i,a){for(var o=a||[],s=0,l=e;l<r;l+=n){var u=t[l],c=t[l+1];o[s++]=i[0]*u+i[2]*c+i[4],o[s++]=i[1]*u+i[3]*c+i[5]}return a&&o.length!=s&&(o.length=s),o}function RP(t,e,r,n,i,a,o,s,l,u,c,h){var d=t[e],f=t[e+1],p=0,m=0,g=0,v=0;function y(){p=d,m=f,d=t[e+=n],f=t[e+1],v+=g,g=Math.sqrt((d-p)*(d-p)+(f-m)*(f-m))}do{y()}while(e<r-n&&v+g<a);for(var x=0===g?0:(a-v)/g,_=Sv(p,d,x),w=Sv(m,f,x),b=e-n,M=v,S=a+s*l(u,i,c);e<r-n&&v+g<S;)y();var T,E=Sv(p,d,x=0===g?0:(S-v)/g),A=Sv(m,f,x);if(h){var R=[_,w,E,A];!function(t,e,r,n,i,a,o){for(var s=o||[],l=Math.cos(i),u=Math.sin(i),c=a[0],h=a[1],d=0,f=e;f<r;f+=n){var p=t[f]-c,m=t[f+1]-h;s[d++]=c+p*l-m*u,s[d++]=h+p*u+m*l;for(var g=f+2;g<f+n;++g)s[d++]=t[g]}o&&s.length!=d&&(s.length=d)}(R,0,4,2,h,R,R),T=R[0]>R[2]}else T=_>E;var P,C=Math.PI,I=[],L=b+n===e;if(g=0,v=M,d=t[e=b],f=t[e+1],L){y(),P=Math.atan2(f-m,d-p),T&&(P+=P>0?-C:C);var O=(E+_)/2,D=(A+w)/2;return I[0]=[O,D,(S-a)/2,P,i],I}for(var k=0,F=(i=i.replace(/\n/g," ")).length;k<F;){y();var N=Math.atan2(f-m,d-p);if(T&&(N+=N>0?-C:C),void 0!==P){var U=N-P;if(U+=U>C?-2*C:U<-C?2*C:0,Math.abs(U)>o)return null}P=N;for(var B=k,z=0;k<F;++k){var G=s*l(u,i[T?F-k-1:k],c);if(e+n<r&&v+g<a+z+G/2)break;z+=G}if(k!==B){var j=T?i.substring(F-B,F-k):i.substring(B,k);O=Sv(p,d,x=0===g?0:(a+z/2-v)/g),D=Sv(m,f,x);I.push([O,D,z/2,N,j]),a+=z}}return I}function PP(t,e,r,n){for(var i=t[e],a=t[e+1],o=0,s=e+n;s<r;s+=n){var l=t[s],u=t[s+1];o+=Math.sqrt((l-i)*(l-i)+(u-a)*(u-a)),i=l,a=u}return o}var CP=[1/0,1/0,-1/0,-1/0],IP=[],LP=[],OP=[],DP=[];function kP(t){return t[3].declutterBox}var FP=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function NP(t,e){return"start"!==e&&"end"!==e||FP.test(t)||(e="start"===e?"left":"right"),hP[e]}function UP(t,e,r){return r>0&&t.push("\n",""),t.push(e,""),t}const BP=function(){function t(t,e,r,n){this.overlaps=r,this.pixelRatio=e,this.resolution=t,this.alignFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}return t.prototype.createLabel=function(t,e,r,n){var i=t+e+r+n;if(this.labels_[i])return this.labels_[i];var a=n?this.strokeStates[n]:null,o=r?this.fillStates[r]:null,s=this.textStates[e],l=this.pixelRatio,u=[s.scale[0]*l,s.scale[1]*l],c=Array.isArray(t),h=s.justify?hP[s.justify]:NP(Array.isArray(t)?t[0]:t,s.textAlign||kR),d=n&&a.lineWidth?a.lineWidth:0,f=c?t:t.split("\n").reduce(UP,[]),p=function(t,e){for(var r=[],n=[],i=[],a=0,o=0,s=0,l=0,u=0,c=e.length;u<=c;u+=2){var h=e[u];if("\n"!==h&&u!==c){var d=e[u+1]||t.font,f=qR(d,h);r.push(f),o+=f;var p=HR(d);n.push(p),l=Math.max(l,p)}else a=Math.max(a,o),i.push(o),o=0,s+=l}return{width:a,height:s,widths:r,heights:n,lineWidths:i}}(s,f),m=p.width,g=p.height,v=p.widths,y=p.heights,x=p.lineWidths,_=m+d,w=[],b=(_+2)*u[0],M=(g+d)*u[1],S={width:b<0?Math.floor(b):Math.ceil(b),height:M<0?Math.floor(M):Math.ceil(M),contextInstructions:w};(1==u[0]&&1==u[1]||w.push("scale",u),n)&&(w.push("strokeStyle",a.strokeStyle),w.push("lineWidth",d),w.push("lineCap",a.lineCap),w.push("lineJoin",a.lineJoin),w.push("miterLimit",a.miterLimit),(r_?OffscreenCanvasRenderingContext2D:CanvasRenderingContext2D).prototype.setLineDash&&(w.push("setLineDash",[a.lineDash]),w.push("lineDashOffset",a.lineDashOffset)));r&&w.push("fillStyle",o.fillStyle),w.push("textBaseline","middle"),w.push("textAlign","center");for(var T,E=.5-h,A=h*_+E*d,R=[],P=[],C=0,I=0,L=0,O=0,D=0,k=f.length;D<k;D+=2){var F=f[D];if("\n"!==F){var N=f[D+1]||s.font;N!==T&&(n&&R.push("font",N),r&&P.push("font",N),T=N),C=Math.max(C,y[L]);var U=[F,A+E*v[L]+h*(v[L]-x[O]),.5*(d+C)+I];A+=v[L],n&&R.push("strokeText",U),r&&P.push("fillText",U),++L}else I+=C,C=0,A=h*_+E*d,++O}return Array.prototype.push.apply(w,R),Array.prototype.push.apply(w,P),this.labels_[i]=S,S},t.prototype.replayTextBackground_=function(t,e,r,n,i,a,o){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,r),t.lineTo.apply(t,n),t.lineTo.apply(t,i),t.lineTo.apply(t,e),a&&(this.alignFill_=a[2],this.fill_(t)),o&&(this.setStrokeStyle_(t,o),t.stroke())},t.prototype.calculateImageOrLabelDimensions_=function(t,e,r,n,i,a,o,s,l,u,c,h,d,f,p,m){var g,v=r-(o*=h[0]),y=n-(s*=h[1]),x=i+l>t?t-l:i,_=a+u>e?e-u:a,w=f[3]+x*h[0]+f[1],b=f[0]+_*h[1]+f[2],M=v-f[3],S=y-f[0];return(p||0!==c)&&(IP[0]=M,DP[0]=M,IP[1]=S,LP[1]=S,LP[0]=M+w,OP[0]=LP[0],OP[1]=S+b,DP[1]=OP[1]),0!==c?(wP(g=bP([1,0,0,1,0,0],r,n,1,1,c,-r,-n),IP),wP(g,LP),wP(g,OP),wP(g,DP),fy(Math.min(IP[0],LP[0],OP[0],DP[0]),Math.min(IP[1],LP[1],OP[1],DP[1]),Math.max(IP[0],LP[0],OP[0],DP[0]),Math.max(IP[1],LP[1],OP[1],DP[1]),CP)):fy(Math.min(M,M+w),Math.min(S,S+b),Math.max(M,M+w),Math.max(S,S+b),CP),d&&(v=Math.round(v),y=Math.round(y)),{drawImageX:v,drawImageY:y,drawImageW:x,drawImageH:_,originX:l,originY:u,declutterBox:{minX:CP[0],minY:CP[1],maxX:CP[2],maxY:CP[3],value:m},canvasTransform:g,scale:h}},t.prototype.replayImageOrLabel_=function(t,e,r,n,i,a,o){var s=!(!a&&!o),l=n.declutterBox,u=t.canvas,c=o?o[2]*n.scale[0]/2:0;return l.minX-c<=u.width/e&&l.maxX+c>=0&&l.minY-c<=u.height/e&&l.maxY+c>=0&&(s&&this.replayTextBackground_(t,IP,LP,OP,DP,a,o),YR(t,n.canvasTransform,i,r,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0},t.prototype.fill_=function(t){if(this.alignFill_){var e=wP(this.renderedTransform_,[0,0]),r=512*this.pixelRatio;t.save(),t.translate(e[0]%r,e[1]%r),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()},t.prototype.setStrokeStyle_=function(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.setLineDash&&(t.lineDashOffset=e[7],t.setLineDash(e[6]))},t.prototype.drawLabelWithPointPlacement_=function(t,e,r,n){var i=this.textStates[e],a=this.createLabel(t,e,n,r),o=this.strokeStates[r],s=this.pixelRatio,l=NP(Array.isArray(t)?t[0]:t,i.textAlign||kR),u=hP[i.textBaseline||FR],c=o&&o.lineWidth?o.lineWidth:0;return{label:a,anchorX:l*(a.width/s-2*i.scale[0])+2*(.5-l)*c,anchorY:u*a.height/s+2*(.5-u)*c}},t.prototype.execute_=function(t,e,r,n,i,a,o,s){var l;this.pixelCoordinates_&&qx(r,this.renderedTransform_)?l=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),l=AP(this.coordinates,0,this.coordinates.length,2,r,this.pixelCoordinates_),_P(this.renderedTransform_,r));for(var u,c,h,d,f,p,m,g,v,y,x,_,w,b,M,S,T=0,E=n.length,A=0,R=0,P=0,C=null,I=null,L=this.coordinateCache_,O=this.viewRotation_,D=Math.round(1e12*Math.atan2(-r[1],r[0]))/1e12,k={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:O},F=this.instructions!=n||this.overlaps?0:200;T<E;){var N=n[T];switch(N[0]){case mR.BEGIN_GEOMETRY:w=N[1],S=N[3],w.getGeometry()?void 0===o||Dy(o,S.getExtent())?++T:T=N[2]+1:T=N[2];break;case mR.BEGIN_PATH:R>F&&(this.fill_(t),R=0),P>F&&(t.stroke(),P=0),R||P||(t.beginPath(),d=NaN,f=NaN),++T;break;case mR.CIRCLE:var U=l[A=N[1]],B=l[A+1],z=l[A+2]-U,G=l[A+3]-B,j=Math.sqrt(z*z+G*G);t.moveTo(U+j,B),t.arc(U,B,j,0,2*Math.PI,!0),++T;break;case mR.CLOSE_PATH:t.closePath(),++T;break;case mR.CUSTOM:A=N[1],u=N[2];var V=N[3],H=N[4],W=6==N.length?N[5]:void 0;k.geometry=V,k.feature=w,T in L||(L[T]=[]);var q=L[T];W?W(l,A,u,2,q):(q[0]=l[A],q[1]=l[A+1],q.length=2),H(q,k),++T;break;case mR.DRAW_IMAGE:A=N[1],u=N[2],g=N[3],c=N[4],h=N[5];var X=N[6],Y=N[7],Z=N[8],K=N[9],J=N[10],Q=N[11],$=N[12],tt=N[13],et=N[14],rt=N[15];if(!g&&N.length>=20){v=N[19],y=N[20],x=N[21],_=N[22];var nt=this.drawLabelWithPointPlacement_(v,y,x,_);g=nt.label,N[3]=g;var it=N[23];c=(nt.anchorX-it)*this.pixelRatio,N[4]=c;var at=N[24];h=(nt.anchorY-at)*this.pixelRatio,N[5]=h,X=g.height,N[6]=X,tt=g.width,N[13]=tt}var ot=void 0;N.length>25&&(ot=N[25]);var st=void 0,lt=void 0,ut=void 0;N.length>17?(st=N[16],lt=N[17],ut=N[18]):(st=NR,lt=!1,ut=!1),J&&D?Q+=O:J||D||(Q-=O);for(var ct=0;A<u;A+=2)if(!(ot&&ot[ct++]<tt/this.pixelRatio)){var ht=[t,e,g,Ut=this.calculateImageOrLabelDimensions_(g.width,g.height,l[A],l[A+1],tt,X,c,h,Z,K,Q,$,i,st,lt||ut,w),Y,lt?C:null,ut?I:null];if(s){if("none"===et)continue;if("obstacle"===et){s.insert(Ut.declutterBox);continue}var dt=void 0,ft=void 0;if(rt){var pt=u-A;if(!rt[pt]){rt[pt]=ht;continue}if(dt=rt[pt],delete rt[pt],ft=kP(dt),s.collides(ft))continue}if(s.collides(Ut.declutterBox))continue;dt&&(s.insert(ft),this.replayImageOrLabel_.apply(this,dt)),s.insert(Ut.declutterBox)}this.replayImageOrLabel_.apply(this,ht)}++T;break;case mR.DRAW_CHARS:var mt=N[1],gt=N[2],vt=N[3],yt=N[4];_=N[5];var xt=N[6],_t=N[7],wt=N[8];x=N[9];var bt=N[10];v=N[11],y=N[12];var Mt=[N[13],N[13]],St=this.textStates[y],Tt=St.font,Et=[St.scale[0]*_t,St.scale[1]*_t],At=void 0;Tt in this.widths_?At=this.widths_[Tt]:(At={},this.widths_[Tt]=At);var Rt=PP(l,mt,gt,2),Pt=Math.abs(Et[0])*XR(Tt,v,At);if(yt||Pt<=Rt){var Ct=this.textStates[y].textAlign,It=RP(l,mt,gt,2,v,(Rt-Pt)*hP[Ct],xt,Math.abs(Et[0]),XR,Tt,At,D?0:this.viewRotation_);t:if(It){var Lt=[],Ot=void 0,Dt=void 0,kt=void 0,Ft=void 0,Nt=void 0;if(x)for(Ot=0,Dt=It.length;Ot<Dt;++Ot){kt=(Nt=It[Ot])[4],Ft=this.createLabel(kt,y,"",x),c=Nt[2]+(Et[0]<0?-bt:bt),h=vt*Ft.height+2*(.5-vt)*bt*Et[1]/Et[0]-wt;var Ut=this.calculateImageOrLabelDimensions_(Ft.width,Ft.height,Nt[0],Nt[1],Ft.width,Ft.height,c,h,0,0,Nt[3],Mt,!1,NR,!1,w);if(s&&s.collides(Ut.declutterBox))break t;Lt.push([t,e,Ft,Ut,1,null,null])}if(_)for(Ot=0,Dt=It.length;Ot<Dt;++Ot){kt=(Nt=It[Ot])[4],Ft=this.createLabel(kt,y,_,""),c=Nt[2],h=vt*Ft.height-wt;Ut=this.calculateImageOrLabelDimensions_(Ft.width,Ft.height,Nt[0],Nt[1],Ft.width,Ft.height,c,h,0,0,Nt[3],Mt,!1,NR,!1,w);if(s&&s.collides(Ut.declutterBox))break t;Lt.push([t,e,Ft,Ut,1,null,null])}s&&s.load(Lt.map(kP));for(var Bt=0,zt=Lt.length;Bt<zt;++Bt)this.replayImageOrLabel_.apply(this,Lt[Bt])}}++T;break;case mR.END_GEOMETRY:if(void 0!==a){var Gt=a(w=N[1],S);if(Gt)return Gt}++T;break;case mR.FILL:F?R++:this.fill_(t),++T;break;case mR.MOVE_TO_LINE_TO:for(A=N[1],u=N[2],b=l[A],m=(M=l[A+1])+.5|0,(p=b+.5|0)===d&&m===f||(t.moveTo(b,M),d=p,f=m),A+=2;A<u;A+=2)p=(b=l[A])+.5|0,m=(M=l[A+1])+.5|0,A!=u-2&&p===d&&m===f||(t.lineTo(b,M),d=p,f=m);++T;break;case mR.SET_FILL_STYLE:C=N,this.alignFill_=N[2],R&&(this.fill_(t),R=0,P&&(t.stroke(),P=0)),t.fillStyle=N[1],++T;break;case mR.SET_STROKE_STYLE:I=N,P&&(t.stroke(),P=0),this.setStrokeStyle_(t,N),++T;break;case mR.STROKE:F?P++:t.stroke(),++T;break;default:++T}}R&&this.fill_(t),P&&t.stroke()},t.prototype.execute=function(t,e,r,n,i,a){this.viewRotation_=n,this.execute_(t,e,r,this.instructions,i,void 0,void 0,a)},t.prototype.executeHitDetection=function(t,e,r,n,i){return this.viewRotation_=r,this.execute_(t,1,e,this.hitDetectionInstructions,!0,n,i)},t}();var zP=["Polygon","Circle","LineString","Image","Text","Default"],GP=function(){function t(t,e,r,n,i,a){this.maxExtent_=t,this.overlaps_=n,this.pixelRatio_=r,this.resolution_=e,this.renderBuffer_=a,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=[1,0,0,1,0,0],this.createExecutors_(i)}return t.prototype.clip=function(t,e){var r=this.getClipCoords(e);t.beginPath(),t.moveTo(r[0],r[1]),t.lineTo(r[2],r[3]),t.lineTo(r[4],r[5]),t.lineTo(r[6],r[7]),t.clip()},t.prototype.createExecutors_=function(t){for(var e in t){var r=this.executorsByZIndex_[e];void 0===r&&(r={},this.executorsByZIndex_[e]=r);var n=t[e];for(var i in n){var a=n[i];r[i]=new BP(this.resolution_,this.pixelRatio_,this.overlaps_,a)}}},t.prototype.hasExecutors=function(t){for(var e in this.executorsByZIndex_)for(var r=this.executorsByZIndex_[e],n=0,i=t.length;n<i;++n)if(t[n]in r)return!0;return!1},t.prototype.forEachFeatureAtCoordinate=function(t,e,r,n,i,a){var o=2*(n=Math.round(n))+1,s=bP(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-r,-t[0],-t[1]),l=!this.hitDetectionContext_;l&&(this.hitDetectionContext_=i_(o,o));var u,c=this.hitDetectionContext_;c.canvas.width!==o||c.canvas.height!==o?(c.canvas.width=o,c.canvas.height=o):l||c.clearRect(0,0,o,o),void 0!==this.renderBuffer_&&(vy(u=[1/0,1/0,-1/0,-1/0],t),oy(u,e*(this.renderBuffer_+n),u));var h,d=VP(n);function f(t,e){for(var r=c.getImageData(0,0,o,o).data,s=0,l=d.length;s<l;s++)if(r[d[s]]>0){if(!a||"Image"!==h&&"Text"!==h||-1!==a.indexOf(t)){var u=(d[s]-3)/4,f=n-u%o,p=n-(u/o|0),m=i(t,e,f*f+p*p);if(m)return m}c.clearRect(0,0,o,o);break}}var p,m,g,v,y,x=Object.keys(this.executorsByZIndex_).map(Number);for(x.sort(Hx),p=x.length-1;p>=0;--p){var _=x[p].toString();for(g=this.executorsByZIndex_[_],m=zP.length-1;m>=0;--m)if(void 0!==(v=g[h=zP[m]])&&(y=v.executeHitDetection(c,s,r,f,u)))return y}},t.prototype.getClipCoords=function(t){var e=this.maxExtent_;if(!e)return null;var r=e[0],n=e[1],i=e[2],a=e[3],o=[r,n,r,a,i,a,i,n];return AP(o,0,8,2,t,o),o},t.prototype.isEmpty=function(){return Yv(this.executorsByZIndex_)},t.prototype.execute=function(t,e,r,n,i,a,o){var s=Object.keys(this.executorsByZIndex_).map(Number);s.sort(Hx),this.maxExtent_&&(t.save(),this.clip(t,r));var l,u,c,h,d,f,p=a||zP;for(o&&s.reverse(),l=0,u=s.length;l<u;++l){var m=s[l].toString();for(d=this.executorsByZIndex_[m],c=0,h=p.length;c<h;++c){void 0!==(f=d[p[c]])&&f.execute(t,e,r,n,i,o)}}this.maxExtent_&&t.restore()},t}(),jP={};function VP(t){if(void 0!==jP[t])return jP[t];for(var e=2*t+1,r=t*t,n=new Array(r+1),i=0;i<=t;++i)for(var a=0;a<=t;++a){var o=i*i+a*a;if(o>r)break;var s=n[o];s||(s=[],n[o]=s),s.push(4*((t+i)*e+(t+a))+3),i>0&&s.push(4*((t-i)*e+(t+a))+3),a>0&&(s.push(4*((t+i)*e+(t-a))+3),i>0&&s.push(4*((t-i)*e+(t-a))+3))}for(var l=[],u=(i=0,n.length);i<u;++i)n[i]&&l.push.apply(l,n[i]);return jP[t]=l,l}const HP=of(Object.freeze(Object.defineProperty({__proto__:null,default:GP,getPixelIndexArray:VP},Symbol.toStringTag,{value:"Module"})));var WP=.5,qP={Point:function(t,e,r,n,i){var a,o=r.getImage(),s=r.getText();if(o){if(o.getImageState()!=l_.LOADED)return;var l=t;if(i){var u=o.getDeclutterMode();if("none"!==u)if(l=i,"obstacle"===u){var c=t.getBuilder(r.getZIndex(),"Image");c.setImageStyle(o,a),c.drawPoint(e,n)}else s&&s.getText()&&(a={})}var h=l.getBuilder(r.getZIndex(),"Image");h.setImageStyle(o,a),h.drawPoint(e,n)}if(s&&s.getText()){var d=t;i&&(d=i);var f=d.getBuilder(r.getZIndex(),"Text");f.setTextStyle(s,a),f.drawText(e,n)}},LineString:function(t,e,r,n,i){var a=r.getStroke();if(a){var o=t.getBuilder(r.getZIndex(),"LineString");o.setFillStrokeStyle(null,a),o.drawLineString(e,n)}var s=r.getText();if(s&&s.getText()){var l=(i||t).getBuilder(r.getZIndex(),"Text");l.setTextStyle(s),l.drawText(e,n)}},Polygon:function(t,e,r,n,i){var a=r.getFill(),o=r.getStroke();if(a||o){var s=t.getBuilder(r.getZIndex(),"Polygon");s.setFillStrokeStyle(a,o),s.drawPolygon(e,n)}var l=r.getText();if(l&&l.getText()){var u=(i||t).getBuilder(r.getZIndex(),"Text");u.setTextStyle(l),u.drawText(e,n)}},MultiPoint:function(t,e,r,n,i){var a,o=r.getImage(),s=r.getText();if(o){if(o.getImageState()!=l_.LOADED)return;var l=t;if(i){var u=o.getDeclutterMode();if("none"!==u)if(l=i,"obstacle"===u){var c=t.getBuilder(r.getZIndex(),"Image");c.setImageStyle(o,a),c.drawMultiPoint(e,n)}else s&&s.getText()&&(a={})}var h=l.getBuilder(r.getZIndex(),"Image");h.setImageStyle(o,a),h.drawMultiPoint(e,n)}if(s&&s.getText()){var d=t;i&&(d=i);var f=d.getBuilder(r.getZIndex(),"Text");f.setTextStyle(s,a),f.drawText(e,n)}},MultiLineString:function(t,e,r,n,i){var a=r.getStroke();if(a){var o=t.getBuilder(r.getZIndex(),"LineString");o.setFillStrokeStyle(null,a),o.drawMultiLineString(e,n)}var s=r.getText();if(s&&s.getText()){var l=(i||t).getBuilder(r.getZIndex(),"Text");l.setTextStyle(s),l.drawText(e,n)}},MultiPolygon:function(t,e,r,n,i){var a=r.getFill(),o=r.getStroke();if(o||a){var s=t.getBuilder(r.getZIndex(),"Polygon");s.setFillStrokeStyle(a,o),s.drawMultiPolygon(e,n)}var l=r.getText();if(l&&l.getText()){var u=(i||t).getBuilder(r.getZIndex(),"Text");u.setTextStyle(l),u.drawText(e,n)}},GeometryCollection:function(t,e,r,n,i){var a,o,s=e.getGeometriesArray();for(a=0,o=s.length;a<o;++a){(0,qP[s[a].getType()])(t,s[a],r,n,i)}},Circle:function(t,e,r,n,i){var a=r.getFill(),o=r.getStroke();if(a||o){var s=t.getBuilder(r.getZIndex(),"Circle");s.setFillStrokeStyle(a,o),s.drawCircle(e,n)}var l=r.getText();if(l&&l.getText()){var u=(i||t).getBuilder(r.getZIndex(),"Text");u.setTextStyle(l),u.drawText(e,n)}}};function XP(t,e){return WP*t/e}function YP(t,e,r,n){if("GeometryCollection"!=e.getType())t.getBuilder(r.getZIndex(),"Default").drawCustom(e,n,r.getRenderer(),r.getHitDetectionRenderer());else for(var i=e.getGeometries(),a=0,o=i.length;a<o;++a)YP(t,i[a],r,n)}const ZP=of(Object.freeze(Object.defineProperty({__proto__:null,defaultOrder:function(t,e){return parseInt(ey(t),10)-parseInt(ey(e),10)},getSquaredTolerance:function(t,e){var r=XP(t,e);return r*r},getTolerance:XP,renderFeature:function(t,e,r,n,i,a,o){var s=!1,l=r.getImage();if(l){var u=l.getImageState();u==l_.LOADED||u==l_.ERROR?l.unlistenImageChange(i):(u==l_.IDLE&&l.load(),l.listenImageChange(i),s=!0)}return function(t,e,r,n,i,a){var o=r.getGeometryFunction()(e);if(!o)return;var s=o.simplifyTransformed(n,i),l=r.getRenderer();if(l)YP(t,s,r,e);else{(0,qP[s.getType()])(t,s,r,e,a)}}(t,e,r,n,a,o),s}},Symbol.toStringTag,{value:"Module"})));const KP=function(){function t(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=nw(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}return t.prototype.clone=function(){var e=this.getScale();return new t({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})},t.prototype.getOpacity=function(){return this.opacity_},t.prototype.getRotateWithView=function(){return this.rotateWithView_},t.prototype.getRotation=function(){return this.rotation_},t.prototype.getScale=function(){return this.scale_},t.prototype.getScaleArray=function(){return this.scaleArray_},t.prototype.getDisplacement=function(){return this.displacement_},t.prototype.getDeclutterMode=function(){return this.declutterMode_},t.prototype.getAnchor=function(){return $v()},t.prototype.getImage=function(t){return $v()},t.prototype.getHitDetectionImage=function(){return $v()},t.prototype.getPixelRatio=function(t){return 1},t.prototype.getImageState=function(){return $v()},t.prototype.getImageSize=function(){return $v()},t.prototype.getOrigin=function(){return $v()},t.prototype.getSize=function(){return $v()},t.prototype.setDisplacement=function(t){this.displacement_=t},t.prototype.setOpacity=function(t){this.opacity_=t},t.prototype.setRotateWithView=function(t){this.rotateWithView_=t},t.prototype.setRotation=function(t){this.rotation_=t},t.prototype.setScale=function(t){this.scale_=t,this.scaleArray_=nw(t)},t.prototype.listenImageChange=function(t){$v()},t.prototype.load=function(){$v()},t.prototype.unlistenImageChange=function(t){$v()},t}();var JP=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const QP=function(t){function e(e){var r=this,n=void 0!==e.rotateWithView&&e.rotateWithView;return(r=t.call(this,{opacity:1,rotateWithView:n,rotation:void 0!==e.rotation?e.rotation:0,scale:void 0!==e.scale?e.scale:1,displacement:void 0!==e.displacement?e.displacement:[0,0],declutterMode:e.declutterMode})||this).canvas_=void 0,r.hitDetectionCanvas_=null,r.fill_=void 0!==e.fill?e.fill:null,r.origin_=[0,0],r.points_=e.points,r.radius_=void 0!==e.radius?e.radius:e.radius1,r.radius2_=e.radius2,r.angle_=void 0!==e.angle?e.angle:0,r.stroke_=void 0!==e.stroke?e.stroke:null,r.size_=null,r.renderOptions_=null,r.render(),r}return JP(e,t),e.prototype.clone=function(){var t=this.getScale(),r=new e({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return r.setOpacity(this.getOpacity()),r},e.prototype.getAnchor=function(){var t=this.size_;if(!t)return null;var e=this.getDisplacement();return[t[0]/2-e[0],t[1]/2+e[1]]},e.prototype.getAngle=function(){return this.angle_},e.prototype.getFill=function(){return this.fill_},e.prototype.setFill=function(t){this.fill_=t,this.render()},e.prototype.getHitDetectionImage=function(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_},e.prototype.getImage=function(t){var e=this.canvas_[t];if(!e){var r=this.renderOptions_,n=i_(r.size*t,r.size*t);this.draw_(r,n,t),e=n.canvas,this.canvas_[t]=e}return e},e.prototype.getPixelRatio=function(t){return t},e.prototype.getImageSize=function(){return this.size_},e.prototype.getImageState=function(){return l_.LOADED},e.prototype.getOrigin=function(){return this.origin_},e.prototype.getPoints=function(){return this.points_},e.prototype.getRadius=function(){return this.radius_},e.prototype.getRadius2=function(){return this.radius2_},e.prototype.getSize=function(){return this.size_},e.prototype.getStroke=function(){return this.stroke_},e.prototype.setStroke=function(t){this.stroke_=t,this.render()},e.prototype.listenImageChange=function(t){},e.prototype.load=function(){},e.prototype.unlistenImageChange=function(t){},e.prototype.calculateLineJoinSize_=function(t,e,r){if(0===e||this.points_===1/0||"bevel"!==t&&"miter"!==t)return e;var n=this.radius_,i=void 0===this.radius2_?n:this.radius2_;if(n<i){var a=n;n=i,i=a}var o=void 0===this.radius2_?this.points_:2*this.points_,s=2*Math.PI/o,l=i*Math.sin(s),u=n-Math.sqrt(i*i-l*l),c=Math.sqrt(l*l+u*u),h=c/l;if("miter"===t&&h<=r)return h*e;var d=e/2/h,f=e/2*(u/c),p=Math.sqrt((n+d)*(n+d)+f*f)-n;if(void 0===this.radius2_||"bevel"===t)return 2*p;var m=n*Math.sin(s),g=i-Math.sqrt(n*n-m*m),v=Math.sqrt(m*m+g*g)/m;if(v<=r){var y=v*e/2-i-n;return 2*Math.max(p,y)}return 2*p},e.prototype.createRenderOptions=function(){var t,e=OR,r=0,n=null,i=0,a=0;this.stroke_&&(null===(t=this.stroke_.getColor())&&(t=DR),t=ER(t),void 0===(a=this.stroke_.getWidth())&&(a=1),n=this.stroke_.getLineDash(),i=this.stroke_.getLineDashOffset(),void 0===(e=this.stroke_.getLineJoin())&&(e=OR),void 0===(r=this.stroke_.getMiterLimit())&&(r=10));var o=this.calculateLineJoinSize_(e,a,r),s=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:t,strokeWidth:a,size:Math.ceil(2*s+o),lineDash:n,lineDashOffset:i,lineJoin:e,miterLimit:r}},e.prototype.render=function(){this.renderOptions_=this.createRenderOptions();var t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]},e.prototype.draw_=function(t,e,r){if(e.scale(r,r),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){var n=this.fill_.getColor();null===n&&(n=CR),e.fillStyle=ER(n),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,e.setLineDash&&t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())},e.prototype.createHitDetectionCanvas_=function(t){if(this.fill_){var e=this.fill_.getColor(),r=0;if("string"==typeof e&&(e=MR(e)),null===e?r=1:Array.isArray(e)&&(r=4===e.length?e[3]:1),0===r){var n=i_(t.size,t.size);this.hitDetectionCanvas_=n.canvas,this.drawHitDetectionCanvas_(t,n)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))},e.prototype.createPath_=function(t){var e=this.points_,r=this.radius_;if(e===1/0)t.arc(0,0,r,0,2*Math.PI);else{var n=void 0===this.radius2_?r:this.radius2_;void 0!==this.radius2_&&(e*=2);for(var i=this.angle_-Math.PI/2,a=2*Math.PI/e,o=0;o<e;o++){var s=i+o*a,l=o%2==0?r:n;t.lineTo(l*Math.cos(s),l*Math.sin(s))}t.closePath()}},e.prototype.drawHitDetectionCanvas_=function(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=CR,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())},e}(KP);var $P=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const tC=function(t){function e(e){var r=e||{};return t.call(this,{points:1/0,fill:r.fill,radius:r.radius,stroke:r.stroke,scale:void 0!==r.scale?r.scale:1,rotation:void 0!==r.rotation?r.rotation:0,rotateWithView:void 0!==r.rotateWithView&&r.rotateWithView,displacement:void 0!==r.displacement?r.displacement:[0,0],declutterMode:r.declutterMode})||this}return $P(e,t),e.prototype.clone=function(){var t=this.getScale(),r=new e({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return r.setOpacity(this.getOpacity()),r},e.prototype.setRadius=function(t){this.radius_=t,this.render()},e}(QP);const eC=function(){function t(t){var e=t||{};this.color_=void 0!==e.color?e.color:null}return t.prototype.clone=function(){var e=this.getColor();return new t({color:Array.isArray(e)?e.slice():e||void 0})},t.prototype.getColor=function(){return this.color_},t.prototype.setColor=function(t){this.color_=t},t}(),rC="fraction",nC="bottom-left",iC="bottom-right",aC="top-left",oC="top-right";function sC(t,e,r){return e+":"+t+":"+(r?xR(r):"null")}var lC=new(function(){function t(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}return t.prototype.clear=function(){this.cache_={},this.cacheSize_=0},t.prototype.canExpireCache=function(){return this.cacheSize_>this.maxCacheSize_},t.prototype.expire=function(){if(this.canExpireCache()){var t=0;for(var e in this.cache_){var r=this.cache_[e];0!=(3&t++)||r.hasListener()||(delete this.cache_[e],--this.cacheSize_)}}},t.prototype.get=function(t,e,r){var n=sC(t,e,r);return n in this.cache_?this.cache_[n]:null},t.prototype.set=function(t,e,r,n){var i=sC(t,e,r);this.cache_[i]=n,++this.cacheSize_},t.prototype.setSize=function(t){this.maxCacheSize_=t,this.expire()},t}()),uC=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),cC=null,hC=function(t){function e(e,r,n,i,a,o){var s=t.call(this)||this;return s.hitDetectionImage_=null,s.image_=e||new Image,null!==i&&(s.image_.crossOrigin=i),s.canvas_={},s.color_=o,s.unlisten_=null,s.imageState_=a,s.size_=n,s.src_=r,s.tainted_,s}return uC(e,t),e.prototype.isTainted_=function(){if(void 0===this.tainted_&&this.imageState_===l_.LOADED){cC||(cC=i_(1,1)),cC.drawImage(this.image_,0,0);try{cC.getImageData(0,0,1,1),this.tainted_=!1}catch(t){cC=null,this.tainted_=!0}}return!0===this.tainted_},e.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(Gx.CHANGE)},e.prototype.handleImageError_=function(){this.imageState_=l_.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.handleImageLoad_=function(){this.imageState_=l_.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.getImage=function(t){return this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_},e.prototype.getPixelRatio=function(t){return this.replaceColor_(t),this.canvas_[t]?t:1},e.prototype.getImageState=function(){return this.imageState_},e.prototype.getHitDetectionImage=function(){if(!this.hitDetectionImage_)if(this.isTainted_()){var t=this.size_[0],e=this.size_[1],r=i_(t,e);r.fillRect(0,0,t,e),this.hitDetectionImage_=r.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},e.prototype.getSize=function(){return this.size_},e.prototype.getSrc=function(){return this.src_},e.prototype.load=function(){if(this.imageState_==l_.IDLE){this.imageState_=l_.LOADING;try{this.image_.src=this.src_}catch(t){this.handleImageError_()}this.unlisten_=p_(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},e.prototype.replaceColor_=function(t){if(this.color_&&!this.canvas_[t]&&this.imageState_===l_.LOADED){var e=document.createElement("canvas");this.canvas_[t]=e,e.width=Math.ceil(this.image_.width*t),e.height=Math.ceil(this.image_.height*t);var r=e.getContext("2d");if(r.scale(t,t),r.drawImage(this.image_,0,0),r.globalCompositeOperation="multiply","multiply"===r.globalCompositeOperation||this.isTainted_())r.fillStyle=xR(this.color_),r.fillRect(0,0,e.width/t,e.height/t),r.globalCompositeOperation="destination-in",r.drawImage(this.image_,0,0);else{for(var n=r.getImageData(0,0,e.width,e.height),i=n.data,a=this.color_[0]/255,o=this.color_[1]/255,s=this.color_[2]/255,l=this.color_[3],u=0,c=i.length;u<c;u+=4)i[u]*=a,i[u+1]*=o,i[u+2]*=s,i[u+3]*=l;r.putImageData(n,0,0)}}},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(Kx);const dC=hC;var fC=globalThis&&globalThis.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const pC=function(t){function e(e){var r=this,n=e||{},i=void 0!==n.opacity?n.opacity:1,a=void 0!==n.rotation?n.rotation:0,o=void 0!==n.scale?n.scale:1,s=void 0!==n.rotateWithView&&n.rotateWithView;(r=t.call(this,{opacity:i,rotation:a,scale:o,displacement:void 0!==n.displacement?n.displacement:[0,0],rotateWithView:s,declutterMode:n.declutterMode})||this).anchor_=void 0!==n.anchor?n.anchor:[.5,.5],r.normalizedAnchor_=null,r.anchorOrigin_=void 0!==n.anchorOrigin?n.anchorOrigin:aC,r.anchorXUnits_=void 0!==n.anchorXUnits?n.anchorXUnits:rC,r.anchorYUnits_=void 0!==n.anchorYUnits?n.anchorYUnits:rC,r.crossOrigin_=void 0!==n.crossOrigin?n.crossOrigin:null;var l=void 0!==n.img?n.img:null;r.imgSize_=n.imgSize;var u=n.src;iy(!(void 0!==u&&l),4),iy(!l||l&&r.imgSize_,5),void 0!==u&&0!==u.length||!l||(u=l.src||ey(l)),iy(void 0!==u&&u.length>0,6);var c=void 0!==n.src?l_.IDLE:l_.LOADED;return r.color_=void 0!==n.color?MR(n.color):null,r.iconImage_=function(t,e,r,n,i,a){var o=lC.get(e,n,a);return o||(o=new hC(t,e,r,n,i,a),lC.set(e,n,a,o)),o}(l,u,void 0!==r.imgSize_?r.imgSize_:null,r.crossOrigin_,c,r.color_),r.offset_=void 0!==n.offset?n.offset:[0,0],r.offsetOrigin_=void 0!==n.offsetOrigin?n.offsetOrigin:aC,r.origin_=null,r.size_=void 0!==n.size?n.size:null,r}return fC(e,t),e.prototype.clone=function(){var t=this.getScale();return new e({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(t)?t.slice():t,size:null!==this.size_?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})},e.prototype.getAnchor=function(){var t=this.normalizedAnchor_;if(!t){t=this.anchor_;var e=this.getSize();if(this.anchorXUnits_==rC||this.anchorYUnits_==rC){if(!e)return null;t=this.anchor_.slice(),this.anchorXUnits_==rC&&(t[0]*=e[0]),this.anchorYUnits_==rC&&(t[1]*=e[1])}if(this.anchorOrigin_!=aC){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice()),this.anchorOrigin_!=oC&&this.anchorOrigin_!=iC||(t[0]=-t[0]+e[0]),this.anchorOrigin_!=nC&&this.anchorOrigin_!=iC||(t[1]=-t[1]+e[1])}this.normalizedAnchor_=t}var r=this.getDisplacement();return[t[0]-r[0],t[1]+r[1]]},e.prototype.setAnchor=function(t){this.anchor_=t,this.normalizedAnchor_=null},e.prototype.getColor=function(){return this.color_},e.prototype.getImage=function(t){return this.iconImage_.getImage(t)},e.prototype.getPixelRatio=function(t){return this.iconImage_.getPixelRatio(t)},e.prototype.getImageSize=function(){return this.iconImage_.getSize()},e.prototype.getImageState=function(){return this.iconImage_.getImageState()},e.prototype.getHitDetectionImage=function(){return this.iconImage_.getHitDetectionImage()},e.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var t=this.offset_;if(this.offsetOrigin_!=aC){var e=this.getSize(),r=this.iconImage_.getSize();if(!e||!r)return null;t=t.slice(),this.offsetOrigin_!=oC&&this.offsetOrigin_!=iC||(t[0]=r[0]-e[0]-t[0]),this.offsetOrigin_!=nC&&this.offsetOrigin_!=iC||(t[1]=r[1]-e[1]-t[1])}return this.origin_=t,this.origin_},e.prototype.getSrc=function(){return this.iconImage_.getSrc()},e.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},e.prototype.listenImageChange=function(t){this.iconImage_.addEventListener(Gx.CHANGE,t)},e.prototype.load=function(){this.iconImage_.load()},e.prototype.unlistenImageChange=function(t){this.iconImage_.removeEventListener(Gx.CHANGE,t)},e}(KP);const mC=function(){function t(t){var e=t||{};this.color_=void 0!==e.color?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=void 0!==e.lineDash?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}return t.prototype.clone=function(){var e=this.getColor();return new t({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},t.prototype.getColor=function(){return this.color_},t.prototype.getLineCap=function(){return this.lineCap_},t.prototype.getLineDash=function(){return this.lineDash_},t.prototype.getLineDashOffset=function(){return this.lineDashOffset_},t.prototype.getLineJoin=function(){return this.lineJoin_},t.prototype.getMiterLimit=function(){return this.miterLimit_},t.prototype.getWidth=function(){return this.width_},t.prototype.setColor=function(t){this.color_=t},t.prototype.setLineCap=function(t){this.lineCap_=t},t.prototype.setLineDash=function(t){this.lineDash_=t},t.prototype.setLineDashOffset=function(t){this.lineDashOffset_=t},t.prototype.setLineJoin=function(t){this.lineJoin_=t},t.prototype.setMiterLimit=function(t){this.miterLimit_=t},t.prototype.setWidth=function(t){this.width_=t},t}();function gC(t){return t.getGeometry()}const vC=function(){function t(t){var e=t||{};this.geometry_=null,this.geometryFunction_=gC,void 0!==e.geometry&&this.setGeometry(e.geometry),this.fill_=void 0!==e.fill?e.fill:null,this.image_=void 0!==e.image?e.image:null,this.renderer_=void 0!==e.renderer?e.renderer:null,this.hitDetectionRenderer_=void 0!==e.hitDetectionRenderer?e.hitDetectionRenderer:null,this.stroke_=void 0!==e.stroke?e.stroke:null,this.text_=void 0!==e.text?e.text:null,this.zIndex_=e.zIndex}return t.prototype.clone=function(){var e=this.getGeometry();return e&&"object"==typeof e&&(e=e.clone()),new t({geometry:e,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},t.prototype.getRenderer=function(){return this.renderer_},t.prototype.setRenderer=function(t){this.renderer_=t},t.prototype.setHitDetectionRenderer=function(t){this.hitDetectionRenderer_=t},t.prototype.getHitDetectionRenderer=function(){return this.hitDetectionRenderer_},t.prototype.getGeometry=function(){return this.geometry_},t.prototype.getGeometryFunction=function(){return this.geometryFunction_},t.prototype.getFill=function(){return this.fill_},t.prototype.setFill=function(t){this.fill_=t},t.prototype.getImage=function(){return this.image_},t.prototype.setImage=function(t){this.image_=t},t.prototype.getStroke=function(){return this.stroke_},t.prototype.setStroke=function(t){this.stroke_=t},t.prototype.getText=function(){return this.text_},t.prototype.setText=function(t){this.text_=t},t.prototype.getZIndex=function(){return this.zIndex_},t.prototype.setGeometry=function(t){"function"==typeof t?this.geometryFunction_=t:"string"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=gC,this.geometry_=t},t.prototype.setZIndex=function(t){this.zIndex_=t},t}();const yC=function(){function t(t){var e=t||{};this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.scaleArray_=nw(void 0!==e.scale?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.textBaseline_=e.textBaseline,this.fill_=void 0!==e.fill?e.fill:new eC({color:"#333"}),this.maxAngle_=void 0!==e.maxAngle?e.maxAngle:Math.PI/4,this.placement_=void 0!==e.placement?e.placement:sP,this.overflow_=!!e.overflow,this.stroke_=void 0!==e.stroke?e.stroke:null,this.offsetX_=void 0!==e.offsetX?e.offsetX:0,this.offsetY_=void 0!==e.offsetY?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=void 0===e.padding?null:e.padding}return t.prototype.clone=function(){var e=this.getScale();return new t({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})},t.prototype.getOverflow=function(){return this.overflow_},t.prototype.getFont=function(){return this.font_},t.prototype.getMaxAngle=function(){return this.maxAngle_},t.prototype.getPlacement=function(){return this.placement_},t.prototype.getOffsetX=function(){return this.offsetX_},t.prototype.getOffsetY=function(){return this.offsetY_},t.prototype.getFill=function(){return this.fill_},t.prototype.getRotateWithView=function(){return this.rotateWithView_},t.prototype.getRotation=function(){return this.rotation_},t.prototype.getScale=function(){return this.scale_},t.prototype.getScaleArray=function(){return this.scaleArray_},t.prototype.getStroke=function(){return this.stroke_},t.prototype.getText=function(){return this.text_},t.prototype.getTextAlign=function(){return this.textAlign_},t.prototype.getJustify=function(){return this.justify_},t.prototype.getTextBaseline=function(){return this.textBaseline_},t.prototype.getBackgroundFill=function(){return this.backgroundFill_},t.prototype.getBackgroundStroke=function(){return this.backgroundStroke_},t.prototype.getPadding=function(){return this.padding_},t.prototype.setOverflow=function(t){this.overflow_=t},t.prototype.setFont=function(t){this.font_=t},t.prototype.setMaxAngle=function(t){this.maxAngle_=t},t.prototype.setOffsetX=function(t){this.offsetX_=t},t.prototype.setOffsetY=function(t){this.offsetY_=t},t.prototype.setPlacement=function(t){this.placement_=t},t.prototype.setRotateWithView=function(t){this.rotateWithView_=t},t.prototype.setFill=function(t){this.fill_=t},t.prototype.setRotation=function(t){this.rotation_=t},t.prototype.setScale=function(t){this.scale_=t,this.scaleArray_=nw(void 0!==t?t:1)},t.prototype.setStroke=function(t){this.stroke_=t},t.prototype.setText=function(t){this.text_=t},t.prototype.setTextAlign=function(t){this.textAlign_=t},t.prototype.setJustify=function(t){this.justify_=t},t.prototype.setTextBaseline=function(t){this.textBaseline_=t},t.prototype.setBackgroundFill=function(t){this.backgroundFill_=t},t.prototype.setBackgroundStroke=function(t){this.backgroundStroke_=t},t.prototype.setPadding=function(t){this.padding_=t},t}(),xC=of(Object.freeze(Object.defineProperty({__proto__:null,Circle:tC,Fill:eC,Icon:pC,IconImage:dC,Image:KP,RegularShape:QP,Stroke:mC,Style:vC,Text:yC},Symbol.toStringTag,{value:"Module"}))),_C=of(EP);var wC;function bC(){if(wC)return lR;wC=1;var t=uf;Object.defineProperty(lR,"__esModule",{value:!0}),lR.default=void 0;var e=Bf,r=t(xS),n=aR,i=uR,a=t(pP),o=t(HP),s=ZP,l=xC,u=_C,c=t(DM()),h=(0,u.create)(),d=new e.Texture;function f(){var t=this;this.storage={},this.contains=function(e){return e in t.storage}}function p(t,e){return new c.default(e,t[0],t[2],t[1],t[3])}function m(t,n,l){if(!t.material)return null;var c=t.material.canvas,d=new e.CanvasTexture(c);d.premultiplyAlpha=l.transparent,d.extent=n.tileExtent;var f=function(t,e){var n=this,l=t.getReplayState(e),u=e.source,c=u.getTileGrid(),h=u.getProjection(),d=u.getTileGridForProjection(h),f=d.getResolution(t.tileCoord[0]),p=d.getTileCoordExtent(t.wrappedTileCoord),m=1,v=(0,i.createEmpty)(),y=!0;t.executorGroups[e.ol_uid]=[];for(var x=u.getSourceTiles(m,h,t),_=function(h,d){var _=x[h];if(_.getState()!==r.default.LOADED)return console.warn("not loaded !!!",_),"continue";for(var w=_.tileCoord,b=c.getTileCoordExtent(w),M=(0,i.getIntersection)(p,b),S=100,T=(0,i.buffer)(M,S*f,v),E=(0,i.equals)(b,M)?null:T,A=new a.default(0,T,f,m),R=(0,s.getSquaredTolerance)(f,m),P=function(t){var r,n=t.getStyleFunction()||e.getStyleFunction();if(n&&(r=n(t,f)),r){var i=function(t,e,r,n){if(!r)return!1;var i=!1;if(Array.isArray(r))for(var a=0,o=r.length;a<o;++a)i=(0,s.renderFeature)(n,t,r[a],e,g,void 0)||i;else i=(0,s.renderFeature)(n,t,r,e,g,void 0);return i}(t,R,r,A);l.dirty=l.dirty||i}},C=_.getFeatures(),I=0,L=C.length;I<L;++I){var O=C[I];E&&!(0,i.intersects)(E,O.getGeometry().getExtent())||P.call(n,O),y=!1}if(!y){var D=new o.default(T,f,m,u.getOverlaps(),A.finish(),S);t.executorGroups[e.ol_uid].push(D)}},w=0,b=x.length;w<b;++w)_(w);return l.renderedRevision=1,l.renderedRenderOrder=null,y}(n.tile,l);if(f)return{texture:d,pitch:new e.Vector4(0,0,0,0)};var p=t.layer.atlasInfo.atlas[l.id];!function(t,e,r,n){var i=1,a=e.getReplayState(n),o=1;a.renderedTileRevision=o;var s=e.wrappedTileCoord,l=s[0],c=n.source,d=c.getTileGridForProjection(c.getProjection()),f=d.getResolution(l),p=t.getContext("2d");p.save(),p.translate(r.x,r.y),p.clearRect(0,0,n.imageSize.w,n.imageSize.h+2*r.offset),p.beginPath(),p.rect(0,0,n.imageSize.w,n.imageSize.h+2*r.offset),p.clip(),n.backgroundColor&&(p.fillStyle=n.backgroundColor,p.fillRect(0,0,n.imageSize.w,n.imageSize.h+2*r.offset));var m=d.getTileCoordExtent(s),g=i/f,v=(0,u.reset)(h);(0,u.scale)(v,g,-g),(0,u.translate)(v,-m[0],-m[3]);for(var y=e.executorGroups[n.ol_uid],x=0,_=y.length;x<_;++x){y[x].execute(p,1,v,0,!0)}p.restore()}(c,n.tile,p,l);var m=n.tile.tileCoord[0].toString();return delete l.usedTiles[m].storage[n.tile.tileCoord],l.source.tileCache.expireCache(l.usedTiles),{texture:d,pitch:n.pitch}}function g(){}var v={preprocessDataLayer:function(t){var e=t.source,r=e.getProjection(),n=e.getTileGridForProjection(r),i=e.getTilePixelSize(0,1,r);t.imageSize={w:i[0],h:i[1]};var a=n.getExtent();t.extent=p(a,r.getCode()),t.getStyleFunction=function(){return t.style(l.Style,l.Fill,l.Stroke,l.Icon,l.Text)},t.fx=0,t.usedTiles={}},executeCommand:function(t){return function(t,e,i){var a,o=e.tile;a=o.getState()===r.default.LOADED?Promise.resolve(m(t,e,i)):new Promise((function(a,s){o.load(),(0,n.listenOnce)(o,"change",(function(n){var o=n.target.getState();o===r.default.ERROR?s():o===r.default.LOADED&&a(m(t,e,i))}))}));return a}(t.requester,t.toDownload,t.layer)},tileTextureCount:function(t,e){return 1},tileInsideLimit:function(t,e){return t.getExtentForLayer(e).as(e.extent.crs()).isInside(e.extent)},getPossibleTextureImprovements:function(t,e,r){var n=e.as(t.extent.crs()),i=function(t,e){var r=t.source,n=r.getProjection(),i=r.getTileGridForProjection(n),a=function(t,e){e=function(t){return[Math.ceil(t.west()),Math.ceil(t.south()),Math.floor(t.east()),Math.floor(t.north())]}(e);for(var r,n=t.getMinZoom(),i=t.getMaxZoom();i>=n;i--)if(1===(r=t.getTileRangeForExtentAndZ(e,i,r)).getWidth()&&1===r.getHeight())return[i,r.minX,r.minY];return null}(i,e);if(!a)return null;var o=r.getTile(a[0],a[1],a[2],1,n),s=o.tileCoord[0].toString();s in t.usedTiles||(t.usedTiles[s]=new f);t.usedTiles[s].storage[o.tileCoord]=o;var l=p(i.getTileCoordExtent(a),n.getCode()),u=t.extent.dimensions(),c=u.y/u.x;l._values[3]=l._values[2]+l.dimensions().x*c;var h=e.offsetToParent(l);return{extent:e,pitch:h,tile:o,tileExtent:l}}(t,n);return r&&r.extent&&r.extent.isInside(i.tileExtent)||r===d?null:i}};return lR.default=v,lR}var MC,SC={};function TC(){if(MC)return SC;MC=1;var t=uf;Object.defineProperty(SC,"__esModule",{value:!0}),SC.default=void 0;var e=Bf,r=t(pP),n=t(HP),i=ZP,a=xC,o=_C,s=t(DM());function l(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function c(t,e){return new s.default(e,t[0],t[2],t[1],t[3])}var h=new e.Texture;h.empty=!0;var d=(0,o.create)();function f(t){return[Math.floor(t.west()),Math.floor(t.south()),Math.ceil(t.east()),Math.ceil(t.north())]}function p(){}var m={preprocessDataLayer:function(t){t.imageSize={w:256,h:256};var e=t.source.getFormat();if(e&&e.dataProjection.getCode()!==t.projection){var r,n=l(t.source.getFeatures());try{for(n.s();!(r=n.n()).done;){r.value.getGeometry().transform(t.source.getFormat().dataProjection.getCode(),t.projection)}}catch(t){n.e(t)}finally{n.f()}t.source.on("addfeature",(function(e){var r=t.source.getFormat();r&&e.feature.getGeometry().transform(r.dataProjection.getCode(),t.projection)}))}t.getStyleFunction=function(){return t.style(a.Style,a.Fill,a.Stroke,a.Icon,a.Text)}},executeCommand:function(t){return function(t,a,s){var l=c(s.source.getExtent(),s.projection);if(!a.intersectsExtent(l))return Promise.resolve({texture:h,pitch:new e.Vector4(0,0,0,0)});var u,m,g=function(t,e){var n=e.source,a=1,o=t.dimensions().x/e.imageSize.w,s=f(t),l=new r.default(0,s,o,a),u=(0,i.getSquaredTolerance)(o,a),c=!1;if(n.forEachFeatureInExtent(s,(function(t){var r,n=t.getStyleFunction()||e.getStyleFunction();n&&(r=n(t,o)),r&&function(t,e,r,n){if(!r)return!1;var a=!1;if(Array.isArray(r))for(var o=0,s=r.length;o<s;++o)a=(0,i.renderFeature)(n,t,r[o],e,p)||a;else a=(0,i.renderFeature)(n,t,r,e,p)}(t,u,r,l),c=!0}),this),c)return l;return null}(a,s);if(g){var v=t.material.canvas;!function(t,e,r,i,a){var s=1,l=r.dimensions().x/a.imageSize.w,u=r.dimensions().y/a.imageSize.h,c=t.getContext("2d");c.save(),c.translate(i.x,i.y),c.clearRect(0,0,a.imageSize.w,a.imageSize.h+2*i.offset),c.beginPath(),c.rect(0,0,a.imageSize.w,a.imageSize.h+2*i.offset),c.clip();var h=(0,o.reset)(d);(0,o.scale)(h,s/l,-s/u),(0,o.translate)(h,-r.west(),-r.north());var p=f(r),m=r.dimensions().x/a.imageSize.w,g=new n.default(p,m,s,!0,e.finish());g.execute(c,1,h,0,!0),c.restore()}(v,g,a,t.layer.atlasInfo.atlas[s.id],s),u=new e.CanvasTexture(v),m=new e.Vector4(0,0,1,1)}else u=new e.Texture,m=new e.Vector4(0,0,0,0);return u.extent=a,u.revision=s.source.getRevision(),Promise.resolve({texture:u,pitch:m})}(t.requester,t.toDownload,t.layer)},tileTextureCount:function(){return 1},tileInsideLimit:function(){return!0},getPossibleTextureImprovements:function(t,e,r){if(r&&r.extent&&r.extent.isInside(e)&&r.revision===t.source.getRevision())return null;var n=c(t.source.getExtent(),t.projection);return e.intersectsExtent(n)?e:r&&r.empty?null:e}};return SC.default=m,SC}var EC,AC,RC,PC={},CC={},IC={get exports(){return CC},set exports(t){CC=t}};function LC(){return EC||(EC=1,function(t){var e=cf.default;function r(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
t.exports=r=function(){return n},t.exports.__esModule=!0,t.exports.default=t.exports;var n={},i=Object.prototype,a=i.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",l=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var i,a,o,s,l=e&&e.prototype instanceof p?e:p,u=Object.create(l.prototype),c=new E(n||[]);return u._invoke=(i=t,a=r,o=c,s="suspendedStart",function(t,e){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===t)throw e;return{value:void 0,done:!0}}for(o.method=t,o.arg=e;;){var r=o.delegate;if(r){var n=M(r,o);if(n){if(n===f)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===s)throw s="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s="executing";var l=d(i,a,o);if("normal"===l.type){if(s=o.done?"completed":"suspendedYield",l.arg===f)continue;return{value:l.arg,done:o.done}}"throw"===l.type&&(s="completed",o.method="throw",o.arg=l.arg)}}),u}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}n.wrap=h;var f={};function p(){}function m(){}function g(){}var v={};c(v,s,(function(){return this}));var y=Object.getPrototypeOf,x=y&&y(y(A([])));x&&x!==i&&a.call(x,s)&&(v=x);var _=g.prototype=p.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,r){function n(i,o,s,l){var u=d(t[i],t,o);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==e(h)&&a.call(h,"__await")?r.resolve(h.__await).then((function(t){n("next",t,s,l)}),(function(t){n("throw",t,s,l)})):r.resolve(h).then((function(t){c.value=t,s(c)}),(function(t){return n("throw",t,s,l)}))}l(u.arg)}var i;this._invoke=function(t,e){function a(){return new r((function(r,i){n(t,e,r,i)}))}return i=i?i.then(a,a):a()}}function M(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,M(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=d(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,f;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function A(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(a.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:R}}function R(){return{value:void 0,done:!0}}return m.prototype=g,c(_,"constructor",g),c(g,"constructor",m),m.displayName=c(g,u,"GeneratorFunction"),n.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,c(t,u,"GeneratorFunction")),t.prototype=Object.create(_),t},n.awrap=function(t){return{__await:t}},w(b.prototype),c(b.prototype,l,(function(){return this})),n.AsyncIterator=b,n.async=function(t,e,r,i,a){void 0===a&&(a=Promise);var o=new b(h(t,e,r,i),a);return n.isGeneratorFunction(e)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},w(_),c(_,u,"Generator"),c(_,s,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),n.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},n.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!t)for(var e in this)"t"===e.charAt(0)&&a.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return o.type="throw",o.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(s&&l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},n}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}(IC)),CC}var OC,DC={},kC={get exports(){return DC},set exports(t){DC=t}};var FC,NC,UC,BC={},zC={},GC={},jC={},VC={},HC={},WC={};function qC(){if(FC)return WC;FC=1,Object.defineProperty(WC,"__esModule",{value:!0});WC.THIS_IS_NOT_AN_OBJECT="This is not an object";WC.THIS_IS_NOT_A_FLOAT16ARRAY_OBJECT="This is not a Float16Array object";WC.THIS_CONSTRUCTOR_IS_NOT_A_SUBCLASS_OF_FLOAT16ARRAY="This constructor is not a subclass of Float16Array";WC.THE_CONSTRUCTOR_PROPERTY_VALUE_IS_NOT_AN_OBJECT="The constructor property value is not an object";WC.SPECIES_CONSTRUCTOR_DIDNT_RETURN_TYPEDARRAY_OBJECT="Species constructor didn't return TypedArray object";WC.DERIVED_CONSTRUCTOR_CREATED_TYPEDARRAY_OBJECT_WHICH_WAS_TOO_SMALL_LENGTH="Derived constructor created TypedArray object which was too small length";WC.ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER="Attempting to access detached ArrayBuffer";WC.CANNOT_CONVERT_UNDEFINED_OR_NULL_TO_OBJECT="Cannot convert undefined or null to object";WC.CANNOT_MIX_BIGINT_AND_OTHER_TYPES="Cannot mix BigInt and other types, use explicit conversions";WC.ITERATOR_PROPERTY_IS_NOT_CALLABLE="@@iterator property is not callable";WC.REDUCE_OF_EMPTY_ARRAY_WITH_NO_INITIAL_VALUE="Reduce of empty array with no initial value";return WC.OFFSET_IS_OUT_OF_BOUNDS="Offset is out of bounds",WC}function XC(){if(NC)return HC;NC=1,Object.defineProperty(HC,"__esModule",{value:!0});var t=qC();function e(t){return(e,...r)=>n(t,e,r)}function r(t,r){return e(s(t,r).get)}const{apply:n,construct:i,defineProperty:a,get:o,getOwnPropertyDescriptor:s,getPrototypeOf:l,has:u,ownKeys:c,set:h,setPrototypeOf:d}=Reflect;HC.ReflectSetPrototypeOf=d,HC.ReflectSet=h,HC.ReflectOwnKeys=c,HC.ReflectHas=u,HC.ReflectGetPrototypeOf=l,HC.ReflectGetOwnPropertyDescriptor=s,HC.ReflectGet=o,HC.ReflectDefineProperty=a,HC.ReflectConstruct=i,HC.ReflectApply=n;const f=Proxy;HC.NativeProxy=f;const{MAX_SAFE_INTEGER:p,isFinite:m,isNaN:g}=Number;HC.NumberIsNaN=g,HC.NumberIsFinite=m,HC.MAX_SAFE_INTEGER=p;const{iterator:v,species:y,toStringTag:x,for:_}=Symbol;HC.SymbolFor=_,HC.SymbolToStringTag=x,HC.SymbolSpecies=y,HC.SymbolIterator=v;const w=Object;HC.NativeObject=w;const{create:b,defineProperty:M,freeze:S,is:T}=w;HC.ObjectIs=T,HC.ObjectFreeze=S,HC.ObjectDefineProperty=M,HC.ObjectCreate=b;const E=w.prototype,A=E.__lookupGetter__?e(E.__lookupGetter__):(e,r)=>{if(null==e)throw xt(t.CANNOT_CONVERT_UNDEFINED_OR_NULL_TO_OBJECT);let n=w(e);do{const t=s(n,r);if(void 0!==t)return R(t,"get")?t.get:void 0}while(null!==(n=l(n)))};HC.ObjectPrototype__lookupGetter__=A;const R=w.hasOwn||e(E.hasOwnProperty);HC.ObjectHasOwn=R;const P=Array,C=P.isArray;HC.ArrayIsArray=C;const I=P.prototype,L=e(I.join);HC.ArrayPrototypeJoin=L;const O=e(I.push);HC.ArrayPrototypePush=O;const D=e(I.toLocaleString);HC.ArrayPrototypeToLocaleString=D;const k=I[v];HC.NativeArrayPrototypeSymbolIterator=k;const F=e(k);HC.ArrayPrototypeSymbolIterator=F;const N=Math.trunc;HC.MathTrunc=N;const U=ArrayBuffer;HC.NativeArrayBuffer=U;const B=U.isView;HC.ArrayBufferIsView=B;const z=U.prototype,G=e(z.slice);HC.ArrayBufferPrototypeSlice=G;const j=r(z,"byteLength");HC.ArrayBufferPrototypeGetByteLength=j;const V="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:null;HC.NativeSharedArrayBuffer=V;const H=V&&r(V.prototype,"byteLength");HC.SharedArrayBufferPrototypeGetByteLength=H;const W=l(Uint8Array);HC.TypedArray=W;const q=W.from,X=W.prototype;HC.TypedArrayPrototype=X;const Y=X[v];HC.NativeTypedArrayPrototypeSymbolIterator=Y;const Z=e(X.keys);HC.TypedArrayPrototypeKeys=Z;const K=e(X.values);HC.TypedArrayPrototypeValues=K;const J=e(X.entries);HC.TypedArrayPrototypeEntries=J;const Q=e(X.set);HC.TypedArrayPrototypeSet=Q;const $=e(X.reverse);HC.TypedArrayPrototypeReverse=$;const tt=e(X.fill);HC.TypedArrayPrototypeFill=tt;const et=e(X.copyWithin);HC.TypedArrayPrototypeCopyWithin=et;const rt=e(X.sort);HC.TypedArrayPrototypeSort=rt;const nt=e(X.slice);HC.TypedArrayPrototypeSlice=nt;const it=e(X.subarray);HC.TypedArrayPrototypeSubarray=it;const at=r(X,"buffer");HC.TypedArrayPrototypeGetBuffer=at;const ot=r(X,"byteOffset");HC.TypedArrayPrototypeGetByteOffset=ot;const st=r(X,"length");HC.TypedArrayPrototypeGetLength=st;const lt=r(X,x);HC.TypedArrayPrototypeGetSymbolToStringTag=lt;const ut=Uint16Array;HC.NativeUint16Array=ut;HC.Uint16ArrayFrom=(...t)=>n(q,ut,t);const ct=Uint32Array;HC.NativeUint32Array=ct;const ht=Float32Array;HC.NativeFloat32Array=ht;const dt=l([][v]());HC.ArrayIteratorPrototype=dt;const ft=e(dt.next);HC.ArrayIteratorPrototypeNext=ft;const pt=e(function*(){}().next);HC.GeneratorPrototypeNext=pt;const mt=l(dt);HC.IteratorPrototype=mt;const gt=DataView.prototype,vt=e(gt.getUint16);HC.DataViewPrototypeGetUint16=vt;const yt=e(gt.setUint16);HC.DataViewPrototypeSetUint16=yt;const xt=TypeError;HC.NativeTypeError=xt;const _t=RangeError;HC.NativeRangeError=_t;const wt=WeakSet;HC.NativeWeakSet=wt;const bt=wt.prototype,Mt=e(bt.add);HC.WeakSetPrototypeAdd=Mt;const St=e(bt.has);HC.WeakSetPrototypeHas=St;const Tt=WeakMap;HC.NativeWeakMap=Tt;const Et=Tt.prototype,At=e(Et.get);HC.WeakMapPrototypeGet=At;const Rt=e(Et.has);HC.WeakMapPrototypeHas=Rt;const Pt=e(Et.set);return HC.WeakMapPrototypeSet=Pt,HC}function YC(){if(UC)return VC;UC=1,Object.defineProperty(VC,"__esModule",{value:!0}),VC.safeIfNeeded=function(n){if(n[t.SymbolIterator]===t.NativeArrayPrototypeSymbolIterator)return n;const i=(0,t.ObjectCreate)(r);return(0,t.WeakMapPrototypeSet)(e,i,(0,t.ArrayPrototypeSymbolIterator)(n)),i},VC.wrap=function(e){const r=(0,t.ObjectCreate)(i);return(0,t.WeakMapPrototypeSet)(n,r,e),r};var t=XC();const e=new t.NativeWeakMap,r=(0,t.ObjectCreate)(null,{next:{value:function(){const r=(0,t.WeakMapPrototypeGet)(e,this);return(0,t.ArrayIteratorPrototypeNext)(r)}},[t.SymbolIterator]:{value:function(){return this}}});const n=new t.NativeWeakMap,i=(0,t.ObjectCreate)(t.IteratorPrototype,{next:{value:function(){const e=(0,t.WeakMapPrototypeGet)(n,this);return(0,t.GeneratorPrototypeNext)(e)},writable:!0,configurable:!0}});for(const e of(0,t.ReflectOwnKeys)(t.ArrayIteratorPrototype))"next"!==e&&(0,t.ObjectDefineProperty)(i,e,(0,t.ReflectGetOwnPropertyDescriptor)(t.ArrayIteratorPrototype,e));return VC}var ZC,KC,JC={},QC={};function $C(){if(ZC)return QC;ZC=1,Object.defineProperty(QC,"__esModule",{value:!0}),QC.isArrayBuffer=function(e){try{return(0,t.ArrayBufferPrototypeGetByteLength)(e),!0}catch(t){return!1}},QC.isCanonicalIntegerIndexString=function(e){if("string"!=typeof e)return!1;const r=+e;if(e!==r+"")return!1;if(!(0,t.NumberIsFinite)(r))return!1;return r===(0,t.MathTrunc)(r)},QC.isNativeBigIntTypedArray=function(e){const r=(0,t.TypedArrayPrototypeGetSymbolToStringTag)(e);return"BigInt64Array"===r||"BigUint64Array"===r},QC.isNativeTypedArray=e,QC.isObject=function(t){return null!==t&&"object"==typeof t||"function"==typeof t},QC.isObjectLike=function(t){return null!==t&&"object"==typeof t},QC.isOrdinaryArray=function(e){if(!(0,t.ArrayIsArray)(e))return!1;if(e[t.SymbolIterator]===t.NativeArrayPrototypeSymbolIterator)return!0;return"Array Iterator"===e[t.SymbolIterator]()[t.SymbolToStringTag]},QC.isOrdinaryNativeTypedArray=function(r){if(!e(r))return!1;if(r[t.SymbolIterator]===t.NativeTypedArrayPrototypeSymbolIterator)return!0;return"Array Iterator"===r[t.SymbolIterator]()[t.SymbolToStringTag]},QC.isSharedArrayBuffer=function(e){if(null===t.NativeSharedArrayBuffer)return!1;try{return(0,t.SharedArrayBufferPrototypeGetByteLength)(e),!0}catch(t){return!1}};var t=XC();function e(e){return void 0!==(0,t.TypedArrayPrototypeGetSymbolToStringTag)(e)}return QC}var tI,eI={};function rI(){if(tI)return eI;tI=1,Object.defineProperty(eI,"__esModule",{value:!0}),eI.convertToNumber=function(t){const e=t>>10;return n[0]=o[l[e]+(1023&t)]+s[e],r[0]},eI.roundToFloat16Bits=function(t){r[0]=t;const e=n[0],o=e>>23&511;return i[o]+((8388607&e)>>a[o])};var t=XC();const e=new t.NativeArrayBuffer(4),r=new t.NativeFloat32Array(e),n=new t.NativeUint32Array(e),i=new t.NativeUint32Array(512),a=new t.NativeUint32Array(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(i[t]=0,i[256|t]=32768,a[t]=24,a[256|t]=24):e<-14?(i[t]=1024>>-e-14,i[256|t]=1024>>-e-14|32768,a[t]=-e-1,a[256|t]=-e-1):e<=15?(i[t]=e+15<<10,i[256|t]=e+15<<10|32768,a[t]=13,a[256|t]=13):e<128?(i[t]=31744,i[256|t]=64512,a[t]=24,a[256|t]=24):(i[t]=31744,i[256|t]=64512,a[t]=13,a[256|t]=13)}const o=new t.NativeUint32Array(2048),s=new t.NativeUint32Array(64),l=new t.NativeUint32Array(64);for(let t=1;t<1024;++t){let e=t<<13,r=0;for(;0==(8388608&e);)e<<=1,r-=8388608;e&=-8388609,r+=947912704,o[t]=e|r}for(let t=1024;t<2048;++t)o[t]=939524096+(t-1024<<13);for(let t=1;t<31;++t)s[t]=t<<23;s[31]=1199570944,s[32]=2147483648;for(let t=33;t<63;++t)s[t]=2147483648+(t-32<<23);s[63]=3347054592;for(let t=1;t<64;++t)32!==t&&(l[t]=1024);return eI}var nI,iI,aI={};function oI(){if(iI)return jC;iI=1,Object.defineProperty(jC,"__esModule",{value:!0}),jC.isFloat16Array=l;var t=YC(),e=function(){if(KC)return JC;KC=1,Object.defineProperty(JC,"__esModule",{value:!0}),JC.hasFloat16ArrayBrand=function(i){if(!(0,t.isObjectLike)(i))return!1;const a=(0,r.ReflectGetPrototypeOf)(i);if(!(0,t.isObjectLike)(a))return!1;const o=a.constructor;if(void 0===o)return!1;if(!(0,t.isObject)(o))throw(0,r.NativeTypeError)(e.THE_CONSTRUCTOR_PROPERTY_VALUE_IS_NOT_AN_OBJECT);return(0,r.ReflectHas)(o,n)};var t=$C(),e=qC(),r=XC();const n=(0,r.SymbolFor)("__Float16Array__");return JC.brand=n,JC}(),r=rI(),n=$C(),i=qC(),a=XC(),o=function(){if(nI)return aI;nI=1,Object.defineProperty(aI,"__esModule",{value:!0}),aI.IsDetachedBuffer=function(e){if((0,t.isSharedArrayBuffer)(e))return!1;try{return(0,r.ArrayBufferPrototypeSlice)(e,0,0),!1}catch(t){}return!0},aI.SpeciesConstructor=function(n,i){if(!(0,t.isObject)(n))throw(0,r.NativeTypeError)(e.THIS_IS_NOT_AN_OBJECT);const a=n.constructor;if(void 0===a)return i;if(!(0,t.isObject)(a))throw(0,r.NativeTypeError)(e.THE_CONSTRUCTOR_PROPERTY_VALUE_IS_NOT_AN_OBJECT);const o=a[r.SymbolSpecies];return null==o?i:o},aI.ToIntegerOrInfinity=n,aI.ToLength=function(t){const e=n(t);return e<0?0:e<r.MAX_SAFE_INTEGER?e:r.MAX_SAFE_INTEGER},aI.defaultCompare=function(t,e){const n=(0,r.NumberIsNaN)(t),i=(0,r.NumberIsNaN)(e);if(n&&i)return 0;if(n)return 1;if(i)return-1;if(t<e)return-1;if(t>e)return 1;if(0===t&&0===e){const n=(0,r.ObjectIs)(t,0),i=(0,r.ObjectIs)(e,0);if(!n&&i)return-1;if(n&&!i)return 1}return 0};var t=$C(),e=qC(),r=XC();function n(t){const e=+t;return(0,r.NumberIsNaN)(e)||0===e?0:(0,r.MathTrunc)(e)}return aI}();const s=new a.NativeWeakMap;function l(t){return(0,a.WeakMapPrototypeHas)(s,t)||!(0,a.ArrayBufferIsView)(t)&&(0,e.hasFloat16ArrayBrand)(t)}function u(t){if(!l(t))throw(0,a.NativeTypeError)(i.THIS_IS_NOT_A_FLOAT16ARRAY_OBJECT)}function c(t,e){const r=l(t),o=(0,n.isNativeTypedArray)(t);if(!r&&!o)throw(0,a.NativeTypeError)(i.SPECIES_CONSTRUCTOR_DIDNT_RETURN_TYPEDARRAY_OBJECT);if("number"==typeof e){let n;if(r){const e=h(t);n=(0,a.TypedArrayPrototypeGetLength)(e)}else n=(0,a.TypedArrayPrototypeGetLength)(t);if(n<e)throw(0,a.NativeTypeError)(i.DERIVED_CONSTRUCTOR_CREATED_TYPEDARRAY_OBJECT_WHICH_WAS_TOO_SMALL_LENGTH)}if((0,n.isNativeBigIntTypedArray)(t))throw(0,a.NativeTypeError)(i.CANNOT_MIX_BIGINT_AND_OTHER_TYPES)}function h(t){const e=(0,a.WeakMapPrototypeGet)(s,t);if(void 0!==e){const t=(0,a.TypedArrayPrototypeGetBuffer)(e);if((0,o.IsDetachedBuffer)(t))throw(0,a.NativeTypeError)(i.ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER);return e}const r=t.buffer;if((0,o.IsDetachedBuffer)(r))throw(0,a.NativeTypeError)(i.ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER);const n=(0,a.ReflectConstruct)(m,[r,t.byteOffset,t.length],t.constructor);return(0,a.WeakMapPrototypeGet)(s,n)}function d(t){const e=(0,a.TypedArrayPrototypeGetLength)(t),n=[];for(let i=0;i<e;++i)n[i]=(0,r.convertToNumber)(t[i]);return n}const f=new a.NativeWeakSet;for(const t of(0,a.ReflectOwnKeys)(a.TypedArrayPrototype)){if(t===a.SymbolToStringTag)continue;const e=(0,a.ReflectGetOwnPropertyDescriptor)(a.TypedArrayPrototype,t);(0,a.ObjectHasOwn)(e,"get")&&"function"==typeof e.get&&(0,a.WeakSetPrototypeAdd)(f,e.get)}const p=(0,a.ObjectFreeze)({get:(t,e,i)=>(0,n.isCanonicalIntegerIndexString)(e)&&(0,a.ObjectHasOwn)(t,e)?(0,r.convertToNumber)((0,a.ReflectGet)(t,e)):(0,a.WeakSetPrototypeHas)(f,(0,a.ObjectPrototype__lookupGetter__)(t,e))?(0,a.ReflectGet)(t,e):(0,a.ReflectGet)(t,e,i),set:(t,e,i,o)=>(0,n.isCanonicalIntegerIndexString)(e)&&(0,a.ObjectHasOwn)(t,e)?(0,a.ReflectSet)(t,e,(0,r.roundToFloat16Bits)(i)):(0,a.ReflectSet)(t,e,i,o),getOwnPropertyDescriptor(t,e){if((0,n.isCanonicalIntegerIndexString)(e)&&(0,a.ObjectHasOwn)(t,e)){const n=(0,a.ReflectGetOwnPropertyDescriptor)(t,e);return n.value=(0,r.convertToNumber)(n.value),n}return(0,a.ReflectGetOwnPropertyDescriptor)(t,e)},defineProperty:(t,e,i)=>(0,n.isCanonicalIntegerIndexString)(e)&&(0,a.ObjectHasOwn)(t,e)&&(0,a.ObjectHasOwn)(i,"value")?(i.value=(0,r.roundToFloat16Bits)(i.value),(0,a.ReflectDefineProperty)(t,e,i)):(0,a.ReflectDefineProperty)(t,e,i)});let m=class f{constructor(t,e,u){let c;if(l(t))c=(0,a.ReflectConstruct)(a.NativeUint16Array,[h(t)],new.target);else if((0,n.isObject)(t)&&!(0,n.isArrayBuffer)(t)){let e,s;if((0,n.isNativeTypedArray)(t)){e=t,s=(0,a.TypedArrayPrototypeGetLength)(t);const r=(0,a.TypedArrayPrototypeGetBuffer)(t),l=(0,n.isSharedArrayBuffer)(r)?a.NativeArrayBuffer:(0,o.SpeciesConstructor)(r,a.NativeArrayBuffer);if((0,o.IsDetachedBuffer)(r))throw(0,a.NativeTypeError)(i.ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER);if((0,n.isNativeBigIntTypedArray)(t))throw(0,a.NativeTypeError)(i.CANNOT_MIX_BIGINT_AND_OTHER_TYPES);const u=new l(2*s);c=(0,a.ReflectConstruct)(a.NativeUint16Array,[u],new.target)}else{const r=t[a.SymbolIterator];if(null!=r&&"function"!=typeof r)throw(0,a.NativeTypeError)(i.ITERATOR_PROPERTY_IS_NOT_CALLABLE);null!=r?(0,n.isOrdinaryArray)(t)?(e=t,s=t.length):(e=[...t],s=e.length):(e=t,s=(0,o.ToLength)(e.length)),c=(0,a.ReflectConstruct)(a.NativeUint16Array,[s],new.target)}for(let t=0;t<s;++t)c[t]=(0,r.roundToFloat16Bits)(e[t])}else c=(0,a.ReflectConstruct)(a.NativeUint16Array,arguments,new.target);const d=new a.NativeProxy(c,p);return(0,a.WeakMapPrototypeSet)(s,d,c),d}static from(s,...u){const c=this;if(!(0,a.ReflectHas)(c,e.brand))throw(0,a.NativeTypeError)(i.THIS_CONSTRUCTOR_IS_NOT_A_SUBCLASS_OF_FLOAT16ARRAY);if(c===f){if(l(s)&&0===u.length){const t=h(s),e=new a.NativeUint16Array((0,a.TypedArrayPrototypeGetBuffer)(t),(0,a.TypedArrayPrototypeGetByteOffset)(t),(0,a.TypedArrayPrototypeGetLength)(t));return new f((0,a.TypedArrayPrototypeGetBuffer)((0,a.TypedArrayPrototypeSlice)(e)))}if(0===u.length)return new f((0,a.TypedArrayPrototypeGetBuffer)((0,a.Uint16ArrayFrom)(s,r.roundToFloat16Bits)));const e=u[0],n=u[1];return new f((0,a.TypedArrayPrototypeGetBuffer)((0,a.Uint16ArrayFrom)(s,(function(n,...i){return(0,r.roundToFloat16Bits)((0,a.ReflectApply)(e,this,[n,...(0,t.safeIfNeeded)(i)]))}),n)))}let d,p;const m=s[a.SymbolIterator];if(null!=m&&"function"!=typeof m)throw(0,a.NativeTypeError)(i.ITERATOR_PROPERTY_IS_NOT_CALLABLE);if(null!=m)(0,n.isOrdinaryArray)(s)?(d=s,p=s.length):(0,n.isOrdinaryNativeTypedArray)(s)?(d=s,p=(0,a.TypedArrayPrototypeGetLength)(s)):(d=[...s],p=d.length);else{if(null==s)throw(0,a.NativeTypeError)(i.CANNOT_CONVERT_UNDEFINED_OR_NULL_TO_OBJECT);d=(0,a.NativeObject)(s),p=(0,o.ToLength)(d.length)}const g=new c(p);if(0===u.length)for(let t=0;t<p;++t)g[t]=d[t];else{const t=u[0],e=u[1];for(let r=0;r<p;++r)g[r]=(0,a.ReflectApply)(t,e,[d[r],r])}return g}static of(...t){const n=this;if(!(0,a.ReflectHas)(n,e.brand))throw(0,a.NativeTypeError)(i.THIS_CONSTRUCTOR_IS_NOT_A_SUBCLASS_OF_FLOAT16ARRAY);const o=t.length;if(n===f){const e=new f(o),n=h(e);for(let e=0;e<o;++e)n[e]=(0,r.roundToFloat16Bits)(t[e]);return e}const s=new n(o);for(let e=0;e<o;++e)s[e]=t[e];return s}keys(){u(this);const t=h(this);return(0,a.TypedArrayPrototypeKeys)(t)}values(){u(this);const e=h(this);return(0,t.wrap)(function*(){for(const t of(0,a.TypedArrayPrototypeValues)(e))yield(0,r.convertToNumber)(t)}())}entries(){u(this);const e=h(this);return(0,t.wrap)(function*(){for(const[t,n]of(0,a.TypedArrayPrototypeEntries)(e))yield[t,(0,r.convertToNumber)(n)]}())}at(t){u(this);const e=h(this),n=(0,a.TypedArrayPrototypeGetLength)(e),i=(0,o.ToIntegerOrInfinity)(t),s=i>=0?i:n+i;if(!(s<0||s>=n))return(0,r.convertToNumber)(e[s])}map(t,...e){u(this);const n=h(this),i=(0,a.TypedArrayPrototypeGetLength)(n),s=e[0],l=(0,o.SpeciesConstructor)(n,f);if(l===f){const e=new f(i),o=h(e);for(let e=0;e<i;++e){const i=(0,r.convertToNumber)(n[e]);o[e]=(0,r.roundToFloat16Bits)((0,a.ReflectApply)(t,s,[i,e,this]))}return e}const d=new l(i);c(d,i);for(let e=0;e<i;++e){const i=(0,r.convertToNumber)(n[e]);d[e]=(0,a.ReflectApply)(t,s,[i,e,this])}return d}filter(t,...e){u(this);const n=h(this),i=(0,a.TypedArrayPrototypeGetLength)(n),s=e[0],l=[];for(let e=0;e<i;++e){const i=(0,r.convertToNumber)(n[e]);(0,a.ReflectApply)(t,s,[i,e,this])&&(0,a.ArrayPrototypePush)(l,i)}const d=new((0,o.SpeciesConstructor)(n,f))(l);return c(d),d}reduce(t,...e){u(this);const n=h(this),o=(0,a.TypedArrayPrototypeGetLength)(n);if(0===o&&0===e.length)throw(0,a.NativeTypeError)(i.REDUCE_OF_EMPTY_ARRAY_WITH_NO_INITIAL_VALUE);let s,l;0===e.length?(s=(0,r.convertToNumber)(n[0]),l=1):(s=e[0],l=0);for(let e=l;e<o;++e)s=t(s,(0,r.convertToNumber)(n[e]),e,this);return s}reduceRight(t,...e){u(this);const n=h(this),o=(0,a.TypedArrayPrototypeGetLength)(n);if(0===o&&0===e.length)throw(0,a.NativeTypeError)(i.REDUCE_OF_EMPTY_ARRAY_WITH_NO_INITIAL_VALUE);let s,l;0===e.length?(s=(0,r.convertToNumber)(n[o-1]),l=o-2):(s=e[0],l=o-1);for(let e=l;e>=0;--e)s=t(s,(0,r.convertToNumber)(n[e]),e,this);return s}forEach(t,...e){u(this);const n=h(this),i=(0,a.TypedArrayPrototypeGetLength)(n),o=e[0];for(let e=0;e<i;++e)(0,a.ReflectApply)(t,o,[(0,r.convertToNumber)(n[e]),e,this])}find(t,...e){u(this);const n=h(this),i=(0,a.TypedArrayPrototypeGetLength)(n),o=e[0];for(let e=0;e<i;++e){const i=(0,r.convertToNumber)(n[e]);if((0,a.ReflectApply)(t,o,[i,e,this]))return i}}findIndex(t,...e){u(this);const n=h(this),i=(0,a.TypedArrayPrototypeGetLength)(n),o=e[0];for(let e=0;e<i;++e){const i=(0,r.convertToNumber)(n[e]);if((0,a.ReflectApply)(t,o,[i,e,this]))return e}return-1}findLast(t,...e){u(this);const n=h(this),i=(0,a.TypedArrayPrototypeGetLength)(n),o=e[0];for(let e=i-1;e>=0;--e){const i=(0,r.convertToNumber)(n[e]);if((0,a.ReflectApply)(t,o,[i,e,this]))return i}}findLastIndex(t,...e){u(this);const n=h(this),i=(0,a.TypedArrayPrototypeGetLength)(n),o=e[0];for(let e=i-1;e>=0;--e){const i=(0,r.convertToNumber)(n[e]);if((0,a.ReflectApply)(t,o,[i,e,this]))return e}return-1}every(t,...e){u(this);const n=h(this),i=(0,a.TypedArrayPrototypeGetLength)(n),o=e[0];for(let e=0;e<i;++e)if(!(0,a.ReflectApply)(t,o,[(0,r.convertToNumber)(n[e]),e,this]))return!1;return!0}some(t,...e){u(this);const n=h(this),i=(0,a.TypedArrayPrototypeGetLength)(n),o=e[0];for(let e=0;e<i;++e)if((0,a.ReflectApply)(t,o,[(0,r.convertToNumber)(n[e]),e,this]))return!0;return!1}set(t,...e){u(this);const s=h(this),c=(0,o.ToIntegerOrInfinity)(e[0]);if(c<0)throw(0,a.NativeRangeError)(i.OFFSET_IS_OUT_OF_BOUNDS);if(null==t)throw(0,a.NativeTypeError)(i.CANNOT_CONVERT_UNDEFINED_OR_NULL_TO_OBJECT);if((0,n.isNativeBigIntTypedArray)(t))throw(0,a.NativeTypeError)(i.CANNOT_MIX_BIGINT_AND_OTHER_TYPES);if(l(t))return(0,a.TypedArrayPrototypeSet)(h(this),h(t),c);if((0,n.isNativeTypedArray)(t)){const e=(0,a.TypedArrayPrototypeGetBuffer)(t);if((0,o.IsDetachedBuffer)(e))throw(0,a.NativeTypeError)(i.ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER)}const d=(0,a.TypedArrayPrototypeGetLength)(s),f=(0,a.NativeObject)(t),p=(0,o.ToLength)(f.length);if(c===1/0||p+c>d)throw(0,a.NativeRangeError)(i.OFFSET_IS_OUT_OF_BOUNDS);for(let t=0;t<p;++t)s[t+c]=(0,r.roundToFloat16Bits)(f[t])}reverse(){u(this);const t=h(this);return(0,a.TypedArrayPrototypeReverse)(t),this}fill(e,...n){u(this);const i=h(this);return(0,a.TypedArrayPrototypeFill)(i,(0,r.roundToFloat16Bits)(e),...(0,t.safeIfNeeded)(n)),this}copyWithin(e,r,...n){u(this);const i=h(this);return(0,a.TypedArrayPrototypeCopyWithin)(i,e,r,...(0,t.safeIfNeeded)(n)),this}sort(t){u(this);const e=h(this),n=void 0!==t?t:o.defaultCompare;return(0,a.TypedArrayPrototypeSort)(e,((t,e)=>n((0,r.convertToNumber)(t),(0,r.convertToNumber)(e)))),this}slice(t,e){u(this);const n=h(this),s=(0,o.SpeciesConstructor)(n,f);if(s===f){const r=new a.NativeUint16Array((0,a.TypedArrayPrototypeGetBuffer)(n),(0,a.TypedArrayPrototypeGetByteOffset)(n),(0,a.TypedArrayPrototypeGetLength)(n));return new f((0,a.TypedArrayPrototypeGetBuffer)((0,a.TypedArrayPrototypeSlice)(r,t,e)))}const l=(0,a.TypedArrayPrototypeGetLength)(n),d=(0,o.ToIntegerOrInfinity)(t),p=void 0===e?l:(0,o.ToIntegerOrInfinity)(e);let m,g;m=d===-1/0?0:d<0?l+d>0?l+d:0:l<d?l:d,g=p===-1/0?0:p<0?l+p>0?l+p:0:l<p?l:p;const v=g-m>0?g-m:0,y=new s(v);if(c(y,v),0===v)return y;const x=(0,a.TypedArrayPrototypeGetBuffer)(n);if((0,o.IsDetachedBuffer)(x))throw(0,a.NativeTypeError)(i.ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER);let _=0;for(;m<g;)y[_]=(0,r.convertToNumber)(n[m]),++m,++_;return y}subarray(t,e){u(this);const r=h(this),n=(0,o.SpeciesConstructor)(r,f),i=new a.NativeUint16Array((0,a.TypedArrayPrototypeGetBuffer)(r),(0,a.TypedArrayPrototypeGetByteOffset)(r),(0,a.TypedArrayPrototypeGetLength)(r)),s=(0,a.TypedArrayPrototypeSubarray)(i,t,e),l=new n((0,a.TypedArrayPrototypeGetBuffer)(s),(0,a.TypedArrayPrototypeGetByteOffset)(s),(0,a.TypedArrayPrototypeGetLength)(s));return c(l),l}indexOf(t,...e){u(this);const n=h(this),i=(0,a.TypedArrayPrototypeGetLength)(n);let s=(0,o.ToIntegerOrInfinity)(e[0]);if(s===1/0)return-1;s<0&&(s+=i,s<0&&(s=0));for(let e=s;e<i;++e)if((0,a.ObjectHasOwn)(n,e)&&(0,r.convertToNumber)(n[e])===t)return e;return-1}lastIndexOf(t,...e){u(this);const n=h(this),i=(0,a.TypedArrayPrototypeGetLength)(n);let s=e.length>=1?(0,o.ToIntegerOrInfinity)(e[0]):i-1;if(s===-1/0)return-1;s>=0?s=s<i-1?s:i-1:s+=i;for(let e=s;e>=0;--e)if((0,a.ObjectHasOwn)(n,e)&&(0,r.convertToNumber)(n[e])===t)return e;return-1}includes(t,...e){u(this);const n=h(this),i=(0,a.TypedArrayPrototypeGetLength)(n);let s=(0,o.ToIntegerOrInfinity)(e[0]);if(s===1/0)return!1;s<0&&(s+=i,s<0&&(s=0));const l=(0,a.NumberIsNaN)(t);for(let e=s;e<i;++e){const i=(0,r.convertToNumber)(n[e]);if(l&&(0,a.NumberIsNaN)(i))return!0;if(i===t)return!0}return!1}join(t){u(this);const e=d(h(this));return(0,a.ArrayPrototypeJoin)(e,t)}toLocaleString(...e){u(this);const r=d(h(this));return(0,a.ArrayPrototypeToLocaleString)(r,...(0,t.safeIfNeeded)(e))}get[a.SymbolToStringTag](){if(l(this))return"Float16Array"}};jC.Float16Array=m,(0,a.ObjectDefineProperty)(m,"BYTES_PER_ELEMENT",{value:2}),(0,a.ObjectDefineProperty)(m,e.brand,{}),(0,a.ReflectSetPrototypeOf)(m,a.TypedArray);const g=m.prototype;return(0,a.ObjectDefineProperty)(g,"BYTES_PER_ELEMENT",{value:2}),(0,a.ObjectDefineProperty)(g,a.SymbolIterator,{value:g.values,writable:!0,configurable:!0}),(0,a.ReflectSetPrototypeOf)(g,a.TypedArrayPrototype),jC}var sI,lI={};var uI,cI={};var hI,dI,fI={};function pI(){if(dI)return GC;dI=1,Object.defineProperty(GC,"__esModule",{value:!0});var t=oI();GC.Float16Array=t.Float16Array,GC.isFloat16Array=t.isFloat16Array;var e=function(){if(sI)return lI;sI=1,Object.defineProperty(lI,"__esModule",{value:!0}),lI.isTypedArray=function(r){return(0,e.isNativeTypedArray)(r)||(0,t.isFloat16Array)(r)};var t=oI(),e=$C();return lI}();GC.isTypedArray=e.isTypedArray;var r=function(){if(uI)return cI;uI=1,Object.defineProperty(cI,"__esModule",{value:!0}),cI.getFloat16=function(n,i,...a){return(0,e.convertToNumber)((0,r.DataViewPrototypeGetUint16)(n,i,...(0,t.safeIfNeeded)(a)))},cI.setFloat16=function(n,i,a,...o){return(0,r.DataViewPrototypeSetUint16)(n,i,(0,e.roundToFloat16Bits)(a),...(0,t.safeIfNeeded)(o))};var t=YC(),e=rI(),r=XC();return cI}();GC.getFloat16=r.getFloat16,GC.setFloat16=r.setFloat16;var n=function(){if(hI)return fI;hI=1,Object.defineProperty(fI,"__esModule",{value:!0}),fI.hfround=function(r){const n=+r;if(!(0,e.NumberIsFinite)(n)||0===n)return n;const i=(0,t.roundToFloat16Bits)(n);return(0,t.convertToNumber)(i)};var t=rI(),e=XC();return fI}();return GC.hfround=n.hfround,GC}var mI,gI={},vI={get exports(){return gI},set exports(t){gI=t}};var yI,xI={},_I={get exports(){return xI},set exports(t){xI=t}},wI={},bI={get exports(){return wI},set exports(t){wI=t}},MI={},SI={get exports(){return MI},set exports(t){MI=t}};var TI,EI={},AI={get exports(){return EI},set exports(t){EI=t}};var RI,PI,CI,II={},LI={get exports(){return II},set exports(t){II=t}};function OI(){if(PI)return wI;PI=1;const t=function(){if(yI)return MI;function t(t,e,r){const n=new RegExp(e).exec(t.slice(r));return n?r+n.index:-1}return yI=1,SI.exports=t,MI.default=t,MI}(),e=function(){if(TI)return EI;function t(t,e,r){const n=new RegExp(e).exec(t.slice(r));return n?r+n.index+n[0].length-1:-1}return TI=1,AI.exports=t,EI.default=t,EI}(),r=function(){if(RI)return II;function t(t,e){const r=new RegExp(e,"g"),n=t.match(r);return n?n.length:0}return RI=1,LI.exports=t,II.default=t,II}();function n(n,i,a){const o=a&&a.debug||!1,s=!(a&&!1===typeof a.nested),l=a&&a.startIndex||0;o&&console.log("[xml-utils] starting findTagByName with",i," and ",a);const u=t(n,`<${i}[ >/]`,l);if(o&&console.log("[xml-utils] start:",u),-1===u)return;const c=n.slice(u+i.length);let h=e(c,"^[^<]*[ /]>",0);const d=-1!==h&&"/"===c[h-1];if(o&&console.log("[xml-utils] selfClosing:",d),!1===d)if(s){let t=0,n=1,a=0;for(;-1!==(h=e(c,"[ /]"+i+">",t));){const e=c.substring(t,h+1);if(n+=r(e,"<"+i),a+=r(e,"/"+i+">"),a>=n)break;t=h}}else h=e(c,"[ /]"+i+">",0);const f=u+i.length+h+1;if(o&&console.log("[xml-utils] end:",f),-1===f)return;const p=n.slice(u,f);let m;return m=d?null:p.slice(p.indexOf(">")+1,p.lastIndexOf("<")),{inner:m,outer:p,start:u,end:f}}return bI.exports=n,wI.default=n,wI}var DI,kI={};function FI(){return DI||(DI=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.geoKeys=t.geoKeyNames=t.LercAddCompression=t.LercParameters=t.ExtraSamplesValues=t.photometricInterpretations=t.fieldTypes=t.fieldTypeNames=t.arrayFields=t.fieldTagTypes=t.fieldTags=t.fieldTagNames=void 0,t.fieldTagNames={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},t.fieldTags={};for(const e in t.fieldTagNames)t.fieldTagNames.hasOwnProperty(e)&&(t.fieldTags[t.fieldTagNames[e]]=parseInt(e,10));t.fieldTagTypes={256:"SHORT",257:"SHORT",258:"SHORT",259:"SHORT",262:"SHORT",273:"LONG",274:"SHORT",277:"SHORT",278:"LONG",279:"LONG",282:"RATIONAL",283:"RATIONAL",284:"SHORT",286:"SHORT",287:"RATIONAL",296:"SHORT",297:"SHORT",305:"ASCII",306:"ASCII",338:"SHORT",339:"SHORT",513:"LONG",514:"LONG",1024:"SHORT",1025:"SHORT",2048:"SHORT",2049:"ASCII",3072:"SHORT",3073:"ASCII",33550:"DOUBLE",33922:"DOUBLE",34665:"LONG",34735:"SHORT",34737:"ASCII",42113:"ASCII"},t.arrayFields=[t.fieldTags.BitsPerSample,t.fieldTags.ExtraSamples,t.fieldTags.SampleFormat,t.fieldTags.StripByteCounts,t.fieldTags.StripOffsets,t.fieldTags.StripRowCounts,t.fieldTags.TileByteCounts,t.fieldTags.TileOffsets,t.fieldTags.SubIFDs],t.fieldTypeNames={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},t.fieldTypes={};for(const e in t.fieldTypeNames)t.fieldTypeNames.hasOwnProperty(e)&&(t.fieldTypes[t.fieldTypeNames[e]]=parseInt(e,10));t.photometricInterpretations={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},t.ExtraSamplesValues={Unspecified:0,Assocalpha:1,Unassalpha:2},t.LercParameters={Version:0,AddCompression:1},t.LercAddCompression={None:0,Deflate:1},t.geoKeyNames={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},t.geoKeys={};for(const e in t.geoKeyNames)t.geoKeyNames.hasOwnProperty(e)&&(t.geoKeys[t.geoKeyNames[e]]=parseInt(e,10))}(kI)),kI}var NI,UI={};function BI(){if(NI)return UI;NI=1,Object.defineProperty(UI,"__esModule",{value:!0}),UI.fromCIELab=UI.fromYCbCr=UI.fromCMYK=UI.fromPalette=UI.fromBlackIsZero=UI.fromWhiteIsZero=void 0,UI.fromWhiteIsZero=function(t,e){const{width:r,height:n}=t,i=new Uint8Array(r*n*3);let a;for(let r=0,n=0;r<t.length;++r,n+=3)a=256-t[r]/e*256,i[n]=a,i[n+1]=a,i[n+2]=a;return i},UI.fromBlackIsZero=function(t,e){const{width:r,height:n}=t,i=new Uint8Array(r*n*3);let a;for(let r=0,n=0;r<t.length;++r,n+=3)a=t[r]/e*256,i[n]=a,i[n+1]=a,i[n+2]=a;return i},UI.fromPalette=function(t,e){const{width:r,height:n}=t,i=new Uint8Array(r*n*3),a=e.length/3,o=e.length/3*2;for(let r=0,n=0;r<t.length;++r,n+=3){const s=t[r];i[n]=e[s]/65536*256,i[n+1]=e[s+a]/65536*256,i[n+2]=e[s+o]/65536*256}return i},UI.fromCMYK=function(t){const{width:e,height:r}=t,n=new Uint8Array(e*r*3);for(let e=0,r=0;e<t.length;e+=4,r+=3){const i=t[e],a=t[e+1],o=t[e+2],s=t[e+3];n[r]=(255-i)/256*255*((255-s)/256),n[r+1]=(255-a)/256*255*((255-s)/256),n[r+2]=(255-o)/256*255*((255-s)/256)}return n},UI.fromYCbCr=function(t){const{width:e,height:r}=t,n=new Uint8ClampedArray(e*r*3);for(let e=0,r=0;e<t.length;e+=3,r+=3){const i=t[e],a=t[e+1],o=t[e+2];n[r]=i+1.402*(o-128),n[r+1]=i-.34414*(a-128)-.71414*(o-128),n[r+2]=i+1.772*(a-128)}return n};return UI.fromCIELab=function(t){const{width:e,height:r}=t,n=new Uint8Array(e*r*3);for(let e=0,r=0;e<t.length;e+=3,r+=3){let i,a,o,s=(t[e+0]+16)/116,l=(t[e+1]<<24>>24)/500+s,u=s-(t[e+2]<<24>>24)/200;l=.95047*(l*l*l>.008856?l*l*l:(l-16/116)/7.787),s=1*(s*s*s>.008856?s*s*s:(s-16/116)/7.787),u=1.08883*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),i=3.2406*l+-1.5372*s+-.4986*u,a=-.9689*l+1.8758*s+.0415*u,o=.0557*l+-.204*s+1.057*u,i=i>.0031308?1.055*i**(1/2.4)-.055:12.92*i,a=a>.0031308?1.055*a**(1/2.4)-.055:12.92*a,o=o>.0031308?1.055*o**(1/2.4)-.055:12.92*o,n[r]=255*Math.max(0,Math.min(1,i)),n[r+1]=255*Math.max(0,Math.min(1,a)),n[r+2]=255*Math.max(0,Math.min(1,o))}return n},UI}var zI,GI,jI,VI={},HI={},WI={},qI={};function XI(){if(GI)return WI;GI=1,Object.defineProperty(WI,"__esModule",{value:!0});const t=function(){if(zI)return qI;function t(t,e){let r=t.length-e,n=0;do{for(let r=e;r>0;r--)t[n+e]+=t[n],n++;r-=e}while(r>0)}function e(t,e,r){let n=0,i=t.length;const a=i/r;for(;i>e;){for(let r=e;r>0;--r)t[n+e]+=t[n],++n;i-=e}const o=t.slice();for(let e=0;e<a;++e)for(let n=0;n<r;++n)t[r*e+n]=o[(r-n-1)*a+e]}return zI=1,Object.defineProperty(qI,"__esModule",{value:!0}),qI.applyPredictor=void 0,qI.applyPredictor=function(r,n,i,a,o,s){if(!n||1===n)return r;for(let t=0;t<o.length;++t){if(o[t]%8!=0)throw new Error("When decoding with predictor, only multiple of 8 bits are supported.");if(o[t]!==o[0])throw new Error("When decoding with predictor, all samples must have the same size.")}const l=o[0]/8,u=2===s?1:o.length;for(let s=0;s<a&&!(s*u*i*l>=r.byteLength);++s){let a;if(2===n){switch(o[0]){case 8:a=new Uint8Array(r,s*u*i*l,u*i*l);break;case 16:a=new Uint16Array(r,s*u*i*l,u*i*l/2);break;case 32:a=new Uint32Array(r,s*u*i*l,u*i*l/4);break;default:throw new Error(`Predictor 2 not allowed with ${o[0]} bits per sample.`)}t(a,u)}else 3===n&&(a=new Uint8Array(r,s*u*i*l,u*i*l),e(a,u,l))}return r},qI}();return WI.default=class{async decode(e,r){const n=await this.decodeBlock(r),i=e.Predictor||1;if(1!==i){const r=!e.StripOffsets,a=r?e.TileWidth:e.ImageWidth,o=r?e.TileLength:e.RowsPerStrip||e.ImageLength;return(0,t.applyPredictor)(n,i,a,o,e.BitsPerSample,e.PlanarConfiguration)}return n}},WI}var YI,ZI={};function KI(){if(YI)return ZI;YI=1;var t=af&&af.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ZI,"__esModule",{value:!0});const e=t(XI()),r=257;function n(t,e){for(let r=e.length-1;r>=0;r--)t.push(e[r]);return t}function i(t){const e=new Uint16Array(4093),i=new Uint8Array(4093);for(let t=0;t<=257;t++)e[t]=4096,i[t]=t;let a=258,o=9,s=0;function l(){a=258,o=9}function u(t){const e=function(t,e,n){const i=e%8,a=Math.floor(e/8),o=8-i,s=e+n-8*(a+1);let l=8*(a+2)-(e+n);const u=8*(a+2)-e;if(l=Math.max(0,l),a>=t.length)return console.warn("ran off the end of the buffer before finding EOI_CODE (end on input code)"),r;let c=t[a]&2**(8-i)-1;c<<=n-o;let h=c;if(a+1<t.length){let e=t[a+1]>>>l;e<<=Math.max(0,n-u),h+=e}if(s>8&&a+2<t.length){const r=8*(a+3)-(e+n);h+=t[a+2]>>>r}return h}(t,s,o);return s+=o,e}function c(t,r){return i[a]=r,e[a]=t,a++,a-1}function h(t){const r=[];for(let n=t;4096!==n;n=e[n])r.push(i[n]);return r}const d=[];l();const f=new Uint8Array(t);let p,m=u(f);for(;m!==r;){if(256===m){for(l(),m=u(f);256===m;)m=u(f);if(m===r)break;if(m>256)throw new Error(`corrupted code at scanline ${m}`);n(d,h(m)),p=m}else if(m<a){const t=h(m);n(d,t),c(p,t[t.length-1]),p=m}else{const t=h(p);if(!t)throw new Error(`Bogus entry. Not in dictionary, ${p} / ${a}, position: ${s}`);n(d,t),d.push(t[t.length-1]),c(p,t[t.length-1]),p=m}a+1>=2**o&&(12===o?p=void 0:o++),m=u(f)}return new Uint8Array(d)}class a extends e.default{decodeBlock(t){return i(t).buffer}}return ZI.default=a,ZI}var JI,QI={};var $I,tL,eL,rL,nL,iL,aL,oL,sL,lL,uL={},cL={},hL={},dL={},fL={};function pL(){if($I)return fL;$I=1;function t(t){let e=t.length;for(;--e>=0;)t[e]=0}const e=256,r=286,n=30,i=15,a=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),o=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),s=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),l=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u=new Array(576);t(u);const c=new Array(60);t(c);const h=new Array(512);t(h);const d=new Array(256);t(d);const f=new Array(29);t(f);const p=new Array(n);function m(t,e,r,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}let g,v,y;function x(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}t(p);const _=t=>t<256?h[t]:h[256+(t>>>7)],w=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},b=(t,e,r)=>{t.bi_valid>16-r?(t.bi_buf|=e<<t.bi_valid&65535,w(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=r-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)},M=(t,e,r)=>{b(t,r[2*e],r[2*e+1])},S=(t,e)=>{let r=0;do{r|=1&t,t>>>=1,r<<=1}while(--e>0);return r>>>1},T=(t,e,r)=>{const n=new Array(16);let a,o,s=0;for(a=1;a<=i;a++)n[a]=s=s+r[a-1]<<1;for(o=0;o<=e;o++){let e=t[2*o+1];0!==e&&(t[2*o]=S(n[e]++,e))}},E=t=>{let e;for(e=0;e<r;e++)t.dyn_ltree[2*e]=0;for(e=0;e<n;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},A=t=>{t.bi_valid>8?w(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},R=(t,e,r,n)=>{const i=2*e,a=2*r;return t[i]<t[a]||t[i]===t[a]&&n[e]<=n[r]},P=(t,e,r)=>{const n=t.heap[r];let i=r<<1;for(;i<=t.heap_len&&(i<t.heap_len&&R(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!R(e,n,t.heap[i],t.depth));)t.heap[r]=t.heap[i],r=i,i<<=1;t.heap[r]=n},C=(t,r,n)=>{let i,s,l,u,c=0;if(0!==t.last_lit)do{i=t.pending_buf[t.d_buf+2*c]<<8|t.pending_buf[t.d_buf+2*c+1],s=t.pending_buf[t.l_buf+c],c++,0===i?M(t,s,r):(l=d[s],M(t,l+e+1,r),u=a[l],0!==u&&(s-=f[l],b(t,s,u)),i--,l=_(i),M(t,l,n),u=o[l],0!==u&&(i-=p[l],b(t,i,u)))}while(c<t.last_lit);M(t,256,r)},I=(t,e)=>{const r=e.dyn_tree,n=e.stat_desc.static_tree,a=e.stat_desc.has_stree,o=e.stat_desc.elems;let s,l,u,c=-1;for(t.heap_len=0,t.heap_max=573,s=0;s<o;s++)0!==r[2*s]?(t.heap[++t.heap_len]=c=s,t.depth[s]=0):r[2*s+1]=0;for(;t.heap_len<2;)u=t.heap[++t.heap_len]=c<2?++c:0,r[2*u]=1,t.depth[u]=0,t.opt_len--,a&&(t.static_len-=n[2*u+1]);for(e.max_code=c,s=t.heap_len>>1;s>=1;s--)P(t,r,s);u=o;do{s=t.heap[1],t.heap[1]=t.heap[t.heap_len--],P(t,r,1),l=t.heap[1],t.heap[--t.heap_max]=s,t.heap[--t.heap_max]=l,r[2*u]=r[2*s]+r[2*l],t.depth[u]=(t.depth[s]>=t.depth[l]?t.depth[s]:t.depth[l])+1,r[2*s+1]=r[2*l+1]=u,t.heap[1]=u++,P(t,r,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const r=e.dyn_tree,n=e.max_code,a=e.stat_desc.static_tree,o=e.stat_desc.has_stree,s=e.stat_desc.extra_bits,l=e.stat_desc.extra_base,u=e.stat_desc.max_length;let c,h,d,f,p,m,g=0;for(f=0;f<=i;f++)t.bl_count[f]=0;for(r[2*t.heap[t.heap_max]+1]=0,c=t.heap_max+1;c<573;c++)h=t.heap[c],f=r[2*r[2*h+1]+1]+1,f>u&&(f=u,g++),r[2*h+1]=f,h>n||(t.bl_count[f]++,p=0,h>=l&&(p=s[h-l]),m=r[2*h],t.opt_len+=m*(f+p),o&&(t.static_len+=m*(a[2*h+1]+p)));if(0!==g){do{for(f=u-1;0===t.bl_count[f];)f--;t.bl_count[f]--,t.bl_count[f+1]+=2,t.bl_count[u]--,g-=2}while(g>0);for(f=u;0!==f;f--)for(h=t.bl_count[f];0!==h;)d=t.heap[--c],d>n||(r[2*d+1]!==f&&(t.opt_len+=(f-r[2*d+1])*r[2*d],r[2*d+1]=f),h--)}})(t,e),T(r,c,t.bl_count)},L=(t,e,r)=>{let n,i,a=-1,o=e[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),e[2*(r+1)+1]=65535,n=0;n<=r;n++)i=o,o=e[2*(n+1)+1],++s<l&&i===o||(s<u?t.bl_tree[2*i]+=s:0!==i?(i!==a&&t.bl_tree[2*i]++,t.bl_tree[32]++):s<=10?t.bl_tree[34]++:t.bl_tree[36]++,s=0,a=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4))},O=(t,e,r)=>{let n,i,a=-1,o=e[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),n=0;n<=r;n++)if(i=o,o=e[2*(n+1)+1],!(++s<l&&i===o)){if(s<u)do{M(t,i,t.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(M(t,i,t.bl_tree),s--),M(t,16,t.bl_tree),b(t,s-3,2)):s<=10?(M(t,17,t.bl_tree),b(t,s-3,3)):(M(t,18,t.bl_tree),b(t,s-11,7));s=0,a=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4)}};let D=!1;const k=(t,e,r,n)=>{b(t,0+(n?1:0),3),((t,e,r,n)=>{A(t),n&&(w(t,r),w(t,~r)),t.pending_buf.set(t.window.subarray(e,e+r),t.pending),t.pending+=r})(t,e,r,!0)};return fL._tr_init=t=>{D||((()=>{let t,e,l,x,_;const w=new Array(16);for(l=0,x=0;x<28;x++)for(f[x]=l,t=0;t<1<<a[x];t++)d[l++]=x;for(d[l-1]=x,_=0,x=0;x<16;x++)for(p[x]=_,t=0;t<1<<o[x];t++)h[_++]=x;for(_>>=7;x<n;x++)for(p[x]=_<<7,t=0;t<1<<o[x]-7;t++)h[256+_++]=x;for(e=0;e<=i;e++)w[e]=0;for(t=0;t<=143;)u[2*t+1]=8,t++,w[8]++;for(;t<=255;)u[2*t+1]=9,t++,w[9]++;for(;t<=279;)u[2*t+1]=7,t++,w[7]++;for(;t<=287;)u[2*t+1]=8,t++,w[8]++;for(T(u,287,w),t=0;t<n;t++)c[2*t+1]=5,c[2*t]=S(t,5);g=new m(u,a,257,r,i),v=new m(c,o,0,n,i),y=new m(new Array(0),s,0,19,7)})(),D=!0),t.l_desc=new x(t.dyn_ltree,g),t.d_desc=new x(t.dyn_dtree,v),t.bl_desc=new x(t.bl_tree,y),t.bi_buf=0,t.bi_valid=0,E(t)},fL._tr_stored_block=k,fL._tr_flush_block=(t,r,n,i)=>{let a,o,s=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let r,n=4093624447;for(r=0;r<=31;r++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*r])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(r=32;r<e;r++)if(0!==t.dyn_ltree[2*r])return 1;return 0})(t)),I(t,t.l_desc),I(t,t.d_desc),s=(t=>{let e;for(L(t,t.dyn_ltree,t.l_desc.max_code),L(t,t.dyn_dtree,t.d_desc.max_code),I(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*l[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),a=t.opt_len+3+7>>>3,o=t.static_len+3+7>>>3,o<=a&&(a=o)):a=o=n+5,n+4<=a&&-1!==r?k(t,r,n,i):4===t.strategy||o===a?(b(t,2+(i?1:0),3),C(t,u,c)):(b(t,4+(i?1:0),3),((t,e,r,n)=>{let i;for(b(t,e-257,5),b(t,r-1,5),b(t,n-4,4),i=0;i<n;i++)b(t,t.bl_tree[2*l[i]+1],3);O(t,t.dyn_ltree,e-1),O(t,t.dyn_dtree,r-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,s+1),C(t,t.dyn_ltree,t.dyn_dtree)),E(t),i&&A(t)},fL._tr_tally=(t,r,n)=>(t.pending_buf[t.d_buf+2*t.last_lit]=r>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&r,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===r?t.dyn_ltree[2*n]++:(t.matches++,r--,t.dyn_ltree[2*(d[n]+e+1)]++,t.dyn_dtree[2*_(r)]++),t.last_lit===t.lit_bufsize-1),fL._tr_align=t=>{b(t,2,3),M(t,256,u),(t=>{16===t.bi_valid?(w(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)},fL}function mL(){if(eL)return tL;eL=1;return tL=(t,e,r,n)=>{let i=65535&t|0,a=t>>>16&65535|0,o=0;for(;0!==r;){o=r>2e3?2e3:r,r-=o;do{i=i+e[n++]|0,a=a+i|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}}function gL(){if(nL)return rL;nL=1;const t=new Uint32Array((()=>{let t,e=[];for(var r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e})());return rL=(e,r,n,i)=>{const a=t,o=i+n;e^=-1;for(let t=i;t<o;t++)e=e>>>8^a[255&(e^r[t])];return-1^e}}function vL(){return aL?iL:(aL=1,iL={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"})}function yL(){return sL?oL:(sL=1,oL={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8})}function xL(){if(lL)return dL;lL=1;const{_tr_init:t,_tr_stored_block:e,_tr_flush_block:r,_tr_tally:n,_tr_align:i}=pL(),a=mL(),o=gL(),s=vL(),{Z_NO_FLUSH:l,Z_PARTIAL_FLUSH:u,Z_FULL_FLUSH:c,Z_FINISH:h,Z_BLOCK:d,Z_OK:f,Z_STREAM_END:p,Z_STREAM_ERROR:m,Z_DATA_ERROR:g,Z_BUF_ERROR:v,Z_DEFAULT_COMPRESSION:y,Z_FILTERED:x,Z_HUFFMAN_ONLY:_,Z_RLE:w,Z_FIXED:b,Z_DEFAULT_STRATEGY:M,Z_UNKNOWN:S,Z_DEFLATED:T}=yL(),E=258,A=262,R=103,P=113,C=666,I=(t,e)=>(t.msg=s[e],e),L=t=>(t<<1)-(t>4?9:0),O=t=>{let e=t.length;for(;--e>=0;)t[e]=0};let D=(t,e,r)=>(e<<t.hash_shift^r)&t.hash_mask;const k=t=>{const e=t.state;let r=e.pending;r>t.avail_out&&(r=t.avail_out),0!==r&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+r),t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))},F=(t,e)=>{r(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,k(t.strm)},N=(t,e)=>{t.pending_buf[t.pending++]=e},U=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},B=(t,e,r,n)=>{let i=t.avail_in;return i>n&&(i=n),0===i?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),r),1===t.state.wrap?t.adler=a(t.adler,e,i,r):2===t.state.wrap&&(t.adler=o(t.adler,e,i,r)),t.next_in+=i,t.total_in+=i,i)},z=(t,e)=>{let r,n,i=t.max_chain_length,a=t.strstart,o=t.prev_length,s=t.nice_match;const l=t.strstart>t.w_size-A?t.strstart-(t.w_size-A):0,u=t.window,c=t.w_mask,h=t.prev,d=t.strstart+E;let f=u[a+o-1],p=u[a+o];t.prev_length>=t.good_match&&(i>>=2),s>t.lookahead&&(s=t.lookahead);do{if(r=e,u[r+o]===p&&u[r+o-1]===f&&u[r]===u[a]&&u[++r]===u[a+1]){a+=2,r++;do{}while(u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&a<d);if(n=E-(d-a),a=d-E,n>o){if(t.match_start=e,o=n,n>=s)break;f=u[a+o-1],p=u[a+o]}}}while((e=h[e&c])>l&&0!=--i);return o<=t.lookahead?o:t.lookahead},G=t=>{const e=t.w_size;let r,n,i,a,o;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-A)){t.window.set(t.window.subarray(e,e+e),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,n=t.hash_size,r=n;do{i=t.head[--r],t.head[r]=i>=e?i-e:0}while(--n);n=e,r=n;do{i=t.prev[--r],t.prev[r]=i>=e?i-e:0}while(--n);a+=e}if(0===t.strm.avail_in)break;if(n=B(t.strm,t.window,t.strstart+t.lookahead,a),t.lookahead+=n,t.lookahead+t.insert>=3)for(o=t.strstart-t.insert,t.ins_h=t.window[o],t.ins_h=D(t,t.ins_h,t.window[o+1]);t.insert&&(t.ins_h=D(t,t.ins_h,t.window[o+3-1]),t.prev[o&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=o,o++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<A&&0!==t.strm.avail_in)},j=(t,e)=>{let r,i;for(;;){if(t.lookahead<A){if(G(t),t.lookahead<A&&e===l)return 1;if(0===t.lookahead)break}if(r=0,t.lookahead>=3&&(t.ins_h=D(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-A&&(t.match_length=z(t,r)),t.match_length>=3)if(i=n(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=D(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=D(t,t.ins_h,t.window[t.strstart+1]);else i=n(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(F(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===h?(F(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(F(t,!1),0===t.strm.avail_out)?1:2},V=(t,e)=>{let r,i,a;for(;;){if(t.lookahead<A){if(G(t),t.lookahead<A&&e===l)return 1;if(0===t.lookahead)break}if(r=0,t.lookahead>=3&&(t.ins_h=D(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-A&&(t.match_length=z(t,r),t.match_length<=5&&(t.strategy===x||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){a=t.strstart+t.lookahead-3,i=n(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=a&&(t.ins_h=D(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(F(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(i=n(t,0,t.window[t.strstart-1]),i&&F(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=n(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===h?(F(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(F(t,!1),0===t.strm.avail_out)?1:2};function H(t,e,r,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=i}const W=[new H(0,0,0,0,((t,e)=>{let r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(G(t),0===t.lookahead&&e===l)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;const n=t.block_start+r;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,F(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-A&&(F(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===h?(F(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(F(t,!1),t.strm.avail_out),1)})),new H(4,4,8,4,j),new H(4,5,16,8,j),new H(4,6,32,32,j),new H(4,4,16,16,V),new H(8,16,32,32,V),new H(8,16,128,128,V),new H(8,32,128,256,V),new H(32,128,258,1024,V),new H(32,258,258,4096,V)];function q(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),O(this.dyn_ltree),O(this.dyn_dtree),O(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),O(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),O(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const X=e=>{if(!e||!e.state)return I(e,m);e.total_in=e.total_out=0,e.data_type=S;const r=e.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap?42:P,e.adler=2===r.wrap?0:1,r.last_flush=l,t(r),f},Y=t=>{const e=X(t);var r;return e===f&&((r=t.state).window_size=2*r.w_size,O(r.head),r.max_lazy_match=W[r.level].max_lazy,r.good_match=W[r.level].good_length,r.nice_match=W[r.level].nice_length,r.max_chain_length=W[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),e},Z=(t,e,r,n,i,a)=>{if(!t)return m;let o=1;if(e===y&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),i<1||i>9||r!==T||n<8||n>15||e<0||e>9||a<0||a>b)return I(t,m);8===n&&(n=9);const s=new q;return t.state=s,s.strm=t,s.wrap=o,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=e,s.strategy=a,s.method=r,Y(t)};return dL.deflateInit=(t,e)=>Z(t,e,T,15,8,M),dL.deflateInit2=Z,dL.deflateReset=Y,dL.deflateResetKeep=X,dL.deflateSetHeader=(t,e)=>t&&t.state?2!==t.state.wrap?m:(t.state.gzhead=e,f):m,dL.deflate=(t,r)=>{let a,s;if(!t||!t.state||r>d||r<0)return t?I(t,m):m;const g=t.state;if(!t.output||!t.input&&0!==t.avail_in||g.status===C&&r!==h)return I(t,0===t.avail_out?v:m);g.strm=t;const y=g.last_flush;if(g.last_flush=r,42===g.status)if(2===g.wrap)t.adler=0,N(g,31),N(g,139),N(g,8),g.gzhead?(N(g,(g.gzhead.text?1:0)+(g.gzhead.hcrc?2:0)+(g.gzhead.extra?4:0)+(g.gzhead.name?8:0)+(g.gzhead.comment?16:0)),N(g,255&g.gzhead.time),N(g,g.gzhead.time>>8&255),N(g,g.gzhead.time>>16&255),N(g,g.gzhead.time>>24&255),N(g,9===g.level?2:g.strategy>=_||g.level<2?4:0),N(g,255&g.gzhead.os),g.gzhead.extra&&g.gzhead.extra.length&&(N(g,255&g.gzhead.extra.length),N(g,g.gzhead.extra.length>>8&255)),g.gzhead.hcrc&&(t.adler=o(t.adler,g.pending_buf,g.pending,0)),g.gzindex=0,g.status=69):(N(g,0),N(g,0),N(g,0),N(g,0),N(g,0),N(g,9===g.level?2:g.strategy>=_||g.level<2?4:0),N(g,3),g.status=P);else{let e=T+(g.w_bits-8<<4)<<8,r=-1;r=g.strategy>=_||g.level<2?0:g.level<6?1:6===g.level?2:3,e|=r<<6,0!==g.strstart&&(e|=32),e+=31-e%31,g.status=P,U(g,e),0!==g.strstart&&(U(g,t.adler>>>16),U(g,65535&t.adler)),t.adler=1}if(69===g.status)if(g.gzhead.extra){for(a=g.pending;g.gzindex<(65535&g.gzhead.extra.length)&&(g.pending!==g.pending_buf_size||(g.gzhead.hcrc&&g.pending>a&&(t.adler=o(t.adler,g.pending_buf,g.pending-a,a)),k(t),a=g.pending,g.pending!==g.pending_buf_size));)N(g,255&g.gzhead.extra[g.gzindex]),g.gzindex++;g.gzhead.hcrc&&g.pending>a&&(t.adler=o(t.adler,g.pending_buf,g.pending-a,a)),g.gzindex===g.gzhead.extra.length&&(g.gzindex=0,g.status=73)}else g.status=73;if(73===g.status)if(g.gzhead.name){a=g.pending;do{if(g.pending===g.pending_buf_size&&(g.gzhead.hcrc&&g.pending>a&&(t.adler=o(t.adler,g.pending_buf,g.pending-a,a)),k(t),a=g.pending,g.pending===g.pending_buf_size)){s=1;break}s=g.gzindex<g.gzhead.name.length?255&g.gzhead.name.charCodeAt(g.gzindex++):0,N(g,s)}while(0!==s);g.gzhead.hcrc&&g.pending>a&&(t.adler=o(t.adler,g.pending_buf,g.pending-a,a)),0===s&&(g.gzindex=0,g.status=91)}else g.status=91;if(91===g.status)if(g.gzhead.comment){a=g.pending;do{if(g.pending===g.pending_buf_size&&(g.gzhead.hcrc&&g.pending>a&&(t.adler=o(t.adler,g.pending_buf,g.pending-a,a)),k(t),a=g.pending,g.pending===g.pending_buf_size)){s=1;break}s=g.gzindex<g.gzhead.comment.length?255&g.gzhead.comment.charCodeAt(g.gzindex++):0,N(g,s)}while(0!==s);g.gzhead.hcrc&&g.pending>a&&(t.adler=o(t.adler,g.pending_buf,g.pending-a,a)),0===s&&(g.status=R)}else g.status=R;if(g.status===R&&(g.gzhead.hcrc?(g.pending+2>g.pending_buf_size&&k(t),g.pending+2<=g.pending_buf_size&&(N(g,255&t.adler),N(g,t.adler>>8&255),t.adler=0,g.status=P)):g.status=P),0!==g.pending){if(k(t),0===t.avail_out)return g.last_flush=-1,f}else if(0===t.avail_in&&L(r)<=L(y)&&r!==h)return I(t,v);if(g.status===C&&0!==t.avail_in)return I(t,v);if(0!==t.avail_in||0!==g.lookahead||r!==l&&g.status!==C){let a=g.strategy===_?((t,e)=>{let r;for(;;){if(0===t.lookahead&&(G(t),0===t.lookahead)){if(e===l)return 1;break}if(t.match_length=0,r=n(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(F(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===h?(F(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(F(t,!1),0===t.strm.avail_out)?1:2})(g,r):g.strategy===w?((t,e)=>{let r,i,a,o;const s=t.window;for(;;){if(t.lookahead<=E){if(G(t),t.lookahead<=E&&e===l)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(a=t.strstart-1,i=s[a],i===s[++a]&&i===s[++a]&&i===s[++a])){o=t.strstart+E;do{}while(i===s[++a]&&i===s[++a]&&i===s[++a]&&i===s[++a]&&i===s[++a]&&i===s[++a]&&i===s[++a]&&i===s[++a]&&a<o);t.match_length=E-(o-a),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(r=n(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=n(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(F(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===h?(F(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(F(t,!1),0===t.strm.avail_out)?1:2})(g,r):W[g.level].func(g,r);if(3!==a&&4!==a||(g.status=C),1===a||3===a)return 0===t.avail_out&&(g.last_flush=-1),f;if(2===a&&(r===u?i(g):r!==d&&(e(g,0,0,!1),r===c&&(O(g.head),0===g.lookahead&&(g.strstart=0,g.block_start=0,g.insert=0))),k(t),0===t.avail_out))return g.last_flush=-1,f}return r!==h?f:g.wrap<=0?p:(2===g.wrap?(N(g,255&t.adler),N(g,t.adler>>8&255),N(g,t.adler>>16&255),N(g,t.adler>>24&255),N(g,255&t.total_in),N(g,t.total_in>>8&255),N(g,t.total_in>>16&255),N(g,t.total_in>>24&255)):(U(g,t.adler>>>16),U(g,65535&t.adler)),k(t),g.wrap>0&&(g.wrap=-g.wrap),0!==g.pending?f:p)},dL.deflateEnd=t=>{if(!t||!t.state)return m;const e=t.state.status;return 42!==e&&69!==e&&73!==e&&91!==e&&e!==R&&e!==P&&e!==C?I(t,m):(t.state=null,e===P?I(t,g):f)},dL.deflateSetDictionary=(t,e)=>{let r=e.length;if(!t||!t.state)return m;const n=t.state,i=n.wrap;if(2===i||1===i&&42!==n.status||n.lookahead)return m;if(1===i&&(t.adler=a(t.adler,e,r,0)),n.wrap=0,r>=n.w_size){0===i&&(O(n.head),n.strstart=0,n.block_start=0,n.insert=0);let t=new Uint8Array(n.w_size);t.set(e.subarray(r-n.w_size,r),0),e=t,r=n.w_size}const o=t.avail_in,s=t.next_in,l=t.input;for(t.avail_in=r,t.next_in=0,t.input=e,G(n);n.lookahead>=3;){let t=n.strstart,e=n.lookahead-2;do{n.ins_h=D(n,n.ins_h,n.window[t+3-1]),n.prev[t&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=t,t++}while(--e);n.strstart=t,n.lookahead=2,G(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=s,t.input=l,t.avail_in=o,n.wrap=i,f},dL.deflateInfo="pako deflate (from Nodeca project)",dL}var _L,wL={};function bL(){if(_L)return wL;_L=1;const t=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);return wL.assign=function(e){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const n=r.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const r in n)t(n,r)&&(e[r]=n[r])}}return e},wL.flattenChunks=t=>{let e=0;for(let r=0,n=t.length;r<n;r++)e+=t[r].length;const r=new Uint8Array(e);for(let e=0,n=0,i=t.length;e<i;e++){let i=t[e];r.set(i,n),n+=i.length}return r},wL}var ML,SL,TL,EL,AL={};function RL(){if(ML)return AL;ML=1;let t=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){t=!1}const e=new Uint8Array(256);for(let t=0;t<256;t++)e[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;e[254]=e[254]=1,AL.string2buf=t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,r,n,i,a,o=t.length,s=0;for(i=0;i<o;i++)r=t.charCodeAt(i),55296==(64512&r)&&i+1<o&&(n=t.charCodeAt(i+1),56320==(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),i++)),s+=r<128?1:r<2048?2:r<65536?3:4;for(e=new Uint8Array(s),a=0,i=0;a<s;i++)r=t.charCodeAt(i),55296==(64512&r)&&i+1<o&&(n=t.charCodeAt(i+1),56320==(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),i++)),r<128?e[a++]=r:r<2048?(e[a++]=192|r>>>6,e[a++]=128|63&r):r<65536?(e[a++]=224|r>>>12,e[a++]=128|r>>>6&63,e[a++]=128|63&r):(e[a++]=240|r>>>18,e[a++]=128|r>>>12&63,e[a++]=128|r>>>6&63,e[a++]=128|63&r);return e};return AL.buf2string=(r,n)=>{const i=n||r.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(r.subarray(0,n));let a,o;const s=new Array(2*i);for(o=0,a=0;a<i;){let t=r[a++];if(t<128){s[o++]=t;continue}let n=e[t];if(n>4)s[o++]=65533,a+=n-1;else{for(t&=2===n?31:3===n?15:7;n>1&&a<i;)t=t<<6|63&r[a++],n--;n>1?s[o++]=65533:t<65536?s[o++]=t:(t-=65536,s[o++]=55296|t>>10&1023,s[o++]=56320|1023&t)}}return((e,r)=>{if(r<65534&&e.subarray&&t)return String.fromCharCode.apply(null,e.length===r?e:e.subarray(0,r));let n="";for(let t=0;t<r;t++)n+=String.fromCharCode(e[t]);return n})(s,o)},AL.utf8border=(t,r)=>{(r=r||t.length)>t.length&&(r=t.length);let n=r-1;for(;n>=0&&128==(192&t[n]);)n--;return n<0||0===n?r:n+e[t[n]]>r?n:r},AL}function PL(){if(TL)return SL;return TL=1,SL=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}}var CL,IL,LL,OL,DL,kL,FL,NL,UL,BL,zL={},GL={};function jL(){if(DL)return GL;DL=1;const t=mL(),e=gL(),r=IL?CL:(IL=1,CL=function(t,e){let r,n,i,a,o,s,l,u,c,h,d,f,p,m,g,v,y,x,_,w,b,M,S,T;const E=t.state;r=t.next_in,S=t.input,n=r+(t.avail_in-5),i=t.next_out,T=t.output,a=i-(e-t.avail_out),o=i+(t.avail_out-257),s=E.dmax,l=E.wsize,u=E.whave,c=E.wnext,h=E.window,d=E.hold,f=E.bits,p=E.lencode,m=E.distcode,g=(1<<E.lenbits)-1,v=(1<<E.distbits)-1;t:do{f<15&&(d+=S[r++]<<f,f+=8,d+=S[r++]<<f,f+=8),y=p[d&g];e:for(;;){if(x=y>>>24,d>>>=x,f-=x,x=y>>>16&255,0===x)T[i++]=65535&y;else{if(!(16&x)){if(0==(64&x)){y=p[(65535&y)+(d&(1<<x)-1)];continue e}if(32&x){E.mode=12;break t}t.msg="invalid literal/length code",E.mode=30;break t}_=65535&y,x&=15,x&&(f<x&&(d+=S[r++]<<f,f+=8),_+=d&(1<<x)-1,d>>>=x,f-=x),f<15&&(d+=S[r++]<<f,f+=8,d+=S[r++]<<f,f+=8),y=m[d&v];r:for(;;){if(x=y>>>24,d>>>=x,f-=x,x=y>>>16&255,!(16&x)){if(0==(64&x)){y=m[(65535&y)+(d&(1<<x)-1)];continue r}t.msg="invalid distance code",E.mode=30;break t}if(w=65535&y,x&=15,f<x&&(d+=S[r++]<<f,f+=8,f<x&&(d+=S[r++]<<f,f+=8)),w+=d&(1<<x)-1,w>s){t.msg="invalid distance too far back",E.mode=30;break t}if(d>>>=x,f-=x,x=i-a,w>x){if(x=w-x,x>u&&E.sane){t.msg="invalid distance too far back",E.mode=30;break t}if(b=0,M=h,0===c){if(b+=l-x,x<_){_-=x;do{T[i++]=h[b++]}while(--x);b=i-w,M=T}}else if(c<x){if(b+=l+c-x,x-=c,x<_){_-=x;do{T[i++]=h[b++]}while(--x);if(b=0,c<_){x=c,_-=x;do{T[i++]=h[b++]}while(--x);b=i-w,M=T}}}else if(b+=c-x,x<_){_-=x;do{T[i++]=h[b++]}while(--x);b=i-w,M=T}for(;_>2;)T[i++]=M[b++],T[i++]=M[b++],T[i++]=M[b++],_-=3;_&&(T[i++]=M[b++],_>1&&(T[i++]=M[b++]))}else{b=i-w;do{T[i++]=T[b++],T[i++]=T[b++],T[i++]=T[b++],_-=3}while(_>2);_&&(T[i++]=T[b++],_>1&&(T[i++]=T[b++]))}break}}break}}while(r<n&&i<o);_=f>>3,r-=_,f-=_<<3,d&=(1<<f)-1,t.next_in=r,t.next_out=i,t.avail_in=r<n?n-r+5:5-(r-n),t.avail_out=i<o?o-i+257:257-(i-o),E.hold=d,E.bits=f}),n=function(){if(OL)return LL;OL=1;const t=15,e=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),r=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),n=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),i=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);return LL=(a,o,s,l,u,c,h,d)=>{const f=d.bits;let p,m,g,v,y,x,_=0,w=0,b=0,M=0,S=0,T=0,E=0,A=0,R=0,P=0,C=null,I=0;const L=new Uint16Array(16),O=new Uint16Array(16);let D,k,F,N=null,U=0;for(_=0;_<=t;_++)L[_]=0;for(w=0;w<l;w++)L[o[s+w]]++;for(S=f,M=t;M>=1&&0===L[M];M--);if(S>M&&(S=M),0===M)return u[c++]=20971520,u[c++]=20971520,d.bits=1,0;for(b=1;b<M&&0===L[b];b++);for(S<b&&(S=b),A=1,_=1;_<=t;_++)if(A<<=1,A-=L[_],A<0)return-1;if(A>0&&(0===a||1!==M))return-1;for(O[1]=0,_=1;_<t;_++)O[_+1]=O[_]+L[_];for(w=0;w<l;w++)0!==o[s+w]&&(h[O[o[s+w]]++]=w);if(0===a?(C=N=h,x=19):1===a?(C=e,I-=257,N=r,U-=257,x=256):(C=n,N=i,x=-1),P=0,w=0,_=b,y=c,T=S,E=0,g=-1,R=1<<S,v=R-1,1===a&&R>852||2===a&&R>592)return 1;for(;;){D=_-E,h[w]<x?(k=0,F=h[w]):h[w]>x?(k=N[U+h[w]],F=C[I+h[w]]):(k=96,F=0),p=1<<_-E,m=1<<T,b=m;do{m-=p,u[y+(P>>E)+m]=D<<24|k<<16|F|0}while(0!==m);for(p=1<<_-1;P&p;)p>>=1;if(0!==p?(P&=p-1,P+=p):P=0,w++,0==--L[_]){if(_===M)break;_=o[s+h[w]]}if(_>S&&(P&v)!==g){for(0===E&&(E=S),y+=b,T=_-E,A=1<<T;T+E<M&&(A-=L[T+E],!(A<=0));)T++,A<<=1;if(R+=1<<T,1===a&&R>852||2===a&&R>592)return 1;g=P&v,u[g]=S<<24|T<<16|y-c|0}}return 0!==P&&(u[y+P]=_-E<<24|64<<16|0),d.bits=S,0}}(),{Z_FINISH:i,Z_BLOCK:a,Z_TREES:o,Z_OK:s,Z_STREAM_END:l,Z_NEED_DICT:u,Z_STREAM_ERROR:c,Z_DATA_ERROR:h,Z_MEM_ERROR:d,Z_BUF_ERROR:f,Z_DEFLATED:p}=yL(),m=12,g=30,v=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function y(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const x=t=>{if(!t||!t.state)return c;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,s},_=t=>{if(!t||!t.state)return c;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,x(t)},w=(t,e)=>{let r;if(!t||!t.state)return c;const n=t.state;return e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?c:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,_(t))},b=(t,e)=>{if(!t)return c;const r=new y;t.state=r,r.window=null;const n=w(t,e);return n!==s&&(t.state=null),n};let M,S,T=!0;const E=t=>{if(T){M=new Int32Array(512),S=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(n(1,t.lens,0,288,M,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;n(2,t.lens,0,32,S,0,t.work,{bits:5}),T=!1}t.lencode=M,t.lenbits=9,t.distcode=S,t.distbits=5},A=(t,e,r,n)=>{let i;const a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),n>=a.wsize?(a.window.set(e.subarray(r-a.wsize,r),0),a.wnext=0,a.whave=a.wsize):(i=a.wsize-a.wnext,i>n&&(i=n),a.window.set(e.subarray(r-n,r-n+i),a.wnext),(n-=i)?(a.window.set(e.subarray(r-n,r),0),a.wnext=n,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0};return GL.inflateReset=_,GL.inflateReset2=w,GL.inflateResetKeep=x,GL.inflateInit=t=>b(t,15),GL.inflateInit2=b,GL.inflate=(y,x)=>{let _,w,b,M,S,T,R,P,C,I,L,O,D,k,F,N,U,B,z,G,j,V,H=0;const W=new Uint8Array(4);let q,X;const Y=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!y||!y.state||!y.output||!y.input&&0!==y.avail_in)return c;_=y.state,_.mode===m&&(_.mode=13),S=y.next_out,b=y.output,R=y.avail_out,M=y.next_in,w=y.input,T=y.avail_in,P=_.hold,C=_.bits,I=T,L=R,V=s;t:for(;;)switch(_.mode){case 1:if(0===_.wrap){_.mode=13;break}for(;C<16;){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}if(2&_.wrap&&35615===P){_.check=0,W[0]=255&P,W[1]=P>>>8&255,_.check=e(_.check,W,2,0),P=0,C=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&P)<<8)+(P>>8))%31){y.msg="incorrect header check",_.mode=g;break}if((15&P)!==p){y.msg="unknown compression method",_.mode=g;break}if(P>>>=4,C-=4,j=8+(15&P),0===_.wbits)_.wbits=j;else if(j>_.wbits){y.msg="invalid window size",_.mode=g;break}_.dmax=1<<_.wbits,y.adler=_.check=1,_.mode=512&P?10:m,P=0,C=0;break;case 2:for(;C<16;){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}if(_.flags=P,(255&_.flags)!==p){y.msg="unknown compression method",_.mode=g;break}if(57344&_.flags){y.msg="unknown header flags set",_.mode=g;break}_.head&&(_.head.text=P>>8&1),512&_.flags&&(W[0]=255&P,W[1]=P>>>8&255,_.check=e(_.check,W,2,0)),P=0,C=0,_.mode=3;case 3:for(;C<32;){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}_.head&&(_.head.time=P),512&_.flags&&(W[0]=255&P,W[1]=P>>>8&255,W[2]=P>>>16&255,W[3]=P>>>24&255,_.check=e(_.check,W,4,0)),P=0,C=0,_.mode=4;case 4:for(;C<16;){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}_.head&&(_.head.xflags=255&P,_.head.os=P>>8),512&_.flags&&(W[0]=255&P,W[1]=P>>>8&255,_.check=e(_.check,W,2,0)),P=0,C=0,_.mode=5;case 5:if(1024&_.flags){for(;C<16;){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}_.length=P,_.head&&(_.head.extra_len=P),512&_.flags&&(W[0]=255&P,W[1]=P>>>8&255,_.check=e(_.check,W,2,0)),P=0,C=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(O=_.length,O>T&&(O=T),O&&(_.head&&(j=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Uint8Array(_.head.extra_len)),_.head.extra.set(w.subarray(M,M+O),j)),512&_.flags&&(_.check=e(_.check,w,O,M)),T-=O,M+=O,_.length-=O),_.length))break t;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(0===T)break t;O=0;do{j=w[M+O++],_.head&&j&&_.length<65536&&(_.head.name+=String.fromCharCode(j))}while(j&&O<T);if(512&_.flags&&(_.check=e(_.check,w,O,M)),T-=O,M+=O,j)break t}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(0===T)break t;O=0;do{j=w[M+O++],_.head&&j&&_.length<65536&&(_.head.comment+=String.fromCharCode(j))}while(j&&O<T);if(512&_.flags&&(_.check=e(_.check,w,O,M)),T-=O,M+=O,j)break t}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;C<16;){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}if(P!==(65535&_.check)){y.msg="header crc mismatch",_.mode=g;break}P=0,C=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),y.adler=_.check=0,_.mode=m;break;case 10:for(;C<32;){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}y.adler=_.check=v(P),P=0,C=0,_.mode=11;case 11:if(0===_.havedict)return y.next_out=S,y.avail_out=R,y.next_in=M,y.avail_in=T,_.hold=P,_.bits=C,u;y.adler=_.check=1,_.mode=m;case m:if(x===a||x===o)break t;case 13:if(_.last){P>>>=7&C,C-=7&C,_.mode=27;break}for(;C<3;){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}switch(_.last=1&P,P>>>=1,C-=1,3&P){case 0:_.mode=14;break;case 1:if(E(_),_.mode=20,x===o){P>>>=2,C-=2;break t}break;case 2:_.mode=17;break;case 3:y.msg="invalid block type",_.mode=g}P>>>=2,C-=2;break;case 14:for(P>>>=7&C,C-=7&C;C<32;){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}if((65535&P)!=(P>>>16^65535)){y.msg="invalid stored block lengths",_.mode=g;break}if(_.length=65535&P,P=0,C=0,_.mode=15,x===o)break t;case 15:_.mode=16;case 16:if(O=_.length,O){if(O>T&&(O=T),O>R&&(O=R),0===O)break t;b.set(w.subarray(M,M+O),S),T-=O,M+=O,R-=O,S+=O,_.length-=O;break}_.mode=m;break;case 17:for(;C<14;){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}if(_.nlen=257+(31&P),P>>>=5,C-=5,_.ndist=1+(31&P),P>>>=5,C-=5,_.ncode=4+(15&P),P>>>=4,C-=4,_.nlen>286||_.ndist>30){y.msg="too many length or distance symbols",_.mode=g;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;C<3;){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}_.lens[Y[_.have++]]=7&P,P>>>=3,C-=3}for(;_.have<19;)_.lens[Y[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,q={bits:_.lenbits},V=n(0,_.lens,0,19,_.lencode,0,_.work,q),_.lenbits=q.bits,V){y.msg="invalid code lengths set",_.mode=g;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;H=_.lencode[P&(1<<_.lenbits)-1],F=H>>>24,N=H>>>16&255,U=65535&H,!(F<=C);){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}if(U<16)P>>>=F,C-=F,_.lens[_.have++]=U;else{if(16===U){for(X=F+2;C<X;){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}if(P>>>=F,C-=F,0===_.have){y.msg="invalid bit length repeat",_.mode=g;break}j=_.lens[_.have-1],O=3+(3&P),P>>>=2,C-=2}else if(17===U){for(X=F+3;C<X;){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}P>>>=F,C-=F,j=0,O=3+(7&P),P>>>=3,C-=3}else{for(X=F+7;C<X;){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}P>>>=F,C-=F,j=0,O=11+(127&P),P>>>=7,C-=7}if(_.have+O>_.nlen+_.ndist){y.msg="invalid bit length repeat",_.mode=g;break}for(;O--;)_.lens[_.have++]=j}}if(_.mode===g)break;if(0===_.lens[256]){y.msg="invalid code -- missing end-of-block",_.mode=g;break}if(_.lenbits=9,q={bits:_.lenbits},V=n(1,_.lens,0,_.nlen,_.lencode,0,_.work,q),_.lenbits=q.bits,V){y.msg="invalid literal/lengths set",_.mode=g;break}if(_.distbits=6,_.distcode=_.distdyn,q={bits:_.distbits},V=n(2,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,q),_.distbits=q.bits,V){y.msg="invalid distances set",_.mode=g;break}if(_.mode=20,x===o)break t;case 20:_.mode=21;case 21:if(T>=6&&R>=258){y.next_out=S,y.avail_out=R,y.next_in=M,y.avail_in=T,_.hold=P,_.bits=C,r(y,L),S=y.next_out,b=y.output,R=y.avail_out,M=y.next_in,w=y.input,T=y.avail_in,P=_.hold,C=_.bits,_.mode===m&&(_.back=-1);break}for(_.back=0;H=_.lencode[P&(1<<_.lenbits)-1],F=H>>>24,N=H>>>16&255,U=65535&H,!(F<=C);){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}if(N&&0==(240&N)){for(B=F,z=N,G=U;H=_.lencode[G+((P&(1<<B+z)-1)>>B)],F=H>>>24,N=H>>>16&255,U=65535&H,!(B+F<=C);){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}P>>>=B,C-=B,_.back+=B}if(P>>>=F,C-=F,_.back+=F,_.length=U,0===N){_.mode=26;break}if(32&N){_.back=-1,_.mode=m;break}if(64&N){y.msg="invalid literal/length code",_.mode=g;break}_.extra=15&N,_.mode=22;case 22:if(_.extra){for(X=_.extra;C<X;){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}_.length+=P&(1<<_.extra)-1,P>>>=_.extra,C-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;H=_.distcode[P&(1<<_.distbits)-1],F=H>>>24,N=H>>>16&255,U=65535&H,!(F<=C);){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}if(0==(240&N)){for(B=F,z=N,G=U;H=_.distcode[G+((P&(1<<B+z)-1)>>B)],F=H>>>24,N=H>>>16&255,U=65535&H,!(B+F<=C);){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}P>>>=B,C-=B,_.back+=B}if(P>>>=F,C-=F,_.back+=F,64&N){y.msg="invalid distance code",_.mode=g;break}_.offset=U,_.extra=15&N,_.mode=24;case 24:if(_.extra){for(X=_.extra;C<X;){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}_.offset+=P&(1<<_.extra)-1,P>>>=_.extra,C-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){y.msg="invalid distance too far back",_.mode=g;break}_.mode=25;case 25:if(0===R)break t;if(O=L-R,_.offset>O){if(O=_.offset-O,O>_.whave&&_.sane){y.msg="invalid distance too far back",_.mode=g;break}O>_.wnext?(O-=_.wnext,D=_.wsize-O):D=_.wnext-O,O>_.length&&(O=_.length),k=_.window}else k=b,D=S-_.offset,O=_.length;O>R&&(O=R),R-=O,_.length-=O;do{b[S++]=k[D++]}while(--O);0===_.length&&(_.mode=21);break;case 26:if(0===R)break t;b[S++]=_.length,R--,_.mode=21;break;case 27:if(_.wrap){for(;C<32;){if(0===T)break t;T--,P|=w[M++]<<C,C+=8}if(L-=R,y.total_out+=L,_.total+=L,L&&(y.adler=_.check=_.flags?e(_.check,b,L,S-L):t(_.check,b,L,S-L)),L=R,(_.flags?P:v(P))!==_.check){y.msg="incorrect data check",_.mode=g;break}P=0,C=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;C<32;){if(0===T)break t;T--,P+=w[M++]<<C,C+=8}if(P!==(4294967295&_.total)){y.msg="incorrect length check",_.mode=g;break}P=0,C=0}_.mode=29;case 29:V=l;break t;case g:V=h;break t;case 31:return d;default:return c}return y.next_out=S,y.avail_out=R,y.next_in=M,y.avail_in=T,_.hold=P,_.bits=C,(_.wsize||L!==y.avail_out&&_.mode<g&&(_.mode<27||x!==i))&&A(y,y.output,y.next_out,L-y.avail_out),I-=y.avail_in,L-=y.avail_out,y.total_in+=I,y.total_out+=L,_.total+=L,_.wrap&&L&&(y.adler=_.check=_.flags?e(_.check,b,L,y.next_out-L):t(_.check,b,L,y.next_out-L)),y.data_type=_.bits+(_.last?64:0)+(_.mode===m?128:0)+(20===_.mode||15===_.mode?256:0),(0===I&&0===L||x===i)&&V===s&&(V=f),V},GL.inflateEnd=t=>{if(!t||!t.state)return c;let e=t.state;return e.window&&(e.window=null),t.state=null,s},GL.inflateGetHeader=(t,e)=>{if(!t||!t.state)return c;const r=t.state;return 0==(2&r.wrap)?c:(r.head=e,e.done=!1,s)},GL.inflateSetDictionary=(e,r)=>{const n=r.length;let i,a,o;return e&&e.state?(i=e.state,0!==i.wrap&&11!==i.mode?c:11===i.mode&&(a=1,a=t(a,r,n,0),a!==i.check)?h:(o=A(e,r,n,n),o?(i.mode=31,d):(i.havedict=1,s))):c},GL.inflateInfo="pako inflate (from Nodeca project)",GL}function VL(){if(NL)return zL;NL=1;const t=jL(),e=bL(),r=RL(),n=vL(),i=PL(),a=FL?kL:(FL=1,kL=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}),o=Object.prototype.toString,{Z_NO_FLUSH:s,Z_FINISH:l,Z_OK:u,Z_STREAM_END:c,Z_NEED_DICT:h,Z_STREAM_ERROR:d,Z_DATA_ERROR:f,Z_MEM_ERROR:p}=yL();function m(s){this.options=e.assign({chunkSize:65536,windowBits:15,to:""},s||{});const l=this.options;l.raw&&l.windowBits>=0&&l.windowBits<16&&(l.windowBits=-l.windowBits,0===l.windowBits&&(l.windowBits=-15)),!(l.windowBits>=0&&l.windowBits<16)||s&&s.windowBits||(l.windowBits+=32),l.windowBits>15&&l.windowBits<48&&0==(15&l.windowBits)&&(l.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;let c=t.inflateInit2(this.strm,l.windowBits);if(c!==u)throw new Error(n[c]);if(this.header=new a,t.inflateGetHeader(this.strm,this.header),l.dictionary&&("string"==typeof l.dictionary?l.dictionary=r.string2buf(l.dictionary):"[object ArrayBuffer]"===o.call(l.dictionary)&&(l.dictionary=new Uint8Array(l.dictionary)),l.raw&&(c=t.inflateSetDictionary(this.strm,l.dictionary),c!==u)))throw new Error(n[c])}function g(t,e){const r=new m(e);if(r.push(t),r.err)throw r.msg||n[r.err];return r.result}return m.prototype.push=function(e,n){const i=this.strm,a=this.options.chunkSize,m=this.options.dictionary;let g,v,y;if(this.ended)return!1;for(v=n===~~n?n:!0===n?l:s,"[object ArrayBuffer]"===o.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(a),i.next_out=0,i.avail_out=a),g=t.inflate(i,v),g===h&&m&&(g=t.inflateSetDictionary(i,m),g===u?g=t.inflate(i,v):g===f&&(g=h));i.avail_in>0&&g===c&&i.state.wrap>0&&0!==e[i.next_in];)t.inflateReset(i),g=t.inflate(i,v);switch(g){case d:case f:case h:case p:return this.onEnd(g),this.ended=!0,!1}if(y=i.avail_out,i.next_out&&(0===i.avail_out||g===c))if("string"===this.options.to){let t=r.utf8border(i.output,i.next_out),e=i.next_out-t,n=r.buf2string(i.output,t);i.next_out=e,i.avail_out=a-e,e&&i.output.set(i.output.subarray(t,t+e),0),this.onData(n)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(g!==u||0!==y){if(g===c)return g=t.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},m.prototype.onData=function(t){this.chunks.push(t)},m.prototype.onEnd=function(t){t===u&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},zL.Inflate=m,zL.inflate=g,zL.inflateRaw=function(t,e){return(e=e||{}).raw=!0,g(t,e)},zL.ungzip=g,zL.constants=yL(),zL}function HL(){if(UL)return cL;UL=1;const{Deflate:t,deflate:e,deflateRaw:r,gzip:n}=function(){if(EL)return hL;EL=1;const t=xL(),e=bL(),r=RL(),n=vL(),i=PL(),a=Object.prototype.toString,{Z_NO_FLUSH:o,Z_SYNC_FLUSH:s,Z_FULL_FLUSH:l,Z_FINISH:u,Z_OK:c,Z_STREAM_END:h,Z_DEFAULT_COMPRESSION:d,Z_DEFAULT_STRATEGY:f,Z_DEFLATED:p}=yL();function m(o){this.options=e.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:f},o||{});let s=this.options;s.raw&&s.windowBits>0?s.windowBits=-s.windowBits:s.gzip&&s.windowBits>0&&s.windowBits<16&&(s.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;let l=t.deflateInit2(this.strm,s.level,s.method,s.windowBits,s.memLevel,s.strategy);if(l!==c)throw new Error(n[l]);if(s.header&&t.deflateSetHeader(this.strm,s.header),s.dictionary){let e;if(e="string"==typeof s.dictionary?r.string2buf(s.dictionary):"[object ArrayBuffer]"===a.call(s.dictionary)?new Uint8Array(s.dictionary):s.dictionary,l=t.deflateSetDictionary(this.strm,e),l!==c)throw new Error(n[l]);this._dict_set=!0}}function g(t,e){const r=new m(e);if(r.push(t,!0),r.err)throw r.msg||n[r.err];return r.result}return m.prototype.push=function(e,n){const i=this.strm,d=this.options.chunkSize;let f,p;if(this.ended)return!1;for(p=n===~~n?n:!0===n?u:o,"string"==typeof e?i.input=r.string2buf(e):"[object ArrayBuffer]"===a.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(d),i.next_out=0,i.avail_out=d),(p===s||p===l)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(f=t.deflate(i,p),f===h)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),f=t.deflateEnd(this.strm),this.onEnd(f),this.ended=!0,f===c;if(0!==i.avail_out){if(p>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},m.prototype.onData=function(t){this.chunks.push(t)},m.prototype.onEnd=function(t){t===c&&(this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},hL.Deflate=m,hL.deflate=g,hL.deflateRaw=function(t,e){return(e=e||{}).raw=!0,g(t,e)},hL.gzip=function(t,e){return(e=e||{}).gzip=!0,g(t,e)},hL.constants=yL(),hL}(),{Inflate:i,inflate:a,inflateRaw:o,ungzip:s}=VL(),l=yL();return cL.Deflate=t,cL.deflate=e,cL.deflateRaw=r,cL.gzip=n,cL.Inflate=i,cL.inflate=a,cL.inflateRaw=o,cL.ungzip=s,cL.constants=l,cL}var WL,qL={};var XL,YL,ZL={},KL={},JL={get exports(){return KL},set exports(t){KL=t}};function QL(){if(YL)return ZL;YL=1;var t=af&&af.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ZL,"__esModule",{value:!0});const e=HL(),r=t((XL||(XL=1,function(t){
/* Copyright 2015-2021 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 @preserve */
!function(){var e,r,n,i,a,o,s,l,u,c,h,d,f,p,m,g,v=(e={defaultNoDataValue:-34027999387901484e22,decode:function(t,o){var s=(o=o||{}).encodedMaskData||null===o.encodedMaskData,l=a(t,o.inputOffset||0,s),u=null!==o.noDataValue?o.noDataValue:e.defaultNoDataValue,c=r(l,o.pixelType||Float32Array,o.encodedMaskData,u,o.returnMask),h={width:l.width,height:l.height,pixelData:c.resultPixels,minValue:c.minValue,maxValue:l.pixels.maxValue,noDataValue:u};return c.resultMask&&(h.maskData=c.resultMask),o.returnEncodedMask&&l.mask&&(h.encodedMaskData=l.mask.bitset?l.mask.bitset:null),o.returnFileInfo&&(h.fileInfo=n(l),o.computeUsedBitDepths&&(h.fileInfo.bitDepths=i(l))),h}},r=function(t,e,r,n,i){var a,s,l,u=0,c=t.pixels.numBlocksX,h=t.pixels.numBlocksY,d=Math.floor(t.width/c),f=Math.floor(t.height/h),p=2*t.maxZError,m=Number.MAX_VALUE;r=r||(t.mask?t.mask.bitset:null),s=new e(t.width*t.height),i&&r&&(l=new Uint8Array(t.width*t.height));for(var g,v,y=new Float32Array(d*f),x=0;x<=h;x++){var _=x!==h?f:t.height%h;if(0!==_)for(var w=0;w<=c;w++){var b=w!==c?d:t.width%c;if(0!==b){var M,S,T,E,A=x*t.width*f+w*d,R=t.width-b,P=t.pixels.blocks[u];if(P.encoding<2?(0===P.encoding?M=P.rawData:(o(P.stuffedData,P.bitsPerPixel,P.numValidPixels,P.offset,p,y,t.pixels.maxValue),M=y),S=0):T=2===P.encoding?0:P.offset,r)for(v=0;v<_;v++){for(7&A&&(E=r[A>>3],E<<=7&A),g=0;g<b;g++)7&A||(E=r[A>>3]),128&E?(l&&(l[A]=1),m=m>(a=P.encoding<2?M[S++]:T)?a:m,s[A++]=a):(l&&(l[A]=0),s[A++]=n),E<<=1;A+=R}else if(P.encoding<2)for(v=0;v<_;v++){for(g=0;g<b;g++)m=m>(a=M[S++])?a:m,s[A++]=a;A+=R}else for(m=m>T?T:m,v=0;v<_;v++){for(g=0;g<b;g++)s[A++]=T;A+=R}if(1===P.encoding&&S!==P.numValidPixels)throw"Block and Mask do not match";u++}}}return{resultPixels:s,resultMask:l,minValue:m}},n=function(t){return{fileIdentifierString:t.fileIdentifierString,fileVersion:t.fileVersion,imageType:t.imageType,height:t.height,width:t.width,maxZError:t.maxZError,eofOffset:t.eofOffset,mask:t.mask?{numBlocksX:t.mask.numBlocksX,numBlocksY:t.mask.numBlocksY,numBytes:t.mask.numBytes,maxValue:t.mask.maxValue}:null,pixels:{numBlocksX:t.pixels.numBlocksX,numBlocksY:t.pixels.numBlocksY,numBytes:t.pixels.numBytes,maxValue:t.pixels.maxValue,noDataValue:t.noDataValue}}},i=function(t){for(var e=t.pixels.numBlocksX*t.pixels.numBlocksY,r={},n=0;n<e;n++){var i=t.pixels.blocks[n];0===i.encoding?r.float32=!0:1===i.encoding?r[i.bitsPerPixel]=!0:r[0]=!0}return Object.keys(r)},a=function(t,e,r){var n={},i=new Uint8Array(t,e,10);if(n.fileIdentifierString=String.fromCharCode.apply(null,i),"CntZImage"!==n.fileIdentifierString.trim())throw"Unexpected file identifier string: "+n.fileIdentifierString;e+=10;var a=new DataView(t,e,24);if(n.fileVersion=a.getInt32(0,!0),n.imageType=a.getInt32(4,!0),n.height=a.getUint32(8,!0),n.width=a.getUint32(12,!0),n.maxZError=a.getFloat64(16,!0),e+=24,!r)if(a=new DataView(t,e,16),n.mask={},n.mask.numBlocksY=a.getUint32(0,!0),n.mask.numBlocksX=a.getUint32(4,!0),n.mask.numBytes=a.getUint32(8,!0),n.mask.maxValue=a.getFloat32(12,!0),e+=16,n.mask.numBytes>0){var o=new Uint8Array(Math.ceil(n.width*n.height/8)),s=(a=new DataView(t,e,n.mask.numBytes)).getInt16(0,!0),l=2,u=0;do{if(s>0)for(;s--;)o[u++]=a.getUint8(l++);else{var c=a.getUint8(l++);for(s=-s;s--;)o[u++]=c}s=a.getInt16(l,!0),l+=2}while(l<n.mask.numBytes);if(-32768!==s||u<o.length)throw"Unexpected end of mask RLE encoding";n.mask.bitset=o,e+=n.mask.numBytes}else 0==(n.mask.numBytes|n.mask.numBlocksY|n.mask.maxValue)&&(n.mask.bitset=new Uint8Array(Math.ceil(n.width*n.height/8)));a=new DataView(t,e,16),n.pixels={},n.pixels.numBlocksY=a.getUint32(0,!0),n.pixels.numBlocksX=a.getUint32(4,!0),n.pixels.numBytes=a.getUint32(8,!0),n.pixels.maxValue=a.getFloat32(12,!0),e+=16;var h=n.pixels.numBlocksX,d=n.pixels.numBlocksY,f=h+(n.width%h>0?1:0),p=d+(n.height%d>0?1:0);n.pixels.blocks=new Array(f*p);for(var m=0,g=0;g<p;g++)for(var v=0;v<f;v++){var y=0,x=t.byteLength-e;a=new DataView(t,e,Math.min(10,x));var _={};n.pixels.blocks[m++]=_;var w=a.getUint8(0);if(y++,_.encoding=63&w,_.encoding>3)throw"Invalid block encoding ("+_.encoding+")";if(2!==_.encoding){if(0!==w&&2!==w){if(w>>=6,_.offsetType=w,2===w)_.offset=a.getInt8(1),y++;else if(1===w)_.offset=a.getInt16(1,!0),y+=2;else{if(0!==w)throw"Invalid block offset type";_.offset=a.getFloat32(1,!0),y+=4}if(1===_.encoding)if(w=a.getUint8(y),y++,_.bitsPerPixel=63&w,w>>=6,_.numValidPixelsType=w,2===w)_.numValidPixels=a.getUint8(y),y++;else if(1===w)_.numValidPixels=a.getUint16(y,!0),y+=2;else{if(0!==w)throw"Invalid valid pixel count type";_.numValidPixels=a.getUint32(y,!0),y+=4}}var b;if(e+=y,3!==_.encoding)if(0===_.encoding){var M=(n.pixels.numBytes-1)/4;if(M!==Math.floor(M))throw"uncompressed block has invalid length";b=new ArrayBuffer(4*M),new Uint8Array(b).set(new Uint8Array(t,e,4*M));var S=new Float32Array(b);_.rawData=S,e+=4*M}else if(1===_.encoding){var T=Math.ceil(_.numValidPixels*_.bitsPerPixel/8),E=Math.ceil(T/4);b=new ArrayBuffer(4*E),new Uint8Array(b).set(new Uint8Array(t,e,T)),_.stuffedData=new Uint32Array(b),e+=T}}else e++}return n.eofOffset=e,n},o=function(t,e,r,n,i,a,o){var s,l,u,c=(1<<e)-1,h=0,d=0,f=Math.ceil((o-n)/i),p=4*t.length-Math.ceil(e*r/8);for(t[t.length-1]<<=8*p,s=0;s<r;s++){if(0===d&&(u=t[h++],d=32),d>=e)l=u>>>d-e&c,d-=e;else{var m=e-d;l=(u&c)<<m&c,l+=(u=t[h++])>>>(d=32-m)}a[s]=l<f?n+l*i:o}return a},e),y=(s=function(t,e,r,n,i,a,o,s){var l,u,c,h,d,f=(1<<r)-1,p=0,m=0,g=4*t.length-Math.ceil(r*n/8);if(t[t.length-1]<<=8*g,i)for(l=0;l<n;l++)0===m&&(c=t[p++],m=32),m>=r?(u=c>>>m-r&f,m-=r):(u=(c&f)<<(h=r-m)&f,u+=(c=t[p++])>>>(m=32-h)),e[l]=i[u];else for(d=Math.ceil((s-a)/o),l=0;l<n;l++)0===m&&(c=t[p++],m=32),m>=r?(u=c>>>m-r&f,m-=r):(u=(c&f)<<(h=r-m)&f,u+=(c=t[p++])>>>(m=32-h)),e[l]=u<d?a+u*o:s},l=function(t,e,r,n,i,a){var o,s=(1<<e)-1,l=0,u=0,c=0,h=0,d=0,f=[],p=4*t.length-Math.ceil(e*r/8);t[t.length-1]<<=8*p;var m=Math.ceil((a-n)/i);for(u=0;u<r;u++)0===h&&(o=t[l++],h=32),h>=e?(d=o>>>h-e&s,h-=e):(d=(o&s)<<(c=e-h)&s,d+=(o=t[l++])>>>(h=32-c)),f[u]=d<m?n+d*i:a;return f.unshift(n),f},u=function(t,e,r,n,i,a,o,s){var l,u,c,h,d=(1<<r)-1,f=0,p=0,m=0;if(i)for(l=0;l<n;l++)0===p&&(c=t[f++],p=32,m=0),p>=r?(u=c>>>m&d,p-=r,m+=r):(u=c>>>m&d,p=32-(h=r-p),u|=((c=t[f++])&(1<<h)-1)<<r-h,m=h),e[l]=i[u];else{var g=Math.ceil((s-a)/o);for(l=0;l<n;l++)0===p&&(c=t[f++],p=32,m=0),p>=r?(u=c>>>m&d,p-=r,m+=r):(u=c>>>m&d,p=32-(h=r-p),u|=((c=t[f++])&(1<<h)-1)<<r-h,m=h),e[l]=u<g?a+u*o:s}return e},c=function(t,e,r,n,i,a){var o,s=(1<<e)-1,l=0,u=0,c=0,h=0,d=0,f=0,p=[],m=Math.ceil((a-n)/i);for(u=0;u<r;u++)0===h&&(o=t[l++],h=32,f=0),h>=e?(d=o>>>f&s,h-=e,f+=e):(d=o>>>f&s,h=32-(c=e-h),d|=((o=t[l++])&(1<<c)-1)<<e-c,f=c),p[u]=d<m?n+d*i:a;return p.unshift(n),p},h=function(t,e,r,n){var i,a,o,s,l=(1<<r)-1,u=0,c=0,h=4*t.length-Math.ceil(r*n/8);for(t[t.length-1]<<=8*h,i=0;i<n;i++)0===c&&(o=t[u++],c=32),c>=r?(a=o>>>c-r&l,c-=r):(a=(o&l)<<(s=r-c)&l,a+=(o=t[u++])>>>(c=32-s)),e[i]=a;return e},d=function(t,e,r,n){var i,a,o,s,l=(1<<r)-1,u=0,c=0,h=0;for(i=0;i<n;i++)0===c&&(o=t[u++],c=32,h=0),c>=r?(a=o>>>h&l,c-=r,h+=r):(a=o>>>h&l,c=32-(s=r-c),a|=((o=t[u++])&(1<<s)-1)<<r-s,h=s),e[i]=a;return e},f={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(t){for(var e=65535,r=65535,n=t.length,i=Math.floor(n/2),a=0;i;){var o=i>=359?359:i;i-=o;do{e+=t[a++]<<8,r+=e+=t[a++]}while(--o);e=(65535&e)+(e>>>16),r=(65535&r)+(r>>>16)}return 1&n&&(r+=e+=t[a]<<8),((r=(65535&r)+(r>>>16))<<16|(e=(65535&e)+(e>>>16)))>>>0},readHeaderInfo:function(t,e){var r=e.ptr,n=new Uint8Array(t,r,6),i={};if(i.fileIdentifierString=String.fromCharCode.apply(null,n),0!==i.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+i.fileIdentifierString;r+=6;var a,o=new DataView(t,r,8),s=o.getInt32(0,!0);if(i.fileVersion=s,r+=4,s>=3&&(i.checksum=o.getUint32(4,!0),r+=4),o=new DataView(t,r,12),i.height=o.getUint32(0,!0),i.width=o.getUint32(4,!0),r+=8,s>=4?(i.numDims=o.getUint32(8,!0),r+=4):i.numDims=1,o=new DataView(t,r,40),i.numValidPixel=o.getUint32(0,!0),i.microBlockSize=o.getInt32(4,!0),i.blobSize=o.getInt32(8,!0),i.imageType=o.getInt32(12,!0),i.maxZError=o.getFloat64(16,!0),i.zMin=o.getFloat64(24,!0),i.zMax=o.getFloat64(32,!0),r+=40,e.headerInfo=i,e.ptr=r,s>=3&&(a=s>=4?52:48,this.computeChecksumFletcher32(new Uint8Array(t,r-a,i.blobSize-14))!==i.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(t,e){var r=e.headerInfo,n=this.getDataTypeArray(r.imageType),i=r.numDims*this.getDataTypeSize(r.imageType),a=this.readSubArray(t,e.ptr,n,i),o=this.readSubArray(t,e.ptr+i,n,i);e.ptr+=2*i;var s,l=!0;for(s=0;s<r.numDims;s++)if(a[s]!==o[s]){l=!1;break}return r.minValues=a,r.maxValues=o,l},readSubArray:function(t,e,r,n){var i;if(r===Uint8Array)i=new Uint8Array(t,e,n);else{var a=new ArrayBuffer(n);new Uint8Array(a).set(new Uint8Array(t,e,n)),i=new r(a)}return i},readMask:function(t,e){var r,n,i=e.ptr,a=e.headerInfo,o=a.width*a.height,s=a.numValidPixel,l=new DataView(t,i,4),u={};if(u.numBytes=l.getUint32(0,!0),i+=4,(0===s||o===s)&&0!==u.numBytes)throw"invalid mask";if(0===s)r=new Uint8Array(Math.ceil(o/8)),u.bitset=r,n=new Uint8Array(o),e.pixels.resultMask=n,i+=u.numBytes;else if(u.numBytes>0){r=new Uint8Array(Math.ceil(o/8));var c=(l=new DataView(t,i,u.numBytes)).getInt16(0,!0),h=2,d=0,f=0;do{if(c>0)for(;c--;)r[d++]=l.getUint8(h++);else for(f=l.getUint8(h++),c=-c;c--;)r[d++]=f;c=l.getInt16(h,!0),h+=2}while(h<u.numBytes);if(-32768!==c||d<r.length)throw"Unexpected end of mask RLE encoding";n=new Uint8Array(o);var p=0,m=0;for(m=0;m<o;m++)7&m?(p=r[m>>3],p<<=7&m):p=r[m>>3],128&p&&(n[m]=1);e.pixels.resultMask=n,u.bitset=r,i+=u.numBytes}return e.ptr=i,e.mask=u,!0},readDataOneSweep:function(t,e,r,n){var i,a=e.ptr,o=e.headerInfo,s=o.numDims,l=o.width*o.height,u=o.imageType,c=o.numValidPixel*f.getDataTypeSize(u)*s,h=e.pixels.resultMask;if(r===Uint8Array)i=new Uint8Array(t,a,c);else{var d=new ArrayBuffer(c);new Uint8Array(d).set(new Uint8Array(t,a,c)),i=new r(d)}if(i.length===l*s)e.pixels.resultPixels=n?f.swapDimensionOrder(i,l,s,r,!0):i;else{e.pixels.resultPixels=new r(l*s);var p=0,m=0,g=0,v=0;if(s>1){if(n){for(m=0;m<l;m++)if(h[m])for(v=m,g=0;g<s;g++,v+=l)e.pixels.resultPixels[v]=i[p++]}else for(m=0;m<l;m++)if(h[m])for(v=m*s,g=0;g<s;g++)e.pixels.resultPixels[v+g]=i[p++]}else for(m=0;m<l;m++)h[m]&&(e.pixels.resultPixels[m]=i[p++])}return a+=c,e.ptr=a,!0},readHuffmanTree:function(t,e){var r=this.HUFFMAN_LUT_BITS_MAX,n=new DataView(t,e.ptr,16);if(e.ptr+=16,n.getInt32(0,!0)<2)throw"unsupported Huffman version";var i=n.getInt32(4,!0),a=n.getInt32(8,!0),o=n.getInt32(12,!0);if(a>=o)return!1;var s=new Uint32Array(o-a);f.decodeBits(t,e,s);var l,u,c,h,d=[];for(l=a;l<o;l++)d[u=l-(l<i?0:i)]={first:s[l-a],second:null};var m=t.byteLength-e.ptr,g=Math.ceil(m/4),v=new ArrayBuffer(4*g);new Uint8Array(v).set(new Uint8Array(t,e.ptr,m));var y,x=new Uint32Array(v),_=0,w=0;for(y=x[0],l=a;l<o;l++)(h=d[u=l-(l<i?0:i)].first)>0&&(d[u].second=y<<_>>>32-h,32-_>=h?32===(_+=h)&&(_=0,y=x[++w]):(_+=h-32,y=x[++w],d[u].second|=y>>>32-_));var b=0,M=0,S=new p;for(l=0;l<d.length;l++)void 0!==d[l]&&(b=Math.max(b,d[l].first));M=b>=r?r:b;var T,E,A,R,P,C=[];for(l=a;l<o;l++)if((h=d[u=l-(l<i?0:i)].first)>0)if(T=[h,u],h<=M)for(E=d[u].second<<M-h,A=1<<M-h,c=0;c<A;c++)C[E|c]=T;else for(E=d[u].second,P=S,R=h-1;R>=0;R--)E>>>R&1?(P.right||(P.right=new p),P=P.right):(P.left||(P.left=new p),P=P.left),0!==R||P.val||(P.val=T[1]);return{decodeLut:C,numBitsLUTQick:M,numBitsLUT:b,tree:S,stuffedData:x,srcPtr:w,bitPos:_}},readHuffman:function(t,e,r,n){var i,a,o,s,l,u,c,h,d,p=e.headerInfo.numDims,m=e.headerInfo.height,g=e.headerInfo.width,v=g*m,y=this.readHuffmanTree(t,e),x=y.decodeLut,_=y.tree,w=y.stuffedData,b=y.srcPtr,M=y.bitPos,S=y.numBitsLUTQick,T=y.numBitsLUT,E=0===e.headerInfo.imageType?128:0,A=e.pixels.resultMask,R=0;M>0&&(b++,M=0);var P,C=w[b],I=1===e.encodeMode,L=new r(v*p),O=L;if(p<2||I){for(P=0;P<p;P++)if(p>1&&(O=new r(L.buffer,v*P,v),R=0),e.headerInfo.numValidPixel===g*m)for(h=0,u=0;u<m;u++)for(c=0;c<g;c++,h++){if(a=0,l=s=C<<M>>>32-S,32-M<S&&(l=s|=w[b+1]>>>64-M-S),x[l])a=x[l][1],M+=x[l][0];else for(l=s=C<<M>>>32-T,32-M<T&&(l=s|=w[b+1]>>>64-M-T),i=_,d=0;d<T;d++)if(!(i=s>>>T-d-1&1?i.right:i.left).left&&!i.right){a=i.val,M=M+d+1;break}M>=32&&(M-=32,C=w[++b]),o=a-E,I?(o+=c>0?R:u>0?O[h-g]:R,o&=255,O[h]=o,R=o):O[h]=o}else for(h=0,u=0;u<m;u++)for(c=0;c<g;c++,h++)if(A[h]){if(a=0,l=s=C<<M>>>32-S,32-M<S&&(l=s|=w[b+1]>>>64-M-S),x[l])a=x[l][1],M+=x[l][0];else for(l=s=C<<M>>>32-T,32-M<T&&(l=s|=w[b+1]>>>64-M-T),i=_,d=0;d<T;d++)if(!(i=s>>>T-d-1&1?i.right:i.left).left&&!i.right){a=i.val,M=M+d+1;break}M>=32&&(M-=32,C=w[++b]),o=a-E,I?(c>0&&A[h-1]?o+=R:u>0&&A[h-g]?o+=O[h-g]:o+=R,o&=255,O[h]=o,R=o):O[h]=o}}else for(h=0,u=0;u<m;u++)for(c=0;c<g;c++)if(h=u*g+c,!A||A[h])for(P=0;P<p;P++,h+=v){if(a=0,l=s=C<<M>>>32-S,32-M<S&&(l=s|=w[b+1]>>>64-M-S),x[l])a=x[l][1],M+=x[l][0];else for(l=s=C<<M>>>32-T,32-M<T&&(l=s|=w[b+1]>>>64-M-T),i=_,d=0;d<T;d++)if(!(i=s>>>T-d-1&1?i.right:i.left).left&&!i.right){a=i.val,M=M+d+1;break}M>=32&&(M-=32,C=w[++b]),o=a-E,O[h]=o}e.ptr=e.ptr+4*(b+1)+(M>0?4:0),e.pixels.resultPixels=L,p>1&&!n&&(e.pixels.resultPixels=f.swapDimensionOrder(L,v,p,r))},decodeBits:function(t,e,r,n,i){var a=e.headerInfo,o=a.fileVersion,f=0,p=t.byteLength-e.ptr>=5?5:t.byteLength-e.ptr,m=new DataView(t,e.ptr,p),g=m.getUint8(0);f++;var v=g>>6,y=0===v?4:3-v,x=(32&g)>0,_=31&g,w=0;if(1===y)w=m.getUint8(f),f++;else if(2===y)w=m.getUint16(f,!0),f+=2;else{if(4!==y)throw"Invalid valid pixel count type";w=m.getUint32(f,!0),f+=4}var b,M,S,T,E,A,R,P,C,I=2*a.maxZError,L=a.numDims>1?a.maxValues[i]:a.zMax;if(x){for(e.counter.lut++,P=m.getUint8(f),f++,T=Math.ceil((P-1)*_/8),E=Math.ceil(T/4),M=new ArrayBuffer(4*E),S=new Uint8Array(M),e.ptr+=f,S.set(new Uint8Array(t,e.ptr,T)),R=new Uint32Array(M),e.ptr+=T,C=0;P-1>>>C;)C++;T=Math.ceil(w*C/8),E=Math.ceil(T/4),M=new ArrayBuffer(4*E),(S=new Uint8Array(M)).set(new Uint8Array(t,e.ptr,T)),b=new Uint32Array(M),e.ptr+=T,A=o>=3?c(R,_,P-1,n,I,L):l(R,_,P-1,n,I,L),o>=3?u(b,r,C,w,A):s(b,r,C,w,A)}else e.counter.bitstuffer++,C=_,e.ptr+=f,C>0&&(T=Math.ceil(w*C/8),E=Math.ceil(T/4),M=new ArrayBuffer(4*E),(S=new Uint8Array(M)).set(new Uint8Array(t,e.ptr,T)),b=new Uint32Array(M),e.ptr+=T,o>=3?null==n?d(b,r,C,w):u(b,r,C,w,!1,n,I,L):null==n?h(b,r,C,w):s(b,r,C,w,!1,n,I,L))},readTiles:function(t,e,r,n){var i=e.headerInfo,a=i.width,o=i.height,s=a*o,l=i.microBlockSize,u=i.imageType,c=f.getDataTypeSize(u),h=Math.ceil(a/l),d=Math.ceil(o/l);e.pixels.numBlocksY=d,e.pixels.numBlocksX=h,e.pixels.ptr=0;var p,m,g,v,y,x,_,w,b,M,S=0,T=0,E=0,A=0,R=0,P=0,C=0,I=0,L=0,O=0,D=0,k=0,F=0,N=0,U=0,B=new r(l*l),z=o%l||l,G=a%l||l,j=i.numDims,V=e.pixels.resultMask,H=e.pixels.resultPixels,W=i.fileVersion>=5?14:15,q=i.zMax;for(E=0;E<d;E++)for(R=E!==d-1?l:z,A=0;A<h;A++)for(O=E*a*l+A*l,D=a-(P=A!==h-1?l:G),w=0;w<j;w++){if(j>1?(M=H,O=E*a*l+A*l,H=new r(e.pixels.resultPixels.buffer,s*w*c,s),q=i.maxValues[w]):M=null,C=t.byteLength-e.ptr,m={},U=0,I=(p=new DataView(t,e.ptr,Math.min(10,C))).getUint8(0),U++,b=i.fileVersion>=5?4&I:0,L=I>>6&255,(I>>2&W)!=(A*l>>3&W))throw"integrity issue";if(b&&0===w)throw"integrity issue";if((y=3&I)>3)throw e.ptr+=U,"Invalid block encoding ("+y+")";if(2!==y)if(0===y){if(b)throw"integrity issue";if(e.counter.uncompressed++,e.ptr+=U,k=(k=R*P*c)<(F=t.byteLength-e.ptr)?k:F,g=new ArrayBuffer(k%c==0?k:k+c-k%c),new Uint8Array(g).set(new Uint8Array(t,e.ptr,k)),v=new r(g),N=0,V)for(S=0;S<R;S++){for(T=0;T<P;T++)V[O]&&(H[O]=v[N++]),O++;O+=D}else for(S=0;S<R;S++){for(T=0;T<P;T++)H[O++]=v[N++];O+=D}e.ptr+=N*c}else if(x=f.getDataTypeUsed(b&&u<6?4:u,L),_=f.getOnePixel(m,U,x,p),U+=f.getDataTypeSize(x),3===y)if(e.ptr+=U,e.counter.constantoffset++,V)for(S=0;S<R;S++){for(T=0;T<P;T++)V[O]&&(H[O]=b?Math.min(q,M[O]+_):_),O++;O+=D}else for(S=0;S<R;S++){for(T=0;T<P;T++)H[O]=b?Math.min(q,M[O]+_):_,O++;O+=D}else if(e.ptr+=U,f.decodeBits(t,e,B,_,w),U=0,b)if(V)for(S=0;S<R;S++){for(T=0;T<P;T++)V[O]&&(H[O]=B[U++]+M[O]),O++;O+=D}else for(S=0;S<R;S++){for(T=0;T<P;T++)H[O]=B[U++]+M[O],O++;O+=D}else if(V)for(S=0;S<R;S++){for(T=0;T<P;T++)V[O]&&(H[O]=B[U++]),O++;O+=D}else for(S=0;S<R;S++){for(T=0;T<P;T++)H[O++]=B[U++];O+=D}else{if(b)if(V)for(S=0;S<R;S++)for(T=0;T<P;T++)V[O]&&(H[O]=M[O]),O++;else for(S=0;S<R;S++)for(T=0;T<P;T++)H[O]=M[O],O++;e.counter.constant++,e.ptr+=U}}j>1&&!n&&(e.pixels.resultPixels=f.swapDimensionOrder(e.pixels.resultPixels,s,j,r))},formatFileInfo:function(t){return{fileIdentifierString:t.headerInfo.fileIdentifierString,fileVersion:t.headerInfo.fileVersion,imageType:t.headerInfo.imageType,height:t.headerInfo.height,width:t.headerInfo.width,numValidPixel:t.headerInfo.numValidPixel,microBlockSize:t.headerInfo.microBlockSize,blobSize:t.headerInfo.blobSize,maxZError:t.headerInfo.maxZError,pixelType:f.getPixelType(t.headerInfo.imageType),eofOffset:t.eofOffset,mask:t.mask?{numBytes:t.mask.numBytes}:null,pixels:{numBlocksX:t.pixels.numBlocksX,numBlocksY:t.pixels.numBlocksY,maxValue:t.headerInfo.zMax,minValue:t.headerInfo.zMin,noDataValue:t.noDataValue}}},constructConstantSurface:function(t,e){var r=t.headerInfo.zMax,n=t.headerInfo.zMin,i=t.headerInfo.maxValues,a=t.headerInfo.numDims,o=t.headerInfo.height*t.headerInfo.width,s=0,l=0,u=0,c=t.pixels.resultMask,h=t.pixels.resultPixels;if(c)if(a>1){if(e)for(s=0;s<a;s++)for(u=s*o,r=i[s],l=0;l<o;l++)c[l]&&(h[u+l]=r);else for(l=0;l<o;l++)if(c[l])for(u=l*a,s=0;s<a;s++)h[u+a]=i[s]}else for(l=0;l<o;l++)c[l]&&(h[l]=r);else if(a>1&&n!==r)if(e)for(s=0;s<a;s++)for(u=s*o,r=i[s],l=0;l<o;l++)h[u+l]=r;else for(l=0;l<o;l++)for(u=l*a,s=0;s<a;s++)h[u+s]=i[s];else for(l=0;l<o*a;l++)h[l]=r},getDataTypeArray:function(t){var e;switch(t){case 0:e=Int8Array;break;case 1:e=Uint8Array;break;case 2:e=Int16Array;break;case 3:e=Uint16Array;break;case 4:e=Int32Array;break;case 5:e=Uint32Array;break;case 6:default:e=Float32Array;break;case 7:e=Float64Array}return e},getPixelType:function(t){var e;switch(t){case 0:e="S8";break;case 1:e="U8";break;case 2:e="S16";break;case 3:e="U16";break;case 4:e="S32";break;case 5:e="U32";break;case 6:default:e="F32";break;case 7:e="F64"}return e},isValidPixelValue:function(t,e){if(null==e)return!1;var r;switch(t){case 0:r=e>=-128&&e<=127;break;case 1:r=e>=0&&e<=255;break;case 2:r=e>=-32768&&e<=32767;break;case 3:r=e>=0&&e<=65536;break;case 4:r=e>=-2147483648&&e<=2147483647;break;case 5:r=e>=0&&e<=4294967296;break;case 6:r=e>=-34027999387901484e22&&e<=34027999387901484e22;break;case 7:r=e>=-17976931348623157e292&&e<=17976931348623157e292;break;default:r=!1}return r},getDataTypeSize:function(t){var e=0;switch(t){case 0:case 1:e=1;break;case 2:case 3:e=2;break;case 4:case 5:case 6:e=4;break;case 7:e=8;break;default:e=t}return e},getDataTypeUsed:function(t,e){var r=t;switch(t){case 2:case 4:r=t-e;break;case 3:case 5:r=t-2*e;break;case 6:r=0===e?t:1===e?2:1;break;case 7:r=0===e?t:t-2*e+1;break;default:r=t}return r},getOnePixel:function(t,e,r,n){var i=0;switch(r){case 0:i=n.getInt8(e);break;case 1:i=n.getUint8(e);break;case 2:i=n.getInt16(e,!0);break;case 3:i=n.getUint16(e,!0);break;case 4:i=n.getInt32(e,!0);break;case 5:i=n.getUInt32(e,!0);break;case 6:i=n.getFloat32(e,!0);break;case 7:i=n.getFloat64(e,!0);break;default:throw"the decoder does not understand this pixel type"}return i},swapDimensionOrder:function(t,e,r,n,i){var a=0,o=0,s=0,l=0,u=t;if(r>1)if(u=new n(e*r),i)for(a=0;a<e;a++)for(l=a,s=0;s<r;s++,l+=e)u[l]=t[o++];else for(a=0;a<e;a++)for(l=a,s=0;s<r;s++,l+=e)u[o++]=t[l];return u}},p=function(t,e,r){this.val=t,this.left=e,this.right=r},{decode:function(t,e){var r=(e=e||{}).noDataValue,n=0,i={};if(i.ptr=e.inputOffset||0,i.pixels={},f.readHeaderInfo(t,i)){var a=i.headerInfo,o=a.fileVersion,s=f.getDataTypeArray(a.imageType);if(o>5)throw"unsupported lerc version 2."+o;f.readMask(t,i),a.numValidPixel===a.width*a.height||i.pixels.resultMask||(i.pixels.resultMask=e.maskData);var l=a.width*a.height;i.pixels.resultPixels=new s(l*a.numDims),i.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var u,c=!e.returnPixelInterleavedDims;if(0!==a.numValidPixel)if(a.zMax===a.zMin)f.constructConstantSurface(i,c);else if(o>=4&&f.checkMinMaxRanges(t,i))f.constructConstantSurface(i,c);else{var h=new DataView(t,i.ptr,2),d=h.getUint8(0);if(i.ptr++,d)f.readDataOneSweep(t,i,s,c);else if(o>1&&a.imageType<=1&&Math.abs(a.maxZError-.5)<1e-5){var p=h.getUint8(1);if(i.ptr++,i.encodeMode=p,p>2||o<4&&p>1)throw"Invalid Huffman flag "+p;p?f.readHuffman(t,i,s,c):f.readTiles(t,i,s,c)}else f.readTiles(t,i,s,c)}i.eofOffset=i.ptr,e.inputOffset?(u=i.headerInfo.blobSize+e.inputOffset-i.ptr,Math.abs(u)>=1&&(i.eofOffset=e.inputOffset+i.headerInfo.blobSize)):(u=i.headerInfo.blobSize-i.ptr,Math.abs(u)>=1&&(i.eofOffset=i.headerInfo.blobSize));var m={width:a.width,height:a.height,pixelData:i.pixels.resultPixels,minValue:a.zMin,maxValue:a.zMax,validPixelCount:a.numValidPixel,dimCount:a.numDims,dimStats:{minValues:a.minValues,maxValues:a.maxValues},maskData:i.pixels.resultMask};if(i.pixels.resultMask&&f.isValidPixelValue(a.imageType,r)){var g=i.pixels.resultMask;for(n=0;n<l;n++)g[n]||(m.pixelData[n]=r);m.noDataValue=r}return i.noDataValue=r,e.returnFileInfo&&(m.fileInfo=f.formatFileInfo(i)),m}},getBandCount:function(t){for(var e=0,r=0,n={ptr:0,pixels:{}};r<t.byteLength-58;)f.readHeaderInfo(t,n),r+=n.headerInfo.blobSize,e++,n.ptr=r;return e}}),x=(m=new ArrayBuffer(4),g=new Uint8Array(m),new Uint32Array(m)[0]=1,1===g[0]),_={decode:function(t,e){if(!x)throw"Big endian system is not supported.";var r,n,i=(e=e||{}).inputOffset||0,a=new Uint8Array(t,i,10),o=String.fromCharCode.apply(null,a);if("CntZImage"===o.trim())r=v,n=1;else{if("Lerc2"!==o.substring(0,5))throw"Unexpected file identifier string: "+o;r=y,n=2}for(var s,l,u,c,h,d,f=0,p=t.byteLength-10,m=[],g={width:0,height:0,pixels:[],pixelType:e.pixelType,mask:null,statistics:[]},_=0;i<p;){var w=r.decode(t,{inputOffset:i,encodedMaskData:s,maskData:u,returnMask:0===f,returnEncodedMask:0===f,returnFileInfo:!0,returnPixelInterleavedDims:e.returnPixelInterleavedDims,pixelType:e.pixelType||null,noDataValue:e.noDataValue||null});i=w.fileInfo.eofOffset,u=w.maskData,0===f&&(s=w.encodedMaskData,g.width=w.width,g.height=w.height,g.dimCount=w.dimCount||1,g.pixelType=w.pixelType||w.fileInfo.pixelType,g.mask=u),n>1&&(u&&m.push(u),w.fileInfo.mask&&w.fileInfo.mask.numBytes>0&&_++),f++,g.pixels.push(w.pixelData),g.statistics.push({minValue:w.minValue,maxValue:w.maxValue,noDataValue:w.noDataValue,dimStats:w.dimStats})}if(n>1&&_>1){for(d=g.width*g.height,g.bandMasks=m,(u=new Uint8Array(d)).set(m[0]),c=1;c<m.length;c++)for(l=m[c],h=0;h<d;h++)u[h]=u[h]&l[h];g.maskData=u}return g}};t.exports?t.exports=_:this.Lerc=_}()}(JL)),KL)),n=t(XI()),i=FI();class a extends n.default{constructor(t){super(),this.planarConfiguration=void 0!==t.PlanarConfiguration?t.PlanarConfiguration:1,this.samplesPerPixel=void 0!==t.SamplesPerPixel?t.SamplesPerPixel:1,this.addCompression=t.LercParameters[i.LercParameters.AddCompression]}decodeBlock(t){switch(this.addCompression){case i.LercAddCompression.None:break;case i.LercAddCompression.Deflate:t=(0,e.inflate)(new Uint8Array(t)).buffer;break;default:throw new Error(`Unsupported LERC additional compression method identifier: ${this.addCompression}`)}return r.default.decode(t,{returnPixelInterleavedDims:1===this.planarConfiguration}).pixels[0].buffer}}return ZL.default=a,ZL}var $L,tO,eO={};function rO(){if(tO)return VI;tO=1;var t=af&&af.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),e=af&&af.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),r=af&&af.__importStar||function(r){if(r&&r.__esModule)return r;var n={};if(null!=r)for(var i in r)"default"!==i&&Object.prototype.hasOwnProperty.call(r,i)&&t(n,r,i);return e(n,r),n};Object.defineProperty(VI,"__esModule",{value:!0}),VI.getDecoder=VI.addDecoder=void 0;const n=new Map;function i(t,e){Array.isArray(t)||(t=[t]),t.forEach((t=>n.set(t,e)))}return VI.addDecoder=i,VI.getDecoder=async function(t){const e=n.get(t.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${t.Compression}`);return new(await e())(t)},i([void 0,1],(()=>Promise.resolve().then((()=>r(function(){if(jI)return HI;jI=1;var t=af&&af.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(HI,"__esModule",{value:!0});const e=t(XI());class r extends e.default{decodeBlock(t){return t}}return HI.default=r,HI}()))).then((t=>t.default)))),i(5,(()=>Promise.resolve().then((()=>r(KI()))).then((t=>t.default)))),i(6,(()=>{throw new Error("old style JPEG compression is not supported.")})),i(7,(()=>Promise.resolve().then((()=>r(function(){if(JI)return QI;JI=1;var t=af&&af.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(QI,"__esModule",{value:!0});const e=t(XI()),r=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),n=4017,i=799,a=3406,o=2276,s=1567,l=3784,u=5793,c=2896;function h(t,e){let r=0;const n=[];let i=16;for(;i>0&&!t[i-1];)--i;n.push({children:[],index:0});let a,o=n[0];for(let s=0;s<i;s++){for(let i=0;i<t[s];i++){for(o=n.pop(),o.children[o.index]=e[r];o.index>0;)o=n.pop();for(o.index++,n.push(o);n.length<=s;)n.push(a={children:[],index:0}),o.children[o.index]=a.children,o=a;r++}s+1<i&&(n.push(a={children:[],index:0}),o.children[o.index]=a.children,o=a)}return n[0].children}function d(t,e,n,i,a,o,s,l,u){const{mcusPerLine:c,progressive:h}=n,d=e;let f=e,p=0,m=0;function g(){if(m>0)return m--,p>>m&1;if(p=t[f++],255===p){const e=t[f++];if(e)throw new Error(`unexpected marker: ${(p<<8|e).toString(16)}`)}return m=7,p>>>7}function v(t){let e,r=t;for(;null!==(e=g());){if(r=r[e],"number"==typeof r)return r;if("object"!=typeof r)throw new Error("invalid huffman sequence")}return null}function y(t){let e=t,r=0;for(;e>0;){const t=g();if(null===t)return;r=r<<1|t,--e}return r}function x(t){const e=y(t);return e>=1<<t-1?e:e+(-1<<t)+1}let _,w=0,b=0;function M(t,e,r,n,i){const a=r%c,o=(r/c|0)*t.v+n,s=a*t.h+i;e(t,t.blocks[o][s])}function S(t,e,r){const n=r/t.blocksPerLine|0,i=r%t.blocksPerLine;e(t,t.blocks[n][i])}const T=i.length;let E,A,R,P,C,I;I=h?0===o?0===l?function(t,e){const r=v(t.huffmanTableDC),n=0===r?0:x(r)<<u;t.pred+=n,e[0]=t.pred}:function(t,e){e[0]|=g()<<u}:0===l?function(t,e){if(w>0)return void w--;let n=o;const i=s;for(;n<=i;){const i=v(t.huffmanTableAC),a=15&i,o=i>>4;if(0===a){if(o<15){w=y(o)+(1<<o)-1;break}n+=16}else n+=o,e[r[n]]=x(a)*(1<<u),n++}}:function(t,e){let n=o;const i=s;let a=0;for(;n<=i;){const i=r[n],o=e[i]<0?-1:1;switch(b){case 0:{const e=v(t.huffmanTableAC),r=15&e;if(a=e>>4,0===r)a<15?(w=y(a)+(1<<a),b=4):(a=16,b=1);else{if(1!==r)throw new Error("invalid ACn encoding");_=x(r),b=a?2:3}continue}case 1:case 2:e[i]?e[i]+=(g()<<u)*o:(a--,0===a&&(b=2===b?3:0));break;case 3:e[i]?e[i]+=(g()<<u)*o:(e[i]=_<<u,b=0);break;case 4:e[i]&&(e[i]+=(g()<<u)*o)}n++}4===b&&(w--,0===w&&(b=0))}:function(t,e){const n=v(t.huffmanTableDC),i=0===n?0:x(n);t.pred+=i,e[0]=t.pred;let a=1;for(;a<64;){const n=v(t.huffmanTableAC),i=15&n,o=n>>4;if(0===i){if(o<15)break;a+=16}else a+=o,e[r[a]]=x(i),a++}};let L,O,D=0;O=1===T?i[0].blocksPerLine*i[0].blocksPerColumn:c*n.mcusPerColumn;const k=a||O;for(;D<O;){for(A=0;A<T;A++)i[A].pred=0;if(w=0,1===T)for(E=i[0],C=0;C<k;C++)S(E,I,D),D++;else for(C=0;C<k;C++){for(A=0;A<T;A++){E=i[A];const{h:t,v:e}=E;for(R=0;R<e;R++)for(P=0;P<t;P++)M(E,I,D,R,P)}if(D++,D===O)break}if(m=0,L=t[f]<<8|t[f+1],L<65280)throw new Error("marker was not found");if(!(L>=65488&&L<=65495))break;f+=2}return f-d}function f(t,e){const r=[],{blocksPerLine:h,blocksPerColumn:d}=e,f=h<<3,p=new Int32Array(64),m=new Uint8Array(64);function g(t,r,h){const d=e.quantizationTable;let f,p,m,g,v,y,x,_,w;const b=h;let M;for(M=0;M<64;M++)b[M]=t[M]*d[M];for(M=0;M<8;++M){const t=8*M;0!==b[1+t]||0!==b[2+t]||0!==b[3+t]||0!==b[4+t]||0!==b[5+t]||0!==b[6+t]||0!==b[7+t]?(f=u*b[0+t]+128>>8,p=u*b[4+t]+128>>8,m=b[2+t],g=b[6+t],v=c*(b[1+t]-b[7+t])+128>>8,_=c*(b[1+t]+b[7+t])+128>>8,y=b[3+t]<<4,x=b[5+t]<<4,w=f-p+1>>1,f=f+p+1>>1,p=w,w=m*l+g*s+128>>8,m=m*s-g*l+128>>8,g=w,w=v-x+1>>1,v=v+x+1>>1,x=w,w=_+y+1>>1,y=_-y+1>>1,_=w,w=f-g+1>>1,f=f+g+1>>1,g=w,w=p-m+1>>1,p=p+m+1>>1,m=w,w=v*o+_*a+2048>>12,v=v*a-_*o+2048>>12,_=w,w=y*i+x*n+2048>>12,y=y*n-x*i+2048>>12,x=w,b[0+t]=f+_,b[7+t]=f-_,b[1+t]=p+x,b[6+t]=p-x,b[2+t]=m+y,b[5+t]=m-y,b[3+t]=g+v,b[4+t]=g-v):(w=u*b[0+t]+512>>10,b[0+t]=w,b[1+t]=w,b[2+t]=w,b[3+t]=w,b[4+t]=w,b[5+t]=w,b[6+t]=w,b[7+t]=w)}for(M=0;M<8;++M){const t=M;0!==b[8+t]||0!==b[16+t]||0!==b[24+t]||0!==b[32+t]||0!==b[40+t]||0!==b[48+t]||0!==b[56+t]?(f=u*b[0+t]+2048>>12,p=u*b[32+t]+2048>>12,m=b[16+t],g=b[48+t],v=c*(b[8+t]-b[56+t])+2048>>12,_=c*(b[8+t]+b[56+t])+2048>>12,y=b[24+t],x=b[40+t],w=f-p+1>>1,f=f+p+1>>1,p=w,w=m*l+g*s+2048>>12,m=m*s-g*l+2048>>12,g=w,w=v-x+1>>1,v=v+x+1>>1,x=w,w=_+y+1>>1,y=_-y+1>>1,_=w,w=f-g+1>>1,f=f+g+1>>1,g=w,w=p-m+1>>1,p=p+m+1>>1,m=w,w=v*o+_*a+2048>>12,v=v*a-_*o+2048>>12,_=w,w=y*i+x*n+2048>>12,y=y*n-x*i+2048>>12,x=w,b[0+t]=f+_,b[56+t]=f-_,b[8+t]=p+x,b[48+t]=p-x,b[16+t]=m+y,b[40+t]=m-y,b[24+t]=g+v,b[32+t]=g-v):(w=u*h[M+0]+8192>>14,b[0+t]=w,b[8+t]=w,b[16+t]=w,b[24+t]=w,b[32+t]=w,b[40+t]=w,b[48+t]=w,b[56+t]=w)}for(M=0;M<64;++M){const t=128+(b[M]+8>>4);r[M]=t<0?0:t>255?255:t}}for(let t=0;t<d;t++){const n=t<<3;for(let t=0;t<8;t++)r.push(new Uint8Array(f));for(let i=0;i<h;i++){g(e.blocks[t][i],m,p);let a=0;const o=i<<3;for(let t=0;t<8;t++){const e=r[n+t];for(let t=0;t<8;t++)e[o+t]=m[a++]}}}return r}class p{constructor(){this.jfif=null,this.adobe=null,this.quantizationTables=[],this.huffmanTablesAC=[],this.huffmanTablesDC=[],this.resetFrames()}resetFrames(){this.frames=[]}parse(t){let e=0;function n(){const r=t[e]<<8|t[e+1];return e+=2,r}function i(){const r=n(),i=t.subarray(e,e+r-2);return e+=i.length,i}function a(t){let e,r,n=0,i=0;for(r in t.components)t.components.hasOwnProperty(r)&&(e=t.components[r],n<e.h&&(n=e.h),i<e.v&&(i=e.v));const a=Math.ceil(t.samplesPerLine/8/n),o=Math.ceil(t.scanLines/8/i);for(r in t.components)if(t.components.hasOwnProperty(r)){e=t.components[r];const s=Math.ceil(Math.ceil(t.samplesPerLine/8)*e.h/n),l=Math.ceil(Math.ceil(t.scanLines/8)*e.v/i),u=a*e.h,c=o*e.v,h=[];for(let t=0;t<c;t++){const t=[];for(let e=0;e<u;e++)t.push(new Int32Array(64));h.push(t)}e.blocksPerLine=s,e.blocksPerColumn=l,e.blocks=h}t.maxH=n,t.maxV=i,t.mcusPerLine=a,t.mcusPerColumn=o}let o=n();if(65496!==o)throw new Error("SOI not found");for(o=n();65497!==o;){switch(o){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:{const t=i();65504===o&&74===t[0]&&70===t[1]&&73===t[2]&&70===t[3]&&0===t[4]&&(this.jfif={version:{major:t[5],minor:t[6]},densityUnits:t[7],xDensity:t[8]<<8|t[9],yDensity:t[10]<<8|t[11],thumbWidth:t[12],thumbHeight:t[13],thumbData:t.subarray(14,14+3*t[12]*t[13])}),65518===o&&65===t[0]&&100===t[1]&&111===t[2]&&98===t[3]&&101===t[4]&&0===t[5]&&(this.adobe={version:t[6],flags0:t[7]<<8|t[8],flags1:t[9]<<8|t[10],transformCode:t[11]});break}case 65499:{const i=n()+e-2;for(;e<i;){const i=t[e++],a=new Int32Array(64);if(i>>4==0)for(let n=0;n<64;n++)a[r[n]]=t[e++];else{if(i>>4!=1)throw new Error("DQT: invalid table spec");for(let t=0;t<64;t++)a[r[t]]=n()}this.quantizationTables[15&i]=a}break}case 65472:case 65473:case 65474:{n();const r={extended:65473===o,progressive:65474===o,precision:t[e++],scanLines:n(),samplesPerLine:n(),components:{},componentsOrder:[]},i=t[e++];let s;for(let n=0;n<i;n++){s=t[e];const n=t[e+1]>>4,i=15&t[e+1],a=t[e+2];r.componentsOrder.push(s),r.components[s]={h:n,v:i,quantizationIdx:a},e+=3}a(r),this.frames.push(r);break}case 65476:{const r=n();for(let n=2;n<r;){const r=t[e++],i=new Uint8Array(16);let a=0;for(let r=0;r<16;r++,e++)i[r]=t[e],a+=i[r];const o=new Uint8Array(a);for(let r=0;r<a;r++,e++)o[r]=t[e];n+=17+a,r>>4==0?this.huffmanTablesDC[15&r]=h(i,o):this.huffmanTablesAC[15&r]=h(i,o)}break}case 65501:n(),this.resetInterval=n();break;case 65498:{n();const r=t[e++],i=[],a=this.frames[0];for(let n=0;n<r;n++){const r=a.components[t[e++]],n=t[e++];r.huffmanTableDC=this.huffmanTablesDC[n>>4],r.huffmanTableAC=this.huffmanTablesAC[15&n],i.push(r)}const o=t[e++],s=t[e++],l=t[e++],u=d(t,e,a,i,this.resetInterval,o,s,l>>4,15&l);e+=u;break}case 65535:255!==t[e]&&e--;break;default:if(255===t[e-3]&&t[e-2]>=192&&t[e-2]<=254){e-=3;break}throw new Error(`unknown JPEG marker ${o.toString(16)}`)}o=n()}}getResult(){const{frames:t}=this;if(0===this.frames.length)throw new Error("no frames were decoded");this.frames.length>1&&console.warn("more than one frame is not supported");for(let t=0;t<this.frames.length;t++){const e=this.frames[t].components;for(const t of Object.keys(e))e[t].quantizationTable=this.quantizationTables[e[t].quantizationIdx],delete e[t].quantizationIdx}const e=t[0],{components:r,componentsOrder:n}=e,i=[],a=e.samplesPerLine,o=e.scanLines;for(let t=0;t<n.length;t++){const a=r[n[t]];i.push({lines:f(0,a),scaleX:a.h/e.maxH,scaleY:a.v/e.maxV})}const s=new Uint8Array(a*o*i.length);let l=0;for(let t=0;t<o;++t)for(let e=0;e<a;++e)for(let r=0;r<i.length;++r){const n=i[r];s[l]=n.lines[0|t*n.scaleY][0|e*n.scaleX],++l}return s}}class m extends e.default{constructor(t){super(),this.reader=new p,t.JPEGTables&&this.reader.parse(t.JPEGTables)}decodeBlock(t){return this.reader.resetFrames(),this.reader.parse(new Uint8Array(t)),this.reader.getResult().buffer}}return QI.default=m,QI}()))).then((t=>t.default)))),i([8,32946],(()=>Promise.resolve().then((()=>r(function(){if(BL)return uL;BL=1;var t=af&&af.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(uL,"__esModule",{value:!0});const e=HL(),r=t(XI());class n extends r.default{decodeBlock(t){return(0,e.inflate)(new Uint8Array(t)).buffer}}return uL.default=n,uL}()))).then((t=>t.default)))),i(32773,(()=>Promise.resolve().then((()=>r(function(){if(WL)return qL;WL=1;var t=af&&af.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(qL,"__esModule",{value:!0});const e=t(XI());class r extends e.default{decodeBlock(t){const e=new DataView(t),r=[];for(let n=0;n<t.byteLength;++n){let t=e.getInt8(n);if(t<0){const i=e.getUint8(n+1);t=-t;for(let e=0;e<=t;++e)r.push(i);n+=1}else{for(let i=0;i<=t;++i)r.push(e.getUint8(n+i+1));n+=t+1}}return new Uint8Array(r).buffer}}return qL.default=r,qL}()))).then((t=>t.default)))),i(34887,(()=>Promise.resolve().then((()=>r(QL()))).then((t=>t.default)))),i(50001,(()=>Promise.resolve().then((()=>r(function(){if($L)return eO;$L=1;var t=af&&af.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(eO,"__esModule",{value:!0});const e=t(XI());class r extends e.default{constructor(){if(super(),"undefined"==typeof createImageBitmap)throw new Error("Cannot decode WebImage as `createImageBitmap` is not available");if("undefined"==typeof document&&"undefined"==typeof OffscreenCanvas)throw new Error("Cannot decode WebImage as neither `document` nor `OffscreenCanvas` is not available")}async decode(t,e){const r=new Blob([e]),n=await createImageBitmap(r);let i;"undefined"!=typeof document?(i=document.createElement("canvas"),i.width=n.width,i.height=n.height):i=new OffscreenCanvas(n.width,n.height);const a=i.getContext("2d");return a.drawImage(n,0,0),a.getImageData(0,0,n.width,n.height).data.buffer}}return eO.default=r,eO}()))).then((t=>t.default)))),VI}var nO,iO,aO={};function oO(){if(iO)return zC;iO=1;var t=af&&af.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(zC,"__esModule",{value:!0});const e=pI(),r=t(function(){if(mI)return gI;function t(t,e,r){const n=r&&r.debug||!1;n&&console.log("getting "+e+" in "+t);const i="object"==typeof t?t.outer:t,a=`${e}\\="([^"]*)"`;n&&console.log("pattern:",a);const o=new RegExp(a).exec(i);if(n&&console.log("match:",o),o)return o[1]}return mI=1,vI.exports=t,gI.default=t,gI}()),n=t(function(){if(CI)return xI;CI=1;const t=OI();function e(e,r,n){const i=[],a=n&&n.debug||!1,o=!n||"boolean"!=typeof n.nested||n.nested;let s,l=n&&n.startIndex||0;for(;s=t(e,r,{debug:a,startIndex:l});)l=o?s.start+1+r.length:s.end,i.push(s);return a&&console.log("findTagsByName found",i.length,"tags"),i}return _I.exports=e,xI.default=e,xI}()),i=FI(),a=BI(),o=rO(),s=function(){if(nO)return aO;function t(t,e,r,n=1){return new(Object.getPrototypeOf(t).constructor)(e*r*n)}function e(e,r,n,i,a){const o=r/i,s=n/a;return e.map((e=>{const l=t(e,i,a);for(let t=0;t<a;++t){const a=Math.min(Math.round(s*t),n-1);for(let n=0;n<i;++n){const s=Math.min(Math.round(o*n),r-1),u=e[a*r+s];l[t*i+n]=u}}return l}))}function r(t,e,r){return(1-r)*t+r*e}function n(e,n,i,a,o){const s=n/a,l=i/o;return e.map((e=>{const u=t(e,a,o);for(let t=0;t<o;++t){const o=l*t,c=Math.floor(o),h=Math.min(Math.ceil(o),i-1);for(let i=0;i<a;++i){const l=s*i,d=l%1,f=Math.floor(l),p=Math.min(Math.ceil(l),n-1),m=e[c*n+f],g=e[c*n+p],v=e[h*n+f],y=e[h*n+p],x=r(r(m,g,d),r(v,y,d),o%1);u[t*a+i]=x}}return u}))}function i(e,r,n,i,a,o){const s=r/i,l=n/a,u=t(e,i,a,o);for(let t=0;t<a;++t){const a=Math.min(Math.round(l*t),n-1);for(let n=0;n<i;++n){const l=Math.min(Math.round(s*n),r-1);for(let s=0;s<o;++s){const c=e[a*r*o+l*o+s];u[t*i*o+n*o+s]=c}}}return u}function a(e,n,i,a,o,s){const l=n/a,u=i/o,c=t(e,a,o,s);for(let t=0;t<o;++t){const o=u*t,h=Math.floor(o),d=Math.min(Math.ceil(o),i-1);for(let i=0;i<a;++i){const u=l*i,f=u%1,p=Math.floor(u),m=Math.min(Math.ceil(u),n-1);for(let l=0;l<s;++l){const u=e[h*n*s+p*s+l],g=e[h*n*s+m*s+l],v=e[d*n*s+p*s+l],y=e[d*n*s+m*s+l],x=r(r(u,g,f),r(v,y,f),o%1);c[t*a*s+i*s+l]=x}}}return c}return nO=1,Object.defineProperty(aO,"__esModule",{value:!0}),aO.resampleInterleaved=aO.resampleBilinearInterleaved=aO.resampleNearestInterleaved=aO.resample=aO.resampleBilinear=aO.resampleNearest=void 0,aO.resampleNearest=e,aO.resampleBilinear=n,aO.resample=function(t,r,i,a,o,s="nearest"){switch(s.toLowerCase()){case"nearest":return e(t,r,i,a,o);case"bilinear":case"linear":return n(t,r,i,a,o);default:throw new Error(`Unsupported resampling method: '${s}'`)}},aO.resampleNearestInterleaved=i,aO.resampleBilinearInterleaved=a,aO.resampleInterleaved=function(t,e,r,n,o,s,l="nearest"){switch(l.toLowerCase()){case"nearest":return i(t,e,r,n,o,s);case"bilinear":case"linear":return a(t,e,r,n,o,s);default:throw new Error(`Unsupported resampling method: '${l}'`)}},aO}();function l(t,e,r){let n=0;for(let i=e;i<r;++i)n+=t[i];return n}function u(t,e,r){switch(t){case 1:if(e<=8)return new Uint8Array(r);if(e<=16)return new Uint16Array(r);if(e<=32)return new Uint32Array(r);break;case 2:if(8===e)return new Int8Array(r);if(16===e)return new Int16Array(r);if(32===e)return new Int32Array(r);break;case 3:switch(e){case 16:case 32:return new Float32Array(r);case 64:return new Float64Array(r)}}throw Error("Unsupported data format/bitsPerSample")}return zC.default=class{constructor(t,e,r,n,i,a){this.fileDirectory=t,this.geoKeys=e,this.dataView=r,this.littleEndian=n,this.tiles=i?{}:null,this.isTiled=!t.StripOffsets;const o=t.PlanarConfiguration;if(this.planarConfiguration=void 0===o?1:o,1!==this.planarConfiguration&&2!==this.planarConfiguration)throw new Error("Invalid planar configuration.");this.source=a}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return void 0!==this.fileDirectory.SamplesPerPixel?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:void 0!==this.fileDirectory.RowsPerStrip?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(t){return this.isTiled||(t+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-t*this.getTileHeight()}getBytesPerPixel(){let t=0;for(let e=0;e<this.fileDirectory.BitsPerSample.length;++e)t+=this.getSampleByteSize(e);return t}getSampleByteSize(t){if(t>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${t} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[t]/8)}getReaderForSample(t){const r=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1,n=this.fileDirectory.BitsPerSample[t];switch(r){case 1:if(n<=8)return DataView.prototype.getUint8;if(n<=16)return DataView.prototype.getUint16;if(n<=32)return DataView.prototype.getUint32;break;case 2:if(n<=8)return DataView.prototype.getInt8;if(n<=16)return DataView.prototype.getInt16;if(n<=32)return DataView.prototype.getInt32;break;case 3:switch(n){case 16:return function(t,r){return(0,e.getFloat16)(this,t,r)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(t=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1}getBitsPerSample(t=0){return this.fileDirectory.BitsPerSample[t]}getArrayForSample(t,e){return u(this.getSampleFormat(t),this.getBitsPerSample(t),e)}async getTileOrStrip(t,e,r,n,i){const a=Math.ceil(this.getWidth()/this.getTileWidth()),o=Math.ceil(this.getHeight()/this.getTileHeight());let s;const{tiles:l}=this;let c,h;1===this.planarConfiguration?s=e*a+t:2===this.planarConfiguration&&(s=r*a*o+e*a+t),this.isTiled?(c=this.fileDirectory.TileOffsets[s],h=this.fileDirectory.TileByteCounts[s]):(c=this.fileDirectory.StripOffsets[s],h=this.fileDirectory.StripByteCounts[s]);const d=(await this.source.fetch([{offset:c,length:h}],i))[0];let f;return null!==l&&l[s]?f=l[s]:(f=(async()=>{let t=await n.decode(this.fileDirectory,d);const r=this.getSampleFormat(),i=this.getBitsPerSample();return function(t,e){return(1!==t&&2!==t||!(e<=32)||e%8!=0)&&(3!==t||16!==e&&32!==e&&64!==e)}(r,i)&&(t=function(t,e,r,n,i,a,o){const s=new DataView(t),l=2===r?1:n,c=u(e,i,2===r?o*a:o*a*n),h=parseInt("1".repeat(i),2);if(1===e){let t;t=1===r?n*i:i;let e=a*t;0!=(7&e)&&(e=e+7&-8);for(let t=0;t<o;++t){const r=t*e;for(let e=0;e<a;++e){const n=r+e*l*i;for(let r=0;r<l;++r){const o=n+r*i,u=(t*a+e)*l+r,d=Math.floor(o/8),f=o%8;if(f+i<=8)c[u]=s.getUint8(d)>>8-i-f&h;else if(f+i<=16)c[u]=s.getUint16(d)>>16-i-f&h;else if(f+i<=24){const t=s.getUint16(d)<<8|s.getUint8(d+2);c[u]=t>>24-i-f&h}else c[u]=s.getUint32(d)>>32-i-f&h}}}}return c.buffer}(t,r,this.planarConfiguration,this.getSamplesPerPixel(),i,this.getTileWidth(),this.getBlockHeight(e))),t})(),null!==l&&(l[s]=f)),{x:t,y:e,sample:r,data:await f}}async _readRaster(t,e,r,n,i,a,o,u,c){const h=this.getTileWidth(),d=this.getTileHeight(),f=this.getWidth(),p=this.getHeight(),m=Math.max(Math.floor(t[0]/h),0),g=Math.min(Math.ceil(t[2]/h),Math.ceil(f/h)),v=Math.max(Math.floor(t[1]/d),0),y=Math.min(Math.ceil(t[3]/d),Math.ceil(p/d)),x=t[2]-t[0];let _=this.getBytesPerPixel();const w=[],b=[];for(let t=0;t<e.length;++t)1===this.planarConfiguration?w.push(l(this.fileDirectory.BitsPerSample,0,e[t])/8):w.push(0),b.push(this.getReaderForSample(e[t]));const M=[],{littleEndian:S}=this;for(let a=v;a<y;++a)for(let o=m;o<g;++o)for(let s=0;s<e.length;++s){const l=s,u=e[s];2===this.planarConfiguration&&(_=this.getSampleByteSize(s));const m=this.getTileOrStrip(o,a,u,i,c).then((i=>{const a=i.data,o=new DataView(a),s=this.getBlockHeight(i.y),u=i.y*d,c=i.x*h,m=u+s,g=(i.x+1)*h,v=b[l],y=Math.min(s,s-(m-t[3]),p-u),M=Math.min(h,h-(g-t[2]),f-c);for(let i=Math.max(0,t[1]-u);i<y;++i)for(let a=Math.max(0,t[0]-c);a<M;++a){const s=(i*h+a)*_,d=v.call(o,s+w[l],S);let f;n?(f=(i+u-t[1])*x*e.length+(a+c-t[0])*e.length+l,r[f]=d):(f=(i+u-t[1])*x+a+c-t[0],r[l][f]=d)}}));M.push(m)}if(await Promise.all(M),a&&t[2]-t[0]!==a||o&&t[3]-t[1]!==o){let i;return i=n?(0,s.resampleInterleaved)(r,t[2]-t[0],t[3]-t[1],a,o,e.length,u):(0,s.resample)(r,t[2]-t[0],t[3]-t[1],a,o,u),i.width=a,i.height=o,i}return r.width=a||t[2]-t[0],r.height=o||t[3]-t[1],r}async readRasters({window:t,samples:e=[],interleave:r,pool:n=null,width:i,height:a,resampleMethod:s,fillValue:l,signal:c}={}){const h=t||[0,0,this.getWidth(),this.getHeight()];if(h[0]>h[2]||h[1]>h[3])throw new Error("Invalid subsets");const d=(h[2]-h[0])*(h[3]-h[1]),f=this.getSamplesPerPixel();if(e&&e.length){for(let t=0;t<e.length;++t)if(e[t]>=f)return Promise.reject(new RangeError(`Invalid sample index '${e[t]}'.`))}else for(let t=0;t<f;++t)e.push(t);let p;if(r){p=u(this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,Math.max.apply(null,this.fileDirectory.BitsPerSample),d*e.length),l&&p.fill(l)}else{p=[];for(let t=0;t<e.length;++t){const r=this.getArrayForSample(e[t],d);Array.isArray(l)&&t<l.length?r.fill(l[t]):l&&!Array.isArray(l)&&r.fill(l),p.push(r)}}const m=n||await(0,o.getDecoder)(this.fileDirectory);return await this._readRaster(h,e,p,r,m,i,a,s,c)}async readRGB({window:t,interleave:e=!0,pool:r=null,width:n,height:o,resampleMethod:s,enableAlpha:l=!1,signal:u}={}){const c=t||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const h=this.fileDirectory.PhotometricInterpretation;if(h===i.photometricInterpretations.RGB){let a=[0,1,2];if(this.fileDirectory.ExtraSamples!==i.ExtraSamplesValues.Unspecified&&l){a=[];for(let t=0;t<this.fileDirectory.BitsPerSample.length;t+=1)a.push(t)}return this.readRasters({window:t,interleave:e,samples:a,pool:r,width:n,height:o,resampleMethod:s,signal:u})}let d;switch(h){case i.photometricInterpretations.WhiteIsZero:case i.photometricInterpretations.BlackIsZero:case i.photometricInterpretations.Palette:d=[0];break;case i.photometricInterpretations.CMYK:d=[0,1,2,3];break;case i.photometricInterpretations.YCbCr:case i.photometricInterpretations.CIELab:d=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const f={window:c,interleave:!0,samples:d,pool:r,width:n,height:o,resampleMethod:s,signal:u},{fileDirectory:p}=this,m=await this.readRasters(f),g=2**this.fileDirectory.BitsPerSample[0];let v;switch(h){case i.photometricInterpretations.WhiteIsZero:v=(0,a.fromWhiteIsZero)(m,g);break;case i.photometricInterpretations.BlackIsZero:v=(0,a.fromBlackIsZero)(m,g);break;case i.photometricInterpretations.Palette:v=(0,a.fromPalette)(m,p.ColorMap);break;case i.photometricInterpretations.CMYK:v=(0,a.fromCMYK)(m);break;case i.photometricInterpretations.YCbCr:v=(0,a.fromYCbCr)(m);break;case i.photometricInterpretations.CIELab:v=(0,a.fromCIELab)(m);break;default:throw new Error("Unsupported photometric interpretation.")}if(!e){const t=new Uint8Array(v.length/3),e=new Uint8Array(v.length/3),r=new Uint8Array(v.length/3);for(let n=0,i=0;n<v.length;n+=3,++i)t[i]=v[n],e[i]=v[n+1],r[i]=v[n+2];v=[t,e,r]}return v.width=m.width,v.height=m.height,v}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const t=[];for(let e=0;e<this.fileDirectory.ModelTiepoint.length;e+=6)t.push({i:this.fileDirectory.ModelTiepoint[e],j:this.fileDirectory.ModelTiepoint[e+1],k:this.fileDirectory.ModelTiepoint[e+2],x:this.fileDirectory.ModelTiepoint[e+3],y:this.fileDirectory.ModelTiepoint[e+4],z:this.fileDirectory.ModelTiepoint[e+5]});return t}getGDALMetadata(t=null){const e={};if(!this.fileDirectory.GDAL_METADATA)return null;const i=this.fileDirectory.GDAL_METADATA;let a=(0,n.default)(i,"Item");a=null===t?a.filter((t=>void 0===(0,r.default)(t,"sample"))):a.filter((e=>Number((0,r.default)(e,"sample"))===t));for(let t=0;t<a.length;++t){const n=a[t];e[(0,r.default)(n,"name")]=n.inner}return e}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const t=this.fileDirectory.GDAL_NODATA;return Number(t.substring(0,t.length-1))}getOrigin(){const t=this.fileDirectory.ModelTiepoint,e=this.fileDirectory.ModelTransformation;if(t&&6===t.length)return[t[3],t[4],t[5]];if(e)return[e[3],e[7],e[11]];throw new Error("The image does not have an affine transformation.")}getResolution(t=null){const e=this.fileDirectory.ModelPixelScale,r=this.fileDirectory.ModelTransformation;if(e)return[e[0],-e[1],e[2]];if(r)return[r[0],r[5],r[10]];if(t){const[e,r,n]=t.getResolution();return[e*t.getWidth()/this.getWidth(),r*t.getHeight()/this.getHeight(),n*t.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return 1===this.geoKeys.GTRasterTypeGeoKey}getBoundingBox(){const t=this.getOrigin(),e=this.getResolution(),r=t[0],n=t[1],i=r+e[0]*this.getWidth(),a=n+e[1]*this.getHeight();return[Math.min(r,i),Math.min(n,a),Math.max(r,i),Math.max(n,a)]}},zC}var sO,lO={};var uO,cO={};var hO,dO,fO,pO,mO={},gO={};function vO(){if(fO)return gO;fO=1;var t=af&&af.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(gO,"__esModule",{value:!0}),gO.create=void 0;const e=t(dO?hO:(dO=1,hO=Worker));return gO.create=function(){const t='function e(e,t,r,n,i,a,o){try{var s=e[a](o),f=s.value}catch(e){return void r(e)}s.done?t(f):Promise.resolve(f).then(n,i)}function t(t){return function(){var r=this,n=arguments;return new Promise((function(i,a){var o=t.apply(r,n);function s(t){e(o,i,a,s,f,"next",t)}function f(t){e(o,i,a,s,f,"throw",t)}s(void 0)}))}}function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}var n={exports:{}};!function(e){var t=function(e){var t,n=Object.prototype,i=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",f=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i=t&&t.prototype instanceof y?t:y,a=Object.create(i.prototype),o=new T(n||[]);return a._invoke=function(e,t,r){var n=h;return function(i,a){if(n===p)throw new Error("Generator is already running");if(n===m){if("throw"===i)throw a;return E()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=I(o,r);if(s){if(s===v)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===h)throw n=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=p;var f=c(e,t,r);if("normal"===f.type){if(n=r.done?m:d,f.arg===v)continue;return{value:f.arg,done:r.done}}"throw"===f.type&&(n=m,r.method="throw",r.arg=f.arg)}}}(e,r,o),a}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var h="suspendedStart",d="suspendedYield",p="executing",m="completed",v={};function y(){}function w(){}function g(){}var b={};l(b,o,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(D([])));x&&x!==n&&i.call(x,o)&&(b=x);var _=g.prototype=y.prototype=Object.create(b);function A(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function P(e,t){function n(a,o,s,f){var l=c(e[a],e,o);if("throw"!==l.type){var u=l.arg,h=u.value;return h&&"object"===r(h)&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,s,f)}),(function(e){n("throw",e,s,f)})):t.resolve(h).then((function(e){u.value=e,s(u)}),(function(e){return n("throw",e,s,f)}))}f(l.arg)}var a;this._invoke=function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return a=a?a.then(i,i):i()}}function I(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,I(e,r),"throw"===r.method))return v;r.method="throw",r.arg=new TypeError("The iterator does not provide a \'throw\' method")}return v}var i=c(n,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function U(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(U,this),this.reset(!0)}function D(e){if(e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function r(){for(;++n<e.length;)if(i.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}return{next:E}}function E(){return{value:t,done:!0}}return w.prototype=g,l(_,"constructor",g),l(g,"constructor",w),w.displayName=l(g,f,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,l(e,f,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},A(P.prototype),l(P.prototype,s,(function(){return this})),e.AsyncIterator=P,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new P(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},A(_),l(_,f,"Generator"),l(_,o,(function(){return this})),l(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=D,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,i){return s.type="throw",s.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var f=i.call(o,"catchLoc"),l=i.call(o,"finallyLoc");if(f&&l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(f){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;S(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:D(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"===("undefined"==typeof globalThis?"undefined":r(globalThis))?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(n);var i=n.exports,a=new Map;function o(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){return a.set(e,t)}))}function s(e){return f.apply(this,arguments)}function f(){return(f=t(i.mark((function e(t){var r,n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.get(t.Compression)){e.next=3;break}throw new Error("Unknown compression method identifier: ".concat(t.Compression));case 3:return e.next=5,r();case 5:return n=e.sent,e.abrupt("return",new n(t));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}o([void 0,1],(function(){return Promise.resolve().then((function(){return _})).then((function(e){return e.default}))})),o(5,(function(){return Promise.resolve().then((function(){return S})).then((function(e){return e.default}))})),o(6,(function(){throw new Error("old style JPEG compression is not supported.")})),o(7,(function(){return Promise.resolve().then((function(){return L})).then((function(e){return e.default}))})),o([8,32946],(function(){return Promise.resolve().then((function(){return Ne})).then((function(e){return e.default}))})),o(32773,(function(){return Promise.resolve().then((function(){return Ye})).then((function(e){return e.default}))})),o(34887,(function(){return Promise.resolve().then((function(){return ut})).then((function(e){return e.default}))})),o(50001,(function(){return Promise.resolve().then((function(){return dt})).then((function(e){return e.default}))}));var l=globalThis;function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&c(e.prototype,t),r&&c(e,r),e}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}function m(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return e}(e)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}function y(e,t){var r=e.length-t,n=0;do{for(var i=t;i>0;i--)e[n+t]+=e[n],n++;r-=t}while(r>0)}function w(e,t,r){for(var n=0,i=e.length,a=i/r;i>t;){for(var o=t;o>0;--o)e[n+t]+=e[n],++n;i-=t}for(var s=e.slice(),f=0;f<a;++f)for(var l=0;l<r;++l)e[r*f+l]=s[(r-l-1)*a+f]}function g(e,t,r,n,i,a){if(!t||1===t)return e;for(var o=0;o<i.length;++o){if(i[o]%8!=0)throw new Error("When decoding with predictor, only multiple of 8 bits are supported.");if(i[o]!==i[0])throw new Error("When decoding with predictor, all samples must have the same size.")}for(var s=i[0]/8,f=2===a?1:i.length,l=0;l<n&&!(l*f*r*s>=e.byteLength);++l){var u=void 0;if(2===t){switch(i[0]){case 8:u=new Uint8Array(e,l*f*r*s,f*r*s);break;case 16:u=new Uint16Array(e,l*f*r*s,f*r*s/2);break;case 32:u=new Uint32Array(e,l*f*r*s,f*r*s/4);break;default:throw new Error("Predictor 2 not allowed with ".concat(i[0]," bits per sample."))}y(u,f)}else 3===t&&w(u=new Uint8Array(e,l*f*r*s,f*r*s),f,s)}return e}l.addEventListener("message",function(){var e=t(i.mark((function e(t){var r,n,a,o,f,u;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.data,n=r.id,a=r.fileDirectory,o=r.buffer,e.next=3,s(a);case 3:return f=e.sent,e.next=6,f.decode(a,o);case 6:u=e.sent,l.postMessage({decoded:u,id:n},[u]);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var b=function(){function e(){u(this,e)}var r;return h(e,[{key:"decode",value:(r=t(i.mark((function e(t,r){var n,a,o,s,f;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.decodeBlock(r);case 2:if(n=e.sent,1===(a=t.Predictor||1)){e.next=9;break}return o=!t.StripOffsets,s=o?t.TileWidth:t.ImageWidth,f=o?t.TileLength:t.RowsPerStrip||t.ImageLength,e.abrupt("return",g(n,a,s,f,t.BitsPerSample,t.PlanarConfiguration));case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})}]),e}();function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=v(e);if(t){var i=v(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m(this,r)}}var x=function(e){p(r,b);var t=k(r);function r(){return u(this,r),t.apply(this,arguments)}return h(r,[{key:"decodeBlock",value:function(e){return e}}]),r}(),_=Object.freeze({__proto__:null,default:x});function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=v(e);if(t){var i=v(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m(this,r)}}function P(e,t){for(var r=t.length-1;r>=0;r--)e.push(t[r]);return e}function I(e){for(var t=new Uint16Array(4093),r=new Uint8Array(4093),n=0;n<=257;n++)t[n]=4096,r[n]=n;var i=258,a=9,o=0;function s(){i=258,a=9}function f(e){var t=function(e,t,r){var n=t%8,i=Math.floor(t/8),a=8-n,o=t+r-8*(i+1),s=8*(i+2)-(t+r),f=8*(i+2)-t;if(s=Math.max(0,s),i>=e.length)return console.warn("ran off the end of the buffer before finding EOI_CODE (end on input code)"),257;var l=e[i]&Math.pow(2,8-n)-1,u=l<<=r-a;if(i+1<e.length){var c=e[i+1]>>>s;u+=c<<=Math.max(0,r-f)}if(o>8&&i+2<e.length){var h=8*(i+3)-(t+r);u+=e[i+2]>>>h}return u}(e,o,a);return o+=a,t}function l(e,n){return r[i]=n,t[i]=e,++i-1}function u(e){for(var n=[],i=e;4096!==i;i=t[i])n.push(r[i]);return n}var c=[];s();for(var h,d=new Uint8Array(e),p=f(d);257!==p;){if(256===p){for(s(),p=f(d);256===p;)p=f(d);if(257===p)break;if(p>256)throw new Error("corrupted code at scanline ".concat(p));P(c,u(p)),h=p}else if(p<i){var m=u(p);P(c,m),l(h,m[m.length-1]),h=p}else{var v=u(h);if(!v)throw new Error("Bogus entry. Not in dictionary, ".concat(h," / ").concat(i,", position: ").concat(o));P(c,v),c.push(v[v.length-1]),l(h,v[v.length-1]),h=p}i+1>=Math.pow(2,a)&&(12===a?h=void 0:a++),p=f(d)}return new Uint8Array(c)}var U=function(e){p(r,b);var t=A(r);function r(){return u(this,r),t.apply(this,arguments)}return h(r,[{key:"decodeBlock",value:function(e){return I(e).buffer}}]),r}(),S=Object.freeze({__proto__:null,default:U});function T(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=v(e);if(t){var i=v(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m(this,r)}}var D=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);function E(e,t){for(var r=0,n=[],i=16;i>0&&!e[i-1];)--i;n.push({children:[],index:0});for(var a,o=n[0],s=0;s<i;s++){for(var f=0;f<e[s];f++){for((o=n.pop()).children[o.index]=t[r];o.index>0;)o=n.pop();for(o.index++,n.push(o);n.length<=s;)n.push(a={children:[],index:0}),o.children[o.index]=a.children,o=a;r++}s+1<i&&(n.push(a={children:[],index:0}),o.children[o.index]=a.children,o=a)}return n[0].children}function B(e,t,n,i,a,o,s,f,l){var u=n.mcusPerLine,c=n.progressive,h=t,d=t,p=0,m=0;function v(){if(m>0)return m--,p>>m&1;if(255===(p=e[d++])){var t=e[d++];if(t)throw new Error("unexpected marker: ".concat((p<<8|t).toString(16)))}return m=7,p>>>7}function y(e){for(var t,n=e;null!==(t=v());){if("number"==typeof(n=n[t]))return n;if("object"!==r(n))throw new Error("invalid huffman sequence")}return null}function w(e){for(var t=e,r=0;t>0;){var n=v();if(null===n)return;r=r<<1|n,--t}return r}function g(e){var t=w(e);return t>=1<<e-1?t:t+(-1<<e)+1}var b=0;var k,x=0;function _(e,t,r,n,i){var a=r%u,o=(r/u|0)*e.v+n,s=a*e.h+i;t(e,e.blocks[o][s])}function A(e,t,r){var n=r/e.blocksPerLine|0,i=r%e.blocksPerLine;t(e,e.blocks[n][i])}var P,I,U,S,T,E,B=i.length;E=c?0===o?0===f?function(e,t){var r=y(e.huffmanTableDC),n=0===r?0:g(r)<<l;e.pred+=n,t[0]=e.pred}:function(e,t){t[0]|=v()<<l}:0===f?function(e,t){if(b>0)b--;else for(var r=o,n=s;r<=n;){var i=y(e.huffmanTableAC),a=15&i,f=i>>4;if(0===a){if(f<15){b=w(f)+(1<<f)-1;break}r+=16}else t[D[r+=f]]=g(a)*(1<<l),r++}}:function(e,t){for(var r=o,n=s,i=0;r<=n;){var a=D[r],f=t[a]<0?-1:1;switch(x){case 0:var u=y(e.huffmanTableAC),c=15&u;if(i=u>>4,0===c)i<15?(b=w(i)+(1<<i),x=4):(i=16,x=1);else{if(1!==c)throw new Error("invalid ACn encoding");k=g(c),x=i?2:3}continue;case 1:case 2:t[a]?t[a]+=(v()<<l)*f:0==--i&&(x=2===x?3:0);break;case 3:t[a]?t[a]+=(v()<<l)*f:(t[a]=k<<l,x=0);break;case 4:t[a]&&(t[a]+=(v()<<l)*f)}r++}4===x&&0==--b&&(x=0)}:function(e,t){var r=y(e.huffmanTableDC),n=0===r?0:g(r);e.pred+=n,t[0]=e.pred;for(var i=1;i<64;){var a=y(e.huffmanTableAC),o=15&a,s=a>>4;if(0===o){if(s<15)break;i+=16}else t[D[i+=s]]=g(o),i++}};var O,M,C=0;M=1===B?i[0].blocksPerLine*i[0].blocksPerColumn:u*n.mcusPerColumn;for(var L=a||M;C<M;){for(I=0;I<B;I++)i[I].pred=0;if(b=0,1===B)for(P=i[0],T=0;T<L;T++)A(P,E,C),C++;else for(T=0;T<L;T++){for(I=0;I<B;I++){var R=P=i[I],V=R.h,G=R.v;for(U=0;U<G;U++)for(S=0;S<V;S++)_(P,E,C,U,S)}if(++C===M)break}if(m=0,(O=e[d]<<8|e[d+1])<65280)throw new Error("marker was not found");if(!(O>=65488&&O<=65495))break;d+=2}return d-h}function O(e,t){var r=[],n=t.blocksPerLine,i=t.blocksPerColumn,a=n<<3,o=new Int32Array(64),s=new Uint8Array(64);function f(e,r,n){var i,a,o,s,f,l,u,c,h,d,p=t.quantizationTable,m=n;for(d=0;d<64;d++)m[d]=e[d]*p[d];for(d=0;d<8;++d){var v=8*d;0!==m[1+v]||0!==m[2+v]||0!==m[3+v]||0!==m[4+v]||0!==m[5+v]||0!==m[6+v]||0!==m[7+v]?(i=5793*m[0+v]+128>>8,a=5793*m[4+v]+128>>8,o=m[2+v],s=m[6+v],f=2896*(m[1+v]-m[7+v])+128>>8,c=2896*(m[1+v]+m[7+v])+128>>8,l=m[3+v]<<4,h=i-a+1>>1,i=i+a+1>>1,a=h,h=3784*o+1567*s+128>>8,o=1567*o-3784*s+128>>8,s=h,h=f-(u=m[5+v]<<4)+1>>1,f=f+u+1>>1,u=h,h=c+l+1>>1,l=c-l+1>>1,c=h,h=i-s+1>>1,i=i+s+1>>1,s=h,h=a-o+1>>1,a=a+o+1>>1,o=h,h=2276*f+3406*c+2048>>12,f=3406*f-2276*c+2048>>12,c=h,h=799*l+4017*u+2048>>12,l=4017*l-799*u+2048>>12,u=h,m[0+v]=i+c,m[7+v]=i-c,m[1+v]=a+u,m[6+v]=a-u,m[2+v]=o+l,m[5+v]=o-l,m[3+v]=s+f,m[4+v]=s-f):(h=5793*m[0+v]+512>>10,m[0+v]=h,m[1+v]=h,m[2+v]=h,m[3+v]=h,m[4+v]=h,m[5+v]=h,m[6+v]=h,m[7+v]=h)}for(d=0;d<8;++d){var y=d;0!==m[8+y]||0!==m[16+y]||0!==m[24+y]||0!==m[32+y]||0!==m[40+y]||0!==m[48+y]||0!==m[56+y]?(i=5793*m[0+y]+2048>>12,a=5793*m[32+y]+2048>>12,o=m[16+y],s=m[48+y],f=2896*(m[8+y]-m[56+y])+2048>>12,c=2896*(m[8+y]+m[56+y])+2048>>12,l=m[24+y],h=i-a+1>>1,i=i+a+1>>1,a=h,h=3784*o+1567*s+2048>>12,o=1567*o-3784*s+2048>>12,s=h,h=f-(u=m[40+y])+1>>1,f=f+u+1>>1,u=h,h=c+l+1>>1,l=c-l+1>>1,c=h,h=i-s+1>>1,i=i+s+1>>1,s=h,h=a-o+1>>1,a=a+o+1>>1,o=h,h=2276*f+3406*c+2048>>12,f=3406*f-2276*c+2048>>12,c=h,h=799*l+4017*u+2048>>12,l=4017*l-799*u+2048>>12,u=h,m[0+y]=i+c,m[56+y]=i-c,m[8+y]=a+u,m[48+y]=a-u,m[16+y]=o+l,m[40+y]=o-l,m[24+y]=s+f,m[32+y]=s-f):(h=5793*n[d+0]+8192>>14,m[0+y]=h,m[8+y]=h,m[16+y]=h,m[24+y]=h,m[32+y]=h,m[40+y]=h,m[48+y]=h,m[56+y]=h)}for(d=0;d<64;++d){var w=128+(m[d]+8>>4);r[d]=w<0?0:w>255?255:w}}for(var l=0;l<i;l++){for(var u=l<<3,c=0;c<8;c++)r.push(new Uint8Array(a));for(var h=0;h<n;h++){f(t.blocks[l][h],s,o);for(var d=0,p=h<<3,m=0;m<8;m++)for(var v=r[u+m],y=0;y<8;y++)v[p+y]=s[d++]}}return r}var M=function(){function e(){u(this,e),this.jfif=null,this.adobe=null,this.quantizationTables=[],this.huffmanTablesAC=[],this.huffmanTablesDC=[],this.resetFrames()}return h(e,[{key:"resetFrames",value:function(){this.frames=[]}},{key:"parse",value:function(e){var t=0;function r(){var r=e[t]<<8|e[t+1];return t+=2,r}function n(e){var t,r,n=0,i=0;for(r in e.components)e.components.hasOwnProperty(r)&&(n<(t=e.components[r]).h&&(n=t.h),i<t.v&&(i=t.v));var a=Math.ceil(e.samplesPerLine/8/n),o=Math.ceil(e.scanLines/8/i);for(r in e.components)if(e.components.hasOwnProperty(r)){t=e.components[r];for(var s=Math.ceil(Math.ceil(e.samplesPerLine/8)*t.h/n),f=Math.ceil(Math.ceil(e.scanLines/8)*t.v/i),l=a*t.h,u=o*t.v,c=[],h=0;h<u;h++){for(var d=[],p=0;p<l;p++)d.push(new Int32Array(64));c.push(d)}t.blocksPerLine=s,t.blocksPerColumn=f,t.blocks=c}e.maxH=n,e.maxV=i,e.mcusPerLine=a,e.mcusPerColumn=o}var i,a,o=r();if(65496!==o)throw new Error("SOI not found");for(o=r();65497!==o;){switch(o){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var s=(i=void 0,a=void 0,i=r(),a=e.subarray(t,t+i-2),t+=a.length,a);65504===o&&74===s[0]&&70===s[1]&&73===s[2]&&70===s[3]&&0===s[4]&&(this.jfif={version:{major:s[5],minor:s[6]},densityUnits:s[7],xDensity:s[8]<<8|s[9],yDensity:s[10]<<8|s[11],thumbWidth:s[12],thumbHeight:s[13],thumbData:s.subarray(14,14+3*s[12]*s[13])}),65518===o&&65===s[0]&&100===s[1]&&111===s[2]&&98===s[3]&&101===s[4]&&0===s[5]&&(this.adobe={version:s[6],flags0:s[7]<<8|s[8],flags1:s[9]<<8|s[10],transformCode:s[11]});break;case 65499:for(var f=r()+t-2;t<f;){var l=e[t++],u=new Int32Array(64);if(l>>4==0)for(var c=0;c<64;c++){u[D[c]]=e[t++]}else{if(l>>4!=1)throw new Error("DQT: invalid table spec");for(var h=0;h<64;h++){u[D[h]]=r()}}this.quantizationTables[15&l]=u}break;case 65472:case 65473:case 65474:r();for(var d={extended:65473===o,progressive:65474===o,precision:e[t++],scanLines:r(),samplesPerLine:r(),components:{},componentsOrder:[]},p=e[t++],m=void 0,v=0;v<p;v++){m=e[t];var y=e[t+1]>>4,w=15&e[t+1],g=e[t+2];d.componentsOrder.push(m),d.components[m]={h:y,v:w,quantizationIdx:g},t+=3}n(d),this.frames.push(d);break;case 65476:for(var b=r(),k=2;k<b;){for(var x=e[t++],_=new Uint8Array(16),A=0,P=0;P<16;P++,t++)_[P]=e[t],A+=_[P];for(var I=new Uint8Array(A),U=0;U<A;U++,t++)I[U]=e[t];k+=17+A,x>>4==0?this.huffmanTablesDC[15&x]=E(_,I):this.huffmanTablesAC[15&x]=E(_,I)}break;case 65501:r(),this.resetInterval=r();break;case 65498:r();for(var S=e[t++],T=[],O=this.frames[0],M=0;M<S;M++){var C=O.components[e[t++]],L=e[t++];C.huffmanTableDC=this.huffmanTablesDC[L>>4],C.huffmanTableAC=this.huffmanTablesAC[15&L],T.push(C)}var R=e[t++],V=e[t++],G=e[t++],F=B(e,t,O,T,this.resetInterval,R,V,G>>4,15&G);t+=F;break;case 65535:255!==e[t]&&t--;break;default:if(255===e[t-3]&&e[t-2]>=192&&e[t-2]<=254){t-=3;break}throw new Error("unknown JPEG marker ".concat(o.toString(16)))}o=r()}}},{key:"getResult",value:function(){var e=this.frames;if(0===this.frames.length)throw new Error("no frames were decoded");this.frames.length>1&&console.warn("more than one frame is not supported");for(var t=0;t<this.frames.length;t++)for(var r=this.frames[t].components,n=0,i=Object.keys(r);n<i.length;n++){var a=i[n];r[a].quantizationTable=this.quantizationTables[r[a].quantizationIdx],delete r[a].quantizationIdx}for(var o=e[0],s=o.components,f=o.componentsOrder,l=[],u=o.samplesPerLine,c=o.scanLines,h=0;h<f.length;h++){var d=s[f[h]];l.push({lines:O(0,d),scaleX:d.h/o.maxH,scaleY:d.v/o.maxV})}for(var p=new Uint8Array(u*c*l.length),m=0,v=0;v<c;++v)for(var y=0;y<u;++y)for(var w=0;w<l.length;++w){var g=l[w];p[m]=g.lines[0|v*g.scaleY][0|y*g.scaleX],++m}return p}}]),e}(),C=function(e){p(r,b);var t=T(r);function r(e){var n;return u(this,r),(n=t.call(this)).reader=new M,e.JPEGTables&&n.reader.parse(e.JPEGTables),n}return h(r,[{key:"decodeBlock",value:function(e){return this.reader.resetFrames(),this.reader.parse(new Uint8Array(e)),this.reader.getResult().buffer}}]),r}(),L=Object.freeze({__proto__:null,default:C});function R(e){for(var t=e.length;--t>=0;)e[t]=0}R(new Array(576)),R(new Array(60)),R(new Array(512)),R(new Array(256)),R(new Array(29)),R(new Array(30));var V=function(e,t,r,n){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==r;){r-=o=r>2e3?2e3:r;do{a=a+(i=i+t[n++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0},G=new Uint32Array(function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}()),F=function(e,t,r,n){var i=G,a=n+r;e^=-1;for(var o=n;o<a;o++)e=e>>>8^i[255&(e^t[o])];return-1^e},z={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},j={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},N=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},Z=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!==r(n))throw new TypeError(n+"must be non-object");for(var i in n)N(n,i)&&(e[i]=n[i])}}return e},K=function(e){for(var t=0,r=0,n=e.length;r<n;r++)t+=e[r].length;for(var i=new Uint8Array(t),a=0,o=0,s=e.length;a<s;a++){var f=e[a];i.set(f,o),o+=f.length}return i},H=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){H=!1}for(var Y=new Uint8Array(256),X=0;X<256;X++)Y[X]=X>=252?6:X>=248?5:X>=240?4:X>=224?3:X>=192?2:1;Y[254]=Y[254]=1;var W=function(e){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);var t,r,n,i,a,o=e.length,s=0;for(i=0;i<o;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<o&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(s),a=0,i=0;a<s;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<o&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?t[a++]=r:r<2048?(t[a++]=192|r>>>6,t[a++]=128|63&r):r<65536?(t[a++]=224|r>>>12,t[a++]=128|r>>>6&63,t[a++]=128|63&r):(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63,t[a++]=128|r>>>6&63,t[a++]=128|63&r);return t},q=function(e,t){var r,n,i=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));var a=new Array(2*i);for(n=0,r=0;r<i;){var o=e[r++];if(o<128)a[n++]=o;else{var s=Y[o];if(s>4)a[n++]=65533,r+=s-1;else{for(o&=2===s?31:3===s?15:7;s>1&&r<i;)o=o<<6|63&e[r++],s--;s>1?a[n++]=65533:o<65536?a[n++]=o:(o-=65536,a[n++]=55296|o>>10&1023,a[n++]=56320|1023&o)}}}return function(e,t){if(t<65534&&e.subarray&&H)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));for(var r="",n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r}(a,n)},J=function(e,t){(t=t||e.length)>e.length&&(t=e.length);for(var r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+Y[e[r]]>t?r:t};var Q=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},$=function(e,t){var r,n,i,a,o,s,f,l,u,c,h,d,p,m,v,y,w,g,b,k,x,_,A,P,I=e.state;r=e.next_in,A=e.input,n=r+(e.avail_in-5),i=e.next_out,P=e.output,a=i-(t-e.avail_out),o=i+(e.avail_out-257),s=I.dmax,f=I.wsize,l=I.whave,u=I.wnext,c=I.window,h=I.hold,d=I.bits,p=I.lencode,m=I.distcode,v=(1<<I.lenbits)-1,y=(1<<I.distbits)-1;e:do{d<15&&(h+=A[r++]<<d,d+=8,h+=A[r++]<<d,d+=8),w=p[h&v];t:for(;;){if(h>>>=g=w>>>24,d-=g,0===(g=w>>>16&255))P[i++]=65535&w;else{if(!(16&g)){if(0==(64&g)){w=p[(65535&w)+(h&(1<<g)-1)];continue t}if(32&g){I.mode=12;break e}e.msg="invalid literal/length code",I.mode=30;break e}b=65535&w,(g&=15)&&(d<g&&(h+=A[r++]<<d,d+=8),b+=h&(1<<g)-1,h>>>=g,d-=g),d<15&&(h+=A[r++]<<d,d+=8,h+=A[r++]<<d,d+=8),w=m[h&y];r:for(;;){if(h>>>=g=w>>>24,d-=g,!(16&(g=w>>>16&255))){if(0==(64&g)){w=m[(65535&w)+(h&(1<<g)-1)];continue r}e.msg="invalid distance code",I.mode=30;break e}if(k=65535&w,d<(g&=15)&&(h+=A[r++]<<d,(d+=8)<g&&(h+=A[r++]<<d,d+=8)),(k+=h&(1<<g)-1)>s){e.msg="invalid distance too far back",I.mode=30;break e}if(h>>>=g,d-=g,k>(g=i-a)){if((g=k-g)>l&&I.sane){e.msg="invalid distance too far back",I.mode=30;break e}if(x=0,_=c,0===u){if(x+=f-g,g<b){b-=g;do{P[i++]=c[x++]}while(--g);x=i-k,_=P}}else if(u<g){if(x+=f+u-g,(g-=u)<b){b-=g;do{P[i++]=c[x++]}while(--g);if(x=0,u<b){b-=g=u;do{P[i++]=c[x++]}while(--g);x=i-k,_=P}}}else if(x+=u-g,g<b){b-=g;do{P[i++]=c[x++]}while(--g);x=i-k,_=P}for(;b>2;)P[i++]=_[x++],P[i++]=_[x++],P[i++]=_[x++],b-=3;b&&(P[i++]=_[x++],b>1&&(P[i++]=_[x++]))}else{x=i-k;do{P[i++]=P[x++],P[i++]=P[x++],P[i++]=P[x++],b-=3}while(b>2);b&&(P[i++]=P[x++],b>1&&(P[i++]=P[x++]))}break}}break}}while(r<n&&i<o);r-=b=d>>3,h&=(1<<(d-=b<<3))-1,e.next_in=r,e.next_out=i,e.avail_in=r<n?n-r+5:5-(r-n),e.avail_out=i<o?o-i+257:257-(i-o),I.hold=h,I.bits=d},ee=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),te=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),re=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ne=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),ie=function(e,t,r,n,i,a,o,s){var f,l,u,c,h,d,p,m,v,y=s.bits,w=0,g=0,b=0,k=0,x=0,_=0,A=0,P=0,I=0,U=0,S=null,T=0,D=new Uint16Array(16),E=new Uint16Array(16),B=null,O=0;for(w=0;w<=15;w++)D[w]=0;for(g=0;g<n;g++)D[t[r+g]]++;for(x=y,k=15;k>=1&&0===D[k];k--);if(x>k&&(x=k),0===k)return i[a++]=20971520,i[a++]=20971520,s.bits=1,0;for(b=1;b<k&&0===D[b];b++);for(x<b&&(x=b),P=1,w=1;w<=15;w++)if(P<<=1,(P-=D[w])<0)return-1;if(P>0&&(0===e||1!==k))return-1;for(E[1]=0,w=1;w<15;w++)E[w+1]=E[w]+D[w];for(g=0;g<n;g++)0!==t[r+g]&&(o[E[t[r+g]]++]=g);if(0===e?(S=B=o,d=19):1===e?(S=ee,T-=257,B=te,O-=257,d=256):(S=re,B=ne,d=-1),U=0,g=0,w=b,h=a,_=x,A=0,u=-1,c=(I=1<<x)-1,1===e&&I>852||2===e&&I>592)return 1;for(;;){p=w-A,o[g]<d?(m=0,v=o[g]):o[g]>d?(m=B[O+o[g]],v=S[T+o[g]]):(m=96,v=0),f=1<<w-A,b=l=1<<_;do{i[h+(U>>A)+(l-=f)]=p<<24|m<<16|v|0}while(0!==l);for(f=1<<w-1;U&f;)f>>=1;if(0!==f?(U&=f-1,U+=f):U=0,g++,0==--D[w]){if(w===k)break;w=t[r+o[g]]}if(w>x&&(U&c)!==u){for(0===A&&(A=x),h+=b,P=1<<(_=w-A);_+A<k&&!((P-=D[_+A])<=0);)_++,P<<=1;if(I+=1<<_,1===e&&I>852||2===e&&I>592)return 1;i[u=U&c]=x<<24|_<<16|h-a|0}}return 0!==U&&(i[h+U]=w-A<<24|64<<16|0),s.bits=x,0},ae=j.Z_FINISH,oe=j.Z_BLOCK,se=j.Z_TREES,fe=j.Z_OK,le=j.Z_STREAM_END,ue=j.Z_NEED_DICT,ce=j.Z_STREAM_ERROR,he=j.Z_DATA_ERROR,de=j.Z_MEM_ERROR,pe=j.Z_BUF_ERROR,me=j.Z_DEFLATED,ve=function(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)};function ye(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var we,ge,be=function(e){if(!e||!e.state)return ce;var t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,fe},ke=function(e){if(!e||!e.state)return ce;var t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,be(e)},xe=function(e,t){var r;if(!e||!e.state)return ce;var n=e.state;return t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?ce:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,ke(e))},_e=function(e,t){if(!e)return ce;var r=new ye;e.state=r,r.window=null;var n=xe(e,t);return n!==fe&&(e.state=null),n},Ae=!0,Pe=function(e){if(Ae){we=new Int32Array(512),ge=new Int32Array(32);for(var t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ie(1,e.lens,0,288,we,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ie(2,e.lens,0,32,ge,0,e.work,{bits:5}),Ae=!1}e.lencode=we,e.lenbits=9,e.distcode=ge,e.distbits=5},Ie=function(e,t,r,n){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),n>=a.wsize?(a.window.set(t.subarray(r-a.wsize,r),0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>n&&(i=n),a.window.set(t.subarray(r-n,r-n+i),a.wnext),(n-=i)?(a.window.set(t.subarray(r-n,r),0),a.wnext=n,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0},Ue={inflateReset:ke,inflateReset2:xe,inflateResetKeep:be,inflateInit:function(e){return _e(e,15)},inflateInit2:_e,inflate:function(e,t){var r,n,i,a,o,s,f,l,u,c,h,d,p,m,v,y,w,g,b,k,x,_,A,P,I=0,U=new Uint8Array(4),S=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return ce;12===(r=e.state).mode&&(r.mode=13),o=e.next_out,i=e.output,f=e.avail_out,a=e.next_in,n=e.input,s=e.avail_in,l=r.hold,u=r.bits,c=s,h=f,_=fe;e:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;u<16;){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}if(2&r.wrap&&35615===l){r.check=0,U[0]=255&l,U[1]=l>>>8&255,r.check=F(r.check,U,2,0),l=0,u=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",r.mode=30;break}if((15&l)!==me){e.msg="unknown compression method",r.mode=30;break}if(u-=4,x=8+(15&(l>>>=4)),0===r.wbits)r.wbits=x;else if(x>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<r.wbits,e.adler=r.check=1,r.mode=512&l?10:12,l=0,u=0;break;case 2:for(;u<16;){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}if(r.flags=l,(255&r.flags)!==me){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=l>>8&1),512&r.flags&&(U[0]=255&l,U[1]=l>>>8&255,r.check=F(r.check,U,2,0)),l=0,u=0,r.mode=3;case 3:for(;u<32;){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}r.head&&(r.head.time=l),512&r.flags&&(U[0]=255&l,U[1]=l>>>8&255,U[2]=l>>>16&255,U[3]=l>>>24&255,r.check=F(r.check,U,4,0)),l=0,u=0,r.mode=4;case 4:for(;u<16;){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}r.head&&(r.head.xflags=255&l,r.head.os=l>>8),512&r.flags&&(U[0]=255&l,U[1]=l>>>8&255,r.check=F(r.check,U,2,0)),l=0,u=0,r.mode=5;case 5:if(1024&r.flags){for(;u<16;){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}r.length=l,r.head&&(r.head.extra_len=l),512&r.flags&&(U[0]=255&l,U[1]=l>>>8&255,r.check=F(r.check,U,2,0)),l=0,u=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((d=r.length)>s&&(d=s),d&&(r.head&&(x=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(a,a+d),x)),512&r.flags&&(r.check=F(r.check,n,d,a)),s-=d,a+=d,r.length-=d),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===s)break e;d=0;do{x=n[a+d++],r.head&&x&&r.length<65536&&(r.head.name+=String.fromCharCode(x))}while(x&&d<s);if(512&r.flags&&(r.check=F(r.check,n,d,a)),s-=d,a+=d,x)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===s)break e;d=0;do{x=n[a+d++],r.head&&x&&r.length<65536&&(r.head.comment+=String.fromCharCode(x))}while(x&&d<s);if(512&r.flags&&(r.check=F(r.check,n,d,a)),s-=d,a+=d,x)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;u<16;){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}if(l!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}l=0,u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;u<32;){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}e.adler=r.check=ve(l),l=0,u=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=o,e.avail_out=f,e.next_in=a,e.avail_in=s,r.hold=l,r.bits=u,ue;e.adler=r.check=1,r.mode=12;case 12:if(t===oe||t===se)break e;case 13:if(r.last){l>>>=7&u,u-=7&u,r.mode=27;break}for(;u<3;){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}switch(r.last=1&l,u-=1,3&(l>>>=1)){case 0:r.mode=14;break;case 1:if(Pe(r),r.mode=20,t===se){l>>>=2,u-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}l>>>=2,u-=2;break;case 14:for(l>>>=7&u,u-=7&u;u<32;){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&l,l=0,u=0,r.mode=15,t===se)break e;case 15:r.mode=16;case 16:if(d=r.length){if(d>s&&(d=s),d>f&&(d=f),0===d)break e;i.set(n.subarray(a,a+d),o),s-=d,a+=d,f-=d,o+=d,r.length-=d;break}r.mode=12;break;case 17:for(;u<14;){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}if(r.nlen=257+(31&l),l>>>=5,u-=5,r.ndist=1+(31&l),l>>>=5,u-=5,r.ncode=4+(15&l),l>>>=4,u-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;u<3;){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}r.lens[S[r.have++]]=7&l,l>>>=3,u-=3}for(;r.have<19;)r.lens[S[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,A={bits:r.lenbits},_=ie(0,r.lens,0,19,r.lencode,0,r.work,A),r.lenbits=A.bits,_){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;y=(I=r.lencode[l&(1<<r.lenbits)-1])>>>16&255,w=65535&I,!((v=I>>>24)<=u);){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}if(w<16)l>>>=v,u-=v,r.lens[r.have++]=w;else{if(16===w){for(P=v+2;u<P;){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}if(l>>>=v,u-=v,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}x=r.lens[r.have-1],d=3+(3&l),l>>>=2,u-=2}else if(17===w){for(P=v+3;u<P;){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}u-=v,x=0,d=3+(7&(l>>>=v)),l>>>=3,u-=3}else{for(P=v+7;u<P;){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}u-=v,x=0,d=11+(127&(l>>>=v)),l>>>=7,u-=7}if(r.have+d>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;d--;)r.lens[r.have++]=x}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,A={bits:r.lenbits},_=ie(1,r.lens,0,r.nlen,r.lencode,0,r.work,A),r.lenbits=A.bits,_){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,A={bits:r.distbits},_=ie(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,A),r.distbits=A.bits,_){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,t===se)break e;case 20:r.mode=21;case 21:if(s>=6&&f>=258){e.next_out=o,e.avail_out=f,e.next_in=a,e.avail_in=s,r.hold=l,r.bits=u,$(e,h),o=e.next_out,i=e.output,f=e.avail_out,a=e.next_in,n=e.input,s=e.avail_in,l=r.hold,u=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;y=(I=r.lencode[l&(1<<r.lenbits)-1])>>>16&255,w=65535&I,!((v=I>>>24)<=u);){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}if(y&&0==(240&y)){for(g=v,b=y,k=w;y=(I=r.lencode[k+((l&(1<<g+b)-1)>>g)])>>>16&255,w=65535&I,!(g+(v=I>>>24)<=u);){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}l>>>=g,u-=g,r.back+=g}if(l>>>=v,u-=v,r.back+=v,r.length=w,0===y){r.mode=26;break}if(32&y){r.back=-1,r.mode=12;break}if(64&y){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&y,r.mode=22;case 22:if(r.extra){for(P=r.extra;u<P;){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}r.length+=l&(1<<r.extra)-1,l>>>=r.extra,u-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;y=(I=r.distcode[l&(1<<r.distbits)-1])>>>16&255,w=65535&I,!((v=I>>>24)<=u);){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}if(0==(240&y)){for(g=v,b=y,k=w;y=(I=r.distcode[k+((l&(1<<g+b)-1)>>g)])>>>16&255,w=65535&I,!(g+(v=I>>>24)<=u);){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}l>>>=g,u-=g,r.back+=g}if(l>>>=v,u-=v,r.back+=v,64&y){e.msg="invalid distance code",r.mode=30;break}r.offset=w,r.extra=15&y,r.mode=24;case 24:if(r.extra){for(P=r.extra;u<P;){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}r.offset+=l&(1<<r.extra)-1,l>>>=r.extra,u-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===f)break e;if(d=h-f,r.offset>d){if((d=r.offset-d)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}d>r.wnext?(d-=r.wnext,p=r.wsize-d):p=r.wnext-d,d>r.length&&(d=r.length),m=r.window}else m=i,p=o-r.offset,d=r.length;d>f&&(d=f),f-=d,r.length-=d;do{i[o++]=m[p++]}while(--d);0===r.length&&(r.mode=21);break;case 26:if(0===f)break e;i[o++]=r.length,f--,r.mode=21;break;case 27:if(r.wrap){for(;u<32;){if(0===s)break e;s--,l|=n[a++]<<u,u+=8}if(h-=f,e.total_out+=h,r.total+=h,h&&(e.adler=r.check=r.flags?F(r.check,i,h,o-h):V(r.check,i,h,o-h)),h=f,(r.flags?l:ve(l))!==r.check){e.msg="incorrect data check",r.mode=30;break}l=0,u=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;u<32;){if(0===s)break e;s--,l+=n[a++]<<u,u+=8}if(l!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}l=0,u=0}r.mode=29;case 29:_=le;break e;case 30:_=he;break e;case 31:return de;default:return ce}return e.next_out=o,e.avail_out=f,e.next_in=a,e.avail_in=s,r.hold=l,r.bits=u,(r.wsize||h!==e.avail_out&&r.mode<30&&(r.mode<27||t!==ae))&&Ie(e,e.output,e.next_out,h-e.avail_out),c-=e.avail_in,h-=e.avail_out,e.total_in+=c,e.total_out+=h,r.total+=h,r.wrap&&h&&(e.adler=r.check=r.flags?F(r.check,i,h,e.next_out-h):V(r.check,i,h,e.next_out-h)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0===c&&0===h||t===ae)&&_===fe&&(_=pe),_},inflateEnd:function(e){if(!e||!e.state)return ce;var t=e.state;return t.window&&(t.window=null),e.state=null,fe},inflateGetHeader:function(e,t){if(!e||!e.state)return ce;var r=e.state;return 0==(2&r.wrap)?ce:(r.head=t,t.done=!1,fe)},inflateSetDictionary:function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?ce:11===r.mode&&V(1,t,n,0)!==r.check?he:Ie(e,t,n,n)?(r.mode=31,de):(r.havedict=1,fe):ce},inflateInfo:"pako inflate (from Nodeca project)"};var Se=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Te=Object.prototype.toString,De=j.Z_NO_FLUSH,Ee=j.Z_FINISH,Be=j.Z_OK,Oe=j.Z_STREAM_END,Me=j.Z_NEED_DICT,Ce=j.Z_STREAM_ERROR,Le=j.Z_DATA_ERROR,Re=j.Z_MEM_ERROR;function Ve(e){this.options=Z({chunkSize:65536,windowBits:15,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Q,this.strm.avail_out=0;var r=Ue.inflateInit2(this.strm,t.windowBits);if(r!==Be)throw new Error(z[r]);if(this.header=new Se,Ue.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=W(t.dictionary):"[object ArrayBuffer]"===Te.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Ue.inflateSetDictionary(this.strm,t.dictionary))!==Be))throw new Error(z[r])}function Ge(e,t){var r=new Ve(t);if(r.push(e),r.err)throw r.msg||z[r.err];return r.result}Ve.prototype.push=function(e,t){var r,n,i,a=this.strm,o=this.options.chunkSize,s=this.options.dictionary;if(this.ended)return!1;for(n=t===~~t?t:!0===t?Ee:De,"[object ArrayBuffer]"===Te.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(o),a.next_out=0,a.avail_out=o),(r=Ue.inflate(a,n))===Me&&s&&((r=Ue.inflateSetDictionary(a,s))===Be?r=Ue.inflate(a,n):r===Le&&(r=Me));a.avail_in>0&&r===Oe&&a.state.wrap>0&&0!==e[a.next_in];)Ue.inflateReset(a),r=Ue.inflate(a,n);switch(r){case Ce:case Le:case Me:case Re:return this.onEnd(r),this.ended=!0,!1}if(i=a.avail_out,a.next_out&&(0===a.avail_out||r===Oe))if("string"===this.options.to){var f=J(a.output,a.next_out),l=a.next_out-f,u=q(a.output,f);a.next_out=l,a.avail_out=o-l,l&&a.output.set(a.output.subarray(f,f+l),0),this.onData(u)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(r!==Be||0!==i){if(r===Oe)return r=Ue.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},Ve.prototype.onData=function(e){this.chunks.push(e)},Ve.prototype.onEnd=function(e){e===Be&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=K(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Fe={Inflate:Ve,inflate:Ge,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Ge(e,t)},ungzip:Ge,constants:j}.inflate;function ze(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=v(e);if(t){var i=v(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m(this,r)}}var je=function(e){p(r,b);var t=ze(r);function r(){return u(this,r),t.apply(this,arguments)}return h(r,[{key:"decodeBlock",value:function(e){return Fe(new Uint8Array(e)).buffer}}]),r}(),Ne=Object.freeze({__proto__:null,default:je});function Ze(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=v(e);if(t){var i=v(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m(this,r)}}var Ke,He=function(e){p(r,b);var t=Ze(r);function r(){return u(this,r),t.apply(this,arguments)}return h(r,[{key:"decodeBlock",value:function(e){for(var t=new DataView(e),r=[],n=0;n<e.byteLength;++n){var i=t.getInt8(n);if(i<0){var a=t.getUint8(n+1);i=-i;for(var o=0;o<=i;++o)r.push(a);n+=1}else{for(var s=0;s<=i;++s)r.push(t.getUint8(n+s+1));n+=i+1}}return new Uint8Array(r).buffer}}]),r}(),Ye=Object.freeze({__proto__:null,default:He}),Xe={exports:{}};Ke=Xe,\n/* Copyright 2015-2021 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 @preserve */\nfunction(){var e,t,r,n,i,a,o,s,f,l,u,c,h,d,p,m,v=(e={defaultNoDataValue:-34027999387901484e22,decode:function(a,o){var s=(o=o||{}).encodedMaskData||null===o.encodedMaskData,f=i(a,o.inputOffset||0,s),l=null!==o.noDataValue?o.noDataValue:e.defaultNoDataValue,u=t(f,o.pixelType||Float32Array,o.encodedMaskData,l,o.returnMask),c={width:f.width,height:f.height,pixelData:u.resultPixels,minValue:u.minValue,maxValue:f.pixels.maxValue,noDataValue:l};return u.resultMask&&(c.maskData=u.resultMask),o.returnEncodedMask&&f.mask&&(c.encodedMaskData=f.mask.bitset?f.mask.bitset:null),o.returnFileInfo&&(c.fileInfo=r(f),o.computeUsedBitDepths&&(c.fileInfo.bitDepths=n(f))),c}},t=function(e,t,r,n,i){var o,s,f,l=0,u=e.pixels.numBlocksX,c=e.pixels.numBlocksY,h=Math.floor(e.width/u),d=Math.floor(e.height/c),p=2*e.maxZError,m=Number.MAX_VALUE;r=r||(e.mask?e.mask.bitset:null),s=new t(e.width*e.height),i&&r&&(f=new Uint8Array(e.width*e.height));for(var v,y,w=new Float32Array(h*d),g=0;g<=c;g++){var b=g!==c?d:e.height%c;if(0!==b)for(var k=0;k<=u;k++){var x=k!==u?h:e.width%u;if(0!==x){var _,A,P,I,U=g*e.width*d+k*h,S=e.width-x,T=e.pixels.blocks[l];if(T.encoding<2?(0===T.encoding?_=T.rawData:(a(T.stuffedData,T.bitsPerPixel,T.numValidPixels,T.offset,p,w,e.pixels.maxValue),_=w),A=0):P=2===T.encoding?0:T.offset,r)for(y=0;y<b;y++){for(7&U&&(I=r[U>>3],I<<=7&U),v=0;v<x;v++)7&U||(I=r[U>>3]),128&I?(f&&(f[U]=1),m=m>(o=T.encoding<2?_[A++]:P)?o:m,s[U++]=o):(f&&(f[U]=0),s[U++]=n),I<<=1;U+=S}else if(T.encoding<2)for(y=0;y<b;y++){for(v=0;v<x;v++)m=m>(o=_[A++])?o:m,s[U++]=o;U+=S}else for(m=m>P?P:m,y=0;y<b;y++){for(v=0;v<x;v++)s[U++]=P;U+=S}if(1===T.encoding&&A!==T.numValidPixels)throw"Block and Mask do not match";l++}}}return{resultPixels:s,resultMask:f,minValue:m}},r=function(e){return{fileIdentifierString:e.fileIdentifierString,fileVersion:e.fileVersion,imageType:e.imageType,height:e.height,width:e.width,maxZError:e.maxZError,eofOffset:e.eofOffset,mask:e.mask?{numBlocksX:e.mask.numBlocksX,numBlocksY:e.mask.numBlocksY,numBytes:e.mask.numBytes,maxValue:e.mask.maxValue}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,numBytes:e.pixels.numBytes,maxValue:e.pixels.maxValue,noDataValue:e.noDataValue}}},n=function(e){for(var t=e.pixels.numBlocksX*e.pixels.numBlocksY,r={},n=0;n<t;n++){var i=e.pixels.blocks[n];0===i.encoding?r.float32=!0:1===i.encoding?r[i.bitsPerPixel]=!0:r[0]=!0}return Object.keys(r)},i=function(e,t,r){var n={},i=new Uint8Array(e,t,10);if(n.fileIdentifierString=String.fromCharCode.apply(null,i),"CntZImage"!==n.fileIdentifierString.trim())throw"Unexpected file identifier string: "+n.fileIdentifierString;t+=10;var a=new DataView(e,t,24);if(n.fileVersion=a.getInt32(0,!0),n.imageType=a.getInt32(4,!0),n.height=a.getUint32(8,!0),n.width=a.getUint32(12,!0),n.maxZError=a.getFloat64(16,!0),t+=24,!r)if(a=new DataView(e,t,16),n.mask={},n.mask.numBlocksY=a.getUint32(0,!0),n.mask.numBlocksX=a.getUint32(4,!0),n.mask.numBytes=a.getUint32(8,!0),n.mask.maxValue=a.getFloat32(12,!0),t+=16,n.mask.numBytes>0){var o=new Uint8Array(Math.ceil(n.width*n.height/8)),s=(a=new DataView(e,t,n.mask.numBytes)).getInt16(0,!0),f=2,l=0;do{if(s>0)for(;s--;)o[l++]=a.getUint8(f++);else{var u=a.getUint8(f++);for(s=-s;s--;)o[l++]=u}s=a.getInt16(f,!0),f+=2}while(f<n.mask.numBytes);if(-32768!==s||l<o.length)throw"Unexpected end of mask RLE encoding";n.mask.bitset=o,t+=n.mask.numBytes}else 0==(n.mask.numBytes|n.mask.numBlocksY|n.mask.maxValue)&&(n.mask.bitset=new Uint8Array(Math.ceil(n.width*n.height/8)));a=new DataView(e,t,16),n.pixels={},n.pixels.numBlocksY=a.getUint32(0,!0),n.pixels.numBlocksX=a.getUint32(4,!0),n.pixels.numBytes=a.getUint32(8,!0),n.pixels.maxValue=a.getFloat32(12,!0),t+=16;var c=n.pixels.numBlocksX,h=n.pixels.numBlocksY,d=c+(n.width%c>0?1:0),p=h+(n.height%h>0?1:0);n.pixels.blocks=new Array(d*p);for(var m=0,v=0;v<p;v++)for(var y=0;y<d;y++){var w=0,g=e.byteLength-t;a=new DataView(e,t,Math.min(10,g));var b={};n.pixels.blocks[m++]=b;var k=a.getUint8(0);if(w++,b.encoding=63&k,b.encoding>3)throw"Invalid block encoding ("+b.encoding+")";if(2!==b.encoding){if(0!==k&&2!==k){if(k>>=6,b.offsetType=k,2===k)b.offset=a.getInt8(1),w++;else if(1===k)b.offset=a.getInt16(1,!0),w+=2;else{if(0!==k)throw"Invalid block offset type";b.offset=a.getFloat32(1,!0),w+=4}if(1===b.encoding)if(k=a.getUint8(w),w++,b.bitsPerPixel=63&k,k>>=6,b.numValidPixelsType=k,2===k)b.numValidPixels=a.getUint8(w),w++;else if(1===k)b.numValidPixels=a.getUint16(w,!0),w+=2;else{if(0!==k)throw"Invalid valid pixel count type";b.numValidPixels=a.getUint32(w,!0),w+=4}}var x;if(t+=w,3!==b.encoding)if(0===b.encoding){var _=(n.pixels.numBytes-1)/4;if(_!==Math.floor(_))throw"uncompressed block has invalid length";x=new ArrayBuffer(4*_),new Uint8Array(x).set(new Uint8Array(e,t,4*_));var A=new Float32Array(x);b.rawData=A,t+=4*_}else if(1===b.encoding){var P=Math.ceil(b.numValidPixels*b.bitsPerPixel/8),I=Math.ceil(P/4);x=new ArrayBuffer(4*I),new Uint8Array(x).set(new Uint8Array(e,t,P)),b.stuffedData=new Uint32Array(x),t+=P}}else t++}return n.eofOffset=t,n},a=function(e,t,r,n,i,a,o){var s,f,l,u=(1<<t)-1,c=0,h=0,d=Math.ceil((o-n)/i),p=4*e.length-Math.ceil(t*r/8);for(e[e.length-1]<<=8*p,s=0;s<r;s++){if(0===h&&(l=e[c++],h=32),h>=t)f=l>>>h-t&u,h-=t;else{var m=t-h;f=(l&u)<<m&u,f+=(l=e[c++])>>>(h=32-m)}a[s]=f<d?n+f*i:o}return a},e),y=(o=function(e,t,r,n,i,a,o,s){var f,l,u,c,h,d=(1<<r)-1,p=0,m=0,v=4*e.length-Math.ceil(r*n/8);if(e[e.length-1]<<=8*v,i)for(f=0;f<n;f++)0===m&&(u=e[p++],m=32),m>=r?(l=u>>>m-r&d,m-=r):(l=(u&d)<<(c=r-m)&d,l+=(u=e[p++])>>>(m=32-c)),t[f]=i[l];else for(h=Math.ceil((s-a)/o),f=0;f<n;f++)0===m&&(u=e[p++],m=32),m>=r?(l=u>>>m-r&d,m-=r):(l=(u&d)<<(c=r-m)&d,l+=(u=e[p++])>>>(m=32-c)),t[f]=l<h?a+l*o:s},s=function(e,t,r,n,i,a){var o,s=(1<<t)-1,f=0,l=0,u=0,c=0,h=0,d=[],p=4*e.length-Math.ceil(t*r/8);e[e.length-1]<<=8*p;var m=Math.ceil((a-n)/i);for(l=0;l<r;l++)0===c&&(o=e[f++],c=32),c>=t?(h=o>>>c-t&s,c-=t):(h=(o&s)<<(u=t-c)&s,h+=(o=e[f++])>>>(c=32-u)),d[l]=h<m?n+h*i:a;return d.unshift(n),d},f=function(e,t,r,n,i,a,o,s){var f,l,u,c,h=(1<<r)-1,d=0,p=0,m=0;if(i)for(f=0;f<n;f++)0===p&&(u=e[d++],p=32,m=0),p>=r?(l=u>>>m&h,p-=r,m+=r):(l=u>>>m&h,p=32-(c=r-p),l|=((u=e[d++])&(1<<c)-1)<<r-c,m=c),t[f]=i[l];else{var v=Math.ceil((s-a)/o);for(f=0;f<n;f++)0===p&&(u=e[d++],p=32,m=0),p>=r?(l=u>>>m&h,p-=r,m+=r):(l=u>>>m&h,p=32-(c=r-p),l|=((u=e[d++])&(1<<c)-1)<<r-c,m=c),t[f]=l<v?a+l*o:s}return t},l=function(e,t,r,n,i,a){var o,s=(1<<t)-1,f=0,l=0,u=0,c=0,h=0,d=0,p=[],m=Math.ceil((a-n)/i);for(l=0;l<r;l++)0===c&&(o=e[f++],c=32,d=0),c>=t?(h=o>>>d&s,c-=t,d+=t):(h=o>>>d&s,c=32-(u=t-c),h|=((o=e[f++])&(1<<u)-1)<<t-u,d=u),p[l]=h<m?n+h*i:a;return p.unshift(n),p},u=function(e,t,r,n){var i,a,o,s,f=(1<<r)-1,l=0,u=0,c=4*e.length-Math.ceil(r*n/8);for(e[e.length-1]<<=8*c,i=0;i<n;i++)0===u&&(o=e[l++],u=32),u>=r?(a=o>>>u-r&f,u-=r):(a=(o&f)<<(s=r-u)&f,a+=(o=e[l++])>>>(u=32-s)),t[i]=a;return t},c=function(e,t,r,n){var i,a,o,s,f=(1<<r)-1,l=0,u=0,c=0;for(i=0;i<n;i++)0===u&&(o=e[l++],u=32,c=0),u>=r?(a=o>>>c&f,u-=r,c+=r):(a=o>>>c&f,u=32-(s=r-u),a|=((o=e[l++])&(1<<s)-1)<<r-s,c=s),t[i]=a;return t},h={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(e){for(var t=65535,r=65535,n=e.length,i=Math.floor(n/2),a=0;i;){var o=i>=359?359:i;i-=o;do{t+=e[a++]<<8,r+=t+=e[a++]}while(--o);t=(65535&t)+(t>>>16),r=(65535&r)+(r>>>16)}return 1&n&&(r+=t+=e[a]<<8),((r=(65535&r)+(r>>>16))<<16|(t=(65535&t)+(t>>>16)))>>>0},readHeaderInfo:function(e,t){var r=t.ptr,n=new Uint8Array(e,r,6),i={};if(i.fileIdentifierString=String.fromCharCode.apply(null,n),0!==i.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+i.fileIdentifierString;r+=6;var a,o=new DataView(e,r,8),s=o.getInt32(0,!0);if(i.fileVersion=s,r+=4,s>=3&&(i.checksum=o.getUint32(4,!0),r+=4),o=new DataView(e,r,12),i.height=o.getUint32(0,!0),i.width=o.getUint32(4,!0),r+=8,s>=4?(i.numDims=o.getUint32(8,!0),r+=4):i.numDims=1,o=new DataView(e,r,40),i.numValidPixel=o.getUint32(0,!0),i.microBlockSize=o.getInt32(4,!0),i.blobSize=o.getInt32(8,!0),i.imageType=o.getInt32(12,!0),i.maxZError=o.getFloat64(16,!0),i.zMin=o.getFloat64(24,!0),i.zMax=o.getFloat64(32,!0),r+=40,t.headerInfo=i,t.ptr=r,s>=3&&(a=s>=4?52:48,this.computeChecksumFletcher32(new Uint8Array(e,r-a,i.blobSize-14))!==i.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(e,t){var r=t.headerInfo,n=this.getDataTypeArray(r.imageType),i=r.numDims*this.getDataTypeSize(r.imageType),a=this.readSubArray(e,t.ptr,n,i),o=this.readSubArray(e,t.ptr+i,n,i);t.ptr+=2*i;var s,f=!0;for(s=0;s<r.numDims;s++)if(a[s]!==o[s]){f=!1;break}return r.minValues=a,r.maxValues=o,f},readSubArray:function(e,t,r,n){var i;if(r===Uint8Array)i=new Uint8Array(e,t,n);else{var a=new ArrayBuffer(n);new Uint8Array(a).set(new Uint8Array(e,t,n)),i=new r(a)}return i},readMask:function(e,t){var r,n,i=t.ptr,a=t.headerInfo,o=a.width*a.height,s=a.numValidPixel,f=new DataView(e,i,4),l={};if(l.numBytes=f.getUint32(0,!0),i+=4,(0===s||o===s)&&0!==l.numBytes)throw"invalid mask";if(0===s)r=new Uint8Array(Math.ceil(o/8)),l.bitset=r,n=new Uint8Array(o),t.pixels.resultMask=n,i+=l.numBytes;else if(l.numBytes>0){r=new Uint8Array(Math.ceil(o/8));var u=(f=new DataView(e,i,l.numBytes)).getInt16(0,!0),c=2,h=0,d=0;do{if(u>0)for(;u--;)r[h++]=f.getUint8(c++);else for(d=f.getUint8(c++),u=-u;u--;)r[h++]=d;u=f.getInt16(c,!0),c+=2}while(c<l.numBytes);if(-32768!==u||h<r.length)throw"Unexpected end of mask RLE encoding";n=new Uint8Array(o);var p=0,m=0;for(m=0;m<o;m++)7&m?(p=r[m>>3],p<<=7&m):p=r[m>>3],128&p&&(n[m]=1);t.pixels.resultMask=n,l.bitset=r,i+=l.numBytes}return t.ptr=i,t.mask=l,!0},readDataOneSweep:function(e,t,r,n){var i,a=t.ptr,o=t.headerInfo,s=o.numDims,f=o.width*o.height,l=o.imageType,u=o.numValidPixel*h.getDataTypeSize(l)*s,c=t.pixels.resultMask;if(r===Uint8Array)i=new Uint8Array(e,a,u);else{var d=new ArrayBuffer(u);new Uint8Array(d).set(new Uint8Array(e,a,u)),i=new r(d)}if(i.length===f*s)t.pixels.resultPixels=n?h.swapDimensionOrder(i,f,s,r,!0):i;else{t.pixels.resultPixels=new r(f*s);var p=0,m=0,v=0,y=0;if(s>1){if(n){for(m=0;m<f;m++)if(c[m])for(y=m,v=0;v<s;v++,y+=f)t.pixels.resultPixels[y]=i[p++]}else for(m=0;m<f;m++)if(c[m])for(y=m*s,v=0;v<s;v++)t.pixels.resultPixels[y+v]=i[p++]}else for(m=0;m<f;m++)c[m]&&(t.pixels.resultPixels[m]=i[p++])}return a+=u,t.ptr=a,!0},readHuffmanTree:function(e,t){var r=this.HUFFMAN_LUT_BITS_MAX,n=new DataView(e,t.ptr,16);if(t.ptr+=16,n.getInt32(0,!0)<2)throw"unsupported Huffman version";var i=n.getInt32(4,!0),a=n.getInt32(8,!0),o=n.getInt32(12,!0);if(a>=o)return!1;var s=new Uint32Array(o-a);h.decodeBits(e,t,s);var f,l,u,c,p=[];for(f=a;f<o;f++)p[l=f-(f<i?0:i)]={first:s[f-a],second:null};var m=e.byteLength-t.ptr,v=Math.ceil(m/4),y=new ArrayBuffer(4*v);new Uint8Array(y).set(new Uint8Array(e,t.ptr,m));var w,g=new Uint32Array(y),b=0,k=0;for(w=g[0],f=a;f<o;f++)(c=p[l=f-(f<i?0:i)].first)>0&&(p[l].second=w<<b>>>32-c,32-b>=c?32===(b+=c)&&(b=0,w=g[++k]):(b+=c-32,w=g[++k],p[l].second|=w>>>32-b));var x=0,_=0,A=new d;for(f=0;f<p.length;f++)void 0!==p[f]&&(x=Math.max(x,p[f].first));_=x>=r?r:x;var P,I,U,S,T,D=[];for(f=a;f<o;f++)if((c=p[l=f-(f<i?0:i)].first)>0)if(P=[c,l],c<=_)for(I=p[l].second<<_-c,U=1<<_-c,u=0;u<U;u++)D[I|u]=P;else for(I=p[l].second,T=A,S=c-1;S>=0;S--)I>>>S&1?(T.right||(T.right=new d),T=T.right):(T.left||(T.left=new d),T=T.left),0!==S||T.val||(T.val=P[1]);return{decodeLut:D,numBitsLUTQick:_,numBitsLUT:x,tree:A,stuffedData:g,srcPtr:k,bitPos:b}},readHuffman:function(e,t,r,n){var i,a,o,s,f,l,u,c,d,p=t.headerInfo.numDims,m=t.headerInfo.height,v=t.headerInfo.width,y=v*m,w=this.readHuffmanTree(e,t),g=w.decodeLut,b=w.tree,k=w.stuffedData,x=w.srcPtr,_=w.bitPos,A=w.numBitsLUTQick,P=w.numBitsLUT,I=0===t.headerInfo.imageType?128:0,U=t.pixels.resultMask,S=0;_>0&&(x++,_=0);var T,D=k[x],E=1===t.encodeMode,B=new r(y*p),O=B;if(p<2||E){for(T=0;T<p;T++)if(p>1&&(O=new r(B.buffer,y*T,y),S=0),t.headerInfo.numValidPixel===v*m)for(c=0,l=0;l<m;l++)for(u=0;u<v;u++,c++){if(a=0,f=s=D<<_>>>32-A,32-_<A&&(f=s|=k[x+1]>>>64-_-A),g[f])a=g[f][1],_+=g[f][0];else for(f=s=D<<_>>>32-P,32-_<P&&(f=s|=k[x+1]>>>64-_-P),i=b,d=0;d<P;d++)if(!(i=s>>>P-d-1&1?i.right:i.left).left&&!i.right){a=i.val,_=_+d+1;break}_>=32&&(_-=32,D=k[++x]),o=a-I,E?(o+=u>0?S:l>0?O[c-v]:S,o&=255,O[c]=o,S=o):O[c]=o}else for(c=0,l=0;l<m;l++)for(u=0;u<v;u++,c++)if(U[c]){if(a=0,f=s=D<<_>>>32-A,32-_<A&&(f=s|=k[x+1]>>>64-_-A),g[f])a=g[f][1],_+=g[f][0];else for(f=s=D<<_>>>32-P,32-_<P&&(f=s|=k[x+1]>>>64-_-P),i=b,d=0;d<P;d++)if(!(i=s>>>P-d-1&1?i.right:i.left).left&&!i.right){a=i.val,_=_+d+1;break}_>=32&&(_-=32,D=k[++x]),o=a-I,E?(u>0&&U[c-1]?o+=S:l>0&&U[c-v]?o+=O[c-v]:o+=S,o&=255,O[c]=o,S=o):O[c]=o}}else for(c=0,l=0;l<m;l++)for(u=0;u<v;u++)if(c=l*v+u,!U||U[c])for(T=0;T<p;T++,c+=y){if(a=0,f=s=D<<_>>>32-A,32-_<A&&(f=s|=k[x+1]>>>64-_-A),g[f])a=g[f][1],_+=g[f][0];else for(f=s=D<<_>>>32-P,32-_<P&&(f=s|=k[x+1]>>>64-_-P),i=b,d=0;d<P;d++)if(!(i=s>>>P-d-1&1?i.right:i.left).left&&!i.right){a=i.val,_=_+d+1;break}_>=32&&(_-=32,D=k[++x]),o=a-I,O[c]=o}t.ptr=t.ptr+4*(x+1)+(_>0?4:0),t.pixels.resultPixels=B,p>1&&!n&&(t.pixels.resultPixels=h.swapDimensionOrder(B,y,p,r))},decodeBits:function(e,t,r,n,i){var a=t.headerInfo,h=a.fileVersion,d=0,p=e.byteLength-t.ptr>=5?5:e.byteLength-t.ptr,m=new DataView(e,t.ptr,p),v=m.getUint8(0);d++;var y=v>>6,w=0===y?4:3-y,g=(32&v)>0,b=31&v,k=0;if(1===w)k=m.getUint8(d),d++;else if(2===w)k=m.getUint16(d,!0),d+=2;else{if(4!==w)throw"Invalid valid pixel count type";k=m.getUint32(d,!0),d+=4}var x,_,A,P,I,U,S,T,D,E=2*a.maxZError,B=a.numDims>1?a.maxValues[i]:a.zMax;if(g){for(t.counter.lut++,T=m.getUint8(d),d++,P=Math.ceil((T-1)*b/8),I=Math.ceil(P/4),_=new ArrayBuffer(4*I),A=new Uint8Array(_),t.ptr+=d,A.set(new Uint8Array(e,t.ptr,P)),S=new Uint32Array(_),t.ptr+=P,D=0;T-1>>>D;)D++;P=Math.ceil(k*D/8),I=Math.ceil(P/4),_=new ArrayBuffer(4*I),(A=new Uint8Array(_)).set(new Uint8Array(e,t.ptr,P)),x=new Uint32Array(_),t.ptr+=P,U=h>=3?l(S,b,T-1,n,E,B):s(S,b,T-1,n,E,B),h>=3?f(x,r,D,k,U):o(x,r,D,k,U)}else t.counter.bitstuffer++,D=b,t.ptr+=d,D>0&&(P=Math.ceil(k*D/8),I=Math.ceil(P/4),_=new ArrayBuffer(4*I),(A=new Uint8Array(_)).set(new Uint8Array(e,t.ptr,P)),x=new Uint32Array(_),t.ptr+=P,h>=3?null==n?c(x,r,D,k):f(x,r,D,k,!1,n,E,B):null==n?u(x,r,D,k):o(x,r,D,k,!1,n,E,B))},readTiles:function(e,t,r,n){var i=t.headerInfo,a=i.width,o=i.height,s=a*o,f=i.microBlockSize,l=i.imageType,u=h.getDataTypeSize(l),c=Math.ceil(a/f),d=Math.ceil(o/f);t.pixels.numBlocksY=d,t.pixels.numBlocksX=c,t.pixels.ptr=0;var p,m,v,y,w,g,b,k,x,_,A=0,P=0,I=0,U=0,S=0,T=0,D=0,E=0,B=0,O=0,M=0,C=0,L=0,R=0,V=0,G=new r(f*f),F=o%f||f,z=a%f||f,j=i.numDims,N=t.pixels.resultMask,Z=t.pixels.resultPixels,K=i.fileVersion>=5?14:15,H=i.zMax;for(I=0;I<d;I++)for(S=I!==d-1?f:F,U=0;U<c;U++)for(O=I*a*f+U*f,M=a-(T=U!==c-1?f:z),k=0;k<j;k++){if(j>1?(_=Z,O=I*a*f+U*f,Z=new r(t.pixels.resultPixels.buffer,s*k*u,s),H=i.maxValues[k]):_=null,D=e.byteLength-t.ptr,m={},V=0,E=(p=new DataView(e,t.ptr,Math.min(10,D))).getUint8(0),V++,x=i.fileVersion>=5?4&E:0,B=E>>6&255,(E>>2&K)!=(U*f>>3&K))throw"integrity issue";if(x&&0===k)throw"integrity issue";if((w=3&E)>3)throw t.ptr+=V,"Invalid block encoding ("+w+")";if(2!==w)if(0===w){if(x)throw"integrity issue";if(t.counter.uncompressed++,t.ptr+=V,C=(C=S*T*u)<(L=e.byteLength-t.ptr)?C:L,v=new ArrayBuffer(C%u==0?C:C+u-C%u),new Uint8Array(v).set(new Uint8Array(e,t.ptr,C)),y=new r(v),R=0,N)for(A=0;A<S;A++){for(P=0;P<T;P++)N[O]&&(Z[O]=y[R++]),O++;O+=M}else for(A=0;A<S;A++){for(P=0;P<T;P++)Z[O++]=y[R++];O+=M}t.ptr+=R*u}else if(g=h.getDataTypeUsed(x&&l<6?4:l,B),b=h.getOnePixel(m,V,g,p),V+=h.getDataTypeSize(g),3===w)if(t.ptr+=V,t.counter.constantoffset++,N)for(A=0;A<S;A++){for(P=0;P<T;P++)N[O]&&(Z[O]=x?Math.min(H,_[O]+b):b),O++;O+=M}else for(A=0;A<S;A++){for(P=0;P<T;P++)Z[O]=x?Math.min(H,_[O]+b):b,O++;O+=M}else if(t.ptr+=V,h.decodeBits(e,t,G,b,k),V=0,x)if(N)for(A=0;A<S;A++){for(P=0;P<T;P++)N[O]&&(Z[O]=G[V++]+_[O]),O++;O+=M}else for(A=0;A<S;A++){for(P=0;P<T;P++)Z[O]=G[V++]+_[O],O++;O+=M}else if(N)for(A=0;A<S;A++){for(P=0;P<T;P++)N[O]&&(Z[O]=G[V++]),O++;O+=M}else for(A=0;A<S;A++){for(P=0;P<T;P++)Z[O++]=G[V++];O+=M}else{if(x)if(N)for(A=0;A<S;A++)for(P=0;P<T;P++)N[O]&&(Z[O]=_[O]),O++;else for(A=0;A<S;A++)for(P=0;P<T;P++)Z[O]=_[O],O++;t.counter.constant++,t.ptr+=V}}j>1&&!n&&(t.pixels.resultPixels=h.swapDimensionOrder(t.pixels.resultPixels,s,j,r))},formatFileInfo:function(e){return{fileIdentifierString:e.headerInfo.fileIdentifierString,fileVersion:e.headerInfo.fileVersion,imageType:e.headerInfo.imageType,height:e.headerInfo.height,width:e.headerInfo.width,numValidPixel:e.headerInfo.numValidPixel,microBlockSize:e.headerInfo.microBlockSize,blobSize:e.headerInfo.blobSize,maxZError:e.headerInfo.maxZError,pixelType:h.getPixelType(e.headerInfo.imageType),eofOffset:e.eofOffset,mask:e.mask?{numBytes:e.mask.numBytes}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,maxValue:e.headerInfo.zMax,minValue:e.headerInfo.zMin,noDataValue:e.noDataValue}}},constructConstantSurface:function(e,t){var r=e.headerInfo.zMax,n=e.headerInfo.zMin,i=e.headerInfo.maxValues,a=e.headerInfo.numDims,o=e.headerInfo.height*e.headerInfo.width,s=0,f=0,l=0,u=e.pixels.resultMask,c=e.pixels.resultPixels;if(u)if(a>1){if(t)for(s=0;s<a;s++)for(l=s*o,r=i[s],f=0;f<o;f++)u[f]&&(c[l+f]=r);else for(f=0;f<o;f++)if(u[f])for(l=f*a,s=0;s<a;s++)c[l+a]=i[s]}else for(f=0;f<o;f++)u[f]&&(c[f]=r);else if(a>1&&n!==r)if(t)for(s=0;s<a;s++)for(l=s*o,r=i[s],f=0;f<o;f++)c[l+f]=r;else for(f=0;f<o;f++)for(l=f*a,s=0;s<a;s++)c[l+s]=i[s];else for(f=0;f<o*a;f++)c[f]=r},getDataTypeArray:function(e){var t;switch(e){case 0:t=Int8Array;break;case 1:t=Uint8Array;break;case 2:t=Int16Array;break;case 3:t=Uint16Array;break;case 4:t=Int32Array;break;case 5:t=Uint32Array;break;case 6:default:t=Float32Array;break;case 7:t=Float64Array}return t},getPixelType:function(e){var t;switch(e){case 0:t="S8";break;case 1:t="U8";break;case 2:t="S16";break;case 3:t="U16";break;case 4:t="S32";break;case 5:t="U32";break;case 6:default:t="F32";break;case 7:t="F64"}return t},isValidPixelValue:function(e,t){if(null==t)return!1;var r;switch(e){case 0:r=t>=-128&&t<=127;break;case 1:r=t>=0&&t<=255;break;case 2:r=t>=-32768&&t<=32767;break;case 3:r=t>=0&&t<=65536;break;case 4:r=t>=-2147483648&&t<=2147483647;break;case 5:r=t>=0&&t<=4294967296;break;case 6:r=t>=-34027999387901484e22&&t<=34027999387901484e22;break;case 7:r=t>=-17976931348623157e292&&t<=17976931348623157e292;break;default:r=!1}return r},getDataTypeSize:function(e){var t=0;switch(e){case 0:case 1:t=1;break;case 2:case 3:t=2;break;case 4:case 5:case 6:t=4;break;case 7:t=8;break;default:t=e}return t},getDataTypeUsed:function(e,t){var r=e;switch(e){case 2:case 4:r=e-t;break;case 3:case 5:r=e-2*t;break;case 6:r=0===t?e:1===t?2:1;break;case 7:r=0===t?e:e-2*t+1;break;default:r=e}return r},getOnePixel:function(e,t,r,n){var i=0;switch(r){case 0:i=n.getInt8(t);break;case 1:i=n.getUint8(t);break;case 2:i=n.getInt16(t,!0);break;case 3:i=n.getUint16(t,!0);break;case 4:i=n.getInt32(t,!0);break;case 5:i=n.getUInt32(t,!0);break;case 6:i=n.getFloat32(t,!0);break;case 7:i=n.getFloat64(t,!0);break;default:throw"the decoder does not understand this pixel type"}return i},swapDimensionOrder:function(e,t,r,n,i){var a=0,o=0,s=0,f=0,l=e;if(r>1)if(l=new n(t*r),i)for(a=0;a<t;a++)for(f=a,s=0;s<r;s++,f+=t)l[f]=e[o++];else for(a=0;a<t;a++)for(f=a,s=0;s<r;s++,f+=t)l[o++]=e[f];return l}},d=function(e,t,r){this.val=e,this.left=t,this.right=r},{decode:function(e,t){var r=(t=t||{}).noDataValue,n=0,i={};i.ptr=t.inputOffset||0,i.pixels={},h.readHeaderInfo(e,i);var a=i.headerInfo,o=a.fileVersion,s=h.getDataTypeArray(a.imageType);if(o>5)throw"unsupported lerc version 2."+o;h.readMask(e,i),a.numValidPixel===a.width*a.height||i.pixels.resultMask||(i.pixels.resultMask=t.maskData);var f=a.width*a.height;i.pixels.resultPixels=new s(f*a.numDims),i.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var l,u=!t.returnPixelInterleavedDims;if(0!==a.numValidPixel)if(a.zMax===a.zMin)h.constructConstantSurface(i,u);else if(o>=4&&h.checkMinMaxRanges(e,i))h.constructConstantSurface(i,u);else{var c=new DataView(e,i.ptr,2),d=c.getUint8(0);if(i.ptr++,d)h.readDataOneSweep(e,i,s,u);else if(o>1&&a.imageType<=1&&Math.abs(a.maxZError-.5)<1e-5){var p=c.getUint8(1);if(i.ptr++,i.encodeMode=p,p>2||o<4&&p>1)throw"Invalid Huffman flag "+p;p?h.readHuffman(e,i,s,u):h.readTiles(e,i,s,u)}else h.readTiles(e,i,s,u)}i.eofOffset=i.ptr,t.inputOffset?(l=i.headerInfo.blobSize+t.inputOffset-i.ptr,Math.abs(l)>=1&&(i.eofOffset=t.inputOffset+i.headerInfo.blobSize)):(l=i.headerInfo.blobSize-i.ptr,Math.abs(l)>=1&&(i.eofOffset=i.headerInfo.blobSize));var m={width:a.width,height:a.height,pixelData:i.pixels.resultPixels,minValue:a.zMin,maxValue:a.zMax,validPixelCount:a.numValidPixel,dimCount:a.numDims,dimStats:{minValues:a.minValues,maxValues:a.maxValues},maskData:i.pixels.resultMask};if(i.pixels.resultMask&&h.isValidPixelValue(a.imageType,r)){var v=i.pixels.resultMask;for(n=0;n<f;n++)v[n]||(m.pixelData[n]=r);m.noDataValue=r}return i.noDataValue=r,t.returnFileInfo&&(m.fileInfo=h.formatFileInfo(i)),m},getBandCount:function(e){for(var t=0,r=0,n={ptr:0,pixels:{}};r<e.byteLength-58;)h.readHeaderInfo(e,n),r+=n.headerInfo.blobSize,t++,n.ptr=r;return t}}),w=(p=new ArrayBuffer(4),m=new Uint8Array(p),new Uint32Array(p)[0]=1,1===m[0]),g={decode:function(e,t){if(!w)throw"Big endian system is not supported.";var r,n,i=(t=t||{}).inputOffset||0,a=new Uint8Array(e,i,10),o=String.fromCharCode.apply(null,a);if("CntZImage"===o.trim())r=v,n=1;else{if("Lerc2"!==o.substring(0,5))throw"Unexpected file identifier string: "+o;r=y,n=2}for(var s,f,l,u,c,h,d=0,p=e.byteLength-10,m=[],g={width:0,height:0,pixels:[],pixelType:t.pixelType,mask:null,statistics:[]},b=0;i<p;){var k=r.decode(e,{inputOffset:i,encodedMaskData:s,maskData:l,returnMask:0===d,returnEncodedMask:0===d,returnFileInfo:!0,returnPixelInterleavedDims:t.returnPixelInterleavedDims,pixelType:t.pixelType||null,noDataValue:t.noDataValue||null});i=k.fileInfo.eofOffset,l=k.maskData,0===d&&(s=k.encodedMaskData,g.width=k.width,g.height=k.height,g.dimCount=k.dimCount||1,g.pixelType=k.pixelType||k.fileInfo.pixelType,g.mask=l),n>1&&(l&&m.push(l),k.fileInfo.mask&&k.fileInfo.mask.numBytes>0&&b++),d++,g.pixels.push(k.pixelData),g.statistics.push({minValue:k.minValue,maxValue:k.maxValue,noDataValue:k.noDataValue,dimStats:k.dimStats})}if(n>1&&b>1){for(h=g.width*g.height,g.bandMasks=m,(l=new Uint8Array(h)).set(m[0]),u=1;u<m.length;u++)for(f=m[u],c=0;c<h;c++)l[c]=l[c]&f[c];g.maskData=l}return g}};Ke.exports?Ke.exports=g:this.Lerc=g}();var We=Xe.exports,qe={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},Je={};for(var Qe in qe)qe.hasOwnProperty(Qe)&&(Je[qe[Qe]]=parseInt(Qe,10));Je.BitsPerSample,Je.ExtraSamples,Je.SampleFormat,Je.StripByteCounts,Je.StripOffsets,Je.StripRowCounts,Je.TileByteCounts,Je.TileOffsets,Je.SubIFDs;var $e={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},et={};for(var tt in $e)$e.hasOwnProperty(tt)&&(et[$e[tt]]=parseInt(tt,10));var rt=1,nt=0,it=1,at={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},ot={};for(var st in at)at.hasOwnProperty(st)&&(ot[at[st]]=parseInt(st,10));function ft(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=v(e);if(t){var i=v(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m(this,r)}}var lt=function(e){p(r,b);var t=ft(r);function r(e){var n;return u(this,r),(n=t.call(this)).planarConfiguration=void 0!==e.PlanarConfiguration?e.PlanarConfiguration:1,n.samplesPerPixel=void 0!==e.SamplesPerPixel?e.SamplesPerPixel:1,n.addCompression=e.LercParameters[rt],n}return h(r,[{key:"decodeBlock",value:function(e){switch(this.addCompression){case nt:break;case it:e=Fe(new Uint8Array(e)).buffer;break;default:throw new Error("Unsupported LERC additional compression method identifier: ".concat(this.addCompression))}return We.decode(e,{returnPixelInterleavedDims:1===this.planarConfiguration}).pixels[0].buffer}}]),r}(),ut=Object.freeze({__proto__:null,default:lt});function ct(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=v(e);if(t){var i=v(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m(this,r)}}var ht=function(e){p(a,b);var r,n=ct(a);function a(){var e;if(u(this,a),e=n.call(this),"undefined"==typeof createImageBitmap)throw new Error("Cannot decode WebImage as `createImageBitmap` is not available");if("undefined"==typeof document&&"undefined"==typeof OffscreenCanvas)throw new Error("Cannot decode WebImage as neither `document` nor `OffscreenCanvas` is not available");return e}return h(a,[{key:"decode",value:(r=t(i.mark((function e(t,r){var n,a,o,s;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Blob([r]),e.next=3,createImageBitmap(n);case 3:return a=e.sent,"undefined"!=typeof document?((o=document.createElement("canvas")).width=a.width,o.height=a.height):o=new OffscreenCanvas(a.width,a.height),(s=o.getContext("2d")).drawImage(a,0,0),e.abrupt("return",s.getImageData(0,0,a.width,a.height).data.buffer);case 8:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})}]),a}(),dt=Object.freeze({__proto__:null,default:ht});';return new e.default("undefined"==typeof Blob?"data:application/javascript;base64,"+Buffer.from(t,"binary").toString("base64"):URL.createObjectURL(new Blob([t],{type:"application/javascript"})))},gO}var yO,xO={},_O={};var wO,bO={};function MO(){if(wO)return bO;wO=1,Object.defineProperty(bO,"__esModule",{value:!0}),bO.BaseSource=void 0;return bO.BaseSource=class{async fetch(t,e=void 0){return Promise.all(t.map((t=>this.fetchSlice(t,e))))}async fetchSlice(t){throw new Error(`fetching of slice ${t} not possible, not implemented`)}get fileSize(){return null}async close(){}},bO}var SO={};class TO extends Map{constructor(t={}){if(super(),!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if("number"==typeof t.maxAge&&0===t.maxAge)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=t.maxSize,this.maxAge=t.maxAge||Number.POSITIVE_INFINITY,this.onEviction=t.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(t){if("function"==typeof this.onEviction)for(const[e,r]of t)this.onEviction(e,r.value)}_deleteIfExpired(t,e){return"number"==typeof e.expiry&&e.expiry<=Date.now()&&("function"==typeof this.onEviction&&this.onEviction(t,e.value),this.delete(t))}_getOrDeleteIfExpired(t,e){if(!1===this._deleteIfExpired(t,e))return e.value}_getItemValue(t,e){return e.expiry?this._getOrDeleteIfExpired(t,e):e.value}_peek(t,e){const r=e.get(t);return this._getItemValue(t,r)}_set(t,e){this.cache.set(t,e),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(t,e){this.oldCache.delete(t),this._set(t,e)}*_entriesAscending(){for(const t of this.oldCache){const[e,r]=t;if(!this.cache.has(e)){!1===this._deleteIfExpired(e,r)&&(yield t)}}for(const t of this.cache){const[e,r]=t;!1===this._deleteIfExpired(e,r)&&(yield t)}}get(t){if(this.cache.has(t)){const e=this.cache.get(t);return this._getItemValue(t,e)}if(this.oldCache.has(t)){const e=this.oldCache.get(t);if(!1===this._deleteIfExpired(t,e))return this._moveToRecent(t,e),e.value}}set(t,e,{maxAge:r=this.maxAge}={}){const n="number"==typeof r&&r!==Number.POSITIVE_INFINITY?Date.now()+r:void 0;this.cache.has(t)?this.cache.set(t,{value:e,expiry:n}):this._set(t,{value:e,expiry:n})}has(t){return this.cache.has(t)?!this._deleteIfExpired(t,this.cache.get(t)):!!this.oldCache.has(t)&&!this._deleteIfExpired(t,this.oldCache.get(t))}peek(t){return this.cache.has(t)?this._peek(t,this.cache):this.oldCache.has(t)?this._peek(t,this.oldCache):void 0}delete(t){const e=this.cache.delete(t);return e&&this._size--,this.oldCache.delete(t)||e}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(t){if(!(t&&t>0))throw new TypeError("`maxSize` must be a number greater than 0");const e=[...this._entriesAscending()],r=e.length-t;r<0?(this.cache=new Map(e),this.oldCache=new Map,this._size=e.length):(r>0&&this._emitEvictions(e.slice(0,r)),this.oldCache=new Map(e.slice(r)),this.cache=new Map,this._size=0),this.maxSize=t}*keys(){for(const[t]of this)yield t}*values(){for(const[,t]of this)yield t}*[Symbol.iterator](){for(const t of this.cache){const[e,r]=t;!1===this._deleteIfExpired(e,r)&&(yield[e,r.value])}for(const t of this.oldCache){const[e,r]=t;if(!this.cache.has(e)){!1===this._deleteIfExpired(e,r)&&(yield[e,r.value])}}}*entriesDescending(){let t=[...this.cache];for(let e=t.length-1;e>=0;--e){const r=t[e],[n,i]=r;!1===this._deleteIfExpired(n,i)&&(yield[n,i.value])}t=[...this.oldCache];for(let e=t.length-1;e>=0;--e){const r=t[e],[n,i]=r;if(!this.cache.has(n)){!1===this._deleteIfExpired(n,i)&&(yield[n,i.value])}}}*entriesAscending(){for(const[t,e]of this._entriesAscending())yield[t,e.value]}get size(){if(!this._size)return this.oldCache.size;let t=0;for(const e of this.oldCache.keys())this.cache.has(e)||t++;return Math.min(this._size+t,this.maxSize)}entries(){return this.entriesAscending()}forEach(t,e=this){for(const[r,n]of this.entriesAscending())t.call(e,n,r,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}const EO=of(Object.freeze(Object.defineProperty({__proto__:null,default:TO},Symbol.toStringTag,{value:"Module"})));var AO,RO,PO={};function CO(){if(AO)return PO;function t(t){const e=[],{length:r}=t;for(let n=0;n<r;n++)e.push(t[n]);return e}AO=1,Object.defineProperty(PO,"__esModule",{value:!0}),PO.AggregateError=PO.CustomAggregateError=PO.AbortError=PO.zip=PO.wait=PO.parseContentRange=PO.toArrayRecursively=PO.toArray=PO.times=PO.range=PO.invert=PO.forEach=PO.endsWith=PO.chunk=PO.assign=void 0,PO.assign=function(t,e){for(const r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},PO.chunk=function(t,e){const r=[],n=t.length;for(let i=0;i<n;i+=e){const n=[];for(let r=i;r<i+e;r++)n.push(t[r]);r.push(n)}return r},PO.endsWith=function(t,e){return!(t.length<e.length)&&t.substr(t.length-e.length)===e},PO.forEach=function(t,e){const{length:r}=t;for(let n=0;n<r;n++)e(t[n],n)},PO.invert=function(t){const e={};for(const r in t)if(t.hasOwnProperty(r)){e[t[r]]=r}return e},PO.range=function(t){const e=[];for(let r=0;r<t;r++)e.push(r);return e},PO.times=function(t,e){const r=[];for(let n=0;n<t;n++)r.push(e(n));return r},PO.toArray=t,PO.toArrayRecursively=function e(r){return r.length?t(r).map(e):r},PO.parseContentRange=function(t){if(!t)return null;if("string"!=typeof t)throw new Error("invalid argument");const e=t=>Number.parseInt(t,10);let r=t.match(/^(\w*) /);const n=r&&r[1];return r=t.match(/(\d+)-(\d+)\/(\d+|\*)/),r?{unit:n,first:e(r[1]),last:e(r[2]),length:"*"===r[3]?null:e(r[3])}:(r=t.match(/(\d+|\*)/),r?{unit:n,first:null,last:null,length:"*"===r[1]?null:e(r[1])}:null)},PO.wait=async function(t){return new Promise((e=>setTimeout(e,t)))},PO.zip=function(t,e){const r=Array.isArray(t)?t:Array.from(t),n=Array.isArray(e)?e:Array.from(e);return r.map(((t,e)=>[t,n[e]]))};class e extends Error{constructor(t){super(t),Error.captureStackTrace&&Error.captureStackTrace(this,e),this.name="AbortError"}}PO.AbortError=e;class r extends Error{constructor(t,e){super(e),this.errors=t,this.message=e,this.name="AggregateError"}}return PO.CustomAggregateError=r,PO.AggregateError=r,PO}var IO,LO,OO={},DO={};function kO(){if(IO)return DO;IO=1,Object.defineProperty(DO,"__esModule",{value:!0}),DO.BaseClient=DO.BaseResponse=void 0;DO.BaseResponse=class{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(t){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}};return DO.BaseClient=class{constructor(t){this.url=t}async request({headers:t,credentials:e,signal:r}={}){throw new Error("request is not implemented")}},DO}var FO,NO={};var UO={};const BO=of(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var zO,GO;function jO(){if(GO)return xO;GO=1,Object.defineProperty(xO,"__esModule",{value:!0}),xO.makeRemoteSource=xO.makeHttpSource=xO.makeXHRSource=xO.makeFetchSource=void 0;const t=function(){if(yO)return _O;yO=1,Object.defineProperty(_O,"__esModule",{value:!0}),_O.parseByteRanges=_O.parseContentRange=_O.parseContentType=void 0;const t="\r\n\r\n";function e(t){if(void 0!==Object.fromEntries)return Object.fromEntries(t);const e={};for(const[r,n]of t)e[r.toLowerCase()]=n;return e}function r(t){return e(t.split("\r\n").map((t=>{const e=t.split(":").map((t=>t.trim()));return e[0]=e[0].toLowerCase(),e})))}function n(t){let e,r,n;return t&&([,e,r,n]=t.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),r=parseInt(r,10),n=parseInt(n,10)),{start:e,end:r,total:n}}return _O.parseContentType=function(t){const[r,...n]=t.split(";").map((t=>t.trim()));return{type:r,params:e(n.map((t=>t.split("="))))}},_O.parseContentRange=n,_O.parseByteRanges=function(e,i){let a=null;const o=new TextDecoder("ascii"),s=[],l=`--${i}`,u=`${l}--`;for(let t=0;t<10;++t)o.decode(new Uint8Array(e,t,l.length))===l&&(a=t);if(null===a)throw new Error("Could not find initial boundary");for(;a<e.byteLength;){const i=o.decode(new Uint8Array(e,a,Math.min(l.length+1024,e.byteLength-a)));if(0===i.length||i.startsWith(u))break;if(!i.startsWith(l))throw new Error("Part does not start with boundary");const c=i.substr(l.length+2);if(0===c.length)break;const h=c.indexOf(t),d=r(c.substr(0,h)),{start:f,end:p,total:m}=n(d["content-range"]),g=a+l.length+h+4,v=parseInt(p,10)+1-parseInt(f,10);s.push({headers:d,data:e.slice(g,g+v),offset:f,length:v,fileSize:m}),a=g+v+4}return s},_O}(),e=MO(),r=function(){if(RO)return SO;RO=1;var t=af&&af.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(SO,"__esModule",{value:!0}),SO.BlockedSource=void 0;const e=t(EO),r=MO(),n=CO();class i{constructor(t,e,r=null){this.offset=t,this.length=e,this.data=r}get top(){return this.offset+this.length}}class a{constructor(t,e,r){this.offset=t,this.length=e,this.blockIds=r}}class o extends r.BaseSource{constructor(t,{blockSize:r=65536,cacheSize:n=100}={}){super(),this.source=t,this.blockSize=r,this.blockCache=new e.default({maxSize:n}),this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(t,e){const r=[],i=[],a=[];for(const{offset:e,length:n}of t){let t=e+n;const{fileSize:o}=this;null!==o&&(t=Math.min(t,o));for(let n=Math.floor(e/this.blockSize)*this.blockSize;n<t;n+=this.blockSize){const t=Math.floor(n/this.blockSize);this.blockCache.has(t)||this.blockRequests.has(t)||(this.blockIdsToFetch.add(t),i.push(t)),this.blockRequests.has(t)&&r.push(this.blockRequests.get(t)),a.push(t)}}await(0,n.wait)(),this.fetchBlocks(e);const o=[];for(const t of i)this.blockRequests.has(t)&&o.push(this.blockRequests.get(t));await Promise.allSettled(r),await Promise.allSettled(o);const s=[],l=a.filter((t=>this.abortedBlockIds.has(t)||!this.blockCache.has(t)));if(l.forEach((t=>this.blockIdsToFetch.add(t))),l.length>0&&e&&!e.aborted){this.fetchBlocks(null);for(const t of l){const e=this.blockRequests.get(t);if(!e)throw new Error(`Block ${t} is not in the block requests`);s.push(e)}await Promise.allSettled(s)}if(e&&e.aborted)throw new n.AbortError("Request was aborted");const u=a.map((t=>this.blockCache.get(t))),c=u.filter((t=>!t));if(c.length)throw new n.AggregateError(c,"Request failed");const h=new Map((0,n.zip)(a,u));return this.readSliceData(t,h)}fetchBlocks(t){if(this.blockIdsToFetch.size>0){const e=this.groupBlocks(this.blockIdsToFetch),r=this.source.fetch(e,t);for(let n=0;n<e.length;++n){const a=e[n];for(const e of a.blockIds)this.blockRequests.set(e,(async()=>{try{const t=(await r)[n],a=e*this.blockSize,o=a-t.offset,s=Math.min(o+this.blockSize,t.data.byteLength),l=t.data.slice(o,s),u=new i(a,l.byteLength,l,e);this.blockCache.set(e,u),this.abortedBlockIds.delete(e)}catch(r){if("AbortError"!==r.name)throw r;r.signal=t,this.blockCache.delete(e),this.abortedBlockIds.add(e)}finally{this.blockRequests.delete(e)}})())}this.blockIdsToFetch.clear()}}groupBlocks(t){const e=Array.from(t).sort(((t,e)=>t-e));if(0===e.length)return[];let r=[],n=null;const i=[];for(const t of e)null===n||n+1===t?(r.push(t),n=t):(i.push(new a(r[0]*this.blockSize,r.length*this.blockSize,r)),r=[t],n=t);return i.push(new a(r[0]*this.blockSize,r.length*this.blockSize,r)),i}readSliceData(t,e){return t.map((t=>{let r=t.offset+t.length;null!==this.fileSize&&(r=Math.min(this.fileSize,r));const n=Math.floor(t.offset/this.blockSize),i=Math.floor(r/this.blockSize),a=new ArrayBuffer(t.length),o=new Uint8Array(a);for(let a=n;a<=i;++a){const n=e.get(a),i=n.offset-t.offset;let s,l=0,u=0;i<0?l=-i:i>0&&(u=i),s=n.top-r<0?n.length-l:r-n.offset-l;const c=new Uint8Array(n.data,l,s);o.set(c,u)}return a}))}}return SO.BlockedSource=o,SO}(),n=function(){if(LO)return OO;LO=1,Object.defineProperty(OO,"__esModule",{value:!0}),OO.FetchClient=void 0;const t=kO();class e extends t.BaseResponse{constructor(t){super(),this.response=t}get status(){return this.response.status}getHeader(t){return this.response.headers.get(t)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class r extends t.BaseClient{constructor(t,e){super(t),this.credentials=e}async request({headers:t,credentials:r,signal:n}={}){const i=await fetch(this.url,{headers:t,credentials:r,signal:n});return new e(i)}}return OO.FetchClient=r,OO}(),i=function(){if(FO)return NO;FO=1,Object.defineProperty(NO,"__esModule",{value:!0}),NO.XHRClient=void 0;const t=kO(),e=CO();class r extends t.BaseResponse{constructor(t,e){super(),this.xhr=t,this.data=e}get status(){return this.xhr.status}getHeader(t){return this.xhr.getResponseHeader(t)}async getData(){return this.data}}class n extends t.BaseClient{constructRequest(t,n){return new Promise(((i,a)=>{const o=new XMLHttpRequest;o.open("GET",this.url),o.responseType="arraybuffer";for(const[e,r]of Object.entries(t))o.setRequestHeader(e,r);o.onload=()=>{const t=o.response;i(new r(o,t))},o.onerror=a,o.onabort=()=>a(new e.AbortError("Request aborted")),o.send(),n&&(n.aborted&&o.abort(),n.addEventListener("abort",(()=>o.abort())))}))}async request({headers:t,signal:e}={}){return await this.constructRequest(t,e)}}return NO.XHRClient=n,NO}(),a=function(){if(zO)return UO;zO=1;var t=af&&af.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(UO,"__esModule",{value:!0}),UO.HttpClient=void 0;const e=t(BO),r=t(BO),n=t(BO),i=kO(),a=CO();class o extends i.BaseResponse{constructor(t,e){super(),this.response=t,this.dataPromise=e}get status(){return this.response.statusCode}getHeader(t){return this.response.headers[t]}async getData(){return await this.dataPromise}}class s extends i.BaseClient{constructor(t){super(t),this.parsedUrl=n.default.parse(this.url),this.httpApi="http:"===this.parsedUrl.protocol?e.default:r.default}constructRequest(t,e){return new Promise(((r,n)=>{const i=this.httpApi.get({...this.parsedUrl,headers:t},(t=>{const e=new Promise((e=>{const r=[];t.on("data",(t=>{r.push(t)})),t.on("end",(()=>{const t=Buffer.concat(r).buffer;e(t)})),t.on("error",n)}));r(new o(t,e))}));i.on("error",n),e&&(e.aborted&&i.destroy(new a.AbortError("Request aborted")),e.addEventListener("abort",(()=>i.destroy(new a.AbortError("Request aborted")))))}))}async request({headers:t,signal:e}={}){return await this.constructRequest(t,e)}}return UO.HttpClient=s,UO}();class o extends e.BaseSource{constructor(t,e,r,n){super(),this.client=t,this.headers=e,this.maxRanges=r,this.allowFullFile=n,this._fileSize=null}async fetch(t,e){return this.maxRanges>=t.length?this.fetchSlices(t,e):(this.maxRanges>0&&t.length,Promise.all(t.map((t=>this.fetchSlice(t,e)))))}async fetchSlices(e,r){const n=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map((({offset:t,length:e})=>`${t}-${t+e}`)).join(",")}`},signal:r});if(n.ok){if(206===n.status){const{type:i,params:a}=(0,t.parseContentType)(n.getHeader("content-type"));if("multipart/byteranges"===i){const e=(0,t.parseByteRanges)(await n.getData(),a.boundary);return this._fileSize=e[0].fileSize||null,e}const o=await n.getData(),{start:s,end:l,total:u}=(0,t.parseContentRange)(n.getHeader("content-range"));this._fileSize=u||null;const c=[{data:o,offset:s,length:l-s}];if(e.length>1){const t=await Promise.all(e.slice(1).map((t=>this.fetchSlice(t,r))));return c.concat(t)}return c}{if(!this.allowFullFile)throw new Error("Server responded with full file");const t=await n.getData();return this._fileSize=t.byteLength,[{data:t,offset:0,length:t.byteLength}]}}throw new Error("Error fetching data.")}async fetchSlice(e,r){const{offset:n,length:i}=e,a=await this.client.request({headers:{...this.headers,Range:`bytes=${n}-${n+i}`},signal:r});if(a.ok){if(206===a.status){const e=await a.getData(),{total:r}=(0,t.parseContentRange)(a.getHeader("content-range"));return this._fileSize=r||null,{data:e,offset:n,length:i}}{if(!this.allowFullFile)throw new Error("Server responded with full file");const t=await a.getData();return this._fileSize=t.byteLength,{data:t,offset:0,length:t.byteLength}}}throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function s(t,{blockSize:e,cacheSize:n}){return null===e?t:new r.BlockedSource(t,{blockSize:e,cacheSize:n})}function l(t,{headers:e={},credentials:r,maxRanges:i=0,allowFullFile:a=!1,...l}={}){const u=new n.FetchClient(t,r);return s(new o(u,e,i,a),l)}function u(t,{headers:e={},maxRanges:r=0,allowFullFile:n=!1,...a}={}){const l=new i.XHRClient(t);return s(new o(l,e,r,n),a)}function c(t,{headers:e={},maxRanges:r=0,allowFullFile:n=!1,...i}={}){const l=new a.HttpClient(t);return s(new o(l,e,r,n),i)}return xO.makeFetchSource=l,xO.makeXHRSource=u,xO.makeHttpSource=c,xO.makeRemoteSource=function(t,{forceXHR:e=!1,...r}={}){return"function"!=typeof fetch||e?"undefined"!=typeof XMLHttpRequest?u(t,r):c(t,r):l(t,r)},xO}var VO,HO={};var WO,qO={};var XO,YO={};function ZO(){if(XO)return YO;XO=1;var t=af&&af.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(YO,"__esModule",{value:!0}),YO.makeFileSource=void 0;const e=t(BO),r=MO();class n extends r.BaseSource{constructor(t){super(),this.path=t,this.openRequest=function(t,r,n){return new Promise(((i,a)=>{e.default.open(t,r,n,((t,e)=>{t?a(t):i(e)}))}))}(t,"r")}async fetchSlice(t){const r=await this.openRequest,{buffer:n}=await function(...t){return new Promise(((r,n)=>{e.default.read(...t,((t,e,i)=>{t?n(t):r({bytesRead:e,buffer:i})}))}))}(r,Buffer.alloc(t.length),0,t.length,t.offset);return n.buffer}async close(){const t=await this.openRequest;await function(t){return new Promise(((r,n)=>{e.default.close(t,(t=>{t?n(t):r()}))}))}(t)}}return YO.makeFileSource=function(t){return new n(t)},YO}var KO,JO={};function QO(){if(KO)return JO;KO=1,Object.defineProperty(JO,"__esModule",{value:!0}),JO.writeGeotiff=void 0;const t=FI(),e=CO(),r=(0,e.invert)(t.fieldTagNames),n=(0,e.invert)(t.geoKeyNames),i={};(0,e.assign)(i,r),(0,e.assign)(i,n);const a=(0,e.invert)(t.fieldTypeNames),o=1e3,s={nextZero:(t,e)=>{let r=e;for(;0!==t[r];)r++;return r},readUshort:(t,e)=>t[e]<<8|t[e+1],readShort:(t,e)=>{const r=s.ui8;return r[0]=t[e+1],r[1]=t[e+0],s.i16[0]},readInt:(t,e)=>{const r=s.ui8;return r[0]=t[e+3],r[1]=t[e+2],r[2]=t[e+1],r[3]=t[e+0],s.i32[0]},readUint:(t,e)=>{const r=s.ui8;return r[0]=t[e+3],r[1]=t[e+2],r[2]=t[e+1],r[3]=t[e+0],s.ui32[0]},readASCII:(t,e,r)=>r.map((r=>String.fromCharCode(t[e+r]))).join(""),readFloat:(t,r)=>{const n=s.ui8;return(0,e.times)(4,(e=>{n[e]=t[r+3-e]})),s.fl32[0]},readDouble:(t,r)=>{const n=s.ui8;return(0,e.times)(8,(e=>{n[e]=t[r+7-e]})),s.fl64[0]},writeUshort:(t,e,r)=>{t[e]=r>>8&255,t[e+1]=255&r},writeUint:(t,e,r)=>{t[e]=r>>24&255,t[e+1]=r>>16&255,t[e+2]=r>>8&255,t[e+3]=r>>0&255},writeASCII:(t,r,n)=>{(0,e.times)(n.length,(e=>{t[r+e]=n.charCodeAt(e)}))},ui8:new Uint8Array(8)};s.fl64=new Float64Array(s.ui8.buffer),s.writeDouble=(t,r,n)=>{s.fl64[0]=n,(0,e.times)(8,(e=>{t[r+e]=s.ui8[7-e]}))};const l=r=>{const n=new Uint8Array(o);let i=4;const l=s;n[0]=77,n[1]=77,n[3]=42;let u=8;if(l.writeUint(n,i,u),i+=4,r.forEach(((i,o)=>{const s=((r,n,i,o)=>{let s=i;const l=Object.keys(o).filter((t=>null!=t&&"undefined"!==t));r.writeUshort(n,s,l.length),s+=2;let u=s+12*l.length+4;for(const i of l){let l=null;"number"==typeof i?l=i:"string"==typeof i&&(l=parseInt(i,10));const c=t.fieldTagTypes[l],h=a[c];if(null==c||void 0===c||void 0===c)throw new Error(`unknown type of tag: ${l}`);let d=o[i];if(void 0===d)throw new Error(`failed to get value for key ${i}`);"ASCII"===c&&"string"==typeof d&&!1===(0,e.endsWith)(d,"\0")&&(d+="\0");const f=d.length;r.writeUshort(n,s,l),s+=2,r.writeUshort(n,s,h),s+=2,r.writeUint(n,s,f),s+=4;let p=[-1,1,1,2,4,8,0,0,0,0,0,0,8][h]*f,m=s;p>4&&(r.writeUint(n,s,u),m=u),"ASCII"===c?r.writeASCII(n,m,d):"SHORT"===c?(0,e.times)(f,(t=>{r.writeUshort(n,m+2*t,d[t])})):"LONG"===c?(0,e.times)(f,(t=>{r.writeUint(n,m+4*t,d[t])})):"RATIONAL"===c?(0,e.times)(f,(t=>{r.writeUint(n,m+8*t,Math.round(1e4*d[t])),r.writeUint(n,m+8*t+4,1e4)})):"DOUBLE"===c&&(0,e.times)(f,(t=>{r.writeDouble(n,m+8*t,d[t])})),p>4&&(p+=1&p,u+=p),s+=4}return[s,u]})(l,n,u,i);u=s[1],o<r.length-1&&l.writeUint(n,s[0],u)})),n.slice)return n.slice(0,u).buffer;const c=new Uint8Array(u);for(let t=0;t<u;t++)c[t]=n[t];return c.buffer},u=[["Compression",1],["PlanarConfiguration",1],["ExtraSamples",0]];return JO.writeGeotiff=function(r,n){let a,s,c,h;"number"==typeof r[0]?(a=n.height||n.ImageLength,c=n.width||n.ImageWidth,s=r.length/(a*c),h=r):(s=r.length,a=r[0].length,c=r[0][0].length,h=[],(0,e.times)(a,(t=>{(0,e.times)(c,(n=>{(0,e.times)(s,(e=>{h.push(r[e][t][n])}))}))}))),n.ImageLength=a,delete n.height,n.ImageWidth=c,delete n.width,n.BitsPerSample||(n.BitsPerSample=(0,e.times)(s,(()=>8))),u.forEach((t=>{const e=t[0];if(!n[e]){const r=t[1];n[e]=r}})),n.PhotometricInterpretation||(n.PhotometricInterpretation=3===n.BitsPerSample.length?2:1),n.SamplesPerPixel||(n.SamplesPerPixel=[s]),n.StripByteCounts||(n.StripByteCounts=[s*a*c]),n.ModelPixelScale||(n.ModelPixelScale=[360/c,180/a,0]),n.SampleFormat||(n.SampleFormat=(0,e.times)(s,(()=>1))),n.hasOwnProperty("GeographicTypeGeoKey")||n.hasOwnProperty("ProjectedCSTypeGeoKey")||(n.GeographicTypeGeoKey=4326,n.ModelTiepoint=[0,0,0,-180,90,0],n.GeogCitationGeoKey="WGS 84",n.GTModelTypeGeoKey=2);const d=Object.keys(n).filter((t=>(0,e.endsWith)(t,"GeoKey"))).sort(((t,e)=>i[t]-i[e]));if(!n.GeoAsciiParams){let e="";d.forEach((r=>{const a=Number(i[r]);"ASCII"===t.fieldTagTypes[a]&&(e+=`${n[r].toString()}\0`)})),e.length>0&&(n.GeoAsciiParams=e)}if(!n.GeoKeyDirectory){const e=[1,1,0,d.length];d.forEach((r=>{const a=Number(i[r]);let o,s,l;e.push(a),"SHORT"===t.fieldTagTypes[a]?(o=1,s=0,l=n[r]):"GeogCitationGeoKey"===r?(o=n.GeoAsciiParams.length,s=Number(i.GeoAsciiParams),l=0):console.log(`[geotiff.js] couldn't get TIFFTagLocation for ${r}`),e.push(s),e.push(o),e.push(l)})),n.GeoKeyDirectory=e}for(const t in d)d.hasOwnProperty(t)&&delete n[t];["Compression","ExtraSamples","GeographicTypeGeoKey","GTModelTypeGeoKey","GTRasterTypeGeoKey","ImageLength","ImageWidth","Orientation","PhotometricInterpretation","ProjectedCSTypeGeoKey","PlanarConfiguration","ResolutionUnit","SamplesPerPixel","XPosition","YPosition"].forEach((t=>{var e;n[t]&&(n[t]=(e=n[t],Array.isArray(e)?e:[e]))}));const f=(t=>{const e={};for(const r in t)"StripOffsets"!==r&&(i[r]||console.error(r,"not in name2code:",Object.keys(i)),e[i[r]]=t[r]);return e})(n);return((t,r,n,i)=>{if(null==n)throw new Error(`you passed into encodeImage a width of type ${n}`);if(null==r)throw new Error(`you passed into encodeImage a width of type ${r}`);const a={256:[r],257:[n],273:[o],278:[n],305:"geotiff.js"};if(i)for(const t in i)i.hasOwnProperty(t)&&(a[t]=i[t]);const s=new Uint8Array(l([a])),u=new Uint8Array(t),c=a[277],h=new Uint8Array(o+r*n*c);return(0,e.times)(s.length,(t=>{h[t]=s[t]})),(0,e.forEach)(u,((t,e)=>{h[o+e]=t})),h.buffer})(h,c,a,f)},JO}var $O,tD,eD,rD,nD={};function iD(){return tD||(tD=1,function(t){var e=af&&af.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),r=af&&af.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=af&&af.__importStar||function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&e(n,t,i);return r(n,t),n},i=af&&af.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(t,"__esModule",{value:!0}),t.GeoTIFFImage=t.Pool=t.writeArrayBuffer=t.fromUrls=t.fromBlob=t.fromFile=t.fromArrayBuffer=t.fromUrl=t.MultiGeoTIFF=t.GeoTIFF=t.setLogger=t.addDecoder=t.getDecoder=t.BaseDecoder=t.rgb=t.globals=void 0;const a=i(oO());t.GeoTIFFImage=a.default;const o=i(function(){if(sO)return lO;sO=1,Object.defineProperty(lO,"__esModule",{value:!0});const t=pI();return lO.default=class{constructor(t){this._dataView=new DataView(t)}get buffer(){return this._dataView.buffer}getUint64(t,e){const r=this.getUint32(t,e),n=this.getUint32(t+4,e);let i;if(e){if(i=r+2**32*n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*r+n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}getInt64(t,e){let r=0;const n=(128&this._dataView.getUint8(t+(e?7:0)))>0;let i=!0;for(let a=0;a<8;a++){let o=this._dataView.getUint8(t+(e?a:7-a));n&&(i?0!==o&&(o=255&~(o-1),i=!1):o=255&~o),r+=o*256**a}return n&&(r=-r),r}getUint8(t,e){return this._dataView.getUint8(t,e)}getInt8(t,e){return this._dataView.getInt8(t,e)}getUint16(t,e){return this._dataView.getUint16(t,e)}getInt16(t,e){return this._dataView.getInt16(t,e)}getUint32(t,e){return this._dataView.getUint32(t,e)}getInt32(t,e){return this._dataView.getInt32(t,e)}getFloat16(e,r){return(0,t.getFloat16)(this._dataView,e,r)}getFloat32(t,e){return this._dataView.getFloat32(t,e)}getFloat64(t,e){return this._dataView.getFloat64(t,e)}},lO}()),s=i((uO||(uO=1,Object.defineProperty(cO,"__esModule",{value:!0}),cO.default=class{constructor(t,e,r,n){this._dataView=new DataView(t),this._sliceOffset=e,this._littleEndian=r,this._bigTiff=n}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(t,e){return this.sliceOffset<=t&&this.sliceTop>=t+e}readUint8(t){return this._dataView.getUint8(t-this._sliceOffset,this._littleEndian)}readInt8(t){return this._dataView.getInt8(t-this._sliceOffset,this._littleEndian)}readUint16(t){return this._dataView.getUint16(t-this._sliceOffset,this._littleEndian)}readInt16(t){return this._dataView.getInt16(t-this._sliceOffset,this._littleEndian)}readUint32(t){return this._dataView.getUint32(t-this._sliceOffset,this._littleEndian)}readInt32(t){return this._dataView.getInt32(t-this._sliceOffset,this._littleEndian)}readFloat32(t){return this._dataView.getFloat32(t-this._sliceOffset,this._littleEndian)}readFloat64(t){return this._dataView.getFloat64(t-this._sliceOffset,this._littleEndian)}readUint64(t){const e=this.readUint32(t),r=this.readUint32(t+4);let n;if(this._littleEndian){if(n=e+2**32*r,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}if(n=2**32*e+r,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}readInt64(t){let e=0;const r=(128&this._dataView.getUint8(t+(this._littleEndian?7:0)))>0;let n=!0;for(let i=0;i<8;i++){let a=this._dataView.getUint8(t+(this._littleEndian?i:7-i));r&&(n?0!==a&&(a=255&~(a-1),n=!1):a=255&~a),e+=a*256**i}return r&&(e=-e),e}readOffset(t){return this._bigTiff?this.readUint64(t):this.readUint32(t)}}),cO)),l=i(function(){if(pO)return mO;pO=1;var t=af&&af.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),e=af&&af.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),r=af&&af.__importStar||function(r){if(r&&r.__esModule)return r;var n={};if(null!=r)for(var i in r)"default"!==i&&Object.prototype.hasOwnProperty.call(r,i)&&t(n,r,i);return e(n,r),n};Object.defineProperty(mO,"__esModule",{value:!0});const n=rO(),i="undefined"!=typeof navigator&&navigator.hardwareConcurrency||2;return mO.default=class{constructor(t=i,e){this.workers=null,this._awaitingDecoder=null,this.size=t,this.messageId=0,t&&(this._awaitingDecoder=e?Promise.resolve(e):new Promise((t=>{Promise.resolve().then((()=>r(vO()))).then((e=>{t(e.create)}))})),this._awaitingDecoder.then((e=>{this._awaitingDecoder=null,this.workers=[];for(let r=0;r<t;r++)this.workers.push({worker:e(),idle:!0})})))}async decode(t,e){return this._awaitingDecoder&&await this._awaitingDecoder,0===this.size?(0,n.getDecoder)(t).then((r=>r.decode(t,e))):new Promise((r=>{const n=this.workers.find((t=>t.idle))||this.workers[Math.floor(Math.random()*this.size)];n.idle=!1;const i=this.messageId++,a=t=>{t.data.id===i&&(n.idle=!0,r(t.data.decoded),n.worker.removeEventListener("message",a))};n.worker.addEventListener("message",a),n.worker.postMessage({fileDirectory:t,buffer:e,id:i},[e])}))}destroy(){this.workers&&(this.workers.forEach((t=>{t.worker.terminate()})),this.workers=null)}},mO}());t.Pool=l.default;const u=jO(),c=function(){if(VO)return HO;VO=1,Object.defineProperty(HO,"__esModule",{value:!0}),HO.makeBufferSource=void 0;const t=MO(),e=CO();class r extends t.BaseSource{constructor(t){super(),this.arrayBuffer=t}fetchSlice(t,r){if(r&&r.aborted)throw new e.AbortError("Request aborted");return this.arrayBuffer.slice(t.offset,t.offset+t.length)}}return HO.makeBufferSource=function(t){return new r(t)},HO}(),h=function(){if(WO)return qO;WO=1,Object.defineProperty(qO,"__esModule",{value:!0}),qO.makeFileReaderSource=void 0;const t=MO();class e extends t.BaseSource{constructor(t){super(),this.file=t}async fetchSlice(t,e){return new Promise(((r,n)=>{const i=this.file.slice(t.offset,t.offset+t.length),a=new FileReader;a.onload=t=>r(t.target.result),a.onerror=n,a.onabort=n,a.readAsArrayBuffer(i),e&&e.addEventListener("abort",(()=>a.abort()))}))}}return qO.makeFileReaderSource=function(t){return new e(t)},qO}(),d=ZO(),f=FI(),p=QO(),m=n(FI());t.globals=m;const g=n(BI());t.rgb=g;const v=rO();Object.defineProperty(t,"getDecoder",{enumerable:!0,get:function(){return v.getDecoder}}),Object.defineProperty(t,"addDecoder",{enumerable:!0,get:function(){return v.addDecoder}});const y=function(){if($O)return nD;$O=1,Object.defineProperty(nD,"__esModule",{value:!0}),nD.timeEnd=nD.time=nD.error=nD.warn=nD.info=nD.log=nD.debug=nD.setLogger=void 0;class t{log(){}debug(){}info(){}warn(){}error(){}time(){}timeEnd(){}}let e=new t;return nD.setLogger=function(r=new t){e=r},nD.debug=function(...t){return e.debug(...t)},nD.log=function(...t){return e.log(...t)},nD.info=function(...t){return e.info(...t)},nD.warn=function(...t){return e.warn(...t)},nD.error=function(...t){return e.error(...t)},nD.time=function(...t){return e.time(...t)},nD.timeEnd=function(...t){return e.timeEnd(...t)},nD}();Object.defineProperty(t,"setLogger",{enumerable:!0,get:function(){return y.setLogger}});var x=XI();function _(t){switch(t){case f.fieldTypes.BYTE:case f.fieldTypes.ASCII:case f.fieldTypes.SBYTE:case f.fieldTypes.UNDEFINED:return 1;case f.fieldTypes.SHORT:case f.fieldTypes.SSHORT:return 2;case f.fieldTypes.LONG:case f.fieldTypes.SLONG:case f.fieldTypes.FLOAT:case f.fieldTypes.IFD:return 4;case f.fieldTypes.RATIONAL:case f.fieldTypes.SRATIONAL:case f.fieldTypes.DOUBLE:case f.fieldTypes.LONG8:case f.fieldTypes.SLONG8:case f.fieldTypes.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${t}`)}}function w(t,e,r,n){let i=null,a=null;const o=_(e);switch(e){case f.fieldTypes.BYTE:case f.fieldTypes.ASCII:case f.fieldTypes.UNDEFINED:i=new Uint8Array(r),a=t.readUint8;break;case f.fieldTypes.SBYTE:i=new Int8Array(r),a=t.readInt8;break;case f.fieldTypes.SHORT:i=new Uint16Array(r),a=t.readUint16;break;case f.fieldTypes.SSHORT:i=new Int16Array(r),a=t.readInt16;break;case f.fieldTypes.LONG:case f.fieldTypes.IFD:i=new Uint32Array(r),a=t.readUint32;break;case f.fieldTypes.SLONG:i=new Int32Array(r),a=t.readInt32;break;case f.fieldTypes.LONG8:case f.fieldTypes.IFD8:i=new Array(r),a=t.readUint64;break;case f.fieldTypes.SLONG8:i=new Array(r),a=t.readInt64;break;case f.fieldTypes.RATIONAL:i=new Uint32Array(2*r),a=t.readUint32;break;case f.fieldTypes.SRATIONAL:i=new Int32Array(2*r),a=t.readInt32;break;case f.fieldTypes.FLOAT:i=new Float32Array(r),a=t.readFloat32;break;case f.fieldTypes.DOUBLE:i=new Float64Array(r),a=t.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e!==f.fieldTypes.RATIONAL&&e!==f.fieldTypes.SRATIONAL)for(let e=0;e<r;++e)i[e]=a.call(t,n+e*o);else for(let e=0;e<r;e+=2)i[e]=a.call(t,n+e*o),i[e+1]=a.call(t,n+(e*o+4));return e===f.fieldTypes.ASCII?new TextDecoder("utf-8").decode(i):i}Object.defineProperty(t,"BaseDecoder",{enumerable:!0,get:function(){return i(x).default}});class b{constructor(t,e,r){this.fileDirectory=t,this.geoKeyDirectory=e,this.nextIFDByteOffset=r}}class M extends Error{constructor(t){super(`No image at index ${t}`),this.index=t}}class S{async readRasters(t={}){const{window:e,width:r,height:n}=t;let{resX:i,resY:a,bbox:o}=t;const s=await this.getImage();let l=s;const u=await this.getImageCount(),c=s.getBoundingBox();if(e&&o)throw new Error('Both "bbox" and "window" passed.');if(r||n){if(e){const[t,r]=s.getOrigin(),[n,i]=s.getResolution();o=[t+e[0]*n,r+e[1]*i,t+e[2]*n,r+e[3]*i]}const t=o||c;if(r){if(i)throw new Error("Both width and resX passed");i=(t[2]-t[0])/r}if(n){if(a)throw new Error("Both width and resY passed");a=(t[3]-t[1])/n}}if(i||a){const t=[];for(let e=0;e<u;++e){const r=await this.getImage(e),{SubfileType:n,NewSubfileType:i}=r.fileDirectory;(0===e||2===n||1&i)&&t.push(r)}t.sort(((t,e)=>t.getWidth()-e.getWidth()));for(let e=0;e<t.length;++e){const r=t[e],n=(c[2]-c[0])/r.getWidth(),o=(c[3]-c[1])/r.getHeight();if(l=r,i&&i>n||a&&a>o)break}}let h=e;if(o){const[t,e]=s.getOrigin(),[r,n]=l.getResolution(s);h=[Math.round((o[0]-t)/r),Math.round((o[1]-e)/n),Math.round((o[2]-t)/r),Math.round((o[3]-e)/n)],h=[Math.min(h[0],h[2]),Math.min(h[1],h[3]),Math.max(h[0],h[2]),Math.max(h[1],h[3])]}return l.readRasters({...t,window:h})}}class T extends S{constructor(t,e,r,n,i={}){super(),this.source=t,this.littleEndian=e,this.bigTiff=r,this.firstIFDOffset=n,this.cache=i.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(t,e){const r=this.bigTiff?4048:1024;return new s.default((await this.source.fetch([{offset:t,length:void 0!==e?e:r}]))[0],t,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(t){const e=this.bigTiff?20:12,r=this.bigTiff?8:2;let n=await this.getSlice(t);const i=this.bigTiff?n.readUint64(t):n.readUint16(t),a=i*e+(this.bigTiff?16:6);n.covers(t,a)||(n=await this.getSlice(t,a));const o={};let s=t+(this.bigTiff?8:2);for(let t=0;t<i;s+=e,++t){const t=n.readUint16(s),e=n.readUint16(s+2),r=this.bigTiff?n.readUint64(s+4):n.readUint32(s+4);let i,a;const l=_(e),u=s+(this.bigTiff?12:8);if(l*r<=(this.bigTiff?8:4))i=w(n,e,r,u);else{const t=n.readOffset(u),a=_(e)*r;if(n.covers(t,a))i=w(n,e,r,t);else{i=w(await this.getSlice(t,a),e,r,t)}}a=1===r&&-1===f.arrayFields.indexOf(t)&&e!==f.fieldTypes.RATIONAL&&e!==f.fieldTypes.SRATIONAL?i[0]:i,o[f.fieldTagNames[t]]=a}const l=function(t){const e=t.GeoKeyDirectory;if(!e)return null;const r={};for(let n=4;n<=4*e[3];n+=4){const i=f.geoKeyNames[e[n]],a=e[n+1]?f.fieldTagNames[e[n+1]]:null,o=e[n+2],s=e[n+3];let l=null;if(a){if(l=t[a],null==l)throw new Error(`Could not get value of geoKey '${i}'.`);"string"==typeof l?l=l.substring(s,s+o-1):l.subarray&&(l=l.subarray(s,s+o),1===o&&(l=l[0]))}else l=s;r[i]=l}return r}(o),u=n.readOffset(t+r+e*i);return new b(o,l,u)}async requestIFD(t){if(this.ifdRequests[t])return this.ifdRequests[t];if(0===t)return this.ifdRequests[t]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[t];if(!this.ifdRequests[t-1])try{this.ifdRequests[t-1]=this.requestIFD(t-1)}catch(e){if(e instanceof M)throw new M(t);throw e}return this.ifdRequests[t]=(async()=>{const e=await this.ifdRequests[t-1];if(0===e.nextIFDByteOffset)throw new M(t);return this.parseFileDirectoryAt(e.nextIFDByteOffset)})(),this.ifdRequests[t]}async getImage(t=0){const e=await this.requestIFD(t);return new a.default(e.fileDirectory,e.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let t=0,e=!0;for(;e;)try{await this.requestIFD(t),++t}catch(t){if(!(t instanceof M))throw t;e=!1}return t}async getGhostValues(){const t=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const e="GDAL_STRUCTURAL_METADATA_SIZE=";let r=await this.getSlice(t,130);if(e===w(r,f.fieldTypes.ASCII,30,t)){const e=w(r,f.fieldTypes.ASCII,130,t).split("\n")[0],n=Number(e.split("=")[1].split(" ")[0])+e.length;n>130&&(r=await this.getSlice(t,n));const i=w(r,f.fieldTypes.ASCII,n,t);this.ghostValues={},i.split("\n").filter((t=>t.length>0)).map((t=>t.split("="))).forEach((([t,e])=>{this.ghostValues[t]=e}))}return this.ghostValues}static async fromSource(t,e,r){const n=(await t.fetch([{offset:0,length:1024}],r))[0],i=new o.default(n),a=i.getUint16(0,0);let s;if(18761===a)s=!0;else{if(19789!==a)throw new TypeError("Invalid byte order value.");s=!1}const l=i.getUint16(2,s);let u;if(42===l)u=!1;else{if(43!==l)throw new TypeError("Invalid magic number.");u=!0;if(8!==i.getUint16(4,s))throw new Error("Unsupported offset byte-size.")}const c=u?i.getUint64(8,s):i.getUint32(4,s);return new T(t,s,u,c,e)}close(){return"function"==typeof this.source.close&&this.source.close()}}t.GeoTIFF=T,t.default=T;class E extends S{constructor(t,e){super(),this.mainFile=t,this.overviewFiles=e,this.imageFiles=[t].concat(e),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const t=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map((t=>t.parseFileDirectoryAt(t.firstIFDOffset))));return this.fileDirectoriesPerFile=await Promise.all(t),this.fileDirectoriesPerFile}async getImage(t=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let e=0,r=0;for(let n=0;n<this.imageFiles.length;n++){const i=this.imageFiles[n];for(let o=0;o<this.imageCounts[n];o++){if(t===e){const t=await i.requestIFD(r);return new a.default(t.fileDirectory,t.geoKeyDirectory,i.dataView,i.littleEndian,i.cache,i.source)}e++,r++}r=0}throw new RangeError("Invalid image index")}async getImageCount(){if(null!==this.imageCount)return this.imageCount;const t=[this.mainFile.getImageCount()].concat(this.overviewFiles.map((t=>t.getImageCount())));return this.imageCounts=await Promise.all(t),this.imageCount=this.imageCounts.reduce(((t,e)=>t+e),0),this.imageCount}}t.MultiGeoTIFF=E,t.fromUrl=async function(t,e={},r){return T.fromSource((0,u.makeRemoteSource)(t,e),r)},t.fromArrayBuffer=async function(t,e){return T.fromSource((0,c.makeBufferSource)(t),e)},t.fromFile=async function(t,e){return T.fromSource((0,d.makeFileSource)(t),e)},t.fromBlob=async function(t,e){return T.fromSource((0,h.makeFileReaderSource)(t),e)},t.fromUrls=async function(t,e=[],r={},n){const i=await T.fromSource((0,u.makeRemoteSource)(t,r),n),a=await Promise.all(e.map((t=>T.fromSource((0,u.makeRemoteSource)(t,r)))));return new E(i,a)},t.writeArrayBuffer=function(t,e){return(0,p.writeGeotiff)(t,e)}}(BC)),BC}function aD(){if(eD)return PC;eD=1;var t=uf;Object.defineProperty(PC,"__esModule",{value:!0}),PC.default=void 0;var e=t(function(){if(RC)return AC;RC=1;var t=LC()();AC=t;try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}return AC}()),r=t((OC||(OC=1,function(t){function e(t,e,r,n,i,a,o){try{var s=t[a](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}t.exports=function(t){return function(){var r=this,n=arguments;return new Promise((function(i,a){var o=t.apply(r,n);function s(t){e(o,i,a,s,l,"next",t)}function l(t){e(o,i,a,s,l,"throw",t)}s(void 0)}))}},t.exports.__esModule=!0,t.exports.default=t.exports}(kC)),DC)),n=t(OM()),i=Bf,a=iD(),o=t(pM()),s=t(dS()),l=t(Qb());function u(t,e){for(var r=1/0,n=-1/0,i=0,a=t.length;i<a;i++){var o=t[i];o!==e&&(r=Math.min(o,r),n=Math.max(o,n))}return{min:r,max:n}}function c(t,e,r){var i=(0,n.default)(t.origin,2),a=i[0],o=i[1],s=(0,n.default)(r,2),l=s[0],u=s[1],c=e._values,h=[Math.round((c[0]-a)/l),Math.round((c[2]-o)/u),Math.round((c[1]-a)/l),Math.round((c[3]-o)/u)];return[Math.min(h[0],h[2]),Math.min(h[1],h[3]),Math.max(h[0],h[2]),Math.max(h[1],h[3])]}function h(){return d.apply(this,arguments)}function d(){return(d=(0,r.default)(e.default.mark((function t(r,n){var a,l,h,d,f,m,g,v,y,x;return e.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.image.readRasters({window:c(r,r.extent,n.resolution),fillValue:r.nodata});case 2:a=t.sent,l=u(a[0],r.nodata),h=l.min,d=l.max,r.dataMin=h,r.dataMax=d,f={pitch:new i.Vector4(0,0,1,1),texture:new i.Texture},m=p(r,a),g=m.data,v=m.width,y=m.height,f.texture.image=s.default.bufferToImage(g,v,y),f.texture.extent=r.extent,x="".concat(r.id).concat(r.extent._values.join(",")),o.default.set(x,f);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function f(){return(f=(0,r.default)(e.default.mark((function t(r){var n,i,o,s,l,u;return e.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,a.fromUrl)(r.source.url);case 2:return n=t.sent,t.next=5,n.getImageCount();case 5:return i=t.sent,t.next=8,n.getImage();case 8:o=t.sent,r.origin=o.getOrigin(),r.nodata=o.getGDALNoData(),r.images=[{image:o,width:o.getWidth(),height:o.getHeight(),resolution:o.getResolution()}],u=1;case 13:if(!(u<i)){t.next=22;break}return t.next=16,n.getImage(u);case 16:s=t.sent,l={image:s,width:s.getWidth(),height:s.getHeight(),resolution:s.getResolution(o)},r.images.push(l);case 19:u++,t.next=13;break;case 22:if(1!==s.getSamplesPerPixel()){t.next=25;break}return t.next=25,h(r,l);case 25:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function p(t,e){var r=e.width,i=e.height,a=new Uint8ClampedArray(r*i*4);if(3===e.length)for(var o=(0,n.default)(e,3),s=o[0],l=o[1],u=o[2],c=0,h=s.length;c<h;c++){var d=4*c;a[d+0]=s[c],a[d+1]=l[c],a[d+2]=u[c],a[d+3]=255}else{1!==e.length&&console.warn("Band selection isn't implemented yet.","Processing the first one as if it was a 1-band file.");for(var f=(0,n.default)(e,1)[0],p=t.nodata,m=t.dataMin,g=255/(t.dataMax-m),v=0,y=f.length;v<y;v++){var x=f[v],_=Math.round((x-m)*g),w=4*v;a[w+0]=_,a[w+1]=_,a[w+2]=_,a[w+3]=x===p?0:255}}return{data:a,width:r,height:i}}var m={executeCommand:function(t){var e=t.layer,r=t.requester,n="".concat(e.id).concat(r.extent._values.join(",")),a=o.default.get(n);if(a)return Promise.resolve(a);a={pitch:new i.Vector4(0,0,1,1),texture:new i.Texture};var u=t.toDownload,h=u.extent,d=u.levelImage;return d.image.readRasters({pool:e.pool,window:c(e,h,d.resolution),fillValue:e.nodata}).then((function(t){if(e instanceof l.default){var i=p(e,t),u=i.data,c=i.width,h=i.height;return a.texture.image=s.default.bufferToImage(u,c,h),a.texture.extent=r.extent,o.default.set(n,a),a}throw new Error("Elevation support for COG not yet implemented")})).catch((function(t){if("AggregateError: Request failed"===t.toString())return a;throw new Error(t)}))},getPossibleTextureImprovements:function(t,e,r){if(r&&r.extent&&r.extent.isInside(e))return null;for(var n=t.images.length-1,i=e.dimensions(),a=i.x/t.dimension.x,o=i.y/t.dimension.y,s=n,l=t.images[s],u=l.width*a,c=l.height*o;s>0&&u<t.imageSize.w&&c<t.imageSize.h;)s--,u=(l=t.images[s]).width*a,c=l.height*o;return{extent:e,levelImage:l}},preprocessDataLayer:function(t){return t.pool=new a.Pool,t.imageSize={w:256,h:256},t.dimension=t.extent.dimensions(),function(){return f.apply(this,arguments)}(t)},tileInsideLimit:function(t,e){return t.getExtentForLayer(e).isInside(e.extent)}};return PC.default=m,PC}var oD,sD,lD={},uD={},cD={get exports(){return uD},set exports(t){uD=t}};function hD(){if(oD)return uD;function t(t,r,i){i=i||2;var a,o,s,c,h,f,p,m=r&&r.length,g=m?r[0]*i:t.length,v=e(t,0,g,i,!0),y=[];if(!v||v.next===v.prev)return y;if(m&&(v=function(t,r,n,i){var a,o,s,c=[];for(a=0,o=r.length;a<o;a++)(s=e(t,r[a]*i,a<o-1?r[a+1]*i:t.length,i,!1))===s.next&&(s.steiner=!0),c.push(d(s));for(c.sort(l),a=0;a<c.length;a++)n=u(c[a],n);return n}(t,r,v,i)),t.length>80*i){a=s=t[0],o=c=t[1];for(var x=i;x<g;x+=i)(h=t[x])<a&&(a=h),(f=t[x+1])<o&&(o=f),h>s&&(s=h),f>c&&(c=f);p=0!==(p=Math.max(s-a,c-o))?32767/p:0}return n(v,y,i,a,o,p,0),y}function e(t,e,r,n,i){var a,o;if(i===T(t,e,r,n)>0)for(a=e;a<r;a+=n)o=b(a,t[a],t[a+1],o);else for(a=r-n;a>=e;a-=n)o=b(a,t[a],t[a+1],o);return o&&g(o,o.next)&&(M(o),o=o.next),o}function r(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!g(n,n.next)&&0!==m(n.prev,n,n.next))n=n.next;else{if(M(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function n(t,e,l,u,c,d,f){if(t){!f&&d&&function(t,e,r,n){var i=t;do{0===i.z&&(i.z=h(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,a,o,s,l,u=1;do{for(r=t,t=null,a=null,o=0;r;){for(o++,n=r,s=0,e=0;e<u&&(s++,n=n.nextZ);e++);for(l=u;s>0||l>0&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),a?a.nextZ=i:t=i,i.prevZ=a,a=i;r=n}a.nextZ=null,u*=2}while(o>1)}(i)}(t,u,c,d);for(var p,m,g=t;t.prev!==t.next;)if(p=t.prev,m=t.next,d?a(t,u,c,d):i(t))e.push(p.i/l|0),e.push(t.i/l|0),e.push(m.i/l|0),M(t),t=m.next,g=m.next;else if((t=m)===g){f?1===f?n(t=o(r(t),e,l),e,l,u,c,d,2):2===f&&s(t,e,l,u,c,d):n(r(t),e,l,u,c,d,1);break}}}function i(t){var e=t.prev,r=t,n=t.next;if(m(e,r,n)>=0)return!1;for(var i=e.x,a=r.x,o=n.x,s=e.y,l=r.y,u=n.y,c=i<a?i<o?i:o:a<o?a:o,h=s<l?s<u?s:u:l<u?l:u,d=i>a?i>o?i:o:a>o?a:o,p=s>l?s>u?s:u:l>u?l:u,g=n.next;g!==e;){if(g.x>=c&&g.x<=d&&g.y>=h&&g.y<=p&&f(i,s,a,l,o,u,g.x,g.y)&&m(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function a(t,e,r,n){var i=t.prev,a=t,o=t.next;if(m(i,a,o)>=0)return!1;for(var s=i.x,l=a.x,u=o.x,c=i.y,d=a.y,p=o.y,g=s<l?s<u?s:u:l<u?l:u,v=c<d?c<p?c:p:d<p?d:p,y=s>l?s>u?s:u:l>u?l:u,x=c>d?c>p?c:p:d>p?d:p,_=h(g,v,e,r,n),w=h(y,x,e,r,n),b=t.prevZ,M=t.nextZ;b&&b.z>=_&&M&&M.z<=w;){if(b.x>=g&&b.x<=y&&b.y>=v&&b.y<=x&&b!==i&&b!==o&&f(s,c,l,d,u,p,b.x,b.y)&&m(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,M.x>=g&&M.x<=y&&M.y>=v&&M.y<=x&&M!==i&&M!==o&&f(s,c,l,d,u,p,M.x,M.y)&&m(M.prev,M,M.next)>=0)return!1;M=M.nextZ}for(;b&&b.z>=_;){if(b.x>=g&&b.x<=y&&b.y>=v&&b.y<=x&&b!==i&&b!==o&&f(s,c,l,d,u,p,b.x,b.y)&&m(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;M&&M.z<=w;){if(M.x>=g&&M.x<=y&&M.y>=v&&M.y<=x&&M!==i&&M!==o&&f(s,c,l,d,u,p,M.x,M.y)&&m(M.prev,M,M.next)>=0)return!1;M=M.nextZ}return!0}function o(t,e,n){var i=t;do{var a=i.prev,o=i.next.next;!g(a,o)&&v(a,i,i.next,o)&&_(a,o)&&_(o,a)&&(e.push(a.i/n|0),e.push(i.i/n|0),e.push(o.i/n|0),M(i),M(i.next),i=t=o),i=i.next}while(i!==t);return r(i)}function s(t,e,i,a,o,s){var l=t;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&p(l,u)){var c=w(l,u);return l=r(l,l.next),c=r(c,c.next),n(l,e,i,a,o,s,0),void n(c,e,i,a,o,s,0)}u=u.next}l=l.next}while(l!==t)}function l(t,e){return t.x-e.x}function u(t,e){var n=function(t,e){var r,n=e,i=t.x,a=t.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>o&&(o=s,r=n.x<n.next.x?n:n.next,s===i))return r}n=n.next}while(n!==e);if(!r)return null;var l,u=r,h=r.x,d=r.y,p=1/0;n=r;do{i>=n.x&&n.x>=h&&i!==n.x&&f(a<d?i:o,a,h,d,a<d?o:i,a,n.x,n.y)&&(l=Math.abs(a-n.y)/(i-n.x),_(n,t)&&(l<p||l===p&&(n.x>r.x||n.x===r.x&&c(r,n)))&&(r=n,p=l)),n=n.next}while(n!==u);return r}(t,e);if(!n)return e;var i=w(n,t);return r(i,i.next),r(n,n.next)}function c(t,e){return m(t.prev,t,e.prev)<0&&m(e.next,t,t.next)<0}function h(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function d(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function f(t,e,r,n,i,a,o,s){return(i-o)*(e-s)>=(t-o)*(a-s)&&(t-o)*(n-s)>=(r-o)*(e-s)&&(r-o)*(a-s)>=(i-o)*(n-s)}function p(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&v(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(_(t,e)&&_(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,a=(t.y+e.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(m(t.prev,t,e.prev)||m(t,e.prev,e))||g(t,e)&&m(t.prev,t,t.next)>0&&m(e.prev,e,e.next)>0)}function m(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function g(t,e){return t.x===e.x&&t.y===e.y}function v(t,e,r,n){var i=x(m(t,e,r)),a=x(m(t,e,n)),o=x(m(r,n,t)),s=x(m(r,n,e));return i!==a&&o!==s||(!(0!==i||!y(t,r,e))||(!(0!==a||!y(t,n,e))||(!(0!==o||!y(r,t,n))||!(0!==s||!y(r,e,n)))))}function y(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function x(t){return t>0?1:t<0?-1:0}function _(t,e){return m(t.prev,t,t.next)<0?m(t,e,t.next)>=0&&m(t,t.prev,e)>=0:m(t,e,t.prev)<0||m(t,t.next,e)<0}function w(t,e){var r=new S(t.i,t.x,t.y),n=new S(e.i,e.x,e.y),i=t.next,a=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function b(t,e,r,n){var i=new S(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function M(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function S(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function T(t,e,r,n){for(var i=0,a=e,o=r-n;a<r;a+=n)i+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return i}return oD=1,cD.exports=t,uD.default=t,t.deviation=function(t,e,r,n){var i=e&&e.length,a=i?e[0]*r:t.length,o=Math.abs(T(t,0,a,r));if(i)for(var s=0,l=e.length;s<l;s++){var u=e[s]*r,c=s<l-1?e[s+1]*r:t.length;o-=Math.abs(T(t,u,c,r))}var h=0;for(s=0;s<n.length;s+=3){var d=n[s]*r,f=n[s+1]*r,p=n[s+2]*r;h+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},t.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var a=0;a<t[i].length;a++)for(var o=0;o<e;o++)r.vertices.push(t[i][a][o]);i>0&&(n+=t[i-1].length,r.holes.push(n))}return r},uD}var dD=uf,fD=cf;Object.defineProperty(lf,"__esModule",{value:!0});var pD=lf.default=lf.INSTANCE_EVENTS=void 0,mD=dD(pf()),gD=dD(yf()),vD=dD(bf()),yD=dD(Cf()),xD=dD(Df()),_D=dD(Uf()),wD=Bf,bD=dD(pv),MD=ax,SD=dD(function(){if(Dx)return lx;Dx=1;var t=uf;Object.defineProperty(lx,"__esModule",{value:!0}),lx.default=void 0;var e=Bf,r=t(Ux());function n(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object.defineProperty(this,"crs",{get:function(){return t}}),this.camera3D=i.camera?i.camera:new e.PerspectiveCamera(30,r/n),this.camera3D.near=.1,this.camera3D.far=2e9,this.camera3D.updateProjectionMatrix(),this.camera2D=new e.OrthographicCamera(0,1,0,1,0,10),this._viewMatrix=new e.Matrix4,this.width=r,this.height=n,this._preSSE=1/0}n.prototype.update=function(t,e){!function(t,e,r){if(e&&r){t.width=e,t.height=r;var n=e/r;if(t.camera3D.aspect!==n&&(t.camera3D.aspect=n,t.camera3D.isOrthographicCamera)){var i=.5*(t.camera3D.right-t.camera3D.left)/n,a=.5*(t.camera3D.top+t.camera3D.bottom);t.camera3D.top=a+i,t.camera3D.bottom=a-i}}t.camera3D.updateProjectionMatrix&&t.camera3D.updateProjectionMatrix(),t.camera2D.right=e,t.camera2D.top=r,t.camera2D.bottom=0,t.camera2D.updateProjectionMatrix()}(this,t,e),this.camera3D.updateMatrixWorld(),this._viewMatrix.multiplyMatrices(this.camera3D.projectionMatrix,this.camera3D.matrixWorldInverse)},n.prototype.position=function(t){return new r.default(this.crs,this.camera3D.position).as(t||this.crs)};var i={frustum:new e.Frustum,matrix:new e.Matrix4,box3:new e.Box3},a=[new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3],o=new e.Box3(new e.Vector3(-1,-1,-1),new e.Vector3(1,1,1));n.prototype.isBox3Visible=function(t,e){return this.box3SizeOnScreen(t,e).intersectsBox(o)},n.prototype.isSphereVisible=function(t,e){return e?(i.matrix.multiplyMatrices(this._viewMatrix,e),i.frustum.setFromProjectionMatrix(i.matrix)):i.frustum.setFromProjectionMatrix(this._viewMatrix),i.frustum.intersectsSphere(t)},n.prototype.box3SizeOnScreen=function(t,e){var r=function(t,e,r){var n=t.camera3D.matrixWorldInverse;r&&(n=i.matrix.multiplyMatrices(t.camera3D.matrixWorldInverse,r)),a[0].set(e.min.x,e.min.y,e.min.z).applyMatrix4(n),a[1].set(e.min.x,e.min.y,e.max.z).applyMatrix4(n),a[2].set(e.min.x,e.max.y,e.min.z).applyMatrix4(n),a[3].set(e.min.x,e.max.y,e.max.z).applyMatrix4(n),a[4].set(e.max.x,e.min.y,e.min.z).applyMatrix4(n),a[5].set(e.max.x,e.min.y,e.max.z).applyMatrix4(n),a[6].set(e.max.x,e.max.y,e.min.z).applyMatrix4(n),a[7].set(e.max.x,e.max.y,e.max.z).applyMatrix4(n);for(var o=!1,s=0;s<8;s++)a[s].z<=-t.camera3D.near?o=!0:a[s].z=-t.camera3D.near;return o?a:void 0}(this,t,e);if(!r)return i.box3.makeEmpty();for(var n=0;n<8;n++)r[n].applyMatrix4(this.camera3D.projectionMatrix);return i.box3.setFromPoints(r)};var s=n;return lx.default=s,lx}()),TD=kD(function(){if(lS)return Bx;lS=1;var t=uf;Object.defineProperty(Bx,"__esModule",{value:!0}),Bx.default=Bx.RENDERING_SCHEDULED=Bx.RENDERING_PAUSED=Bx.MAIN_LOOP_EVENTS=void 0;var e=Bf,r=t(jb()),n=t(oS()),i=t(pM()),a=t(function(){if(sS)return uS;sS=1;var t=uf;Object.defineProperty(uS,"__esModule",{value:!0}),uS.default=void 0;var e=t(yf()),r=t(pf()),n=Bf,i=(0,e.default)((function t(e,i,a){(0,r.default)(this,t),this.camera=e,this.scheduler=i,this.instance=a,this.distance={plane:(new n.Plane).setFromNormalAndCoplanarPoint(e.camera3D.getWorldDirection(new n.Vector3),e.camera3D.position),min:1/0,max:0},this.fastUpdateHint=void 0}));return uS.default=i,uS}());function o(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){l=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(l)throw a}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var l=0;Bx.RENDERING_PAUSED=l,Bx.RENDERING_SCHEDULED=1;var u=new e.Sphere,c={UPDATE_START:"update_start",BEFORE_CAMERA_UPDATE:"before_camera_update",AFTER_CAMERA_UPDATE:"after_camera_update",BEFORE_LAYER_UPDATE:"before_layer_update",AFTER_LAYER_UPDATE:"after_layer_update",BEFORE_RENDER:"before_render",AFTER_RENDER:"after_render",UPDATE_END:"update_end"};function h(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.renderingState=l,this.needsRedraw=!1,this.scheduler=t,this.gfxEngine=e,this._updateLoopRestarted=!0,this.maxFar=r.maxFar||2e9,this.minNear=r.minNear||.1}function d(t,e,r){if(r){var n,i=o(r);try{for(i.s();!(n=i.n()).done;){var a=n.value,s=e.update(t,a),l=e.getObjectToUpdateForAttachedLayers(a);if(l)if(l.element){var u,c=o(e._attachedLayers);try{for(c.s();!(u=c.n()).done;){var h=u.value;h.ready&&h.update(t,l.element,l.parent)}}catch(t){c.e(t)}finally{c.f()}}else if(l.elements)for(var f=0;f<l.elements.length;f++){if(!l.elements[f].isObject3D)throw new Error("\n                            Invalid object for attached layer to update.\n                            Must be a THREE.Object and have a THREE.Material");var p,m=o(e._attachedLayers);try{for(m.s();!(p=m.n()).done;){var g=p.value;g.ready&&g.update(t,l.elements[f],l.parent)}}catch(t){m.e(t)}finally{m.f()}}d(t,e,s)}}catch(t){i.e(t)}finally{i.f()}}}function f(t,e){var r=!1,n=new Set;return t.forEach((function(t){t===e||t.isCamera?r=!0:t.layer===e&&n.add(t)})),r?new Set([e]):n}Bx.MAIN_LOOP_EVENTS=c,h.prototype=Object.create(e.EventDispatcher.prototype),h.prototype.constructor=h,h.prototype.scheduleUpdate=function(t,e){var r=this;this.needsRedraw|=e,1!==this.renderingState&&(this.renderingState=1,requestAnimationFrame((function(e){r._step(t,e)})))},h.prototype._update=function(t,i,s){var l=new a.default(t.camera,this.scheduler,t);t.camera.camera3D.near=this.minNear,t.camera.camera3D.far=this.maxFar,t.camera.update(),i.forEach((function(e){var a=e.layer||e;a instanceof r.default&&(a instanceof n.default||i.add(t.getOwner(a)))}));var h,p=o(t.getObjects());try{for(p.s();!(h=p.n()).done;){var m=h.value;if(l.fastUpdateHint=void 0,l.entity=m,m.ready&&m.visible){t.execFrameRequesters(c.BEFORE_LAYER_UPDATE,s,this._updateLoopRestarted,m);var g=f(i,m);if(g.size>0){m._distance.min=1/0,m._distance.max=0;var v=m.preUpdate(l,g);d(l,m,v),m.postUpdate(l,i)}m._distance&&(l.distance.min=Math.min(l.distance.min,m._distance.min),m._distance.max===1/0?l.distance.max=this.maxFar:l.distance.max=Math.max(l.distance.max,m._distance.max)),t.execFrameRequesters(c.AFTER_LAYER_UPDATE,s,this._updateLoopRestarted,m)}}}catch(t){p.e(t)}finally{p.f()}t.threeObjects.traverse((function(t){if(t.visible&&t.geometry&&t.geometry.boundingSphere){u.copy(t.geometry.boundingSphere),u.applyMatrix4(t.matrixWorld);var r=u.distanceToPoint(l.camera.camera3D.position);l.distance.min=e.Math.clamp(r,0,l.distance.min),l.distance.max=Math.max(l.distance.max,r+2*u.radius)}}));var y=l.distance.min;t.camera.camera3D.isPerspective&&(y*=y*Math.cos(e.Math.degToRad(t.camera.camera3D.fov/2))),y=y===1/0?this.minNear:e.Math.clamp(y,this.minNear,this.maxFar),t.camera.camera3D.near=y;var x=0===l.distance.max?this.maxFar:e.Math.clamp(l.distance.max,y,this.maxFar);t.camera.camera3D.far=x,t.camera.update()},h.prototype._step=function(t,e){var r=e-this._lastTimestamp;t._executeFrameRequestersRemovals(),t.execFrameRequesters(c.UPDATE_START,r,this._updateLoopRestarted);var n=this.needsRedraw;this._lastTimestamp=e,this.needsRedraw=!1,this.renderingState=l;var a=new Set(t._changeSources);t._changeSources.clear();var o=this.gfxEngine.getWindowSize();t.execFrameRequesters(c.BEFORE_CAMERA_UPDATE,r,this._updateLoopRestarted),t.camera.update(o.x,o.y),t.execFrameRequesters(c.AFTER_CAMERA_UPDATE,r,this._updateLoopRestarted);var s=t.camera.camera3D.matrixAutoUpdate;t.camera.camera3D.matrixAutoUpdate=!1,this._update(t,a,r),0===this.scheduler.commandsWaitingExecutionCount()&&this.dispatchEvent({type:"command-queue-empty"}),n&&this._renderInstance(t,r),this._updateLoopRestarted=this.renderingState===l,t.camera.camera3D.matrixAutoUpdate=s,i.default.flush(),t.execFrameRequesters(c.UPDATE_END,r,this._updateLoopRestarted)},h.prototype._renderInstance=function(t,e){t.execFrameRequesters(c.BEFORE_RENDER,e,this._updateLoopRestarted),t.render?t.render():this.gfxEngine.renderView(t),t.execFrameRequesters(c.AFTER_RENDER,e,this._updateLoopRestarted)};var p=h;return Bx.default=p,Bx}()),ED=dD(dS()),AD=Ob(),RD=kD(jb()),PD=dD(oS()),CD=dD(function(){if(rD)return fS;rD=1;var t=uf;Object.defineProperty(fS,"__esModule",{value:!0}),fS.default=void 0;var e=t(yS()),r=t(xS),n=t(jS()),i=t(tA()),a=t(DA()),o=t(WA()),s=t(nR()),l=t(sR()),u=t(bC()),c=t(TC()),h=t(aD()),d=t(Jb()),f=t(pM());function p(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return m(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function g(t,e){var r=e.priority-t.priority;return 0===r?e.timestamp-t.timestamp:r}function v(){return{queue:function(t){var r=t.layer,n=this.storages.get(r.id);n||(n={q:new e.default({comparator:g}),priority:1,accumulator:0},this.storages.set(r.id,n)),n.priority=r.priority||1,n.q.queue(t),this.counters.pending++},storages:new Map,counters:{executing:0,executed:0,failed:0,cancelled:0,pending:0},execute:function(t,e){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this.counters.pending-=n,this.counters.executing+=n,e.executeCommand(t).then((function(e){r.counters.executing-=n,t.resolve(e),r.counters.executed+=n}),(function(e){r.counters.executing-=n,t.reject(e),r.counters.failed+=n,r.counters.failed<3&&console.error(e)}))}}}function y(){this.defaultQueue=v(),this.hostQueues=new Map,this.providers={},this.maxCommandsPerHost=6,this.initDefaultProviders()}function x(t){return!!t.toDownload&&(t.url?!!f.default.get(t.url):!!t.tile&&t.tile.getState()===r.default.LOADED)}y.prototype.constructor=y,y.prototype.initDefaultProviders=function(){this.addProtocolProvider("tile",n.default),this.addProtocolProvider("3d-tiles",i.default),this.addProtocolProvider("tms",a.default),this.addProtocolProvider("xyz",a.default),this.addProtocolProvider("potreeconverter",o.default),this.addProtocolProvider("customtiledimage",s.default),this.addProtocolProvider("oltile",l.default),this.addProtocolProvider("olvectortile",u.default),this.addProtocolProvider("olvector",c.default),this.addProtocolProvider("cog",h.default)},y.prototype.runCommand=function(t,e){var r=this,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this.providers[t.layer.protocol];if(!i)throw new Error("No known provider for layer",t.layer.id);return e.execute(t,i,n?1:0).then((function(){if(t.view.notifyChange(t.requester,t.redraw),n&&r.flush(e,t.layer.id),n&&e.counters.executing<r.maxCommandsPerHost){var i=r.deQueue(e);i&&r.runCommand(i,e)}}))},y.prototype.execute=function(t){var e=t.layer,r=e.url?new URL(e.url,document.location).host:void 0;t.promise=new Promise((function(e,r){t.resolve=e,t.reject=r})),r&&!this.hostQueues.has(r)&&this.hostQueues.set(r,v());var n=r?this.hostQueues.get(r):this.defaultQueue;return x(t)?this.runCommand(t,n,!1):n.queue(t),this.executeNextForQueue(n),t.promise},y.prototype.flush=function(t,e){var r=this;if(e){for(var n=[],i=t.storages.get(e),a=0;a<i.q.priv.data.length;a++){var o=i.q.priv.data[a];x(o)&&(n.push(this.runCommand(o,t,!1)),i.q.priv.data.splice(a,1),i.q.length--,a--)}n.length&&Promise.all(n).then((function(){r.executeNextForQueue(t)}))}},y.prototype.executeNextForQueue=function(t){var e=this;t.counters.executing<this.maxCommandsPerHost&&Promise.resolve().then((function(){if(t.counters.executing<e.maxCommandsPerHost){var r=e.deQueue(t);r&&e.runCommand(r,t)}}))},y.prototype.addProtocolProvider=function(t,e){if("function"!=typeof e.executeCommand)throw new Error("Can't add provider for ".concat(t,": missing a executeCommand function."));if("function"!=typeof e.preprocessDataLayer)throw new Error("Can't add provider for ".concat(t,": missing a preprocessDataLayer function."));this.providers[t]=e},y.prototype.getProtocolProvider=function(t){return this.providers[t]},y.prototype.commandsWaitingExecutionCount=function(){var t,e=this.defaultQueue.counters.pending+this.defaultQueue.counters.executing,r=p(this.hostQueues);try{for(r.s();!(t=r.n()).done;){var n=t.value;e+=n[1].counters.pending+n[1].counters.executing}}catch(t){r.e(t)}finally{r.f()}return e},y.prototype.commandsRunningCount=function(){var t,e=this.defaultQueue.counters.executing,r=p(this.hostQueues);try{for(r.s();!(t=r.n()).done;){e+=t.value[1].counters.executing}}catch(t){r.e(t)}finally{r.f()}return e},y.prototype.resetCommandsCount=function(t){var e=this.defaultQueue.counters[t];this.defaultQueue.counters[t]=0;var r,n=p(this.hostQueues);try{for(n.s();!(r=n.n()).done;){var i=r.value;e+=i[1].counters[t],i[1].counters[t]=0}}catch(t){n.e(t)}finally{n.f()}return e},y.prototype.deQueue=function(t){for(var e=function(t){var e,r,n,i=0,a=p(t);try{for(a.s();!(n=a.n()).done;){var o=n.value[1];o.q.length>0&&(i+=o.priority,o.accumulator+=o.priority,(!e||o.accumulator>r)&&(e=o,r=o.accumulator))}}catch(t){a.e(t)}finally{a.f()}return e?(e.accumulator-=i,e.q):null}(t.storages);e&&e.length>0;){var r=e.dequeue();if(!r.earlyDropFunction||!r.earlyDropFunction(r))return r;t.counters.pending--,t.counters.cancelled++,r.reject(new d.default(r))}return e?this.deQueue(t):null};var _=y;return fS.default=_,fS}()),ID=dD(WM()),LD=dD(function(){if(sD)return lD;sD=1;var t=uf;Object.defineProperty(lD,"__esModule",{value:!0}),lD.default=void 0;var e=Bf,r=t(hD());function n(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){l=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function a(t,e,r){for(var n=e[t],i=arguments.length,a=new Array(i>3?i-3:0),o=3;o<i;o++)a[o-3]=arguments[o];return n?"function"==typeof n?n.apply(void 0,a):n:"function"==typeof r?r.apply(void 0,a):r}function o(){var t=new e.Color;return t.setHex(16777215*Math.random()),t}function s(t,r,n){for(var i=new Float32Array(3*t.flatCoordinates.length/t.stride),a=new Uint8Array(3*t.flatCoordinates.length),o=0;o<t.flatCoordinates.length/t.stride;o++){for(var s=0;s<t.stride;s++)i[3*o+s]=t.flatCoordinates[t.stride*o+s];2===t.stride&&(i[3*o+2]=Array.isArray(n)?n[o]:n)}!function(t,e,r,n,i,a){for(var o=a;o<a+e;++o)t[3*o]=r,t[3*o+1]=n,t[3*o+2]=i}(a,t.flatCoordinates.length,255*r.r,255*r.g,255*r.b,0);var l=new e.BufferGeometry;return l.setAttribute("position",new e.BufferAttribute(i,3)),l.setAttribute("color",new e.BufferAttribute(a,3,!0)),l.computeBoundingSphere(),l}function l(t,i){var l;switch(t.getGeometry().getType()){case"Point":case"MultiPoint":l=function(t,r,n){var i=a("altitude",n,0,r,t),l=a("color",n,o,t.getProperties()),u=s(t.getGeometry(),l,i);return new e.Points(u)}(t,t.properties,i);break;case"LineString":case"MultiLineString":l=function(t,r,n){var i=a("altitude",n,0,r,t),l=a("color",n,o,t.getProperties()),u=s(t.getGeometry(),l,i);return new e.Line(u)}(t,t.properties,i);break;case"Polygon":l=function(t,n,i){var l=a("altitude",i,0,t),u=a("color",i,o,t.getProperties()),c=t.getGeometry(),h=s(c,u,l),d=c.getEnds().map((function(t){return t/c.stride})),f=(0,r.default)(h.attributes.position.array,d.slice(0,-1),3);return h.setIndex(new e.BufferAttribute(new Uint16Array(f),1)),new e.Mesh(h)}(t,t.properties,i);break;case"MultiPolygon":l=function(t,i,l){var u,c=a("altitude",l,0,t),h=a("color",l,o,t.getProperties()),d=t.getGeometry(),f=s(d,h,c),p=[],m=0,g=function(t){return t+m},v=function(t){return t/d.stride-m},y=n(d.getEndss());try{for(y.s();!(u=y.n()).done;){var x=u.value,_=x[x.length-1]/d.stride,w=x.map(v),b=(0,r.default)(f.attributes.position.array.slice(3*m,3*_),w.slice(0,-1),3);p=p.concat(b.map(g)),m=_}}catch(t){y.e(t)}finally{y.f()}return f.setIndex(new e.BufferAttribute(new Uint16Array(p),1)),new e.Mesh(f)}(t,t.properties,i)}return l.material.vertexColors=!0,l.material.color=new e.Color(16777215),l.properties=t.properties,l}var u={convert:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(r){return r?function(t,r){if(!t||0===t.length)return null;if(1===t.length)return l(t[0],r);var i=new e.Group;i.minAltitude=1/0;var a,o=n(t);try{for(o.s();!(a=o.n()).done;){var s=l(a.value,r);i.add(s),i.minAltitude=Math.min(s.minAltitude,i.minAltitude)}}catch(t){o.e(t)}finally{o.f()}return i}(r,t):null}}};return lD.default=u,lD}()),OD=dD(LS());function DD(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(DD=function(t){return t?r:e})(t)}function kD(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==fD(t)&&"function"!=typeof t)return{default:t};var r=DD(e);if(r&&r.has(t))return r.get(t);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if("default"!==a&&Object.prototype.hasOwnProperty.call(t,a)){var o=i?Object.getOwnPropertyDescriptor(t,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=t[a]}return n.default=t,r&&r.set(t,n),n}function FD(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return ND(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ND(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function ND(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function UD(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=(0,_D.default)(t);if(e){var i=(0,_D.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,xD.default)(this,r)}}dD(rS());var BD={LAYERS_INITIALIZED:"layers-initialized"};lf.INSTANCE_EVENTS=BD;var zD=new wD.Vector2,GD=function(t){(0,yD.default)(r,t);var e=UD(r);function r(t){var n,i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((0,mD.default)(this,r),n=e.call(this),wD.Object3D.DefaultUp.set(0,0,1),!t)throw new Error("Invalid viewerDiv parameter (must non be null/undefined)");(n.referenceCrs=a.crs||"EPSG:3857",a.mainLoop)?n.mainLoop=a.mainLoop:(i=a.renderer&&a.renderer.domElement?new ED.default(a.renderer):new ED.default(t,a.renderer),n.mainLoop=new TD.default(new CD.default,i));return n.scene=a.scene3D||new wD.Scene,n.threeObjects=new wD.Group,n.scene.add(n.threeObjects),n.scene2D=new wD.Scene,a.scene3D||(n.scene.autoUpdate=!1),n.camera=new SD.default(n.referenceCrs,n.mainLoop.gfxEngine.getWindowSize().x,n.mainLoop.gfxEngine.getWindowSize().y,a),n._frameRequesters={},n._objects=[],window.addEventListener("resize",(function(){var e=t.getBoundingClientRect(),r=new wD.Vector2(e.width,e.height);n.mainLoop.gfxEngine.onWindowResize(r.x,r.y),n.notifyChange(n.camera.camera3D)}),!1),n._changeSources=new Set,n._delayedFrameRequesterRemoval=[],n._allLayersAreReadyCallback=function(){n.getObjects().every((function(t){return t.ready}))&&n.getLayers().every((function(t){return t.ready}))&&0===n.mainLoop.scheduler.commandsWaitingExecutionCount()&&n.mainLoop.renderingState===TD.RENDERING_PAUSED&&(n.dispatchEvent({type:BD.LAYERS_INITIALIZED}),n.removeFrameRequester(TD.MAIN_LOOP_EVENTS.UPDATE_END,n._allLayersAreReadyCallback))},n.controls=null,n._controlFunctions=null,Object.defineProperty((0,vD.default)(n),"domElement",{value:n.mainLoop.gfxEngine.renderer.domElement,writable:!1}),n}return(0,gD.default)(r,[{key:"add",value:function(t){var e=this;return t instanceof wD.Object3D||t instanceof PD.default?(t._instance=this,new Promise((function(r,n){if(t)if(e.getObjects((function(e){return e.id===t.id})).length>0)n(new Error("Invalid id '".concat(t.id,"': id already used")));else{var i=e.mainLoop.scheduler.getProtocolProvider(t.protocol);!t.protocol||i?(t=function(t,e,r,n){if(!(e instanceof RD.default||e instanceof PD.default)){var i=new RD.default(e.id),a=e;delete a.id,e=Object.assign(i,e),a.id=e.id}e.options=e.options||{},e.updateStrategy||(e.updateStrategy={type:AD.STRATEGY_MIN_NETWORK_TRAFFIC});r&&(r.tileInsideLimit&&(e.tileInsideLimit=r.tileInsideLimit.bind(r)),r.getPossibleTextureImprovements&&(e.getPossibleTextureImprovements=r.getPossibleTextureImprovements.bind(r)),r.tileTextureCount&&(e.tileTextureCount=r.tileTextureCount.bind(r)));if(!e.whenReady){e.object3d||(e.threejsLayer=t.mainLoop.gfxEngine.getUniqueThreejsLayer());var o=Promise.resolve();r&&r.preprocessDataLayer&&((o=r.preprocessDataLayer(e,t,t.mainLoop.scheduler,n))&&o.then||(o=Promise.resolve())),e.whenReady=o.then((function(){return e.ready=!0,e}))}return(0,RD.defineLayerProperty)(e,"visible",!0,(function(){return jD(e,t)})),(0,RD.defineLayerProperty)(e,"frozen",!1),jD(e,t),e}(e,t,i),t.projection||(t.projection=e.referenceCrs),e._objects.push(t),t.whenReady.then((function(t){if("function"==typeof t.update)if("function"==typeof t.preUpdate){t.object3d&&!t.object3d.parent&&t.object3d!==e.scene&&e.scene.add(t.object3d),e.notifyChange(t,!1);var i=e._frameRequesters[TD.MAIN_LOOP_EVENTS.UPDATE_END];i&&-1!==i.indexOf(e._allLayersAreReadyCallback)||e.addFrameRequester(TD.MAIN_LOOP_EVENTS.UPDATE_END,e._allLayersAreReadyCallback),r(t)}else n(new Error("Cant add Entity3D: missing a preUpdate function"));else n(new Error("Cant add Entity3D: missing a update function"))}))):n(new Error("".concat(t.protocol," is not a recognized protocol name.")))}else n(new Error("object is undefined"))}))):Promise.reject(new Error("object is not an instance of THREE.Object3D or Giro3d.Entity3D"))}},{key:"remove",value:function(t){t.object3d&&(OD.default.removeChildrenAndCleanupRecursively(t,t.object3d),this.scene.remove(t.object3d)),"function"==typeof t.clean&&t.clean(),this._objects.splice(this._objects.indexOf(t,1)),this.notifyChange(this.camera.camera3D,!0)}},{key:"addVector",value:function(t){var e=this;return new Promise((function(r){var n=t.getSource(),i=LD.default.convert({altitude:1});n.on("change",(function(){t.object3d&&(e.threeObjects.remove(t.object3d),t.object3d.traverse((function(t){t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose(),t.dispose()}))),t.object3d=i(n.getFeatures()),e.threeObjects.add(t.object3d),e.notifyChange(t.object3d,!0)})),n.getFeatures().length>0?(t.object3d=i(n.getFeatures()),e.threeObjects.add(t.object3d),e.notifyChange(t.object3d,!0),r(t)):(n.once("change",(function(){return r(t)})),n.loadFeatures([-1/0,-1/0,1/0,1/0],void 0,e.referenceCrs))}))}},{key:"notifyChange",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&this._changeSources.add(t),this.mainLoop.scheduleUpdate(this,e)}},{key:"getObjects",value:function(t){var e,r=[],n=FD(this._objects);try{for(n.s();!(e=n.n()).done;){var i=e.value;t&&!t(i)||r.push(i)}}catch(t){n.e(t)}finally{n.f()}return r}},{key:"getLayers",value:function(t){var e,r=[],n=FD(this._objects);try{for(n.s();!(e=n.n()).done;){var i=e.value;r=r.concat(i.getLayers(t))}}catch(t){n.e(t)}finally{n.f()}return r}},{key:"getOwner",value:function(t){var e,r=FD(this._objects);try{for(r.s();!(e=r.n()).done;){var n,i=e.value,a=FD(i._attachedLayers);try{for(a.s();!(n=a.n()).done;){if(n.value===t)return i}}catch(t){a.e(t)}finally{a.f()}}}catch(t){r.e(t)}finally{r.f()}return null}},{key:"addFrameRequester",value:function(t,e){if("function"!=typeof e)throw new Error("frameRequester must be a function");this._frameRequesters[t]?this._frameRequesters[t].push(e):this._frameRequesters[t]=[e]}},{key:"removeFrameRequester",value:function(t,e){this._frameRequesters[t].indexOf(e)>=0?this._delayedFrameRequesterRemoval.push({when:t,frameRequester:e}):console.error("Invalid call to removeFrameRequester: frameRequester isn't registered")}},{key:"_executeFrameRequestersRemovals",value:function(){var t,e=FD(this._delayedFrameRequesterRemoval);try{for(e.s();!(t=e.n()).done;){var r=t.value,n=this._frameRequesters[r.when].indexOf(r.frameRequester);n>=0?this._frameRequesters[r.when].splice(n,1):console.warn("FrameReq has already been removed")}}catch(t){e.e(t)}finally{e.f()}this._delayedFrameRequesterRemoval.length=0}},{key:"execFrameRequesters",value:function(t,e,r){if(this._frameRequesters[t]){this._delayedFrameRequesterRemoval.length>0&&this._executeFrameRequestersRemovals();for(var n=arguments.length,i=new Array(n>3?n-3:0),a=3;a<n;a++)i[a-3]=arguments[a];var o,s=FD(this._frameRequesters[t]);try{for(s.s();!(o=s.n()).done;){var l=o.value;l.update?l.update(e,r,i):l(e,r,i)}}catch(t){s.e(t)}finally{s.f()}}}},{key:"eventToViewCoords",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(void 0===t.touches||!t.touches.length)return zD.set(t.offsetX,t.offsetY);var r=this.mainLoop.gfxEngine.renderer.domElement.getBoundingClientRect();return zD.set(t.touches[e].clientX-r.x,t.touches[e].clientY-r.y)}},{key:"eventToNormalizedCoords",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.viewToNormalizedCoords(this.eventToViewCoords(t,e))}},{key:"viewToNormalizedCoords",value:function(t){return zD.x=t.x/this.camera.width*2-1,zD.y=t.y/this.camera.height*-2+1,zD}},{key:"normalizedToViewCoords",value:function(t){return zD.x=.5*(t.x+1)*this.camera.width,zD.y=-.5*(t.y-1)*this.camera.height,zD}},{key:"pickObjectsAt",value:function(t,e){for(var r=[],n=arguments.length,i=new Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];var o=0===i.length?this.getObjects().concat(this.threeObjects):[].concat(i),s=t instanceof Event?this.eventToViewCoords(t):t;e=e||0;var l,u=FD(o);try{for(u.s();!(l=u.n()).done;){var c=l.value;if(c instanceof PD.default||c instanceof RD.default||"string"==typeof c)for(var h=("string"==typeof c?VD(this,c):c).pickObjectsAt(this,s,e),d=0;d<h.length;d++)r.push(h[d]);else{if(!c.isObject3D)throw new Error("Invalid where arg (value = ".concat(i,"). Expected layers, layer ids or Object3Ds"));ID.default.pickObjectsAt(this,s,e,c,r)}}}catch(t){u.e(t)}finally{u.f()}return r}},{key:"focusObject",value:function(t){if(t instanceof Map){var e=t.extent.dimensions(),r=t.extent.center().clone();r._values[2]=Math.max(e.x,e.y);var n=r.xyz();n.z=0,this.camera.camera3D.position.copy(r.xyz()),this.camera.camera3D.lookAt(n),this.camera.camera3D.updateMatrixWorld(!0)}}},{key:"useTHREEControls",value:function(t){var e=this;if(!this.controls){if(this._controlFunctions={frameRequester:function(){return t.update()},eventListener:function(){return e.notifyChange(e.camera.camera3D)}},"function"!=typeof t.addEventListener)throw new Error("Unsupported control class: only event dispatcher controls are supported.");t.addEventListener("change",this._controlFunctions.eventListener),this.addFrameRequester("before_camera_update",this._controlFunctions.frameRequester),this.controls=t}}},{key:"removeTHREEControls",value:function(){this.controls&&(this.controls.removeEventListener("change",this._controlFunctions.eventListener),this.removeFrameRequester("before_camera_update",this._controlFunctions.frameRequester),this.controls=null,this._controlFunctions=null)}}],[{key:"registerCRS",value:function(t,e){if(!t||""===t)throw new Error("missing CRS name");if(!e||""===e)throw new Error("missing CRS PROJ string");bD.default.defs(t,e),(0,MD.register)(bD.default)}}]),r}(wD.EventDispatcher),jD=function(t,e){t.object3d&&(t.object3d.visible=t.visible),t.threejsLayer&&(t.visible?e.camera.camera3D.layers.enable(t.threejsLayer):e.camera.camera3D.layers.disable(t.threejsLayer))};function VD(t,e){var r=t.getObjects((function(t){return t.id===e}));if(!r.length)throw new Error("Invalid layer id used as where argument (value = ".concat(e,")"));return r[0]}var HD=GD;pD=lf.default=HD;var WD={},qD=uf;Object.defineProperty(WD,"__esModule",{value:!0});var XD=WD.default=void 0,YD=qD(yf()),ZD=qD(pf()),KD=(0,YD.default)((function t(e,r){(0,ZD.default)(this,t),this.url=e,this.networkOptions=r}));XD=WD.default=KD;const JD={class:"bimdata-giro3d"},QD=["id"];const $D={name:"Giro3dPlugin",component:((t,e)=>{const r=t.__vccOpts||t;for(const[t,n]of e)r[t]=n;return r})({name:"giro3d",data:()=>({loadedModelIds:[],modelPointClouds:new Map,giro3dDivId:null}),created(){this.giro3dDivId=`3d-engine-${this.$viewer.globalContext.plugins.id}`,this.localContextResizeSubscription=this.$viewer.globalContext.hub.on("context-resize",this.onResize)},unmounted(){this.$viewer.globalContext.hub.off(this.localContextResizeSubscription)},async mounted(){const t=document.getElementById(this.giro3dDivId);await this.$nextTick();const e=new pD(t,{renderer:{clearColor:!1}}),r=new nf(e.camera.camera3D,e.domElement);r.enableDamping=!0,r.dampingFactor=.25,e.useTHREEControls(r),e.notifyChange(e.camera.camera3D),this.instance=e,this.controls=r},methods:{onResize({width:t,height:e}){this.instance&&(this.instance.mainLoop.gfxEngine.onWindowResize(t,e),this.instance.notifyChange(this.instance.camera.camera3D))},placeCamera(t,e){const{instance:r,controls:n}=this;r.camera.camera3D.position.set(t.x,t.y,t.z),r.camera.camera3D.lookAt(e),n.target.copy(e)},initializeCamera(t){const e=new Sr,r=t.root.bbox?t.root.bbox:t.root.boundingVolume.box.clone().applyMatrix4(t.root.matrixWorld);this.instance.camera.camera3D.far=2*r.getSize(e).length();const n=r.getSize(e).x/r.getSize(e).z,i=r.min.clone().add(r.getSize(e).multiply({x:0,y:0,z:.5*n})),a=r.getCenter(e);a.z=r.min.z,this.placeCamera(i,a)},async loadModels(t){this.loadedModelIds.push(...t.map((t=>t.id)).filter((t=>!this.loadedModelIds.includes(t)))),t.forEach((async(t,e)=>{const{apiUrl:r,cloudId:n,projectId:i,accessToken:a}=this.$viewer.api,o=await fetch(`${r}/cloud/${n}/project/${i}/model/${t.id}/tileset?tile_format=pnts`,{headers:new Headers({accept:"*/*",Authorization:`Bearer ${a}`})}),s=URL.createObjectURL(await o.blob()),l=new EE("pointcloud",new XD(s));this.modelPointClouds.set(t,l),await this.instance.add(l),URL.revokeObjectURL(s),0===e&&this.initializeCamera(l)}))},async unloadModels(t){const e=t.map((t=>this.modelPointClouds.get(t))).filter(Boolean);t.forEach((t=>this.modelPointClouds.delete(t))),e.forEach((t=>{this.instance.remove(t)}));const r=t.map((t=>t.id));this.loadedModelIds=this.loadedModelIds.filter((t=>!r.includes(t)))}}},[["render",function(t,e,r,n,i,a){const o=BIMDataViewerVue.resolveComponent("NoModelWindowPlaceHolder"),s=BIMDataViewerVue.resolveComponent("ModelsLoader");return BIMDataViewerVue.openBlock(),BIMDataViewerVue.createElementBlock("div",JD,[0!==i.loadedModelIds.length||t.loading?BIMDataViewerVue.createCommentVNode("",!0):(BIMDataViewerVue.openBlock(),BIMDataViewerVue.createBlock(o,{key:0})),BIMDataViewerVue.createVNode(s,{types:["POINT_CLOUD"],onLoadModels:a.loadModels,onUnloadModels:a.unloadModels,preview:""},null,8,["onLoadModels","onUnloadModels"]),BIMDataViewerVue.createElementVNode("div",{id:i.giro3dDivId,class:"bimdata-giro3d__viewer"},null,8,QD)])}],["__scopeId","data-v-fd5ecc76"]]),window:{name:"giro3d",label:"Giro3dPlugin.window_label",plugins:["fullscreen"]},i18n:{en:{window_label:"Giro3d"},fr:{window_label:"Giro3d"}}};export{$D as default};